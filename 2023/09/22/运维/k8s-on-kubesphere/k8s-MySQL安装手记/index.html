<!DOCTYPE html>
<html lang="zh-CN">
    <!-- title -->


    

<!-- keywords -->



<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="author" content="Arcticsea">
    <meta name="renderer" content="webkit">
    <meta name="copyright" content="Arcticsea">
    
        <meta name="keywords" content="hexo,hexo-theme,hexo-blog">
    
    <meta name="description" content="ctf teclo blog">
    <meta name="description" content="基于 KubeSphere 玩转 k8s-MySQL 安装手记大家好，我是老 Z！  本系列文档是我在云原生技术领域的学习和运维实践的手记，用输出倒逼输入是一种高效的学习方法，能够快速积累经验和提高技术，只有把学到的知识写出来并能够让其他人理解，才能说明真正掌握了这项知识。 如果你喜欢本文，请分享给你的小伙伴！  本系列文档内容涵盖 (但不限于) 以下技术领域：   KubeSphere  Kub">
<meta property="og:type" content="article">
<meta property="og:title" content="k8s-MySQL 安装手记">
<meta property="og:url" content="https://lhhxs.github.io/2023/09/22/%E8%BF%90%E7%BB%B4/k8s-on-kubesphere/k8s-MySQL%E5%AE%89%E8%A3%85%E6%89%8B%E8%AE%B0/index.html">
<meta property="og:site_name" content="北极海的博客空间">
<meta property="og:description" content="基于 KubeSphere 玩转 k8s-MySQL 安装手记大家好，我是老 Z！  本系列文档是我在云原生技术领域的学习和运维实践的手记，用输出倒逼输入是一种高效的学习方法，能够快速积累经验和提高技术，只有把学到的知识写出来并能够让其他人理解，才能说明真正掌握了这项知识。 如果你喜欢本文，请分享给你的小伙伴！  本系列文档内容涵盖 (但不限于) 以下技术领域：   KubeSphere  Kub">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/image-20220509141222130.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/image-20220509142153500.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-lstack-login.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-workspace-lstack.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-overview.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-0.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-1.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-2.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-3.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-4.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-5.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-6.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-7.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-8.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-9.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-10.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-11.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-12.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-13.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-14.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-15.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-16.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-17.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-18.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-19.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-20.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-21.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-22.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-23.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-24.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-25.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-26.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-27.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-28.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-29.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-30.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-31.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-32.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-33.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-34.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-35.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-36.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-37.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-38.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-39.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-40.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-41.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-42.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-43.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-44.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-45.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-46.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-47.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-48.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-49.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-50.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-51.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-52.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-53.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-54.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-55.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-56.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-57.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-58.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-59.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-60.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-61.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-62.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-63.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-64.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-65.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-66.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-67.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-70.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-71.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-72.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-73.png">
<meta property="og:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-74.png">
<meta property="article:published_time" content="2023-09-22T01:38:09.274Z">
<meta property="article:modified_time" content="2023-09-22T01:42:58.861Z">
<meta property="article:author" content="Arcticsea">
<meta property="article:tag" content="k8s">
<meta property="article:tag" content="kubesphere">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/image-20220509141222130.png">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link rel="icon" href="/assets/favicon.ico">
    
    <title>k8s-MySQL 安装手记 · arcticsea的博客空间</title>
    <!-- /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
/* This file is meant as a standalone workflow for
- testing support for link[rel=preload]
- enabling async CSS loading in browsers that do not support rel=preload
- applying rel preload css once loaded, whether supported or not.
*/ -->
<script>
    (function (w) {
        'use strict'
        // rel=preload support test
        if (!w.loadCSS) {
            w.loadCSS = function () {}
        }
        // define on the loadCSS obj
        var rp = (loadCSS.relpreload = {})
        // rel=preload feature support test
        // runs once and returns a function for compat purposes
        rp.support = (function () {
            var ret
            try {
                ret = w.document.createElement('link').relList.supports('preload')
            } catch (e) {
                ret = false
            }
            return function () {
                return ret
            }
        })()

        // if preload isn't supported, get an asynchronous load by using a non-matching media attribute
        // then change that media back to its intended value on load
        rp.bindMediaToggle = function (link) {
            // remember existing media attr for ultimate state, or default to 'all'
            var finalMedia = link.media || 'all'

            function enableStylesheet() {
                link.media = finalMedia
            }

            // bind load handlers to enable media
            if (link.addEventListener) {
                link.addEventListener('load', enableStylesheet)
            } else if (link.attachEvent) {
                link.attachEvent('onload', enableStylesheet)
            }

            // Set rel and non-applicable media type to start an async request
            // note: timeout allows this to happen async to let rendering continue in IE
            setTimeout(function () {
                link.rel = 'stylesheet'
                link.media = 'only x'
            })
            // also enable media after 3 seconds,
            // which will catch very old browsers (android 2.x, old firefox) that don't support onload on link
            setTimeout(enableStylesheet, 3000)
        }

        // loop through link elements in DOM
        rp.poly = function () {
            // double check this to prevent external calls from running
            if (rp.support()) {
                return
            }
            var links = w.document.getElementsByTagName('link')
            for (var i = 0; i < links.length; i++) {
                var link = links[i]
                // qualify links to those with rel=preload and as=style attrs
                if (
                    link.rel === 'preload' &&
                    link.getAttribute('as') === 'style' &&
                    !link.getAttribute('data-loadcss')
                ) {
                    // prevent rerunning on link
                    link.setAttribute('data-loadcss', true)
                    // bind listeners to toggle media back
                    rp.bindMediaToggle(link)
                }
            }
        }

        // if unsupported, run the polyfill
        if (!rp.support()) {
            // run once at least
            rp.poly()

            // rerun poly on an interval until onload
            var run = w.setInterval(rp.poly, 500)
            if (w.addEventListener) {
                w.addEventListener('load', function () {
                    rp.poly()
                    w.clearInterval(run)
                })
            } else if (w.attachEvent) {
                w.attachEvent('onload', function () {
                    rp.poly()
                    w.clearInterval(run)
                })
            }
        }

        // commonjs
        if (typeof exports !== 'undefined') {
            exports.loadCSS = loadCSS
        } else {
            w.loadCSS = loadCSS
        }
    })(typeof global !== 'undefined' ? global : this)
</script>

    <style type="text/css">
    @font-face {
        font-family: 'Oswald-Regular';
        src: url("/font/Oswald-Regular.ttf");
    }

    body {
        margin: 0;
    }

    header,
    footer,
    .back-top,
    .sidebar,
    .container,
    .site-intro-meta,
    .toc-wrapper {
        display: none;
    }

    .site-intro {
        position: relative;
        z-index: 3;
        width: 100%;
        /* height: 50vh; */
        overflow: hidden;
    }

    .site-intro-placeholder {
        position: absolute;
        z-index: -2;
        top: 0;
        left: 0;
        width: calc(100% + 300px);
        height: 100%;
        background: repeating-linear-gradient(-45deg, #444 0, #444 80px, #333 80px, #333 160px);
        background-position: center center;
        transform: translate3d(-226px, 0, 0);
        animation: gradient-move 2.5s ease-out 0s infinite;
    }

    @keyframes gradient-move {
        0% {
            transform: translate3d(-226px, 0, 0);
        }
        100% {
            transform: translate3d(0, 0, 0);
        }
    }
</style>

    <link rel="preload" href="/css/style.css?v=20211217" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="/css/dark.css?v=20211217" as="style">
    <link rel="stylesheet" href="/css/dark.css">
    <link rel="stylesheet" href="/css/mobile.css?v=20211217" media="(max-width: 960px)">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" as="script">
    <link rel="preload" href="/scripts/main.js?v=20211217" as="script">
    <link rel="preload" href="/scripts/dark.js?v=20211217" as="script">
    <link rel="preload" href="/font/Oswald-Regular.ttf" as="font" crossorigin>
    <link rel="preload" href="https://at.alicdn.com/t/font_327081_1dta1rlogw17zaor.woff" as="font" crossorigin>
    <!-- algolia -->
    
    <!-- 百度统计  -->
    
    <!-- 谷歌统计  -->
    
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="北极海的博客空间" type="application/atom+xml">
</head>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script type="text/javascript">
        if (typeof window.$ == undefined) {
            console.warn('jquery load from jsdelivr failed, will load local script')
            document.write('<script src="/lib/jquery.min.js" />')
        }
    </script>
    
        <body class="post-body">
    
        <!-- header -->
        <header class="header header-mobile">
    <!-- top read progress line -->
    <div class="header-element">
        <div class="read-progress"></div>
    </div>
    <!-- sidebar menu button -->
    <div class="header-element">
        
            <div class="header-sidebar-menu">
        
            
                <div style="padding-left: 1px;">&#xe775;</div>
            
        </div>
    </div>
    <!-- header actions -->
    <div class="header-actions">
        <!-- theme mode switch button -->
        <span class="header-theme-btn header-element">
            <i class="fas fa-adjust"></i>
        </span>
        <!-- back to home page text -->
        <span class="home-link header-element">
            <a href=/>arcticsea's blog zone</a>
        </span>
    </div>
    <!-- toggle banner for post layout -->
    
        
            <div class="banner">
        
            <div class="blog-title header-element">
                <a href="/">arcticsea&#39;s blog zone</a>
            </div>
            <div class="post-title header-element">
                <a href="#" class="post-name">k8s-MySQL 安装手记</a>
            </div>
        </div>
    
</header>

        <!-- fixed footer -->
        <footer class="footer-fixed">
    <!-- back to top button -->
    <div class="footer-fixed-element">
        
            <div class="back-top back-top-hidden">
        
        
            <div>&#xe639;</div>
        
        </div>
    </div>
</footer>

        <!-- wrapper -->
        <div class="wrapper">
            <div class="site-intro" style="







    height:50vh;

">
    
    <!-- 主页  -->
    
        
    <!-- 404页  -->
            
    <div class="site-intro-placeholder"></div>
    <div class="site-intro-img" style="background-image: url(/intro/post-bg.jpg)"></div>
    <div class="site-intro-meta">
        <!-- 标题  -->
        <h1 class="intro-title">
            <!-- 主页  -->
            
                k8s-MySQL 安装手记
            <!-- 404 -->
            
        </h1>
        <!-- 副标题 -->
        <p class="intro-subtitle">
            <!-- 主页副标题  -->
            
                
            <!-- 404 -->
            
        </p>
        <!-- 文章页 meta -->
        
            <div class="post-intros">
                <!-- 文章页标签  -->
                
                    <div class= post-intro-tags >
    
    
        <a class="post-tag" href="javascript:void(0);" data-tags="k8s">k8s</a>
    
        <a class="post-tag" href="javascript:void(0);" data-tags="kubesphere">kubesphere</a>
    
</div>

                
                
                    <div class="post-intro-read">
                        <span>字数统计: <span class="post-count word-count">18.2k</span>阅读时长: <span class="post-count reading-time">93 min</span></span>
                    </div>
                
                <div class="post-intro-meta">
                    <!-- 撰写日期 -->
                    <span class="iconfont-archer post-intro-calander">&#xe676;</span>
                    <span class="post-intro-time">2023/09/22</span>
                    <!-- busuanzi -->
                    
                        <span id="busuanzi_container_page_pv" class="busuanzi-pv">
                            <span class="iconfont-archer post-intro-busuanzi">&#xe602;</span>
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    
                    <!-- 文章分享 -->
                    <span class="share-wrapper">
                        <span class="iconfont-archer share-icon">&#xe71d;</span>
                        <span class="share-text">Share</span>
                        <ul class="share-list">
                            <li class="iconfont-archer share-qr" data-type="qr">&#xe75b;
                                <div class="share-qrcode"></div>
                            </li>
                            <li class="iconfont-archer" data-type="weibo">&#xe619;</li>
                            <li class="iconfont-archer" data-type="qzone">&#xe62e;</li>
                            <li class="iconfont-archer" data-type="twitter">&#xe634;</li>
                            <li class="iconfont-archer" data-type="facebook">&#xe67a;</li>
                        </ul>
                    </span>
                </div>
            </div>
        
    </div>
</div>

            <script>
  // get user agent
  function getBrowserVersions() {
    var u = window.navigator.userAgent
    return {
      userAgent: u,
      trident: u.indexOf('Trident') > -1, //IE内核
      presto: u.indexOf('Presto') > -1, //opera内核
      webKit: u.indexOf('AppleWebKit') > -1, //苹果、谷歌内核
      gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') == -1, //火狐内核
      mobile: !!u.match(/AppleWebKit.*Mobile.*/), //是否为移动终端
      ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
      android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或者uc浏览器
      iPhone: u.indexOf('iPhone') > -1 || u.indexOf('Mac') > -1, //是否为iPhone或者安卓QQ浏览器
      iPad: u.indexOf('iPad') > -1, //是否为iPad
      webApp: u.indexOf('Safari') == -1, //是否为web应用程序，没有头部与底部
      weixin: u.indexOf('MicroMessenger') == -1, //是否为微信浏览器
      uc: u.indexOf('UCBrowser') > -1, //是否为android下的UC浏览器
    }
  }
  var browser = {
    versions: getBrowserVersions(),
  }
  console.log('userAgent: ' + browser.versions.userAgent)

  // callback
  function fontLoaded() {
    console.log('font loaded')
    if (document.getElementsByClassName('site-intro-meta')) {
      document
        .getElementsByClassName('intro-title')[0]
        .classList.add('intro-fade-in')
      document
        .getElementsByClassName('intro-subtitle')[0]
        .classList.add('intro-fade-in')
      var postIntros = document.getElementsByClassName('post-intros')[0]
      if (postIntros) {
        postIntros.classList.add('post-fade-in')
      }
    }
  }

  // UC不支持跨域，所以直接显示
  function asyncCb() {
    if (browser.versions.uc) {
      console.log('UCBrowser')
      fontLoaded()
    } else {
      WebFont.load({
        custom: {
          families: ['Oswald-Regular'],
        },
        loading: function () {
          // 所有字体开始加载
          // console.log('font loading');
        },
        active: function () {
          // 所有字体已渲染
          fontLoaded()
        },
        inactive: function () {
          // 字体预加载失败，无效字体或浏览器不支持加载
          console.log('inactive: timeout')
          fontLoaded()
        },
        timeout: 5000, // Set the timeout to two seconds
      })
    }
  }

  function asyncErr() {
    console.warn('script load from CDN failed, will load local script')
  }

  // load webfont-loader async, and add callback function
  function async(u, cb, err) {
    var d = document,
      t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0]
    o.src = u
    if (cb) {
      o.addEventListener(
        'load',
        function (e) {
          cb(null, e)
        },
        false
      )
    }
    if (err) {
      o.addEventListener(
        'error',
        function (e) {
          err(null, e)
        },
        false
      )
    }
    s.parentNode.insertBefore(o, s)
  }

  var asyncLoadWithFallBack = function (arr, success, reject) {
    var currReject = function () {
      reject()
      arr.shift()
      if (arr.length) async(arr[0], success, currReject)
    }

    async(arr[0], success, currReject)
  }

  asyncLoadWithFallBack(
    [
      'https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js',
      'https://cdn.bootcss.com/webfont/1.6.28/webfontloader.js',
      "/lib/webfontloader.min.js",
    ],
    asyncCb,
    asyncErr
  )
</script>

            <img class="loading" src="/assets/loading.svg" style="display: block; margin: 6rem auto 0 auto; width: 6rem; height: 6rem;" />
            <div class="container container-unloaded">
                <main class="main post-page">
    <article class="article-entry">
        <h1 id="基于-KubeSphere-玩转-k8s-MySQL-安装手记"><a href="#基于-KubeSphere-玩转-k8s-MySQL-安装手记" class="headerlink" title="基于 KubeSphere 玩转 k8s-MySQL 安装手记"></a>基于 KubeSphere 玩转 k8s-MySQL 安装手记</h1><p><strong>大家好，我是老 Z！</strong></p>
<blockquote>
<p>本系列文档是我在云原生技术领域的学习和运维实践的手记，<strong>用输出倒逼输入</strong>是一种高效的学习方法，能够快速积累经验和提高技术，只有把学到的知识写出来并能够让其他人理解，才能说明真正掌握了这项知识。</p>
<p>如果你喜欢本文，请分享给你的小伙伴！</p>
</blockquote>
<p><strong>本系列文档内容涵盖 (但不限于) 以下技术领域：</strong></p>
<blockquote>
<ul>
<li><p><strong>KubeSphere</strong></p>
</li>
<li><p><strong>Kubernetes</strong></p>
</li>
<li><p><strong>Ansible</strong></p>
</li>
<li><p><strong>自动化运维</strong></p>
</li>
<li><p><strong>CNCF 技术栈</strong></p>
</li>
</ul>
</blockquote>
<h2 id="1-本文简介"><a href="#1-本文简介" class="headerlink" title="1. 本文简介"></a>1. 本文简介</h2><p>本文实现了 MySQL 数据库在基于 KubeSphere 部署的 Kubernetes 集群上的安装部署，部署方式采用了图形化和手写 YAML 文件两种形式。部署过程涉及的所有 YAML 文件都会使用 Git 进行版本管理，并存放在 Git 仓库中。因此，本文还会涉及 GitOps 的基础操作。</p>
<p>本文部署的 MySQL 选择了比较保守的 5.7 系列，其他版本可能会有不同。本文的操作仅适用于小规模数据量且对可靠性和性能要求不高的数据库使用场景，例如开发测试环境、例如我生产环境的 Nacos 服务。生产环境或是重要的数据库个人不建议将数据放到 K8S 上，优先采用云服务商提供的 RDS，其次自己利用虚拟机搭建 MySQL 主从或是 Galera Cluster，且一定做好备份方案。</p>
<p>  <strong>数据库的可靠性、可用性是运维的重中之重，不容忽视，切记！！！</strong></p>
<blockquote>
<p><strong>本文知识量</strong></p>
</blockquote>
<ul>
<li>阅读时长：40 分</li>
<li>行：2646</li>
<li>单词：15535</li>
<li>字符：110805</li>
<li>图片：80 张</li>
</ul>
<blockquote>
<p><strong>本文知识点</strong></p>
</blockquote>
<ul>
<li>定级：<strong>入门级</strong></li>
<li>单节点 MySQL 在 Kubernetes 上的安装配置</li>
<li>KubeSphere 图形化部署工作负载</li>
<li>GitOps 入门</li>
<li>Git 常用操作</li>
<li>配置代码如何实现在 GitHub 和 Gitee 保持同步</li>
<li>MySQL 性能测试基础</li>
<li>运维思想、思路</li>
</ul>
<blockquote>
<p><strong>演示服务器配置</strong></p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">主机名</th>
<th align="center">操作系统</th>
<th align="center">IP</th>
<th align="center">CPU</th>
<th align="center">内存</th>
<th align="center">系统盘</th>
<th align="center">数据盘</th>
<th align="center">用途</th>
</tr>
</thead>
<tbody><tr>
<td align="center">zdeops-master</td>
<td align="center">CentOS-7.9-x86_64</td>
<td align="center">192.168.9.9</td>
<td align="center">2</td>
<td align="center">4</td>
<td align="center">40</td>
<td align="center">200</td>
<td align="center">Ansible 运维控制节点</td>
</tr>
<tr>
<td align="center">ks-k8s-master-0</td>
<td align="center">CentOS-7.9-x86_64</td>
<td align="center">192.168.9.91</td>
<td align="center">8</td>
<td align="center">32</td>
<td align="center">40</td>
<td align="center">200</td>
<td align="center">KubeSphere&#x2F;k8s-master&#x2F;k8s-worker</td>
</tr>
<tr>
<td align="center">ks-k8s-master-1</td>
<td align="center">CentOS-7.9-x86_64</td>
<td align="center">192.168.9.92</td>
<td align="center">8</td>
<td align="center">32</td>
<td align="center">40</td>
<td align="center">200</td>
<td align="center">KubeSphere&#x2F;k8s-master&#x2F;k8s-worker</td>
</tr>
<tr>
<td align="center">ks-k8s-master-2</td>
<td align="center">CentOS-7.9-x86_64</td>
<td align="center">192.168.9.93</td>
<td align="center">8</td>
<td align="center">32</td>
<td align="center">40</td>
<td align="center">200</td>
<td align="center">KubeSphere&#x2F;k8s-master&#x2F;k8s-worker</td>
</tr>
<tr>
<td align="center">glusterfs-node-0</td>
<td align="center">CentOS-7.9-x86_64</td>
<td align="center">192.168.9.95</td>
<td align="center">4</td>
<td align="center">8</td>
<td align="center">40</td>
<td align="center">200</td>
<td align="center">GlusterFS&#x2F;Elasticsearch</td>
</tr>
<tr>
<td align="center">glusterfs-node-1</td>
<td align="center"></td>
<td align="center">192.168.9.96</td>
<td align="center">4</td>
<td align="center">8</td>
<td align="center">40</td>
<td align="center">200</td>
<td align="center">GlusterFS&#x2F;Elasticsearch</td>
</tr>
<tr>
<td align="center">glusterfs-node-2</td>
<td align="center">CentOS-7.9-x86_64</td>
<td align="center">192.168.9.97</td>
<td align="center">4</td>
<td align="center">8</td>
<td align="center">40</td>
<td align="center">200</td>
<td align="center">GlusterFS&#x2F;Elasticsearch</td>
</tr>
</tbody></table>
<hr>
<h2 id="2-MySQL-安装之旅"><a href="#2-MySQL-安装之旅" class="headerlink" title="2. MySQL 安装之旅"></a>2. MySQL 安装之旅</h2><h3 id="2-1-寻找参考文档"><a href="#2-1-寻找参考文档" class="headerlink" title="2.1. 寻找参考文档"></a>2.1. 寻找参考文档</h3><blockquote>
<p><strong>01-我个人查找参考文档习惯的的寻找路径</strong></p>
</blockquote>
<ul>
<li><strong>官方网站</strong>-精准定位<ul>
<li>官网有时没有相关文档、或是文档不够详细</li>
<li>英文文档、阅读困难</li>
</ul>
</li>
<li><strong>搜索关键字</strong>-大海捞针<ul>
<li>CSDN</li>
<li>博客园</li>
<li>某个人博客</li>
<li>问答网站</li>
<li>其他</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>02-打开 <a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/">MySQL 官方网站</a></strong></p>
</blockquote>
<p>选择 <strong>MySQL5.7</strong> 版本的 Reference Manual。</p>
<p><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/image-20220509141222130.png" alt="image-20220509141222130"></p>
<p>在 <strong>Installing MySQL on Linux</strong> 章节中，搜寻一番，发现在**<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/linux-installation-docker.html">Deploying MySQL on Linux with Docker</a>**小节下两篇具有参考价值的文档，先去看看。</p>
<p><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/image-20220509142153500.png" alt="image-20220509142153500"></p>
<p>浏览完以后你会发现，只是学会了利用 Docker Image 安装 MySQL 的基本方法，细节不上图了。</p>
<p>虽然官方没有提到如何在 K8S 上部署 MySQL，但是我已经有 Docker 和 K8S 的基础知识了，先不去进行搜索吃别人的了，自己尝试在 K8S 上部署一个单节点的 MySQL。</p>
<h3 id="2-2-尝试部署单节点-MySQL"><a href="#2-2-尝试部署单节点-MySQL" class="headerlink" title="2.2. 尝试部署单节点 MySQL"></a>2.2. 尝试部署单节点 MySQL</h3><blockquote>
<p><strong>01-先梳理一下思路，部署一个 MySQL 我们需要准备哪些资源</strong></p>
</blockquote>
<ul>
<li>在 DockerHub 获取 MySQL 镜像。</li>
<li>查看 MySQL 镜像说明，确定安装初始化参数。</li>
<li>MySQL 属于有状态服务，所以我们需要定义 StatefulSet 类型的资源。</li>
<li>编写 StatefulSet 类型的 MySQL 资源定义文件-YAML。</li>
</ul>
<blockquote>
<p><strong>02-查看官方镜像说明，确定初始化参数</strong></p>
</blockquote>
<p><strong>如果之前有 Docker 部署 MySQL 的经验，这一步就很简单了，直接把参数配置搬过来就行。</strong> </p>
<p>打开 <a target="_blank" rel="noopener" href="https://hub.docker.com,搜索/">https://hub.docker.com，搜索</a> mysql。</p>
<p>搜索结果中会有很多的 mysql，我重点关注了两个镜像。</p>
<ul>
<li>Docker 官方维护的 <a target="_blank" rel="noopener" href="https://hub.docker.com/_/mysql">mysql 仓库</a></li>
<li>Oracle 的 MySQL 团队维护的 <a target="_blank" rel="noopener" href="https://hub.docker.com/r/mysql/mysql-server">mysql 仓库</a></li>
</ul>
<p>本次实验我使用了 Docker 官方维护的仓库，进入 MySQL 仓库页面。</p>
<p>大概浏览一遍，确认了几个必须要配置的地方（确定过程需要经验和技术积累）。</p>
<ul>
<li><p>镜像：<strong>mysql:5.7.38</strong></p>
</li>
<li><p>root 密码：<strong>MYSQL_ROOT_PASSWORD</strong></p>
</li>
<li><p>数据持久化存储目录：**&#x2F;var&#x2F;lib&#x2F;mysql**</p>
</li>
</ul>
<blockquote>
<p><strong>03-利用 KubeSphere 部署 MySQL(V1 版)</strong></p>
</blockquote>
<p>确定了初始化的参数，接下来就开始部署 MySQL。</p>
<p>按 K8S 常规套路编写资源定义 YAML 文件？NO！我现在是小白，手写配置文件太高端了，还不适合我。</p>
<p>我们这里投机取巧一下，利用 KubeSphere 的图形化操作一波，这样可以保证部署的一次成功率(还有一个隐藏的好处，先卖个关子)。</p>
<p>使用<strong>企业空间管理员</strong>权限的账户，登录 KubeSphere 控制台。</p>
<p><strong>这一步没有使用 admin 用户，采用多租户户形式，模拟真实的生产环境</strong></p>
<p><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-lstack-login.png" alt="kubesphere-lstack-login"></p>
<p><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-workspace-lstack.png" alt="kubesphere-workspace-lstack"></p>
<p>点击<strong>项目</strong>，点击 <strong>lstack</strong> 项目，进入项目的管理页面 (如无特殊说明，后面的很多界面操作都是在该页面完成)。</p>
<p><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack.png" alt="kubesphere-projects-lstack"></p>
<p><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-overview.png" alt="kubesphere-projects-lstack-overview"></p>
<p><strong>应用负载</strong>-&gt;<strong>工作负载</strong>-&gt;<strong>有状态副本集</strong>，点击<strong>创建</strong>。<br><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets.png" alt="kubesphere-projects-lstack-statefulsets"></p>
<p>弹出<strong>创建有状态副本集</strong>页面，<strong>基本信息</strong>页，<strong>名称</strong>输入 <strong>mysql</strong>。<br><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-0.png" alt="kubesphere-projects-lstack-statefulsets-mysql-0"></p>
<p><strong>容器组设置</strong>页。</p>
<ul>
<li><strong>容器组副本数量</strong>：1</li>
<li>点击<strong>添加容器</strong>，镜像搜索栏输入 <strong>mysql:5.7.38</strong></li>
<li><strong>容器名称</strong>： lstack-mysql</li>
<li><strong>CPU（Core）资源</strong>：预留 0.5，限制 2</li>
<li><strong>内存（Mi）</strong>：预留 500i，限制 4000</li>
<li><strong>端口设置</strong>：协议 TCP，名称 tcp-mysql，容器端口：3306，服务端口 3306</li>
<li><strong>环境变量</strong>：<ul>
<li>引用配置字典或保密字典</li>
<li>创建保密字典，键（MYSQL_ROOT_PASSWORD），值（P@88w0rd）</li>
</ul>
</li>
<li><strong>同步主机时区</strong>：勾选上</li>
<li>其他未说明的配置采用默认值<br><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-1.png" alt="kubesphere-projects-lstack-statefulsets-mysql-1"><br><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-2.png" alt="kubesphere-projects-lstack-statefulsets-mysql-2"><br><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-3.png" alt="kubesphere-projects-lstack-statefulsets-mysql-3"><br><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-4.png" alt="kubesphere-projects-lstack-statefulsets-mysql-4"></li>
</ul>
<p><strong>创建保密字典</strong>：在<strong>环境变量</strong>选项中，点击<strong>创建保密字典</strong>，按后续图示操作。<br><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-5.png" alt="kubesphere-projects-lstack-statefulsets-mysql-5"><br><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-6.png" alt="kubesphere-projects-lstack-statefulsets-mysql-6"><br><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-7.png" alt="kubesphere-projects-lstack-statefulsets-mysql-7"><br><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-8.png" alt="kubesphere-projects-lstack-statefulsets-mysql-8"></p>
<p>点击<strong>创建</strong>，返回<strong>容器组设置</strong>页面。<br><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-9.png" alt="kubesphere-projects-lstack-statefulsets-mysql-9"></p>
<p>按以上信息配置完成后，点击<strong>对号</strong>按钮。<br><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-10.png" alt="kubesphere-projects-lstack-statefulsets-mysql-10"></p>
<p><strong>容器组设置</strong>完成后，点击<strong>下一步</strong>，进入<strong>存储卷设置</strong>。<br><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-11.png" alt="kubesphere-projects-lstack-statefulsets-mysql-11"></p>
<p><strong>存储卷设置</strong>-&gt;<strong>存储卷模板</strong>-&gt;<strong>添加存储卷模板</strong>。</p>
<ul>
<li>存储卷名称：data<ul>
<li>这个地方不要多写，系统会自动添加 StatefulSet 的名称作为名称后缀，生成类似 data-mysql-0 命名形式的存储卷</li>
</ul>
</li>
<li>存储类型：glusterfs</li>
<li>访问模式：ReadWriteOnce</li>
<li>存储卷容量：5Gi</li>
<li>挂载路径：读写 &#x2F;var&#x2F;lib&#x2F;mysql<br><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-12.png" alt="kubesphere-projects-lstack-statefulsets-mysql-12"></li>
</ul>
<p>按以上信息配置完成后，点击<strong>对号</strong>按钮。<br><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-13.png" alt="kubesphere-projects-lstack-statefulsets-mysql-13"></p>
<p><strong>存储卷设置</strong>完成后，点击<strong>下一步</strong>，进入<strong>高级设置</strong>，保持默认值，点击<strong>创建</strong>按钮。<br><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-14.png" alt="kubesphere-projects-lstack-statefulsets-mysql-14"></p>
<p><strong>创建</strong>成功后，自动返回工作负载页面。第一次创建会去 DockerHub 下载镜像，所以初始显示状态为<strong>更新中</strong>。<br><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-15.png" alt="kubesphere-projects-lstack-statefulsets-mysql-15"></p>
<p>镜像下载完成并且容器配置正确时，状态变成<strong>运行中</strong>。<br><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-16.png" alt="kubesphere-projects-lstack-statefulsets-mysql-16"></p>
<p>点击 <strong>mysql</strong>，进入有状态副本集详细页面。<br><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-17.png" alt="kubesphere-projects-lstack-statefulsets-mysql-17"><br><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-18.png" alt="kubesphere-projects-lstack-statefulsets-mysql-18"><br><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-19.png" alt="kubesphere-projects-lstack-statefulsets-mysql-19"></p>
<p><strong>监控</strong>，可以看到初始启动时的资源使用情况，后续可以根据监控数据调整我们的资源的配置。<br><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-20.png" alt="kubesphere-projects-lstack-statefulsets-mysql-20"></p>
<p><strong>环境变量</strong>，可以看到我们新增加的 Secret 字典生效了，并且密码是隐藏显示的。<br><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-21.png" alt="kubesphere-projects-lstack-statefulsets-mysql-21"><br><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-22.png" alt="kubesphere-projects-lstack-statefulsets-mysql-22"></p>
<p>再来看看<strong>容器组</strong>的详细信息，在<strong>资源状态</strong>页面，点击容器组 <strong>mysql-0。</strong><br><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-23.png" alt="kubesphere-projects-lstack-statefulsets-mysql-23"><br><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-24.png" alt="kubesphere-projects-lstack-statefulsets-mysql-24"><br><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-25.png" alt="kubesphere-projects-lstack-statefulsets-mysql-25"><br><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-26.png" alt="kubesphere-projects-lstack-statefulsets-mysql-26"><br><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-27.png" alt="kubesphere-projects-lstack-statefulsets-mysql-27"><br><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-28.png" alt="kubesphere-projects-lstack-statefulsets-mysql-28"></p>
<p>再来看看 StatefulSet 对应的服务(Service)，<strong>应用负载</strong>-&gt;<strong>服务</strong>。</p>
<p>可以看到自动创建了一个 StatefulSet MySQL 对应的有状态服务(Headless)，**mysql-2v7f(mysql)**。<br><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-29.png" alt="kubesphere-projects-lstack-statefulsets-mysql-29"></p>
<p>点击 **mysql-2v7f(mysql)**，可以查看服务详情。<br><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-30.png" alt="kubesphere-projects-lstack-statefulsets-mysql-30"><br><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-31.png" alt="kubesphere-projects-lstack-statefulsets-mysql-31"><br><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-32.png" alt="kubesphere-projects-lstack-statefulsets-mysql-32"></p>
<p>最后验证一下，我们的 MySQL 服务是否正常(这里只看服务本身，先不测试外部连接)。</p>
<p><strong>应用负载</strong>-&gt;<strong>工作负载</strong>-&gt;<strong>有状态副本集</strong>-&gt;<strong>mysql</strong>-&gt;<strong>容器组</strong>-&gt;<strong>mysql-0</strong>-&gt;<strong>终端。</strong><br><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-33.png" alt="kubesphere-projects-lstack-statefulsets-mysql-33"><br><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-34.png" alt="image-20220510112902273"></p>
<p>至此，MySQL 在 K8S 的基本安装就完成了，K8S 集群内的其他应用可以通过 svc 的地址访问 MySQL 服务 (svc 地址就是 <strong>mysql-2v7f.lstack</strong>)，此时名字看着还是很不友好，我们先不用它。</p>
<h3 id="2-3-MySQL-配置进阶"><a href="#2-3-MySQL-配置进阶" class="headerlink" title="2.3. MySQL 配置进阶"></a>2.3. MySQL 配置进阶</h3><p>上面完成了 MySQL 的基本安装配置。但是，实际使用中我们通常还有如下需求，需要我们对 MySQL 进行配置。</p>
<blockquote>
<p><strong>01 开启外部访问</strong></p>
</blockquote>
<p>开启外部访问方便管理员操作 MySQL 数据库，也可以满足 K8S 集群之外的服务访问 MySQL 数据库的需求。</p>
<p>在 KubeSphere 中开启服务的外部访问需要先设置项目网关。</p>
<p>用项目管理员用户登录控制台。</p>
<p><strong>工作台</strong>-&gt;<strong>项目</strong>-&gt; 点击<strong>具体的项目</strong>-&gt;<strong>项目设置</strong>-&gt;<strong>网关设置</strong>，点击<strong>开启网关</strong>。</p>
<p><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-35.png" alt="kubesphere-projects-lstack-statefulsets-mysql-35"></p>
<p>目前访问模式有 NodePort 和 LoadBalancer，但是 LoadBalancer 只支持公有云提供商云上的负载均衡器，所以我们只能选择 NodePort，点击确定。</p>
<p><strong>NodePort 模式里会创建一个采用了 nginx-ingress 的 kubesphere-router 的容器组，细节我们会在以后的专文探讨。</strong></p>
<p><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-36.png" alt="kubesphere-projects-lstack-statefulsets-mysql-36"></p>
<p><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-37.png" alt="kubesphere-projects-lstack-statefulsets-mysql-37"></p>
<p>网关设置的细节不在本文深入讨论，后续会有专文探讨。现在，做到这一步就 OK 了。</p>
<p>接下来创建一个 MySQL 服务用于对外提供服务。</p>
<p><strong>应用负载</strong>-&gt;-<strong>服务</strong>&gt;<strong>创建</strong>-&gt; 选择<strong>自定义服务</strong>-&gt;<strong>指定工作负载</strong>。</p>
<p><strong>这里有一个外部服务的选项，那个是基于 Ingress 使用域名访问的，不是目前我们想要的方式。</strong></p>
<p><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-38.png" alt="kubesphere-projects-lstack-statefulsets-mysql-38"></p>
<p><strong>指定工作负载创建服务-基本信息</strong>。</p>
<ul>
<li><strong>名称：</strong>mysql-external</li>
</ul>
<p><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-39.png" alt="kubesphere-projects-lstack-statefulsets-mysql-39"></p>
<p><strong>指定工作负载创建服务-服务设置</strong>，点击<strong>指定工作负载</strong>，选择<strong>有状态副本集</strong>-&gt;<strong>mysql</strong>，点击<strong>确定</strong>。</p>
<p><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-40.png" alt="kubesphere-projects-lstack-statefulsets-mysql-40"></p>
<p><strong>指定工作负载创建服务-服务设置</strong>，<strong>端口</strong>配置。</p>
<ul>
<li><strong>协议：</strong> TCP</li>
<li><strong>名称：</strong> tcp-mysql-external</li>
<li><strong>容器端口：</strong> 3306</li>
<li><strong>服务端口：</strong> 3306</li>
</ul>
<p><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-41.png" alt="kubesphere-projects-lstack-statefulsets-mysql-41"></p>
<p><strong>指定工作负载创建服务-高级设置</strong>。</p>
<ul>
<li><strong>外部访问：</strong> <strong>访问模式</strong>选择 NodePort</li>
</ul>
<p><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-42.png" alt="kubesphere-projects-lstack-statefulsets-mysql-42"></p>
<p>完成所有设置后，点击<strong>创建</strong>，创建成功会自动返回服务列表，在服务列表中可以看到我们新创建的服务 <strong>mysql-external</strong> 及自动分配的外部访问端口号。</p>
<p><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-43.png" alt="kubesphere-projects-lstack-statefulsets-mysql-43"></p>
<p>先用 telnet 命令测试一下，MySQL 服务的连通性，能看到下面的结果就说明 MySQL 已经可以在 K8S 集群外部访问了。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@ks-k8s-master-0 ~]# telnet 192.168.9.91 32529</span><br><span class="line">Trying 192.168.9.91...</span><br><span class="line">Connected to 192.168.9.91.</span><br><span class="line">Escape character is &#x27;^]&#x27;.</span><br><span class="line">EHost &#x27;10.233.117.0&#x27; is not allowed to connect to this MySQL serverConnection closed by foreign host.</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">细节！上面的EHost地址是192.168.9.91这个节点在K8S集群内部分配的IP</span></span><br><span class="line">[root@ks-k8s-master-0 ~]# ip add | grep 117 -B 2 -A 1</span><br><span class="line">7: tunl0@NONE: &lt;NOARP,UP,LOWER_UP&gt; mtu 1440 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/ipip 0.0.0.0 brd 0.0.0.0</span><br><span class="line">    inet 10.233.117.0/32 scope global tunl0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">[root@ks-k8s-master-0 ~]# ip add | grep 91</span><br><span class="line">    inet 192.168.9.91/24 brd 192.168.9.255 scope global noprefixroute ens160</span><br><span class="line">    link/ether c6:d3:91:95:f1:0f brd ff:ff:ff:ff:ff:ff</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>02-自定义 MySQL 配置文件</strong></p>
</blockquote>
<p>默认安装的 MySQL 使用的 my.cnf 配置文件，适配的使用场景有限，所以自定义 mysql 配置文件是必然要做的一项配置。</p>
<p>这里我随机找了一份配置文件，仅仅是为了实现自定义配置的功能，请根据自己的使用场景使用合适的自定义配置文件。</p>
<p>使用自定义配置前，我们先需要了解目前 mysql 容器的配置文件结构。</p>
<p>使用 KubeSphere 提供的<strong>终端</strong>工具，进入 mysql 容器内部，执行下面的命令，分析执行结果(终端登录方式参考前文截图)。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">bash</span></span><br><span class="line">root@mysql-0:/# ls /etc/mysql/ -l</span><br><span class="line">total 8</span><br><span class="line">drwxr-xr-x 2 root root   62 Apr 28 06:20 conf.d</span><br><span class="line">lrwxrwxrwx 1 root root   24 Apr 28 06:20 my.cnf -&gt; /etc/alternatives/my.cnf</span><br><span class="line">-rw-r--r-- 1 root root  839 Aug  3  2016 my.cnf.fallback</span><br><span class="line">-rw-r--r-- 1 root root 1200 Mar 22 01:44 mysql.cnf</span><br><span class="line">drwxr-xr-x 2 root root   24 Apr 28 06:20 mysql.conf.d</span><br><span class="line"></span><br><span class="line">root@mysql-0:/# ls /etc/mysql/conf.d/ -l</span><br><span class="line">total 12</span><br><span class="line">-rw-r--r-- 1 root root 43 Apr 28 06:20 docker.cnf</span><br><span class="line">-rw-r--r-- 1 root root  8 Aug  3  2016 mysql.cnf</span><br><span class="line">-rw-r--r-- 1 root root 55 Aug  3  2016 mysqldump.cnf</span><br><span class="line"></span><br><span class="line">root@mysql-0:/# ls /etc/mysql/mysql.conf.d/ -l</span><br><span class="line">total 4</span><br><span class="line">-rw-r--r-- 1 root root 1589 Apr 28 06:20 mysqld.cnf</span><br><span class="line"></span><br><span class="line">root@mysql-0:/# ls -l /etc/alternatives/my.cnf</span><br><span class="line">lrwxrwxrwx 1 root root 20 Apr 28 06:20 /etc/alternatives/my.cnf -&gt; /etc/mysql/mysql.cnf</span><br><span class="line"></span><br><span class="line">root@mysql-0:/# cat /etc/mysql/mysql.cnf</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Copyright (c) 2016, 2021, Oracle and/or its affiliates.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># This program is free software; you can redistribute it and/or modify</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">it under the terms of the GNU General Public License, version 2.0,</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">as published by the Free Software Foundation.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># This program is also distributed with certain software (including</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">but not limited to OpenSSL) that is licensed under separate terms,</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">as designated <span class="keyword">in</span> a particular file or component or <span class="keyword">in</span> included license</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">documentation.  The authors of MySQL hereby grant you an additional</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">permission to <span class="built_in">link</span> the program and your derivative works with the</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">separately licensed software that they have included with MySQL.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># This program is distributed in the hope that it will be useful,</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">but WITHOUT ANY WARRANTY; without even the implied warranty of</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">GNU General Public License, version 2.0, <span class="keyword">for</span> more details.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># You should have received a copy of the GNU General Public License</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">along with this program; <span class="keyword">if</span> not, write to the Free Software</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA</span></span><br><span class="line"></span><br><span class="line">!includedir /etc/mysql/conf.d/</span><br><span class="line">!includedir /etc/mysql/mysql.conf.d/</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 挑两个配置文件看看</span></span></span><br><span class="line">root@mysql-0:~# cat /etc/mysql/conf.d/docker.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">skip-host-cache</span><br><span class="line">skip-name-resolve</span><br><span class="line"></span><br><span class="line">root@mysql-0:~# cat /etc/mysql/mysql.conf.d/mysqld.cnf</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Copyright (c) 2014, 2021, Oracle and/or its affiliates.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># This program is free software; you can redistribute it and/or modify</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">it under the terms of the GNU General Public License, version 2.0,</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">as published by the Free Software Foundation.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># This program is also distributed with certain software (including</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">but not limited to OpenSSL) that is licensed under separate terms,</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">as designated <span class="keyword">in</span> a particular file or component or <span class="keyword">in</span> included license</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">documentation.  The authors of MySQL hereby grant you an additional</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">permission to <span class="built_in">link</span> the program and your derivative works with the</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">separately licensed software that they have included with MySQL.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># This program is distributed in the hope that it will be useful,</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">but WITHOUT ANY WARRANTY; without even the implied warranty of</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">GNU General Public License, version 2.0, <span class="keyword">for</span> more details.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># You should have received a copy of the GNU General Public License</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">along with this program; <span class="keyword">if</span> not, write to the Free Software</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># The MySQL  Server configuration file.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># For explanations see</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">http://dev.mysql.com/doc/mysql/en/server-system-variables.html</span></span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">pid-file        = /var/run/mysqld/mysqld.pid</span><br><span class="line">socket          = /var/run/mysqld/mysqld.sock</span><br><span class="line">datadir         = /var/lib/mysql</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">log-error      = /var/log/mysql/error.log</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">By default we only accept connections from localhost</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">bind-address   = 127.0.0.1</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Disabling symbolic-links is recommended to prevent assorted security risks</span></span><br><span class="line">symbolic-links=0</span><br></pre></td></tr></table></figure>

<p>分析上面的输出我们得到以下结论。</p>
<ul>
<li><p>根配置文件：**&#x2F;etc&#x2F;mysql&#x2F;mysql.cnf**</p>
</li>
<li><p>自定义的配置文件可以存放在 <strong>&#x2F;etc&#x2F;mysql&#x2F;conf.d&#x2F;</strong> 或 <strong>&#x2F;etc&#x2F;mysql&#x2F;mysql.conf.d&#x2F;</strong> 目录下</p>
</li>
<li><p>通过上面的结论，发现有两种方式实现自定义配置文件。</p>
<ul>
<li><p>直接替换 <strong>&#x2F;etc&#x2F;mysql&#x2F;mysql.cnf</strong></p>
<blockquote>
<p><strong>适用于个性化配置较多较复杂的场景，比如 50+的配置项。</strong></p>
</blockquote>
</li>
<li><p>将自定义的配置放在 <strong>&#x2F;etc&#x2F;mysql&#x2F;conf.d&#x2F;</strong> 或 <strong>&#x2F;etc&#x2F;mysql&#x2F;mysql.conf.d&#x2F;</strong> 目录下，根据官方配置使用情况，建议选择 <strong>&#x2F;etc&#x2F;mysql&#x2F;conf.d&#x2F;</strong></p>
<blockquote>
<p><strong>适用于自定义配置较少的场景，比如只是为了开启个别功能，或是个别默认参数不符合使用需求</strong></p>
</blockquote>
</li>
</ul>
</li>
</ul>
<p>本文采用第二种方式，采用一个独立的 custom.cnf 文件配置以下参数。</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="comment">#performance setttings</span></span><br><span class="line"><span class="attr">lock_wait_timeout</span> = <span class="number">3600</span></span><br><span class="line"><span class="attr">open_files_limit</span>    = <span class="number">65535</span></span><br><span class="line"><span class="attr">back_log</span> = <span class="number">1024</span></span><br><span class="line"><span class="attr">max_connections</span> = <span class="number">512</span></span><br><span class="line"><span class="attr">max_connect_errors</span> = <span class="number">1000000</span></span><br><span class="line"><span class="attr">table_open_cache</span> = <span class="number">1024</span></span><br><span class="line"><span class="attr">table_definition_cache</span> = <span class="number">1024</span></span><br><span class="line"><span class="attr">thread_stack</span> = <span class="number">512</span>K</span><br><span class="line"><span class="attr">sort_buffer_size</span> = <span class="number">4</span>M</span><br><span class="line"><span class="attr">join_buffer_size</span> = <span class="number">4</span>M</span><br><span class="line"><span class="attr">read_buffer_size</span> = <span class="number">8</span>M</span><br><span class="line"><span class="attr">read_rnd_buffer_size</span> = <span class="number">4</span>M</span><br><span class="line"><span class="attr">bulk_insert_buffer_size</span> = <span class="number">64</span>M</span><br><span class="line"><span class="attr">thread_cache_size</span> = <span class="number">768</span></span><br><span class="line"><span class="attr">interactive_timeout</span> = <span class="number">600</span></span><br><span class="line"><span class="attr">wait_timeout</span> = <span class="number">600</span></span><br><span class="line"><span class="attr">tmp_table_size</span> = <span class="number">32</span>M</span><br><span class="line"><span class="attr">max_heap_table_size</span> = <span class="number">32</span>M</span><br><span class="line">  </span><br></pre></td></tr></table></figure>

<p>实现思路。</p>
<ul>
<li><p>k8s 中我们可以通过配置 ConfigMap 的方式将文件挂载给容器</p>
</li>
<li><p>将自定义的 mysql 配置文件，定义为一个 ConfigMap</p>
</li>
<li><p>将 ConfigMap 挂载给 mysql 的容器</p>
</li>
</ul>
<p>创建 ConfigMap 配置文件，<strong>配置</strong>-&gt;<strong>配置字典</strong>，点击<strong>创建</strong>。</p>
<p><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-44.png" alt="kubesphere-projects-lstack-statefulsets-mysql-44"></p>
<p><strong>创建配置字典-基本信息</strong>。</p>
<ul>
<li>名称：mysql-cnf</li>
</ul>
<p><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-45.png" alt="kubesphere-projects-lstack-statefulsets-mysql-45"></p>
<p><strong>创建配置字典-数据设置</strong>。</p>
<ul>
<li>点击<strong>添加数据</strong></li>
<li><strong>键：</strong> custom.cnf</li>
<li><strong>值：</strong> 粘贴上面的配置参数</li>
</ul>
<p><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-46.png" alt="kubesphere-projects-lstack-statefulsets-mysql-46"></p>
<p><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-47.png" alt="kubesphere-projects-lstack-statefulsets-mysql-47"></p>
<p>填写完键值信息后，点击<strong>对号</strong>确定，最后点击<strong>创建</strong>，创建完成后会返回<strong>配置字典</strong>页面。</p>
<p><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-48.png" alt="kubesphere-projects-lstack-statefulsets-mysql-48"></p>
<p><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-49.png" alt="kubesphere-projects-lstack-statefulsets-mysql-49"></p>
<p>接下来将自定义配置文件，挂载到 mysql 容器。</p>
<p><strong>应用负载</strong>-&gt;<strong>工作负载</strong>-&gt;<strong>有状态副本集</strong>-&gt; 点击 <strong>mysql</strong>-&gt; 进入详细配置页面-&gt;<strong>更多操作</strong>-点击<strong>编辑设置</strong>。</p>
<p><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-50.png" alt="kubesphere-projects-lstack-statefulsets-mysql-50"></p>
<p><strong>编辑设置</strong>-&gt;<strong>存储卷</strong>-&gt;<strong>挂载配置字典或保密字典</strong>。</p>
<p><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-51.png" alt="kubesphere-projects-lstack-statefulsets-mysql-51"></p>
<p><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-52.png" alt="kubesphere-projects-lstack-statefulsets-mysql-52"></p>
<p><strong>存储卷</strong>。</p>
<ul>
<li><strong>选择配置字典：</strong>mysql-cnf</li>
<li><strong>只读</strong></li>
<li><strong>挂载路径：</strong>&#x2F;etc&#x2F;mysql&#x2F;conf.d&#x2F;custom.cnf</li>
<li>指定子路径：custom.cnf<ul>
<li><strong>此处必须这么写，否则会覆盖掉指定目录下的所有已存在文件</strong></li>
<li><strong>底层就是 subPath</strong></li>
<li><strong>具体操作看下图图示，注意细节</strong></li>
</ul>
</li>
<li><strong>选择特定键：</strong> <ul>
<li>键：custom.cnf</li>
<li>路径：custom.cnf</li>
</ul>
</li>
</ul>
<p><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-53.png" alt="kubesphere-projects-lstack-statefulsets-mysql-53"></p>
<p><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-54.png" alt="kubesphere-projects-lstack-statefulsets-mysql-54"></p>
<p><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-55.png" alt="kubesphere-projects-lstack-statefulsets-mysql-55"></p>
<p>输入完成后，点击<strong>对号</strong>。 </p>
<p><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-56.png" alt="kubesphere-projects-lstack-statefulsets-mysql-56"></p>
<p>再次点击<strong>对号</strong>，点击<strong>确定</strong>，mysql 容器会自动开始重建。</p>
<p><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-57.png" alt="kubesphere-projects-lstack-statefulsets-mysql-57"></p>
<p><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-58.png" alt="kubesphere-projects-lstack-statefulsets-mysql-58"></p>
<p>重建成功后我们验证一下配置文件是否成功挂载。</p>
<p>先看一下容器组的配置，发现新增了一个存储卷 <strong>volume-xxxx</strong>。</p>
<p><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-59.png" alt="kubesphere-projects-lstack-statefulsets-mysql-59"></p>
<p><strong>终端</strong>-&gt; 进入容器内部查看。</p>
<p>查看配置文件挂载和文件内容。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">bash</span></span><br><span class="line">root@mysql-0:/# ls /etc/mysql/conf.d/</span><br><span class="line">custom.cnf  docker.cnf  mysql.cnf  mysqldump.cnf</span><br><span class="line"></span><br><span class="line">root@mysql-0:/# ls -l /etc/mysql/conf.d/</span><br><span class="line">total 16</span><br><span class="line">-rw-r--r-- 1 root root 463 May 11 11:07 custom.cnf</span><br><span class="line">-rw-r--r-- 1 root root  43 Apr 28 06:20 docker.cnf</span><br><span class="line">-rw-r--r-- 1 root root   8 Aug  3  2016 mysql.cnf</span><br><span class="line">-rw-r--r-- 1 root root  55 Aug  3  2016 mysqldump.cnf</span><br><span class="line"></span><br><span class="line">root@mysql-0:/# cat /etc/mysql/conf.d/custom.cnf</span><br><span class="line">[mysqld]</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">performance setttings</span></span><br><span class="line">lock_wait_timeout = 3600</span><br><span class="line">open_files_limit    = 65535</span><br><span class="line">back_log = 1024</span><br><span class="line">max_connections = 512</span><br><span class="line">max_connect_errors = 1000000</span><br><span class="line">table_open_cache = 1024</span><br><span class="line">table_definition_cache = 1024</span><br><span class="line">thread_stack = 512K</span><br><span class="line">sort_buffer_size = 4M</span><br><span class="line">join_buffer_size = 4M</span><br><span class="line">read_buffer_size = 8M</span><br><span class="line">read_rnd_buffer_size = 4M</span><br><span class="line">bulk_insert_buffer_size = 64M</span><br><span class="line">thread_cache_size = 768</span><br><span class="line">interactive_timeout = 600</span><br><span class="line">wait_timeout = 600</span><br><span class="line">tmp_table_size = 32M</span><br><span class="line">max_heap_table_size = 32M</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>查看配置参数是否生效。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">root@mysql-0:/# mysql -u root -p</span><br><span class="line">Enter password:</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 2</span><br><span class="line">Server version: 5.7.38 MySQL Community Server (GPL)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2022, Oracle and/or its affiliates.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type &#x27;help;&#x27; or &#x27;\h&#x27; for help. Type &#x27;\c&#x27; to clear the current input statement.</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">SHOW GLOBAL VARIABLES LIKE <span class="string">&#x27;max_connect%&#x27;</span>;</span></span><br><span class="line">+--------------------+---------+</span><br><span class="line">| Variable_name      | Value   |</span><br><span class="line">+--------------------+---------+</span><br><span class="line">| max_connect_errors | 1000000 |</span><br><span class="line">| max_connections    | 512     |</span><br><span class="line">+--------------------+---------+</span><br><span class="line">2 rows in set (0.02 sec)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt;</span></span><br></pre></td></tr></table></figure>

<p>执行结果跟我们的配置一致，说明配置成功。</p>
<blockquote>
<p><strong>03-导入数据库数据</strong></p>
</blockquote>
<p>将数据库文件（SQL），挂载到容器的指定目录下 <strong>&#x2F;docker-entrypoint-initdb.d</strong>，容器创建时会自动导入（<strong>非必要不推荐</strong>）。</p>
<p>用数据库管理工具远程管理数据库（<strong>推荐</strong>）。</p>
<hr>
<h2 id="3-原生-K8S-部署-MySQL-实现-GitOps"><a href="#3-原生-K8S-部署-MySQL-实现-GitOps" class="headerlink" title="3. 原生 K8S 部署 MySQL 实现 GitOps"></a>3. 原生 K8S 部署 MySQL 实现 GitOps</h2><p>上面我们完成了通过 KubeSphere 部署单实例 MySQL，那么原生的 K8S 又该如何操作？GitOps 又是什么、又该如何实现？</p>
<h3 id="3-1-什么是-GitOps-网文摘抄"><a href="#3-1-什么是-GitOps-网文摘抄" class="headerlink" title="3.1. 什么是 GitOps(网文摘抄)"></a>3.1. 什么是 GitOps(网文摘抄)</h3><ul>
<li>GitOps 是一套使用 Git 来管理基础架构和应用配置的实践，而 Git 指的是一个开源版控制系统。</li>
<li>GitOps 在运行过程中以 Git 为声明性基础架构和应用的单一事实来源。</li>
<li>GitOps 使用 Git 拉取请求来自动管理基础架构的置备和部署。</li>
<li>Git 存储库包含系统的全部状态，因此系统状态的修改痕迹既可查看也可审计。</li>
<li>GitOps 经常被用作 Kubernetes 和云原生应用开发的运维模式，并且可以实现对 Kubernetes 的持续部署。</li>
<li>GitOps 是一种持续交付的方式。它的核心思想是将应用系统的声明性基础架构和应用程序存放在 Git 版本库中。</li>
</ul>
<h3 id="3-2-准备-K8S-上的-MySQL-资源配置清单-思路梳理"><a href="#3-2-准备-K8S-上的-MySQL-资源配置清单-思路梳理" class="headerlink" title="3.2. 准备 K8S 上的 MySQL 资源配置清单-思路梳理"></a>3.2. 准备 K8S 上的 MySQL 资源配置清单-思路梳理</h3><p>我们知道玩 K8S 的必备技能就是要手写资源配置清单，一般使用 YAML 格式的文件来创建我们预期的资源配置。</p>
<p>此时我们也要手写 MySQL 的资源配置清单？我很慌，参数我记不全啊。</p>
<p>NO！NO！NO！投机取巧的时刻到了，前面卖的关子在这揭开了。</p>
<p>前面我们已经通过 KubeSphere 的图形界面创建了 MySQL 的资源配置，而且 KubeSphere 一个很棒的功能就是可以直接在线编辑资源的 YAML 文件。</p>
<p>我们可以在创建资源的时候，直接编辑 YAML 文件创建资源。也可以通过编辑 YAML 的方式修改已有的资源。</p>
<p>当然啊，你不用图形界面，直接在 K8S 底层用命令行的方式去获取 YAML 格式的输出，再编辑，也是可以的。</p>
<p>梳理一下 MySQL 涉及的资源配置清单包含的资源。</p>
<ul>
<li><strong>StatefulSet(有状态副本集)</strong></li>
<li><strong>Service(服务)</strong><ul>
<li>集群内部（Headless）</li>
<li>集群外部（自定义服务）</li>
</ul>
</li>
<li><strong>ConfigMap</strong></li>
<li><strong>Secret</strong></li>
</ul>
<p>接下来我们就分别获取这些资源配置清单。</p>
<h3 id="3-3-准备-K8S-上的-MySQL-资源配置清单"><a href="#3-3-准备-K8S-上的-MySQL-资源配置清单" class="headerlink" title="3.3. 准备 K8S 上的 MySQL 资源配置清单"></a>3.3. 准备 K8S 上的 MySQL 资源配置清单</h3><blockquote>
<p><strong>01-ConfigMap</strong></p>
</blockquote>
<p><strong>配置</strong>-&gt;<strong>配置字典</strong>，找到 <strong>mysql-cnf</strong>，点击右侧的<strong>三个竖点</strong>，点击<strong>编辑 YAML</strong>。</p>
<p><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-60.png" alt="kubesphere-projects-lstack-statefulsets-mysql-60"></p>
<p>打开<strong>编辑 YAML</strong> 页面，可以直接复制所有内容，也可以点击右上角的下载图标，下载文件(也可以利用上传图标上传文件)。</p>
<p><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-61.png" alt="kubesphere-projects-lstack-statefulsets-mysql-61"></p>
<p>获取的现网配置不能完全的拿来就用，需要修改，把系统自动添加的一些元数据信息清理掉。</p>
<p>现网的 <strong>mysql-cfm.yaml</strong>。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mysql-cnf</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">lstack</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">kubesphere.io/creator:</span> <span class="string">lstack</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">custom.cnf:</span> <span class="string">|-</span></span><br><span class="line"><span class="string">    [mysqld]</span></span><br><span class="line"><span class="string">    #performance setttings</span></span><br><span class="line"><span class="string">    lock_wait_timeout = 3600</span></span><br><span class="line"><span class="string">    open_files_limit    = 65535</span></span><br><span class="line"><span class="string">    back_log = 1024</span></span><br><span class="line"><span class="string">    max_connections = 512</span></span><br><span class="line"><span class="string">    max_connect_errors = 1000000</span></span><br><span class="line"><span class="string">    table_open_cache = 1024</span></span><br><span class="line"><span class="string">    table_definition_cache = 1024</span></span><br><span class="line"><span class="string">    thread_stack = 512K</span></span><br><span class="line"><span class="string">    sort_buffer_size = 4M</span></span><br><span class="line"><span class="string">    join_buffer_size = 4M</span></span><br><span class="line"><span class="string">    read_buffer_size = 8M</span></span><br><span class="line"><span class="string">    read_rnd_buffer_size = 4M</span></span><br><span class="line"><span class="string">    bulk_insert_buffer_size = 64M</span></span><br><span class="line"><span class="string">    thread_cache_size = 768</span></span><br><span class="line"><span class="string">    interactive_timeout = 600</span></span><br><span class="line"><span class="string">    wait_timeout = 600</span></span><br><span class="line"><span class="string">    tmp_table_size = 32M</span></span><br><span class="line"><span class="string">    max_heap_table_size = 32M</span></span><br><span class="line"><span class="string"></span>    </span><br></pre></td></tr></table></figure>

<p>修改后的 <strong>mysql-cfm.yaml</strong>。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mysql-cnf</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">lstack</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">custom.cnf:</span> <span class="string">|-</span></span><br><span class="line"><span class="string">    [mysqld]</span></span><br><span class="line"><span class="string">    #performance setttings</span></span><br><span class="line"><span class="string">    lock_wait_timeout = 3600</span></span><br><span class="line"><span class="string">    open_files_limit    = 65535</span></span><br><span class="line"><span class="string">    back_log = 1024</span></span><br><span class="line"><span class="string">    max_connections = 512</span></span><br><span class="line"><span class="string">    max_connect_errors = 1000000</span></span><br><span class="line"><span class="string">    table_open_cache = 1024</span></span><br><span class="line"><span class="string">    table_definition_cache = 1024</span></span><br><span class="line"><span class="string">    thread_stack = 512K</span></span><br><span class="line"><span class="string">    sort_buffer_size = 4M</span></span><br><span class="line"><span class="string">    join_buffer_size = 4M</span></span><br><span class="line"><span class="string">    read_buffer_size = 8M</span></span><br><span class="line"><span class="string">    read_rnd_buffer_size = 4M</span></span><br><span class="line"><span class="string">    bulk_insert_buffer_size = 64M</span></span><br><span class="line"><span class="string">    thread_cache_size = 768</span></span><br><span class="line"><span class="string">    interactive_timeout = 600</span></span><br><span class="line"><span class="string">    wait_timeout = 600</span></span><br><span class="line"><span class="string">    tmp_table_size = 32M</span></span><br><span class="line"><span class="string">    max_heap_table_size = 32M</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>02-Secret</strong></p>
</blockquote>
<p><strong>配置</strong>-&gt;<strong>保密字典</strong>，找到 <strong>mysql-secret</strong>，点击右侧的<strong>三个竖点</strong>，点击<strong>编辑 YAML</strong>。</p>
<p>现网的 <strong>mysql-secret.yaml</strong>。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mysql-secret</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">lstack</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">kubesphere.io/creator:</span> <span class="string">lstack</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">MYSQL_ROOT_PASSWORD:</span> <span class="string">UEA4OHcwcmQ=</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">Opaque</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>修改后的 <strong>mysql-secret.yaml</strong>。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mysql-secret</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">lstack</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">MYSQL_ROOT_PASSWORD:</span> <span class="string">UEA4OHcwcmQ=</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">Opaque</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这里要说一句，Secret 里的值是用 base64 方式加密的，所以这里的 <strong>MYSQL_ROOT_PASSWORD</strong>，要用实际的密码用 base64 的方式加密。</p>
<ul>
<li><p>base64 解密。</p>
</li>
<li><p>&#96;&#96;&#96;shell<br>[root@ks-k8s-master-0 ~]# echo “UEA4OHcwcmQ&#x3D;” | base64 -d<br>P@88w0rd</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- base 加密。</span><br><span class="line"></span><br><span class="line">- ```shell</span><br><span class="line">  [root@ks-k8s-master-0 ~]# echo -n &quot;P@88w0rd&quot; | base64</span><br><span class="line">  UEA4OHcwcmQ=</span><br></pre></td></tr></table></figure></li>
</ul>
<blockquote>
<p><strong>03-StatefulSet</strong></p>
</blockquote>
<p><strong>应用负载</strong>-&gt;<strong>工作负载</strong>-&gt;<strong>有状态副本集</strong>，找到 <strong>mysql</strong>，点击右侧的<strong>三个竖点</strong>，点击<strong>编辑 YAML</strong>。</p>
<p>现网的 <strong>mysql-sts.yaml</strong>。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mysql</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">lstack</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">mysql</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">kubesphere.io/creator:</span> <span class="string">lstack</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">mysql</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">creationTimestamp:</span> <span class="literal">null</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">mysql</span></span><br><span class="line">      <span class="attr">annotations:</span></span><br><span class="line">        <span class="attr">logging.kubesphere.io/logsidecar-config:</span> <span class="string">&#x27;&#123;&#125;&#x27;</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">host-time</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/etc/localtime</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">volume-rca2zx</span></span><br><span class="line">          <span class="attr">configMap:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">mysql-cnf</span></span><br><span class="line">            <span class="attr">items:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">custom.cnf</span></span><br><span class="line">                <span class="attr">path:</span> <span class="string">custom.cnf</span></span><br><span class="line">            <span class="attr">defaultMode:</span> <span class="number">420</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">lstack-mysql</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">&#x27;mysql:5.7.38&#x27;</span></span><br><span class="line">          <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tcp-mysql</span></span><br><span class="line">              <span class="attr">containerPort:</span> <span class="number">3306</span></span><br><span class="line">              <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">          <span class="attr">env:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MYSQL_ROOT_PASSWORD</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">secretKeyRef:</span></span><br><span class="line">                  <span class="attr">name:</span> <span class="string">mysql-secret</span></span><br><span class="line">                  <span class="attr">key:</span> <span class="string">MYSQL_ROOT_PASSWORD</span></span><br><span class="line">          <span class="attr">resources:</span></span><br><span class="line">            <span class="attr">limits:</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="string">&#x27;2&#x27;</span></span><br><span class="line">              <span class="attr">memory:</span> <span class="string">4000Mi</span></span><br><span class="line">            <span class="attr">requests:</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="string">500m</span></span><br><span class="line">              <span class="attr">memory:</span> <span class="string">500Mi</span></span><br><span class="line">          <span class="attr">volumeMounts:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">host-time</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">/etc/localtime</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">data</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">/var/lib/mysql</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">volume-rca2zx</span></span><br><span class="line">              <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">/etc/mysql/conf.d/custom.cnf</span></span><br><span class="line">              <span class="attr">subPath:</span> <span class="string">custom.cnf</span></span><br><span class="line">          <span class="attr">terminationMessagePath:</span> <span class="string">/dev/termination-log</span></span><br><span class="line">          <span class="attr">terminationMessagePolicy:</span> <span class="string">File</span></span><br><span class="line">          <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">      <span class="attr">restartPolicy:</span> <span class="string">Always</span></span><br><span class="line">      <span class="attr">terminationGracePeriodSeconds:</span> <span class="number">30</span></span><br><span class="line">      <span class="attr">dnsPolicy:</span> <span class="string">ClusterFirst</span></span><br><span class="line">      <span class="attr">serviceAccountName:</span> <span class="string">default</span></span><br><span class="line">      <span class="attr">serviceAccount:</span> <span class="string">default</span></span><br><span class="line">      <span class="attr">securityContext:</span> &#123;&#125;</span><br><span class="line">      <span class="attr">schedulerName:</span> <span class="string">default-scheduler</span></span><br><span class="line">  <span class="attr">volumeClaimTemplates:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line">      <span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line">      <span class="attr">metadata:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">data</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">lstack</span></span><br><span class="line">        <span class="attr">creationTimestamp:</span> <span class="literal">null</span></span><br><span class="line">      <span class="attr">spec:</span></span><br><span class="line">        <span class="attr">accessModes:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">ReadWriteOnce</span></span><br><span class="line">        <span class="attr">resources:</span></span><br><span class="line">          <span class="attr">requests:</span></span><br><span class="line">            <span class="attr">storage:</span> <span class="string">5Gi</span></span><br><span class="line">        <span class="attr">storageClassName:</span> <span class="string">glusterfs</span></span><br><span class="line">        <span class="attr">volumeMode:</span> <span class="string">Filesystem</span></span><br><span class="line">      <span class="attr">status:</span></span><br><span class="line">        <span class="attr">phase:</span> <span class="string">Pending</span></span><br><span class="line">  <span class="attr">serviceName:</span> <span class="string">mysql-1dpr</span></span><br><span class="line">  <span class="attr">podManagementPolicy:</span> <span class="string">OrderedReady</span></span><br><span class="line">  <span class="attr">updateStrategy:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">RollingUpdate</span></span><br><span class="line">    <span class="attr">rollingUpdate:</span></span><br><span class="line">      <span class="attr">partition:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">revisionHistoryLimit:</span> <span class="number">10</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>修改后的 <strong>mysql-sts.yaml</strong>。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mysql</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">lstack</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">mysql</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">mysql</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">host-time</span></span><br><span class="line">          <span class="attr">hostPath:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/etc/localtime</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">volume-cnf</span></span><br><span class="line">          <span class="attr">configMap:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">mysql-cnf</span></span><br><span class="line">            <span class="attr">items:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">custom.cnf</span></span><br><span class="line">                <span class="attr">path:</span> <span class="string">custom.cnf</span></span><br><span class="line">            <span class="attr">defaultMode:</span> <span class="number">420</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">lstack-mysql</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">&#x27;mysql:5.7.38&#x27;</span></span><br><span class="line">          <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tcp-mysql</span></span><br><span class="line">              <span class="attr">containerPort:</span> <span class="number">3306</span></span><br><span class="line">              <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">          <span class="attr">env:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">MYSQL_ROOT_PASSWORD</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">secretKeyRef:</span></span><br><span class="line">                  <span class="attr">name:</span> <span class="string">mysql-secret</span></span><br><span class="line">                  <span class="attr">key:</span> <span class="string">MYSQL_ROOT_PASSWORD</span></span><br><span class="line">          <span class="attr">resources:</span></span><br><span class="line">            <span class="attr">limits:</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="string">&#x27;2&#x27;</span></span><br><span class="line">              <span class="attr">memory:</span> <span class="string">4000Mi</span></span><br><span class="line">            <span class="attr">requests:</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="string">500m</span></span><br><span class="line">              <span class="attr">memory:</span> <span class="string">500Mi</span></span><br><span class="line">          <span class="attr">volumeMounts:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">host-time</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">/etc/localtime</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">data</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">/var/lib/mysql</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">volume-cnf</span></span><br><span class="line">              <span class="attr">mountPath:</span> <span class="string">/etc/mysql/conf.d/custom.cnf</span></span><br><span class="line">              <span class="attr">subPath:</span> <span class="string">custom.cnf</span></span><br><span class="line">  <span class="attr">volumeClaimTemplates:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">metadata:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">data</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">lstack</span></span><br><span class="line">      <span class="attr">spec:</span></span><br><span class="line">        <span class="attr">accessModes:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">ReadWriteOnce</span></span><br><span class="line">        <span class="attr">resources:</span></span><br><span class="line">          <span class="attr">requests:</span></span><br><span class="line">            <span class="attr">storage:</span> <span class="string">5Gi</span></span><br><span class="line">        <span class="attr">storageClassName:</span> <span class="string">glusterfs</span></span><br><span class="line">  <span class="attr">serviceName:</span> <span class="string">mysql-headless</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>04-Service</strong></p>
</blockquote>
<p>先创建 <strong>Headless</strong> 服务，<strong>应用负载</strong>-&gt;<strong>服务</strong>-&gt;，找到 <strong>mysql-xxxx(mysql)<strong>，点击右侧的</strong>三个竖点</strong>，点击<strong>编辑 YAML</strong>。</p>
<p>现网的 <strong>mysql-headless.yaml</strong>。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mysql-1dpr</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">lstack</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">mysql</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">kubesphere.io/alias-name:</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">kubesphere.io/creator:</span> <span class="string">lstack</span></span><br><span class="line">    <span class="attr">kubesphere.io/serviceType:</span> <span class="string">statefulservice</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tcp-mysql</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">3306</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">3306</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">mysql</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="string">None</span></span><br><span class="line">  <span class="attr">clusterIPs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">None</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span></span><br><span class="line">  <span class="attr">sessionAffinity:</span> <span class="string">None</span></span><br><span class="line">  <span class="attr">ipFamilies:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">IPv4</span></span><br><span class="line">  <span class="attr">ipFamilyPolicy:</span> <span class="string">SingleStack</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>修改后的 <strong>mysql-headless.yaml</strong>。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mysql-headless</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">lstack</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">mysql</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tcp-mysql</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">3306</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">3306</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">mysql</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="string">None</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>再看看自定义的 <strong>mysql-external</strong> 服务 ,<strong>应用负载</strong>-&gt;<strong>服务</strong>-&gt;，找到 <strong>mysql-external</strong>，点击右侧的<strong>三个竖点</strong>，点击<strong>编辑 YAML</strong>。</p>
<p>现网的 <strong>mysql-external.yaml</strong>。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mysql-external</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">lstack</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">mysql-external</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">kubesphere.io/creator:</span> <span class="string">lstack</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tcp-mysql-external</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">3306</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">3306</span></span><br><span class="line">      <span class="attr">nodePort:</span> <span class="number">32529</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">mysql</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="number">10.233</span><span class="number">.36</span><span class="number">.71</span></span><br><span class="line">  <span class="attr">clusterIPs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">10.233</span><span class="number">.36</span><span class="number">.71</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">  <span class="attr">sessionAffinity:</span> <span class="string">None</span></span><br><span class="line">  <span class="attr">externalTrafficPolicy:</span> <span class="string">Cluster</span></span><br><span class="line">  <span class="attr">ipFamilies:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">IPv4</span></span><br><span class="line">  <span class="attr">ipFamilyPolicy:</span> <span class="string">SingleStack</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这里有一点要说明 <strong>nodePort</strong> 这个参数，如果 K8S 集群可控，建议规划一套服务端口使用规范，每个需要 <strong>nodePort</strong> 的服务都指定固定的端口，这样有利于运维的标准化。</p>
<p>修改后的 <strong>mysql-external.yaml</strong>(注意 <strong>nodePort</strong> 参数没有指定)。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mysql-external</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">lstack</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">mysql-external</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tcp-mysql-external</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">3306</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">3306</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">mysql</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="3-4-将-MySQL-资源配置清单提交到-Git-仓库。"><a href="#3-4-将-MySQL-资源配置清单提交到-Git-仓库。" class="headerlink" title="3.4. 将 MySQL 资源配置清单提交到 Git 仓库。"></a>3.4. 将 MySQL 资源配置清单提交到 Git 仓库。</h3><p>通过上面的操作，我们获取了 MySQL 的资源配置清单。</p>
<p>本人强迫症，喜欢分类存放，所以我用了 4 个文件，<strong>mysql-headless.yaml</strong> 跟 <strong>mysql-sts.yaml</strong> 合并在一个文件当然你也可以放到一个配置文件里。</p>
<ul>
<li><strong>mysql-external.yaml</strong></li>
<li><strong>mysql-sts.yaml</strong></li>
<li><strong>mysql-secret.yaml</strong></li>
<li><strong>mysql-cfm.yaml</strong></li>
</ul>
<blockquote>
<p><strong>01-将资源配置清单提交到 Git 仓库</strong></p>
</blockquote>
<p>选择 GitHub 作为主仓库，Gitee 作为同步仓库(人工)。</p>
<p>本系列文档所有 k8s 的资源配置清单文件使用了一个公共仓库，生产环境建议每种服务创建一个配置仓库，有利于更精细化的版本控制。</p>
<p>本文为了演示主备仓库的使用，所有选择了 Github 和 Gitee 两种 Git 服务，实际使用中为了更好的使用体验建议选择 Gitee。</p>
<p>在 GitHub 新建一个仓库，仓库名称**<a target="_blank" rel="noopener" href="https://github.com/devops/k8s-yaml">k8s-yaml</a><strong>，添加一个 README 文件初始化仓库，点击</strong>Create repository**，确认创建。</p>
<p><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-62.png" alt="kubesphere-projects-lstack-statefulsets-mysql-62"></p>
<p><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-63.png" alt="kubesphere-projects-lstack-statefulsets-mysql-63"></p>
<p>将代码仓库 Clone 回本地。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">github % git clone git@github.com:devops/k8s-yaml.git</span><br><span class="line">Cloning into &#x27;k8s-yaml&#x27;...</span><br><span class="line">Enter passphrase for key &#x27;/Users/z/.ssh/id_rsa&#x27;: </span><br><span class="line">remote: Enumerating objects: 3, done.</span><br><span class="line">remote: Counting objects: 100% (3/3), done.</span><br><span class="line">remote: Total 3 (delta 0), reused 0 (delta 0), pack-reused 0</span><br><span class="line">Receiving objects: 100% (3/3), done.</span><br><span class="line"></span><br><span class="line">github % ls k8s-yaml </span><br><span class="line">README.md</span><br></pre></td></tr></table></figure>

<p>新创建一个文件夹，用自己喜欢的文本编辑器 (推荐 vscode) 编辑 MySQL 的资源配置清单，并将文件放入新创建的文件夹。</p>
<p>为了以后的扩展性，这里创建了一个 <strong>single</strong> 命名的二级目录，存放单实例的资源配置清单文件。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">github % mkdir -p k8s-yaml/mysql/single</span><br><span class="line">github % ls -l k8s-yaml/mysql/single</span><br><span class="line">total 32</span><br><span class="line">-rw-r--r--  1 z  staff   646  5 11 19:23 mysql-cfm.yaml</span><br><span class="line">-rw-r--r--  1 z  staff   266  5 11 19:31 mysql-external.yaml</span><br><span class="line">-rw-r--r--  1 z  staff   134  5 11 19:23 mysql-secret.yaml</span><br><span class="line">-rw-r--r--  1 z  staff  1911  5 11 19:31 mysql-sts.yaml</span><br></pre></td></tr></table></figure>

<p>将编辑好的资源配置文件清单，提交到 GitHub。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">github % cd k8s-yaml</span><br><span class="line">k8s-yaml[main*] % git status</span><br><span class="line">On branch main</span><br><span class="line">Your branch is up to date with &#x27;origin/main&#x27;.</span><br><span class="line"></span><br><span class="line">Untracked files:</span><br><span class="line">  (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)</span><br><span class="line">	mysql/</span><br><span class="line"></span><br><span class="line">nothing added to commit but untracked files present (use &quot;git add&quot; to track)</span><br><span class="line"></span><br><span class="line">k8s-yaml[main*] % git add .</span><br><span class="line">k8s-yaml[main*] % git commit -am &#x27;添加MySQL single资源配置清单&#x27;</span><br><span class="line">[main 1d00559] 添加MySQL single资源配置清单</span><br><span class="line"> 4 files changed, 138 insertions(+)</span><br><span class="line"> create mode 100644 mysql/single/mysql-cfm.yaml</span><br><span class="line"> create mode 100644 mysql/single/mysql-external.yaml</span><br><span class="line"> create mode 100644 mysql/single/mysql-secret.yaml</span><br><span class="line"> create mode 100644 mysql/single/mysql-sts.yaml</span><br><span class="line">k8s-yaml[main] % git status</span><br><span class="line">On branch main</span><br><span class="line">Your branch is ahead of &#x27;origin/main&#x27; by 1 commit.</span><br><span class="line">  (use &quot;git push&quot; to publish your local commits)</span><br><span class="line"></span><br><span class="line">nothing to commit, working tree clean</span><br><span class="line">k8s-yaml[main] % git push</span><br><span class="line">Enter passphrase for key &#x27;/Users/z/.ssh/id_rsa&#x27;:</span><br><span class="line">Enumerating objects: 9, done.</span><br><span class="line">Counting objects: 100% (9/9), done.</span><br><span class="line">Delta compression using up to 8 threads</span><br><span class="line">Compressing objects: 100% (7/7), done.</span><br><span class="line">Writing objects: 100% (8/8), 1.59 KiB | 1.59 MiB/s, done.</span><br><span class="line">Total 8 (delta 1), reused 0 (delta 0), pack-reused 0</span><br><span class="line">remote: Resolving deltas: 100% (1/1), done.</span><br><span class="line">To github.com:devops/k8s-yaml.git</span><br><span class="line">   e31f780..1d00559  main -&gt; main</span><br></pre></td></tr></table></figure>

<p>在 GitHub 上查看，确认代码是否提交。</p>
<p><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-64.png" alt="kubesphere-projects-lstack-statefulsets-mysql-64"></p>
<p>接下来将资源配置清单同步到 Gitee 备份仓库。</p>
<ul>
<li>本文采用了手工推送同步的方式 (个人习惯)</li>
<li>Gitee 也支持自动同步 GitHub 的仓库 (更便捷)</li>
</ul>
<p>在 Gitee 新建一个仓库，仓库名称**<a target="_blank" rel="noopener" href="https://gitee.com/zdevops/k8s-yaml">k8s-yaml</a><strong>，类型默认</strong>私有<strong>，点击</strong>创建**。</p>
<p><strong>创建完成后可去仓库设置中修改为开源。</strong></p>
<p><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-65.png" alt="kubesphere-projects-lstack-statefulsets-mysql-65"></p>
<p>创建完成后，因为我们创建的时候，没选择初始化仓库的配置，所以，默认会显示一个帮助页面，告诉你该如何提交代码到仓库。</p>
<p><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-66.png" alt="kubesphere-projects-lstack-statefulsets-mysql-66"></p>
<p>因为，我们已经有了代码仓库，所以我们选择<strong>已有仓库</strong>的配置方法，将已有代码提交到 Gitee。</p>
<p>根据帮助提示操作，要注意 <strong>origin</strong> 我们要换成 <strong>gitee</strong>。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">k8s-yaml[main] % git remote add gitee https://gitee.com/zdevops/k8s-yaml.git</span><br><span class="line"></span><br><span class="line">k8s-yaml[main] % git push -u gitee</span><br><span class="line">Enumerating objects: 11, done.</span><br><span class="line">Counting objects: 100% (11/11), done.</span><br><span class="line">Delta compression using up to 8 threads</span><br><span class="line">Compressing objects: 100% (8/8), done.</span><br><span class="line">Writing objects: 100% (11/11), 2.14 KiB | 2.14 MiB/s, done.</span><br><span class="line">Total 11 (delta 1), reused 3 (delta 0), pack-reused 0</span><br><span class="line">remote: Powered by GITEE.COM [GNK-6.3]</span><br><span class="line">remote: Create a pull request for &#x27;main&#x27; on Gitee by visiting:</span><br><span class="line">remote:     https://gitee.com/zdevops/k8s-yaml/pull/new/zdevops:main...zdevops:master</span><br><span class="line">To https://gitee.com/zdevops/k8s-yaml.git</span><br><span class="line"> * [new branch]      main -&gt; main</span><br><span class="line">Branch &#x27;main&#x27; set up to track remote branch &#x27;main&#x27; from &#x27;gitee&#x27;.</span><br></pre></td></tr></table></figure>

<p>在 Gitee 上查看，确认代码是否提交。</p>
<p><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-67.png" alt="kubesphere-projects-lstack-statefulsets-mysql-67"></p>
<p>修改 Gitee 仓库为开源(可选)。</p>
<p>Gitee 仓库-&gt;<strong>管理</strong>-&gt;<strong>仓库设置</strong>-&gt;<strong>基本信息</strong>，最后面<strong>是否开源</strong>，选择<strong>开源</strong>，<strong>仓库公开须知</strong>，三个都勾选，点击<strong>保存</strong>。</p>
<p><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-70.png" alt="kubesphere-projects-lstack-statefulsets-mysql-70"></p>
<p>修改后，你的代码仓库就是开源，所有人可见的了。</p>
<h3 id="3-5-GitOps-初体验-在-K8S-集群上部署-MySQL"><a href="#3-5-GitOps-初体验-在-K8S-集群上部署-MySQL" class="headerlink" title="3.5. GitOps 初体验-在 K8S 集群上部署 MySQL"></a>3.5. GitOps 初体验-在 K8S 集群上部署 MySQL</h3><p>MySQL 资源配置清单已经存放到了 Git 在线仓库，接下来开启我们的 GitOps 体验之旅。</p>
<p>登录 k8s 的 master 节点，执行后面的操作任务。</p>
<p><strong>生产环境建议打造独立的运维管理节点进行整个集群的管理 , 可以参考《基于 KubeSphere 玩转 k8s-运维管理节点打造手记》</strong></p>
<p>安装 Git。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">[root@ks-k8s-master-0 ~]# yum install git -y</span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * base: mirrors.aliyun.com</span><br><span class="line"> * centos-gluster9: mirrors.aliyun.com</span><br><span class="line"> * extras: mirrors.aliyun.com</span><br><span class="line"> * updates: mirrors.aliyun.com</span><br><span class="line">Resolving Dependencies</span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Running transaction check</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package git.x86_64 0:1.8.3.1-23.el7_8 will be installed</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl-Git = 1.8.3.1-23.el7_8 <span class="keyword">for</span> package: git-1.8.3.1-23.el7_8.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: rsync <span class="keyword">for</span> package: git-1.8.3.1-23.el7_8.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(Term::ReadKey) <span class="keyword">for</span> package: git-1.8.3.1-23.el7_8.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(Git) <span class="keyword">for</span> package: git-1.8.3.1-23.el7_8.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(Error) <span class="keyword">for</span> package: git-1.8.3.1-23.el7_8.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Running transaction check</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-Error.noarch 1:0.17020-2.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-Git.noarch 0:1.8.3.1-23.el7_8 will be installed</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-TermReadKey.x86_64 0:2.30-20.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package rsync.x86_64 0:3.1.2-10.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Finished Dependency Resolution</span></span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">==============================================================================================================================</span><br><span class="line"> Package                            Arch                     Version                             Repository              Size</span><br><span class="line">==============================================================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> git                                x86_64                   1.8.3.1-23.el7_8                    base                   4.4 M</span><br><span class="line">Installing for dependencies:</span><br><span class="line"> perl-Error                         noarch                   1:0.17020-2.el7                     base                    32 k</span><br><span class="line"> perl-Git                           noarch                   1.8.3.1-23.el7_8                    base                    56 k</span><br><span class="line"> perl-TermReadKey                   x86_64                   2.30-20.el7                         base                    31 k</span><br><span class="line"> rsync                              x86_64                   3.1.2-10.el7                        base                   404 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">==============================================================================================================================</span><br><span class="line">Install  1 Package (+4 Dependent packages)</span><br><span class="line"></span><br><span class="line">Total download size: 4.9 M</span><br><span class="line">Installed size: 23 M</span><br><span class="line">Downloading packages:</span><br><span class="line">(1/5): perl-Error-0.17020-2.el7.noarch.rpm                                                             |  32 kB  00:00:00     </span><br><span class="line">(2/5): perl-Git-1.8.3.1-23.el7_8.noarch.rpm                                                            |  56 kB  00:00:00     </span><br><span class="line">(3/5): perl-TermReadKey-2.30-20.el7.x86_64.rpm                                                         |  31 kB  00:00:00     </span><br><span class="line">(4/5): git-1.8.3.1-23.el7_8.x86_64.rpm                                                                 | 4.4 MB  00:00:00     </span><br><span class="line">(5/5): rsync-3.1.2-10.el7.x86_64.rpm                                                                   | 404 kB  00:00:00     </span><br><span class="line">------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line">Total                                                                                          13 MB/s | 4.9 MB  00:00:00     </span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  Installing : 1:perl-Error-0.17020-2.el7.noarch                                                                          1/5 </span><br><span class="line">  Installing : rsync-3.1.2-10.el7.x86_64                                                                                  2/5 </span><br><span class="line">  Installing : perl-TermReadKey-2.30-20.el7.x86_64                                                                        3/5 </span><br><span class="line">  Installing : perl-Git-1.8.3.1-23.el7_8.noarch                                                                           4/5 </span><br><span class="line">  Installing : git-1.8.3.1-23.el7_8.x86_64                                                                                5/5 </span><br><span class="line">  Verifying  : git-1.8.3.1-23.el7_8.x86_64                                                                                1/5 </span><br><span class="line">  Verifying  : 1:perl-Error-0.17020-2.el7.noarch                                                                          2/5 </span><br><span class="line">  Verifying  : perl-TermReadKey-2.30-20.el7.x86_64                                                                        3/5 </span><br><span class="line">  Verifying  : perl-Git-1.8.3.1-23.el7_8.noarch                                                                           4/5 </span><br><span class="line">  Verifying  : rsync-3.1.2-10.el7.x86_64                                                                                  5/5 </span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  git.x86_64 0:1.8.3.1-23.el7_8                                                                                               </span><br><span class="line"></span><br><span class="line">Dependency Installed:</span><br><span class="line">  perl-Error.noarch 1:0.17020-2.el7       perl-Git.noarch 0:1.8.3.1-23.el7_8       perl-TermReadKey.x86_64 0:2.30-20.el7      </span><br><span class="line">  rsync.x86_64 0:3.1.2-10.el7            </span><br><span class="line"></span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure>

<p>创建 devops 目录，我选择 &#x2F;opt 目录作为 devops 的根目录。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@ks-k8s-master-0 ~]# mkdir /opt/devops</span><br><span class="line">[root@ks-k8s-master-0 ~]# cd /opt/devops/</span><br><span class="line">[root@ks-k8s-master-0 devops]# </span><br></pre></td></tr></table></figure>

<p>从 Gitee 下载 <strong>k8s-yaml</strong> 仓库的代码。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@ks-k8s-master-0 devops]# git clone https://gitee.com/zdevops/k8s-yaml.git</span><br><span class="line">Cloning into &#x27;k8s-yaml&#x27;...</span><br><span class="line">remote: Enumerating objects: 11, done.</span><br><span class="line">remote: Counting objects: 100% (11/11), done.</span><br><span class="line">remote: Compressing objects: 100% (8/8), done.</span><br><span class="line">remote: Total 11 (delta 1), reused 0 (delta 0), pack-reused 0</span><br><span class="line">Unpacking objects: 100% (11/11), done.</span><br><span class="line"></span><br><span class="line">[root@ks-k8s-master-0 devops]# ls k8s-yaml/</span><br><span class="line">mysql  README.md</span><br></pre></td></tr></table></figure>

<p>由于是同一个测试环境，先清理掉现有的 MySQL 服务。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@ks-k8s-master-0 devops]# kubectl get secrets -n lstack </span><br><span class="line">NAME                  TYPE                                  DATA   AGE</span><br><span class="line">default-token-x2gzv   kubernetes.io/service-account-token   3      31d</span><br><span class="line">mysql-secret          Opaque                                1      2d20h</span><br><span class="line"></span><br><span class="line">[root@ks-k8s-master-0 devops]# kubectl get configmaps -n lstack </span><br><span class="line">NAME               DATA   AGE</span><br><span class="line">kube-root-ca.crt   1      31d</span><br><span class="line">mysql-cnf          1      47h</span><br><span class="line"></span><br><span class="line">[root@ks-k8s-master-0 devops]# kubectl get service -n lstack </span><br><span class="line">NAME                                                     TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE</span><br><span class="line">glusterfs-dynamic-afe88cf4-86b1-4215-833a-534c5f779a22   ClusterIP   10.233.13.188   &lt;none&gt;        1/TCP            2d</span><br><span class="line">mysql-1dpr                                               ClusterIP   None            &lt;none&gt;        3306/TCP         2d</span><br><span class="line">mysql-external                                           NodePort    10.233.36.71    &lt;none&gt;        3306:32529/TCP   47h</span><br><span class="line"></span><br><span class="line">[root@ks-k8s-master-0 devops]# kubectl get statefulsets -n lstack </span><br><span class="line">NAME    READY   AGE</span><br><span class="line">mysql   1/1     2d</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">清理</span></span><br><span class="line">[root@ks-k8s-master-0 devops]# kubectl delete statefulsets mysql -n lstack</span><br><span class="line">statefulset.apps &quot;mysql&quot; deleted</span><br><span class="line">[root@ks-k8s-master-0 devops]# kubectl delete service mysql-external -n lstack</span><br><span class="line">service &quot;mysql-external&quot; deleted</span><br><span class="line">[root@ks-k8s-master-0 devops]# kubectl delete service mysql-1dpr -n lstack</span><br><span class="line">service &quot;mysql-1dpr&quot; deleted</span><br><span class="line">[root@ks-k8s-master-0 devops]# kubectl delete secrets mysql-secret -n lstack</span><br><span class="line">secret &quot;mysql-secret&quot; deleted</span><br><span class="line">[root@ks-k8s-master-0 devops]# kubectl delete configmaps mysql-cnf -n lstack</span><br><span class="line">configmap &quot;mysql-cnf&quot; deleted</span><br></pre></td></tr></table></figure>

<p>利用资源配置清单一键部署 MySQL。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@ks-k8s-master-0 devops]# cd /opt/devops/k8s-yaml/</span><br><span class="line">[root@ks-k8s-master-0 k8s-yaml]# ls</span><br><span class="line">mysql  README.md</span><br><span class="line"></span><br><span class="line">[root@ks-k8s-master-0 k8s-yaml]# kubectl apply -f mysql/single/</span><br><span class="line">configmap/mysql-cnf created</span><br><span class="line">service/mysql-external created</span><br><span class="line">secret/mysql-secret created</span><br><span class="line">service/mysql-headless created</span><br></pre></td></tr></table></figure>

<p>验证结果，发现 <strong>StatefulSet</strong> 没有创建，分析问题。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">[root@ks-k8s-master-0 k8s-yaml]# kubectl get statefulsets -n lstack</span><br><span class="line">No resources found in lstack namespace.</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">一开始我以为我遗漏了配置文件，<span class="built_in">ls</span>看一眼，发现文件都在</span></span><br><span class="line">[root@ks-k8s-master-0 k8s-yaml]# ls</span><br><span class="line">mysql  README.md</span><br><span class="line">[root@ks-k8s-master-0 k8s-yaml]# cd mysql/</span><br><span class="line">[root@ks-k8s-master-0 mysql]# ls</span><br><span class="line">single</span><br><span class="line">[root@ks-k8s-master-0 mysql]# cd single/</span><br><span class="line">[root@ks-k8s-master-0 single]# ls</span><br><span class="line">mysql-cfm.yaml  mysql-external.yaml  mysql-secret.yaml  mysql-sts.yaml</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">确认一下文件内容，发现文件也有内容</span></span><br><span class="line">[root@ks-k8s-master-0 single]# vi mysql-sts.yaml</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">再次执行，发现了端倪，为啥只有service/mysql-headless 的资源配置，没有statefulset</span></span><br><span class="line">[root@ks-k8s-master-0 single]# kubectl apply -f mysql-sts.yaml </span><br><span class="line">service/mysql-headless unchanged</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">再次确认，发现编辑文件的时候遗漏了一点，当一个配置文件有多种资源定义时，不同资源的配置直接需要用<span class="string">&quot;---&quot;</span>分隔。修改配置文件再次执行，发现执行成功。</span></span><br><span class="line">[root@ks-k8s-master-0 single]# vi mysql-sts.yaml</span><br><span class="line">[root@ks-k8s-master-0 single]# cd ..</span><br><span class="line"></span><br><span class="line">[root@ks-k8s-master-0 mysql]# kubectl apply -f single/</span><br><span class="line">configmap/mysql-cnf unchanged</span><br><span class="line">service/mysql-external unchanged</span><br><span class="line">secret/mysql-secret unchanged</span><br><span class="line">statefulset.apps/mysql created</span><br><span class="line">service/mysql-headless unchanged</span><br><span class="line"></span><br><span class="line">[root@ks-k8s-master-0 mysql]# kubectl get statefulsets -n lstack -o wide</span><br><span class="line">NAME    READY   AGE   CONTAINERS     IMAGES</span><br><span class="line">mysql   1/1     31s   lstack-mysql   mysql:5.7.38</span><br><span class="line">[root@ks-k8s-master-0 mysql]# kubectl get pods -n lstack -o wide</span><br><span class="line">NAME      READY   STATUS    RESTARTS   AGE   IP              NODE              NOMINATED NODE   READINESS GATES</span><br><span class="line">mysql-0   1/1     Running   0          35s   10.233.116.59   ks-k8s-master-2   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure>

<p>回到我们的 KubeSphere 的管理控制台，发现 mysql 的工作负载也能在界面中显示，这也验证了在原生 k8s 上的操作也会直接反应到 KubeSphere 的管理控制台。</p>
<p><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-71.png" alt="kubesphere-projects-lstack-statefulsets-mysql-71"></p>
<h3 id="3-6-二次体验-GitOps"><a href="#3-6-二次体验-GitOps" class="headerlink" title="3.6. 二次体验 GitOps"></a>3.6. 二次体验 GitOps</h3><p>正好借着上面出现的问题，二次体验一下 GitOps。我们直接在部署服务器上修改了 <strong>mysql-sts.yaml</strong>，且修改后的结果验证成功。</p>
<p><strong>为了演示 GitOps 的更多场景，直接在部署服务器上修改，然后提交到在线代码仓库。</strong></p>
<p><strong>实际工作中我都是在自己的办公电脑上修改，提交到在线代码仓库，然后部署服务器拉取更新代码。</strong></p>
<p>修改后的 <strong>mysql-sts.yaml</strong>，由于篇幅问题这里只演示关键部分，StatefulSet 的完整配置见 Gitee 仓库或是前文。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StatefulSet</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mysql</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">lstack</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">mysql</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mysql-headless</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">lstack</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">mysql</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tcp-mysql</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">3306</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">3306</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">mysql</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="string">None</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span></span><br></pre></td></tr></table></figure>

<p>提交修改后的代码到代码仓库。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改后查看git仓库的变化</span></span><br><span class="line">[root@ks-k8s-master-0 single]# git status</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">On branch main</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Changes not staged <span class="keyword">for</span> commit:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">  (use <span class="string">&quot;git add &lt;file&gt;...&quot;</span> to update what will be committed)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">  (use <span class="string">&quot;git checkout -- &lt;file&gt;...&quot;</span> to discard changes <span class="keyword">in</span> working directory)</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">#       modified:   mysql-sts.yaml</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash">no changes added to commit (use <span class="string">&quot;git add&quot;</span> and/or <span class="string">&quot;git commit -a&quot;</span>)</span></span><br><span class="line"></span><br><span class="line">[root@ks-k8s-master-0 single]# git diff </span><br><span class="line">diff --git a/mysql/single/mysql-sts.yaml b/mysql/single/mysql-sts.yaml</span><br><span class="line">index f775920..1eded9c 100644</span><br><span class="line">--- a/mysql/single/mysql-sts.yaml</span><br><span class="line">+++ b/mysql/single/mysql-sts.yaml</span><br><span class="line">@@ -1,3 +1,4 @@</span><br><span class="line">+---</span><br><span class="line"> kind: StatefulSet</span><br><span class="line"> apiVersion: apps/v1</span><br><span class="line"> metadata:</span><br><span class="line">@@ -68,6 +69,7 @@ spec:</span><br><span class="line">         storageClassName: glusterfs</span><br><span class="line">   serviceName: mysql-headless</span><br><span class="line"> </span><br><span class="line">+---</span><br><span class="line"> kind: Service</span><br><span class="line"> apiVersion: v1</span><br><span class="line"> metadata:</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">本地提交代码变更</span></span><br><span class="line">[root@ks-k8s-master-0 single]# git commit -am &#x27;修复mysql statefulset配置不生效问题&#x27;</span><br><span class="line"></span><br><span class="line">*** Please tell me who you are.</span><br><span class="line"></span><br><span class="line">Run</span><br><span class="line"></span><br><span class="line">  git config --global user.email &quot;you@example.com&quot;</span><br><span class="line">  git config --global user.name &quot;Your Name&quot;</span><br><span class="line"></span><br><span class="line">to set your account&#x27;s default identity.</span><br><span class="line">Omit --global to set the identity only in this repository.</span><br><span class="line"></span><br><span class="line">fatal: unable to auto-detect email address (got &#x27;root@ks-k8s-master-0.(none)&#x27;)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">发现报错了，因为我们这是新环境，还没有配置git的user.email和user.name。按提示配置。</span> </span><br><span class="line">[root@ks-k8s-master-0 single]# git config --global user.email devops@163.com</span><br><span class="line">[root@ks-k8s-master-0 single]# git config --global user.name &quot;devops&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">再次提交</span></span><br><span class="line">[root@ks-k8s-master-0 single]# git commit -am &#x27;修复mysql statefulset配置不生效问题&#x27;</span><br><span class="line">[main f5ba03b] 修复mysql statefulset配置不生效问题</span><br><span class="line"> 1 file changed, 2 insertions(+)</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">push到在线代码仓库，有一个warning可以忽略，也可以按提示执行</span></span><br><span class="line">[root@ks-k8s-master-0 single]# git push</span><br><span class="line">warning: push.default is unset; its implicit value is changing in</span><br><span class="line">Git 2.0 from &#x27;matching&#x27; to &#x27;simple&#x27;. To squelch this message</span><br><span class="line">and maintain the current behavior after the default changes, use:</span><br><span class="line"></span><br><span class="line">  git config --global push.default matching</span><br><span class="line"></span><br><span class="line">To squelch this message and adopt the new behavior now, use:</span><br><span class="line"></span><br><span class="line">  git config --global push.default simple</span><br><span class="line"></span><br><span class="line">See &#x27;git help config&#x27; and search for &#x27;push.default&#x27; for further information.</span><br><span class="line">(the &#x27;simple&#x27; mode was introduced in Git 1.7.11. Use the similar mode</span><br><span class="line">&#x27;current&#x27; instead of &#x27;simple&#x27; if you sometimes use older versions of Git)</span><br><span class="line"></span><br><span class="line">Username for &#x27;https://gitee.com&#x27;: zdevops</span><br><span class="line">Password for &#x27;https://zdevops@gitee.com&#x27;: </span><br><span class="line">Counting objects: 9, done.</span><br><span class="line">Delta compression using up to 8 threads.</span><br><span class="line">Compressing objects: 100% (4/4), done.</span><br><span class="line">Writing objects: 100% (5/5), 456 bytes | 0 bytes/s, done.</span><br><span class="line">Total 5 (delta 2), reused 0 (delta 0)</span><br><span class="line">remote: Powered by GITEE.COM [GNK-6.3]</span><br><span class="line">To https://gitee.com/zdevops/k8s-yaml.git</span><br><span class="line">   1d00559..f5ba03b  main -&gt; main</span><br></pre></td></tr></table></figure>

<p>查看 Gitee 在线代码仓库是否有变更。</p>
<p><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-72.png" alt="kubesphere-projects-lstack-statefulsets-mysql-72"></p>
<p>在个人的办公电脑上，同步更新后的代码。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">更新代码</span></span><br><span class="line">k8s-yaml[main] % git pull</span><br><span class="line">remote: Enumerating objects: 9, done.</span><br><span class="line">remote: Counting objects: 100% (9/9), done.</span><br><span class="line">remote: Compressing objects: 100% (4/4), done.</span><br><span class="line">remote: Total 5 (delta 2), reused 0 (delta 0), pack-reused 0</span><br><span class="line">Unpacking objects: 100% (5/5), 436 bytes | 87.00 KiB/s, done.</span><br><span class="line">From https://gitee.com/zdevops/k8s-yaml</span><br><span class="line">   1d00559..f5ba03b  main       -&gt; gitee/main</span><br><span class="line">Updating 1d00559..f5ba03b</span><br><span class="line">Fast-forward</span><br><span class="line"> mysql/single/mysql-sts.yaml | 2 ++</span><br><span class="line"> 1 file changed, 2 insertions(+)</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">同步更新后的代码到Github</span></span><br><span class="line">k8s-yaml[main] % git push -u origin</span><br><span class="line">Enter passphrase for key &#x27;/Users/z/.ssh/id_rsa&#x27;:</span><br><span class="line">Enumerating objects: 9, done.</span><br><span class="line">Counting objects: 100% (9/9), done.</span><br><span class="line">Delta compression using up to 8 threads</span><br><span class="line">Compressing objects: 100% (4/4), done.</span><br><span class="line">Writing objects: 100% (5/5), 456 bytes | 456.00 KiB/s, done.</span><br><span class="line">Total 5 (delta 2), reused 0 (delta 0), pack-reused 0</span><br><span class="line">remote: Resolving deltas: 100% (2/2), completed with 2 local objects.</span><br><span class="line">To github.com:devops/k8s-yaml.git</span><br><span class="line">   1d00559..f5ba03b  main -&gt; main</span><br><span class="line">Branch &#x27;main&#x27; set up to track remote branch &#x27;main&#x27; from &#x27;origin&#x27;.</span><br></pre></td></tr></table></figure>

<p>查看 GitHub 在线代码仓库是否有变更。</p>
<p><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-73.png" alt="kubesphere-projects-lstack-statefulsets-mysql-73"></p>
<h3 id="3-7-再次体验-GitOps"><a href="#3-7-再次体验-GitOps" class="headerlink" title="3.7.再次体验 GitOps"></a>3.7.再次体验 GitOps</h3><p><strong>模拟一个业务场景，再次体验一下 GitOps。</strong></p>
<ul>
<li><p>MySQL 上线运行后，由于业务量上涨，初始配置参数中的 <strong>max_connections</strong> 太小了，需要增大。</p>
</li>
<li><p>配置参数调整完成后，更新线上配置，并重启服务(生产环境数据库不要轻易重启，这种需求可以用临时修改解决)。</p>
</li>
<li><p>这里只是模拟一个简单的例子，带大家体验 GitOps，实际使用中所有的配置文件都建议使用 Git 进行版本控制。</p>
</li>
</ul>
<p>编辑本地 Git 仓库 MySQL 资源配置清单中的 <strong>mysql-cfm.yaml</strong> 文件，修改 <strong>max_connections</strong>，从 512 变成 1024。</p>
<p>提交修改到 Git 在线仓库。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看修改状态</span></span><br><span class="line">k8s-yaml[main*] % git status</span><br><span class="line">On branch main</span><br><span class="line">Your branch is up to date with &#x27;origin/main&#x27;.</span><br><span class="line"></span><br><span class="line">Changes not staged for commit:</span><br><span class="line">  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)</span><br><span class="line">  (use &quot;git restore &lt;file&gt;...&quot; to discard changes in working directory)</span><br><span class="line">	modified:   mysql/single/mysql-cfm.yaml</span><br><span class="line"></span><br><span class="line">no changes added to commit (use &quot;git add&quot; and/or &quot;git commit -a&quot;)</span><br><span class="line"></span><br><span class="line">k8s-yaml[main*] % git diff</span><br><span class="line">diff --git a/mysql/single/mysql-cfm.yaml b/mysql/single/mysql-cfm.yaml</span><br><span class="line">index e24d96d..50d1778 100644</span><br><span class="line">--- a/mysql/single/mysql-cfm.yaml</span><br><span class="line">+++ b/mysql/single/mysql-cfm.yaml</span><br><span class="line">@@ -10,7 +10,7 @@ data:</span><br><span class="line">     lock_wait_timeout = 3600</span><br><span class="line">     open_files_limit    = 65535</span><br><span class="line">     back_log = 1024</span><br><span class="line">-    max_connections = 512</span><br><span class="line">+    max_connections = 1024</span><br><span class="line">     max_connect_errors = 1000000</span><br><span class="line">     table_open_cache = 1024</span><br><span class="line">     table_definition_cache = 1024</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">提交本地修改</span></span><br><span class="line">k8s-yaml[main*] % git commit -am &#x27;修改mysql-cnf中max_connections的值&#x27;</span><br><span class="line">[main 180f97a] 修改mysql-cnf中max_connections的值</span><br><span class="line"> 1 file changed, 1 insertion(+), 1 deletion(-)</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">提交到Github</span></span><br><span class="line">k8s-yaml[main] % git push</span><br><span class="line">Enter passphrase for key &#x27;/Users/z/.ssh/id_rsa&#x27;:</span><br><span class="line">Enumerating objects: 9, done.</span><br><span class="line">Counting objects: 100% (9/9), done.</span><br><span class="line">Delta compression using up to 8 threads</span><br><span class="line">Compressing objects: 100% (4/4), done.</span><br><span class="line">Writing objects: 100% (5/5), 447 bytes | 447.00 KiB/s, done.</span><br><span class="line">Total 5 (delta 2), reused 0 (delta 0), pack-reused 0</span><br><span class="line">remote: Resolving deltas: 100% (2/2), completed with 2 local objects.</span><br><span class="line">To github.com:devops/k8s-yaml.git</span><br><span class="line">   f5ba03b..180f97a  main -&gt; main</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">同步到Gitee</span></span><br><span class="line">k8s-yaml[main] % git push -u gitee</span><br><span class="line">Enumerating objects: 9, done.</span><br><span class="line">Counting objects: 100% (9/9), done.</span><br><span class="line">Delta compression using up to 8 threads</span><br><span class="line">Compressing objects: 100% (4/4), done.</span><br><span class="line">Writing objects: 100% (5/5), 447 bytes | 447.00 KiB/s, done.</span><br><span class="line">Total 5 (delta 2), reused 0 (delta 0), pack-reused 0</span><br><span class="line">remote: Powered by GITEE.COM [GNK-6.3]</span><br><span class="line">To https://gitee.com/zdevops/k8s-yaml.git</span><br><span class="line">   f5ba03b..180f97a  main -&gt; main</span><br><span class="line">Branch &#x27;main&#x27; set up to track remote branch &#x27;main&#x27; from &#x27;gitee&#x27;.</span><br></pre></td></tr></table></figure>

<p>登录运维管理节点，更新 Git 代码，并重新运行。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">[root@ks-k8s-master-0 k8s-yaml]# git pull</span><br><span class="line">remote: Enumerating objects: 9, done.</span><br><span class="line">remote: Counting objects: 100% (9/9), done.</span><br><span class="line">remote: Compressing objects: 100% (4/4), done.</span><br><span class="line">remote: Total 5 (delta 2), reused 0 (delta 0), pack-reused 0</span><br><span class="line">Unpacking objects: 100% (5/5), done.</span><br><span class="line">From https://gitee.com/zdevops/k8s-yaml</span><br><span class="line">   f5ba03b..180f97a  main       -&gt; origin/main</span><br><span class="line">Updating f5ba03b..180f97a</span><br><span class="line">Fast-forward</span><br><span class="line"> mysql/single/mysql-cfm.yaml | 2 +-</span><br><span class="line"> 1 file changed, 1 insertion(+), 1 deletion(-)</span><br><span class="line"></span><br><span class="line">[root@ks-k8s-master-0 k8s-yaml]# kubectl apply -f mysql/single/</span><br><span class="line">configmap/mysql-cnf configured</span><br><span class="line">service/mysql-external unchanged</span><br><span class="line">secret/mysql-secret unchanged</span><br><span class="line">statefulset.apps/mysql configured</span><br><span class="line">service/mysql-headless unchanged</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看ConfigMap的变化</span></span><br><span class="line">[root@ks-k8s-master-0 k8s-yaml]# kubectl get configmaps mysql-cnf -n lstack -o yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">data:</span><br><span class="line">  custom.cnf: |-</span><br><span class="line">    [mysqld]</span><br><span class="line">    #performance setttings</span><br><span class="line">    lock_wait_timeout = 3600</span><br><span class="line">    open_files_limit    = 65535</span><br><span class="line">    back_log = 1024</span><br><span class="line">    max_connections = 1024</span><br><span class="line">    max_connect_errors = 1000000</span><br><span class="line">    table_open_cache = 1024</span><br><span class="line">    table_definition_cache = 1024</span><br><span class="line">    thread_stack = 512K</span><br><span class="line">    sort_buffer_size = 4M</span><br><span class="line">    join_buffer_size = 4M</span><br><span class="line">    read_buffer_size = 8M</span><br><span class="line">    read_rnd_buffer_size = 4M</span><br><span class="line">    bulk_insert_buffer_size = 64M</span><br><span class="line">    thread_cache_size = 768</span><br><span class="line">    interactive_timeout = 600</span><br><span class="line">    wait_timeout = 600</span><br><span class="line">    tmp_table_size = 32M</span><br><span class="line">    max_heap_table_size = 32M</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  annotations:</span><br><span class="line">    kubectl.kubernetes.io/last-applied-configuration: |</span><br><span class="line">      &#123;&quot;apiVersion&quot;:&quot;v1&quot;,&quot;data&quot;:&#123;&quot;custom.cnf&quot;:&quot;[mysqld]\n#performance setttings\nlock_wait_timeout = 3600\nopen_files_limit    = 65535\nback_log = 1024\nmax_connections = 1024\nmax_connect_errors = 1000000\ntable_open_cache = 1024\ntable_definition_cache = 1024\nthread_stack = 512K\nsort_buffer_size = 4M\njoin_buffer_size = 4M\nread_buffer_size = 8M\nread_rnd_buffer_size = 4M\nbulk_insert_buffer_size = 64M\nthread_cache_size = 768\ninteractive_timeout = 600\nwait_timeout = 600\ntmp_table_size = 32M\nmax_heap_table_size = 32M&quot;&#125;,&quot;kind&quot;:&quot;ConfigMap&quot;,&quot;metadata&quot;:&#123;&quot;annotations&quot;:&#123;&#125;,&quot;name&quot;:&quot;mysql-cnf&quot;,&quot;namespace&quot;:&quot;lstack&quot;&#125;&#125;</span><br><span class="line">  creationTimestamp: &quot;2022-05-12T07:20:07Z&quot;</span><br><span class="line">  name: mysql-cnf</span><br><span class="line">  namespace: lstack</span><br><span class="line">  resourceVersion: &quot;8928391&quot;</span><br><span class="line">  uid: 1b7322cf-f11e-445d-a2ba-b42a90ade469</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重启mysql pod使配置生效</span></span><br><span class="line">[root@ks-k8s-master-0 k8s-yaml]# kubectl delete -f mysql/single/mysql-sts.yaml </span><br><span class="line">statefulset.apps &quot;mysql&quot; deleted</span><br><span class="line">service &quot;mysql-headless&quot; deleted</span><br><span class="line"></span><br><span class="line">[root@ks-k8s-master-0 k8s-yaml]# kubectl apply -f mysql/single/mysql-sts.yaml </span><br><span class="line">statefulset.apps/mysql created</span><br><span class="line">service/mysql-headless created</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看mysql容器内部配置是否更新</span></span><br><span class="line">[root@ks-k8s-master-0 k8s-yaml]# kubectl exec  mysql-0  -n lstack -- cat /etc/mysql/conf.d/custom.cnf</span><br><span class="line">[mysqld]</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">performance setttings</span></span><br><span class="line">lock_wait_timeout = 3600</span><br><span class="line">open_files_limit    = 65535</span><br><span class="line">back_log = 1024</span><br><span class="line">max_connections = 1024</span><br><span class="line">max_connect_errors = 1000000</span><br><span class="line">table_open_cache = 1024</span><br><span class="line">table_definition_cache = 1024</span><br><span class="line">thread_stack = 512K</span><br><span class="line">sort_buffer_size = 4M</span><br><span class="line">join_buffer_size = 4M</span><br><span class="line">read_buffer_size = 8M</span><br><span class="line">read_rnd_buffer_size = 4M</span><br><span class="line">bulk_insert_buffer_size = 64M</span><br><span class="line">thread_cache_size = 768</span><br><span class="line">interactive_timeout = 600</span><br><span class="line">wait_timeout = 600</span><br><span class="line">tmp_table_size = 32M</span><br></pre></td></tr></table></figure>

<p><strong>切记！</strong> 上面的例子只是让大家体验 GitOps，生产环境不要轻易重启数据库服务器，除非你知道自己在干什么。</p>
<p>现在经过验证，我们的 MySQL 的配置可用且比较稳定，我们把这个好的状态记录下来，避免以后修改变更弄坏了，再找不回原来正确的配置。</p>
<p>在我们的个人电脑上给当前的 Git 代码打个 Tag，记录当前的状态 (也可以通过在线仓库的管理界面操作)。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">打tag -a tag名字 -m tag描述</span></span><br><span class="line">k8s-yaml[main] % git tag -a v0.1  -m &#x27;mysql version v0.1&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看现有tag</span></span><br><span class="line">k8s-yaml[main] % git tag -l</span><br><span class="line">v0.1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看tag详细信息</span></span><br><span class="line">k8s-yaml[main] % git show v0.1</span><br><span class="line">tag v0.1</span><br><span class="line">Tagger: devops &lt;devops@163.com&gt;</span><br><span class="line">Date:   Thu May 12 18:15:34 2022 +0800</span><br><span class="line"></span><br><span class="line">mysql version v0.1</span><br><span class="line"></span><br><span class="line">commit 180f97ac96da504a0b46eb4871ef423f64fde093 (HEAD -&gt; main, tag: v0.1, origin/main, origin/HEAD, gitee/main)</span><br><span class="line">Author: devops &lt;devops@163.com&gt;</span><br><span class="line">Date:   Thu May 12 17:48:18 2022 +0800</span><br><span class="line"></span><br><span class="line">    修改mysql-cnf中max_connections的值</span><br><span class="line"></span><br><span class="line">diff --git a/mysql/single/mysql-cfm.yaml b/mysql/single/mysql-cfm.yaml</span><br><span class="line">index e24d96d..50d1778 100644</span><br><span class="line">--- a/mysql/single/mysql-cfm.yaml</span><br><span class="line">+++ b/mysql/single/mysql-cfm.yaml</span><br><span class="line">@@ -10,7 +10,7 @@ data:</span><br><span class="line">     lock_wait_timeout = 3600</span><br><span class="line">     open_files_limit    = 65535</span><br><span class="line">     back_log = 1024</span><br><span class="line">-    max_connections = 512</span><br><span class="line">+    max_connections = 1024</span><br><span class="line">     max_connect_errors = 1000000</span><br><span class="line">     table_open_cache = 1024</span><br><span class="line">     table_definition_cache = 1024</span><br><span class="line">     </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将tag推送到远程服务器</span></span><br><span class="line">k8s-yaml[main] % git push -u origin --tags</span><br><span class="line">Enter passphrase for key &#x27;/Users/z/.ssh/id_rsa&#x27;:</span><br><span class="line">Enumerating objects: 1, done.</span><br><span class="line">Counting objects: 100% (1/1), done.</span><br><span class="line">Writing objects: 100% (1/1), 157 bytes | 157.00 KiB/s, done.</span><br><span class="line">Total 1 (delta 0), reused 0 (delta 0), pack-reused 0</span><br><span class="line">To github.com:devops/k8s-yaml.git</span><br><span class="line"> * [new tag]         v0.1 -&gt; v0.1</span><br><span class="line"></span><br><span class="line">k8s-yaml[main] % git push -u gitee --tags</span><br><span class="line">Enumerating objects: 1, done.</span><br><span class="line">Counting objects: 100% (1/1), done.</span><br><span class="line">Writing objects: 100% (1/1), 157 bytes | 157.00 KiB/s, done.</span><br><span class="line">Total 1 (delta 0), reused 0 (delta 0), pack-reused 0</span><br><span class="line">remote: Powered by GITEE.COM [GNK-6.3]</span><br><span class="line">To https://gitee.com/zdevops/k8s-yaml.git</span><br><span class="line"> * [new tag]         v0.1 -&gt; v0.1</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">线上服务器验证（图略）</span></span><br></pre></td></tr></table></figure>

<p>运维管理服务器更新代码，并切换到指定 tag(<strong>注意！使用 Git 一定要养成每次操作前 git pull</strong> 这种习惯)。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 更新代码</span></span></span><br><span class="line">[root@ks-k8s-master-0 k8s-yaml]# git pull</span><br><span class="line">remote: Enumerating objects: 1, done.</span><br><span class="line">remote: Counting objects: 100% (1/1), done.</span><br><span class="line">remote: Total 1 (delta 0), reused 0 (delta 0), pack-reused 0</span><br><span class="line">Unpacking objects: 100% (1/1), done.</span><br><span class="line">From https://gitee.com/zdevops/k8s-yaml</span><br><span class="line"> * [new tag]         v0.1       -&gt; v0.1</span><br><span class="line">Already up-to-date.</span><br><span class="line"></span><br><span class="line">[root@ks-k8s-master-0 k8s-yaml]# git status</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">On branch main</span></span><br><span class="line">nothing to commit, working directory clean</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 切换到v0.1</span></span></span><br><span class="line">[root@ks-k8s-master-0 k8s-yaml]# git checkout -b v0.1</span><br><span class="line">Switched to a new branch &#x27;v0.1&#x27;</span><br><span class="line"></span><br><span class="line">[root@ks-k8s-master-0 k8s-yaml]# git status</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">On branch v0.1</span></span><br><span class="line">nothing to commit, working directory clean</span><br></pre></td></tr></table></figure>

<p>通过上面的几波操作，我们可以看到，我们所有的配置变更都采用了 Git 管理，完整的记录了配置的全生命周期管理，通过给仓库打分支或是 tag，可以方便我们切换到任意已记录状态。</p>
<hr>
<h2 id="4-高可用部署-MySQL-预留占坑"><a href="#4-高可用部署-MySQL-预留占坑" class="headerlink" title="4. 高可用部署 MySQL(预留占坑)"></a>4. 高可用部署 MySQL(预留占坑)</h2><p>暂时没有高可用部署的需求，因此不涉及高可用模式的 MySQL 的部署，但是有一些思考留着占坑。</p>
<h3 id="4-1-目前的做法"><a href="#4-1-目前的做法" class="headerlink" title="4.1. 目前的做法"></a>4.1. 目前的做法</h3><ul>
<li>不给自己找麻烦，有高可用需求直接买云服务商的 RDS。</li>
<li>实在需要自己搭建，在 K8S 集群之外部署主从。</li>
</ul>
<h3 id="4-2-以后可能的方向"><a href="#4-2-以后可能的方向" class="headerlink" title="4.2. 以后可能的方向"></a>4.2. 以后可能的方向</h3><ul>
<li>K8S 上的 MySQL 主从部署</li>
<li>Operator</li>
<li>Helm</li>
</ul>
<hr>
<h2 id="5-遗留问题"><a href="#5-遗留问题" class="headerlink" title="5.  遗留问题"></a>5.  遗留问题</h2><p>此部分内容也是运维 MySQL 必备的技能，有些内容我也没有经验无法分享，有些内容会在 &lt;&lt; 基于 KubeSphere 的 Kubernetes 生产实践之路 &gt;&gt; 系列文档中介绍。</p>
<ul>
<li>MySQL 数据库备份</li>
<li>MySQL 高可用部署</li>
<li>MySQL 安全加固</li>
<li>MySQL 调优</li>
</ul>
<hr>
<h2 id="6-MySQL-性能-基准-测试"><a href="#6-MySQL-性能-基准-测试" class="headerlink" title="6. MySQL 性能 (基准) 测试"></a>6. MySQL 性能 (基准) 测试</h2><p>运维一定要做到对自己的运维环境<strong>心中有数</strong>，MySQL 上线前一定要进行性能 (基准测试)，有助于了解我们的数据库服务器能达到的理想状态。本次介绍的只是皮毛，只是告诉大家一些基本入门的知识，更细节、更深入的内容请参考其他更专业的文档。</p>
<h3 id="6-1-性能-基准-测试工具安装"><a href="#6-1-性能-基准-测试工具安装" class="headerlink" title="6.1. 性能 (基准) 测试工具安装"></a>6.1. 性能 (基准) 测试工具安装</h3><blockquote>
<p><strong>01-工具选型 (sysbench)</strong></p>
</blockquote>
<ul>
<li>云厂商展示自家数据库产品性能都用这个工具</li>
<li>据说很多 DBA 也喜欢用</li>
</ul>
<blockquote>
<p><strong>02-sysbench 工具安装</strong></p>
</blockquote>
<ul>
<li>安装工具</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入软件源</span></span><br><span class="line">[<span class="string">root@ks-k8s-master-0</span> <span class="string">~</span>]<span class="comment"># curl -s https://packagecloud.io/install/repositories/akopytov/sysbench/script.rpm.sh | sudo bash</span></span><br><span class="line"></span><br><span class="line"><span class="string">Detected</span> <span class="string">operating</span> <span class="string">system</span> <span class="string">as</span> <span class="string">centos/7.</span></span><br><span class="line"><span class="string">Checking</span> <span class="string">for</span> <span class="string">curl...</span></span><br><span class="line"><span class="string">Detected</span> <span class="string">curl...</span></span><br><span class="line"><span class="attr">Downloading repository file:</span> <span class="string">https://packagecloud.io/install/repositories/akopytov/sysbench/config_file.repo?os=centos&amp;dist=7&amp;source=script</span></span><br><span class="line"><span class="string">done.</span></span><br><span class="line"><span class="string">Installing</span> <span class="string">pygpgme</span> <span class="string">to</span> <span class="string">verify</span> <span class="string">GPG</span> <span class="string">signatures...</span></span><br><span class="line"><span class="attr">Loaded plugins:</span> <span class="string">fastestmirror</span></span><br><span class="line"><span class="string">Loading</span> <span class="string">mirror</span> <span class="string">speeds</span> <span class="string">from</span> <span class="string">cached</span> <span class="string">hostfile</span></span><br><span class="line"> <span class="string">*</span> <span class="attr">base:</span> <span class="string">mirrors.aliyun.com</span></span><br><span class="line"> <span class="string">*</span> <span class="attr">centos-gluster9:</span> <span class="string">mirrors.aliyun.com</span></span><br><span class="line"> <span class="string">*</span> <span class="attr">extras:</span> <span class="string">mirrors.aliyun.com</span></span><br><span class="line"> <span class="string">*</span> <span class="attr">updates:</span> <span class="string">mirrors.aliyun.com</span></span><br><span class="line"><span class="string">akopytov_sysbench-source/signature</span>                                                 <span class="string">|</span>  <span class="number">833</span> <span class="string">B</span>  <span class="number">00</span><span class="string">:00:00</span>     </span><br><span class="line"><span class="string">Retrieving</span> <span class="string">key</span> <span class="string">from</span> <span class="string">https://packagecloud.io/akopytov/sysbench/gpgkey</span></span><br><span class="line"><span class="attr">Importing GPG key 0x04DCFD39:</span></span><br><span class="line"> <span class="attr">Userid     :</span> <span class="string">&quot;https://packagecloud.io/akopytov/sysbench-prerelease (https://packagecloud.io/docs#gpg_signing) &lt;support@packagecloud.io&gt;&quot;</span></span><br><span class="line"> <span class="attr">Fingerprint:</span> <span class="number">9789 </span><span class="string">8d69</span> <span class="string">f99e</span> <span class="string">e5ca</span> <span class="string">c462</span> <span class="string">a0f8</span> <span class="string">cf10</span> <span class="number">4890 </span><span class="string">04dc</span> <span class="string">fd39</span></span><br><span class="line"> <span class="attr">From       :</span> <span class="string">https://packagecloud.io/akopytov/sysbench/gpgkey</span></span><br><span class="line"><span class="string">akopytov_sysbench-source/signature</span>                                                 <span class="string">|</span> <span class="number">1.0</span> <span class="string">kB</span>  <span class="number">00</span><span class="string">:00:01</span> <span class="string">!!!</span> </span><br><span class="line"><span class="string">base</span>                                                                               <span class="string">|</span> <span class="number">3.6</span> <span class="string">kB</span>  <span class="number">00</span><span class="string">:00:00</span>     </span><br><span class="line"><span class="string">centos-gluster9</span>                                                                    <span class="string">|</span> <span class="number">3.0</span> <span class="string">kB</span>  <span class="number">00</span><span class="string">:00:00</span>     </span><br><span class="line"><span class="string">extras</span>                                                                             <span class="string">|</span> <span class="number">2.9</span> <span class="string">kB</span>  <span class="number">00</span><span class="string">:00:00</span>     </span><br><span class="line"><span class="string">updates</span>                                                                            <span class="string">|</span> <span class="number">2.9</span> <span class="string">kB</span>  <span class="number">00</span><span class="string">:00:00</span>     </span><br><span class="line"><span class="string">akopytov_sysbench-source/primary</span>                                                                                                <span class="string">|</span> <span class="number">2.0</span> <span class="string">kB</span>  <span class="number">00</span><span class="string">:00:09</span>     </span><br><span class="line"><span class="string">akopytov_sysbench-source</span>                                                                                                                         <span class="number">15</span><span class="string">/15</span></span><br><span class="line"><span class="string">Package</span> <span class="string">pygpgme-0.3-9.el7.x86_64</span> <span class="string">already</span> <span class="string">installed</span> <span class="string">and</span> <span class="string">latest</span> <span class="string">version</span></span><br><span class="line"><span class="string">Nothing</span> <span class="string">to</span> <span class="string">do</span></span><br><span class="line"><span class="string">Installing</span> <span class="string">yum-utils...</span></span><br><span class="line"><span class="attr">Loaded plugins:</span> <span class="string">fastestmirror</span></span><br><span class="line"><span class="string">Loading</span> <span class="string">mirror</span> <span class="string">speeds</span> <span class="string">from</span> <span class="string">cached</span> <span class="string">hostfile</span></span><br><span class="line"> <span class="string">*</span> <span class="attr">base:</span> <span class="string">mirrors.aliyun.com</span></span><br><span class="line"> <span class="string">*</span> <span class="attr">centos-gluster9:</span> <span class="string">mirrors.aliyun.com</span></span><br><span class="line"> <span class="string">*</span> <span class="attr">extras:</span> <span class="string">mirrors.aliyun.com</span></span><br><span class="line"> <span class="string">*</span> <span class="attr">updates:</span> <span class="string">mirrors.aliyun.com</span></span><br><span class="line"><span class="string">Package</span> <span class="string">yum-utils-1.1.31-54.el7_8.noarch</span> <span class="string">already</span> <span class="string">installed</span> <span class="string">and</span> <span class="string">latest</span> <span class="string">version</span></span><br><span class="line"><span class="string">Nothing</span> <span class="string">to</span> <span class="string">do</span></span><br><span class="line"><span class="string">Generating</span> <span class="string">yum</span> <span class="string">cache</span> <span class="string">for</span> <span class="string">akopytov_sysbench...</span></span><br><span class="line"><span class="attr">Importing GPG key 0x04DCFD39:</span></span><br><span class="line"> <span class="attr">Userid     :</span> <span class="string">&quot;https://packagecloud.io/akopytov/sysbench-prerelease (https://packagecloud.io/docs#gpg_signing) &lt;support@packagecloud.io&gt;&quot;</span></span><br><span class="line"> <span class="attr">Fingerprint:</span> <span class="number">9789 </span><span class="string">8d69</span> <span class="string">f99e</span> <span class="string">e5ca</span> <span class="string">c462</span> <span class="string">a0f8</span> <span class="string">cf10</span> <span class="number">4890 </span><span class="string">04dc</span> <span class="string">fd39</span></span><br><span class="line"> <span class="attr">From       :</span> <span class="string">https://packagecloud.io/akopytov/sysbench/gpgkey</span></span><br><span class="line"><span class="string">Generating</span> <span class="string">yum</span> <span class="string">cache</span> <span class="string">for</span> <span class="string">akopytov_sysbench-source...</span></span><br><span class="line"></span><br><span class="line"><span class="string">The</span> <span class="string">repository</span> <span class="string">is</span> <span class="string">setup!</span> <span class="string">You</span> <span class="string">can</span> <span class="string">now</span> <span class="string">install</span> <span class="string">packages.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装sysbench</span></span><br><span class="line">[<span class="string">root@ks-k8s-master-0</span> <span class="string">~</span>]<span class="comment"># yum install sysbench -y</span></span><br><span class="line"><span class="attr">Loaded plugins:</span> <span class="string">fastestmirror</span></span><br><span class="line"><span class="string">Loading</span> <span class="string">mirror</span> <span class="string">speeds</span> <span class="string">from</span> <span class="string">cached</span> <span class="string">hostfile</span></span><br><span class="line"> <span class="string">*</span> <span class="attr">base:</span> <span class="string">mirrors.aliyun.com</span></span><br><span class="line"> <span class="string">*</span> <span class="attr">centos-gluster9:</span> <span class="string">mirrors.aliyun.com</span></span><br><span class="line"> <span class="string">*</span> <span class="attr">extras:</span> <span class="string">mirrors.aliyun.com</span></span><br><span class="line"> <span class="string">*</span> <span class="attr">updates:</span> <span class="string">mirrors.aliyun.com</span></span><br><span class="line"><span class="string">akopytov_sysbench/x86_64/signature</span>                                                                                  <span class="string">|</span>  <span class="number">833</span> <span class="string">B</span>  <span class="number">00</span><span class="string">:00:00</span>     </span><br><span class="line"><span class="string">akopytov_sysbench/x86_64/signature</span>                                                                                  <span class="string">|</span> <span class="number">1.0</span> <span class="string">kB</span>  <span class="number">00</span><span class="string">:00:00</span> <span class="string">!!!</span> </span><br><span class="line"><span class="string">akopytov_sysbench-source/signature</span>                                                                                  <span class="string">|</span>  <span class="number">833</span> <span class="string">B</span>  <span class="number">00</span><span class="string">:00:00</span>     </span><br><span class="line"><span class="string">akopytov_sysbench-source/signature</span>                                                                                  <span class="string">|</span> <span class="number">1.0</span> <span class="string">kB</span>  <span class="number">00</span><span class="string">:00:00</span> <span class="string">!!!</span> </span><br><span class="line"><span class="string">Resolving</span> <span class="string">Dependencies</span></span><br><span class="line"><span class="string">--&gt;</span> <span class="string">Running</span> <span class="string">transaction</span> <span class="string">check</span></span><br><span class="line"><span class="string">---&gt;</span> <span class="string">Package</span> <span class="string">sysbench.x86_64</span> <span class="number">0</span><span class="string">:1.0.20-1.el7</span> <span class="string">will</span> <span class="string">be</span> <span class="string">installed</span></span><br><span class="line"><span class="string">--&gt;</span> <span class="attr">Processing Dependency:</span> <span class="string">libpq.so.5()(64bit)</span> <span class="attr">for package:</span> <span class="string">sysbench-1.0.20-1.el7.x86_64</span></span><br><span class="line"><span class="string">--&gt;</span> <span class="string">Running</span> <span class="string">transaction</span> <span class="string">check</span></span><br><span class="line"><span class="string">---&gt;</span> <span class="string">Package</span> <span class="string">postgresql-libs.x86_64</span> <span class="number">0</span><span class="string">:9.2.24-7.el7_9</span> <span class="string">will</span> <span class="string">be</span> <span class="string">installed</span></span><br><span class="line"><span class="string">--&gt;</span> <span class="string">Finished</span> <span class="string">Dependency</span> <span class="string">Resolution</span></span><br><span class="line"></span><br><span class="line"><span class="string">Dependencies</span> <span class="string">Resolved</span></span><br><span class="line"></span><br><span class="line"><span class="string">===========================================================================================================================================</span></span><br><span class="line"> <span class="string">Package</span>                            <span class="string">Arch</span>                      <span class="string">Version</span>                           <span class="string">Repository</span>                            <span class="string">Size</span></span><br><span class="line"><span class="string">===========================================================================================================================================</span></span><br><span class="line"><span class="attr">Installing:</span></span><br><span class="line"> <span class="string">sysbench</span>                           <span class="string">x86_64</span>                    <span class="number">1.0</span><span class="number">.20</span><span class="number">-1.</span><span class="string">el7</span>                      <span class="string">akopytov_sysbench</span>                    <span class="number">430</span> <span class="string">k</span></span><br><span class="line"><span class="attr">Installing for dependencies:</span></span><br><span class="line"> <span class="string">postgresql-libs</span>                    <span class="string">x86_64</span>                    <span class="number">9.2</span><span class="number">.24</span><span class="number">-7.</span><span class="string">el7_9</span>                    <span class="string">updates</span>                              <span class="number">235</span> <span class="string">k</span></span><br><span class="line"></span><br><span class="line"><span class="string">Transaction</span> <span class="string">Summary</span></span><br><span class="line"><span class="string">===========================================================================================================================================</span></span><br><span class="line"><span class="string">Install</span>  <span class="number">1</span> <span class="string">Package</span> <span class="string">(+1</span> <span class="string">Dependent</span> <span class="string">package)</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Total download size:</span> <span class="number">665</span> <span class="string">k</span></span><br><span class="line"><span class="attr">Installed size:</span> <span class="number">1.8</span> <span class="string">M</span></span><br><span class="line"><span class="attr">Downloading packages:</span></span><br><span class="line"><span class="string">(1/2):</span> <span class="string">postgresql-libs-9.2.24-7.el7_9.x86_64.rpm</span>                                                                    <span class="string">|</span> <span class="number">235</span> <span class="string">kB</span>  <span class="number">00</span><span class="string">:00:00</span>     </span><br><span class="line"><span class="string">(2/2):</span> <span class="string">sysbench-1.0.20-1.el7.x86_64.rpm</span>                                                                             <span class="string">|</span> <span class="number">430</span> <span class="string">kB</span>  <span class="number">00</span><span class="string">:00:03</span>     </span><br><span class="line"><span class="string">-------------------------------------------------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="string">Total</span>                                                                                                      <span class="number">204</span> <span class="string">kB/s</span> <span class="string">|</span> <span class="number">665</span> <span class="string">kB</span>  <span class="number">00</span><span class="string">:00:03</span>     </span><br><span class="line"><span class="string">Running</span> <span class="string">transaction</span> <span class="string">check</span></span><br><span class="line"><span class="string">Running</span> <span class="string">transaction</span> <span class="string">test</span></span><br><span class="line"><span class="string">Transaction</span> <span class="string">test</span> <span class="string">succeeded</span></span><br><span class="line"><span class="string">Running</span> <span class="string">transaction</span></span><br><span class="line">  <span class="attr">Installing :</span> <span class="string">postgresql-libs-9.2.24-7.el7_9.x86_64</span>                                                                                   <span class="number">1</span><span class="string">/2</span> </span><br><span class="line">  <span class="attr">Installing :</span> <span class="string">sysbench-1.0.20-1.el7.x86_64</span>                                                                                            <span class="number">2</span><span class="string">/2</span> </span><br><span class="line">  <span class="attr">Verifying  :</span> <span class="string">postgresql-libs-9.2.24-7.el7_9.x86_64</span>                                                                                   <span class="number">1</span><span class="string">/2</span> </span><br><span class="line">  <span class="attr">Verifying  :</span> <span class="string">sysbench-1.0.20-1.el7.x86_64</span>                                                                                            <span class="number">2</span><span class="string">/2</span> </span><br><span class="line"></span><br><span class="line"><span class="attr">Installed:</span></span><br><span class="line">  <span class="string">sysbench.x86_64</span> <span class="number">0</span><span class="string">:1.0.20-1.el7</span>                                                                                                           </span><br><span class="line"></span><br><span class="line"><span class="attr">Dependency Installed:</span></span><br><span class="line">  <span class="string">postgresql-libs.x86_64</span> <span class="number">0</span><span class="string">:9.2.24-7.el7_9</span>                                                                                                  </span><br><span class="line"></span><br><span class="line"><span class="string">Complete!</span></span><br></pre></td></tr></table></figure>

<ul>
<li>验证-执行命令查看版本</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@ks-k8s-master-0 ~]# sysbench --version</span><br><span class="line">sysbench 1.0.20</span><br></pre></td></tr></table></figure>

<h3 id="6-2-性能-基准-测试"><a href="#6-2-性能-基准-测试" class="headerlink" title="6.2. 性能 (基准) 测试"></a>6.2. 性能 (基准) 测试</h3><blockquote>
<p><strong>01-测试方案</strong></p>
</blockquote>
<ul>
<li><p>测试参数</p>
</li>
<li><table>
<thead>
<tr>
<th align="center">指标</th>
<th align="center">值</th>
</tr>
</thead>
<tbody><tr>
<td align="center">线程数</td>
<td align="center">8&#x2F;16&#x2F;32</td>
</tr>
<tr>
<td align="center">单表数据量</td>
<td align="center">100000</td>
</tr>
<tr>
<td align="center">表数量</td>
<td align="center">16</td>
</tr>
</tbody></table>
<p>性能指标</p>
<table>
<thead>
<tr>
<th align="center">指标</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">TPS</td>
<td align="center">Transactions Per Second ，即数据库每秒执行的事务数，以 commit 成功次数为准。</td>
</tr>
<tr>
<td align="center">QPS</td>
<td align="center">Queries Per Second ，即数据库每秒执行的 SQL 数（含 insert、select、update、delete 等）。</td>
</tr>
<tr>
<td align="center">RT</td>
<td align="center">Response Time ，响应时间。包括平均响应时间、最小响应时间、最大响应时间、每个响应时间的查询占比。比较需要重点关注的是，前 95-99% 的最大响应时间。因为它决定了大多数情况下的短板。</td>
</tr>
<tr>
<td align="center">Concurrency Threads</td>
<td align="center">并发量，每秒可处理的查询请求的数量。</td>
</tr>
</tbody></table>
</li>
</ul>
<blockquote>
<p><strong>02-准备测试数据</strong></p>
</blockquote>
<p>使用我们在 k8s 上创建的数据库，涉及数据库操作命令，需要<strong>终端</strong>登录到容器内运行。</p>
<p>提前创建测试用数据库 <strong>sbtest</strong>，并赋予 root 从任意 IP 远程管理所有数据库的权限。</p>
<p><strong>生产环境千万不要这么搞，一定要遵循最小化原则！</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">bash</span></span><br><span class="line">root@mysql-0:/# mysql -u root -p</span><br><span class="line">Enter password:</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 4</span><br><span class="line">Server version: 5.7.38 MySQL Community Server (GPL)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2022, Oracle and/or its affiliates.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type &#x27;help;&#x27; or &#x27;\h&#x27; for help. Type &#x27;\c&#x27; to clear the current input statement.</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">create database sbtest;</span></span><br><span class="line">Query OK, 1 row affected (0.02 sec)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">grant all privileges on *.* to <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified by <span class="string">&#x27;P@88w0rd&#x27;</span> with grant option;</span></span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.02 sec)</span><br></pre></td></tr></table></figure>

<ul>
<li>测试数据库是否能连接</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装mysql客户端，下面的示例是在k8s节点上安装的，由于系统是最小化安装，所有会安装很多依赖。实际测试可以起一个mysql的pod或是用其他的mysql客户端工具。</span></span><br><span class="line"></span><br><span class="line">[root@ks-k8s-master-0 ~]# yum install mysql -y</span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * base: mirrors.aliyun.com</span><br><span class="line"> * centos-gluster9: mirrors.aliyun.com</span><br><span class="line"> * extras: mirrors.aliyun.com</span><br><span class="line"> * updates: mirrors.aliyun.com</span><br><span class="line">akopytov_sysbench/x86_64/signature                                                                                  |  833 B  00:00:00     </span><br><span class="line">akopytov_sysbench/x86_64/signature                                                                                  | 1.0 kB  00:00:00 !!! </span><br><span class="line">akopytov_sysbench-source/signature                                                                                  |  833 B  00:00:00     </span><br><span class="line">akopytov_sysbench-source/signature                                                                                  | 1.0 kB  00:00:00 !!! </span><br><span class="line">Resolving Dependencies</span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Running transaction check</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package mariadb.x86_64 1:5.5.68-1.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(Sys::Hostname) <span class="keyword">for</span> package: 1:mariadb-5.5.68-1.el7.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(IPC::Open3) <span class="keyword">for</span> package: 1:mariadb-5.5.68-1.el7.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(Getopt::Long) <span class="keyword">for</span> package: 1:mariadb-5.5.68-1.el7.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(File::Temp) <span class="keyword">for</span> package: 1:mariadb-5.5.68-1.el7.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(Fcntl) <span class="keyword">for</span> package: 1:mariadb-5.5.68-1.el7.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(Exporter) <span class="keyword">for</span> package: 1:mariadb-5.5.68-1.el7.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: /usr/bin/perl <span class="keyword">for</span> package: 1:mariadb-5.5.68-1.el7.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Running transaction check</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl.x86_64 4:5.16.3-299.el7_9 will be installed</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl-libs = 4:5.16.3-299.el7_9 <span class="keyword">for</span> package: 4:perl-5.16.3-299.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(Socket) &gt;= 1.3 <span class="keyword">for</span> package: 4:perl-5.16.3-299.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(Scalar::Util) &gt;= 1.10 <span class="keyword">for</span> package: 4:perl-5.16.3-299.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl-macros <span class="keyword">for</span> package: 4:perl-5.16.3-299.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl-libs <span class="keyword">for</span> package: 4:perl-5.16.3-299.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(threads::shared) <span class="keyword">for</span> package: 4:perl-5.16.3-299.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(threads) <span class="keyword">for</span> package: 4:perl-5.16.3-299.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(constant) <span class="keyword">for</span> package: 4:perl-5.16.3-299.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(Time::Local) <span class="keyword">for</span> package: 4:perl-5.16.3-299.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(Time::HiRes) <span class="keyword">for</span> package: 4:perl-5.16.3-299.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(Storable) <span class="keyword">for</span> package: 4:perl-5.16.3-299.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(Socket) <span class="keyword">for</span> package: 4:perl-5.16.3-299.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(Scalar::Util) <span class="keyword">for</span> package: 4:perl-5.16.3-299.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(Pod::Simple::XHTML) <span class="keyword">for</span> package: 4:perl-5.16.3-299.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(Pod::Simple::Search) <span class="keyword">for</span> package: 4:perl-5.16.3-299.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(Filter::Util::Call) <span class="keyword">for</span> package: 4:perl-5.16.3-299.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(File::Spec::Unix) <span class="keyword">for</span> package: 4:perl-5.16.3-299.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(File::Spec::Functions) <span class="keyword">for</span> package: 4:perl-5.16.3-299.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(File::Spec) <span class="keyword">for</span> package: 4:perl-5.16.3-299.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(File::Path) <span class="keyword">for</span> package: 4:perl-5.16.3-299.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(Cwd) <span class="keyword">for</span> package: 4:perl-5.16.3-299.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(Carp) <span class="keyword">for</span> package: 4:perl-5.16.3-299.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: libperl.so()(64bit) <span class="keyword">for</span> package: 4:perl-5.16.3-299.el7_9.x86_64</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-Exporter.noarch 0:5.68-3.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-File-Temp.noarch 0:0.23.01-3.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-Getopt-Long.noarch 0:2.40-3.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(Pod::Usage) &gt;= 1.14 <span class="keyword">for</span> package: perl-Getopt-Long-2.40-3.el7.noarch</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(Text::ParseWords) <span class="keyword">for</span> package: perl-Getopt-Long-2.40-3.el7.noarch</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Running transaction check</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-Carp.noarch 0:1.26-244.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-File-Path.noarch 0:2.09-2.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-Filter.x86_64 0:1.49-3.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-PathTools.x86_64 0:3.40-5.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-Pod-Simple.noarch 1:3.28-4.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(Pod::Escapes) &gt;= 1.04 <span class="keyword">for</span> package: 1:perl-Pod-Simple-3.28-4.el7.noarch</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(Encode) <span class="keyword">for</span> package: 1:perl-Pod-Simple-3.28-4.el7.noarch</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-Pod-Usage.noarch 0:1.63-3.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(Pod::Text) &gt;= 3.15 <span class="keyword">for</span> package: perl-Pod-Usage-1.63-3.el7.noarch</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl-Pod-Perldoc <span class="keyword">for</span> package: perl-Pod-Usage-1.63-3.el7.noarch</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-Scalar-List-Utils.x86_64 0:1.27-248.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-Socket.x86_64 0:2.010-5.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-Storable.x86_64 0:2.45-3.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-Text-ParseWords.noarch 0:3.29-4.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-Time-HiRes.x86_64 4:1.9725-3.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-Time-Local.noarch 0:1.2300-2.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-constant.noarch 0:1.27-2.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-libs.x86_64 4:5.16.3-299.el7_9 will be installed</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-macros.x86_64 4:5.16.3-299.el7_9 will be installed</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-threads.x86_64 0:1.87-4.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-threads-shared.x86_64 0:1.43-6.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Running transaction check</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-Encode.x86_64 0:2.51-7.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-Pod-Escapes.noarch 1:1.04-299.el7_9 will be installed</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-Pod-Perldoc.noarch 0:3.20-4.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(parent) <span class="keyword">for</span> package: perl-Pod-Perldoc-3.20-4.el7.noarch</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Processing Dependency: perl(HTTP::Tiny) <span class="keyword">for</span> package: perl-Pod-Perldoc-3.20-4.el7.noarch</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-podlators.noarch 0:2.5.1-3.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Running transaction check</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-HTTP-Tiny.noarch 0:0.033-3.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Package perl-parent.noarch 1:0.225-244.el7 will be installed</span></span><br><span class="line"><span class="meta prompt_">--&gt; </span><span class="language-bash">Finished Dependency Resolution</span></span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">===========================================================================================================================================</span><br><span class="line"> Package                                  Arch                     Version                                 Repository                 Size</span><br><span class="line">===========================================================================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> mariadb                                  x86_64                   1:5.5.68-1.el7                          base                      8.8 M</span><br><span class="line">Installing for dependencies:</span><br><span class="line"> perl                                     x86_64                   4:5.16.3-299.el7_9                      updates                   8.0 M</span><br><span class="line"> perl-Carp                                noarch                   1.26-244.el7                            base                       19 k</span><br><span class="line"> perl-Encode                              x86_64                   2.51-7.el7                              base                      1.5 M</span><br><span class="line"> perl-Exporter                            noarch                   5.68-3.el7                              base                       28 k</span><br><span class="line"> perl-File-Path                           noarch                   2.09-2.el7                              base                       26 k</span><br><span class="line"> perl-File-Temp                           noarch                   0.23.01-3.el7                           base                       56 k</span><br><span class="line"> perl-Filter                              x86_64                   1.49-3.el7                              base                       76 k</span><br><span class="line"> perl-Getopt-Long                         noarch                   2.40-3.el7                              base                       56 k</span><br><span class="line"> perl-HTTP-Tiny                           noarch                   0.033-3.el7                             base                       38 k</span><br><span class="line"> perl-PathTools                           x86_64                   3.40-5.el7                              base                       82 k</span><br><span class="line"> perl-Pod-Escapes                         noarch                   1:1.04-299.el7_9                        updates                    52 k</span><br><span class="line"> perl-Pod-Perldoc                         noarch                   3.20-4.el7                              base                       87 k</span><br><span class="line"> perl-Pod-Simple                          noarch                   1:3.28-4.el7                            base                      216 k</span><br><span class="line"> perl-Pod-Usage                           noarch                   1.63-3.el7                              base                       27 k</span><br><span class="line"> perl-Scalar-List-Utils                   x86_64                   1.27-248.el7                            base                       36 k</span><br><span class="line"> perl-Socket                              x86_64                   2.010-5.el7                             base                       49 k</span><br><span class="line"> perl-Storable                            x86_64                   2.45-3.el7                              base                       77 k</span><br><span class="line"> perl-Text-ParseWords                     noarch                   3.29-4.el7                              base                       14 k</span><br><span class="line"> perl-Time-HiRes                          x86_64                   4:1.9725-3.el7                          base                       45 k</span><br><span class="line"> perl-Time-Local                          noarch                   1.2300-2.el7                            base                       24 k</span><br><span class="line"> perl-constant                            noarch                   1.27-2.el7                              base                       19 k</span><br><span class="line"> perl-libs                                x86_64                   4:5.16.3-299.el7_9                      updates                   690 k</span><br><span class="line"> perl-macros                              x86_64                   4:5.16.3-299.el7_9                      updates                    44 k</span><br><span class="line"> perl-parent                              noarch                   1:0.225-244.el7                         base                       12 k</span><br><span class="line"> perl-podlators                           noarch                   2.5.1-3.el7                             base                      112 k</span><br><span class="line"> perl-threads                             x86_64                   1.87-4.el7                              base                       49 k</span><br><span class="line"> perl-threads-shared                      x86_64                   1.43-6.el7                              base                       39 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">===========================================================================================================================================</span><br><span class="line">Install  1 Package (+27 Dependent packages)</span><br><span class="line"></span><br><span class="line">Total download size: 20 M</span><br><span class="line">Installed size: 85 M</span><br><span class="line">Downloading packages:</span><br><span class="line">(1/28): perl-Carp-1.26-244.el7.noarch.rpm                                                                           |  19 kB  00:00:00     </span><br><span class="line">(2/28): perl-Encode-2.51-7.el7.x86_64.rpm                                                                           | 1.5 MB  00:00:00     </span><br><span class="line">(3/28): perl-Exporter-5.68-3.el7.noarch.rpm                                                                         |  28 kB  00:00:00     </span><br><span class="line">(4/28): perl-File-Path-2.09-2.el7.noarch.rpm                                                                        |  26 kB  00:00:00     </span><br><span class="line">(5/28): perl-File-Temp-0.23.01-3.el7.noarch.rpm                                                                     |  56 kB  00:00:00     </span><br><span class="line">(6/28): perl-Filter-1.49-3.el7.x86_64.rpm                                                                           |  76 kB  00:00:00     </span><br><span class="line">(7/28): perl-Getopt-Long-2.40-3.el7.noarch.rpm                                                                      |  56 kB  00:00:00     </span><br><span class="line">(8/28): perl-HTTP-Tiny-0.033-3.el7.noarch.rpm                                                                       |  38 kB  00:00:00     </span><br><span class="line">(9/28): perl-PathTools-3.40-5.el7.x86_64.rpm                                                                        |  82 kB  00:00:00     </span><br><span class="line">(10/28): perl-5.16.3-299.el7_9.x86_64.rpm                                                                           | 8.0 MB  00:00:00     </span><br><span class="line">(11/28): perl-Pod-Perldoc-3.20-4.el7.noarch.rpm                                                                     |  87 kB  00:00:00     </span><br><span class="line">(12/28): mariadb-5.5.68-1.el7.x86_64.rpm                                                                            | 8.8 MB  00:00:00     </span><br><span class="line">(13/28): perl-Pod-Escapes-1.04-299.el7_9.noarch.rpm                                                                 |  52 kB  00:00:00     </span><br><span class="line">(14/28): perl-Pod-Simple-3.28-4.el7.noarch.rpm                                                                      | 216 kB  00:00:00     </span><br><span class="line">(15/28): perl-Scalar-List-Utils-1.27-248.el7.x86_64.rpm                                                             |  36 kB  00:00:00     </span><br><span class="line">(16/28): perl-Socket-2.010-5.el7.x86_64.rpm                                                                         |  49 kB  00:00:00     </span><br><span class="line">(17/28): perl-Storable-2.45-3.el7.x86_64.rpm                                                                        |  77 kB  00:00:00     </span><br><span class="line">(18/28): perl-Text-ParseWords-3.29-4.el7.noarch.rpm                                                                 |  14 kB  00:00:00     </span><br><span class="line">(19/28): perl-Time-HiRes-1.9725-3.el7.x86_64.rpm                                                                    |  45 kB  00:00:00     </span><br><span class="line">(20/28): perl-Pod-Usage-1.63-3.el7.noarch.rpm                                                                       |  27 kB  00:00:00     </span><br><span class="line">(21/28): perl-Time-Local-1.2300-2.el7.noarch.rpm                                                                    |  24 kB  00:00:00     </span><br><span class="line">(22/28): perl-constant-1.27-2.el7.noarch.rpm                                                                        |  19 kB  00:00:00     </span><br><span class="line">(23/28): perl-podlators-2.5.1-3.el7.noarch.rpm                                                                      | 112 kB  00:00:00     </span><br><span class="line">(24/28): perl-threads-1.87-4.el7.x86_64.rpm                                                                         |  49 kB  00:00:00     </span><br><span class="line">(25/28): perl-threads-shared-1.43-6.el7.x86_64.rpm                                                                  |  39 kB  00:00:00     </span><br><span class="line">(26/28): perl-macros-5.16.3-299.el7_9.x86_64.rpm                                                                    |  44 kB  00:00:00     </span><br><span class="line">(27/28): perl-libs-5.16.3-299.el7_9.x86_64.rpm                                                                      | 690 kB  00:00:00     </span><br><span class="line">(28/28): perl-parent-0.225-244.el7.noarch.rpm                                                                       |  12 kB  00:00:00     </span><br><span class="line">-------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line">Total                                                                                                       14 MB/s |  20 MB  00:00:01     </span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  Installing : 1:perl-parent-0.225-244.el7.noarch                                                                                     1/28 </span><br><span class="line">  Installing : perl-HTTP-Tiny-0.033-3.el7.noarch                                                                                      2/28 </span><br><span class="line">  Installing : perl-podlators-2.5.1-3.el7.noarch                                                                                      3/28 </span><br><span class="line">  Installing : perl-Pod-Perldoc-3.20-4.el7.noarch                                                                                     4/28 </span><br><span class="line">  Installing : 1:perl-Pod-Escapes-1.04-299.el7_9.noarch                                                                               5/28 </span><br><span class="line">  Installing : perl-Encode-2.51-7.el7.x86_64                                                                                          6/28 </span><br><span class="line">  Installing : perl-Text-ParseWords-3.29-4.el7.noarch                                                                                 7/28 </span><br><span class="line">  Installing : perl-Pod-Usage-1.63-3.el7.noarch                                                                                       8/28 </span><br><span class="line">  Installing : 4:perl-macros-5.16.3-299.el7_9.x86_64                                                                                  9/28 </span><br><span class="line">  Installing : perl-Storable-2.45-3.el7.x86_64                                                                                       10/28 </span><br><span class="line">  Installing : perl-Exporter-5.68-3.el7.noarch                                                                                       11/28 </span><br><span class="line">  Installing : perl-constant-1.27-2.el7.noarch                                                                                       12/28 </span><br><span class="line">  Installing : perl-Socket-2.010-5.el7.x86_64                                                                                        13/28 </span><br><span class="line">  Installing : perl-Time-Local-1.2300-2.el7.noarch                                                                                   14/28 </span><br><span class="line">  Installing : perl-Carp-1.26-244.el7.noarch                                                                                         15/28 </span><br><span class="line">  Installing : 4:perl-Time-HiRes-1.9725-3.el7.x86_64                                                                                 16/28 </span><br><span class="line">  Installing : perl-PathTools-3.40-5.el7.x86_64                                                                                      17/28 </span><br><span class="line">  Installing : perl-Scalar-List-Utils-1.27-248.el7.x86_64                                                                            18/28 </span><br><span class="line">  Installing : 1:perl-Pod-Simple-3.28-4.el7.noarch                                                                                   19/28 </span><br><span class="line">  Installing : perl-File-Temp-0.23.01-3.el7.noarch                                                                                   20/28 </span><br><span class="line">  Installing : perl-File-Path-2.09-2.el7.noarch                                                                                      21/28 </span><br><span class="line">  Installing : perl-threads-shared-1.43-6.el7.x86_64                                                                                 22/28 </span><br><span class="line">  Installing : perl-threads-1.87-4.el7.x86_64                                                                                        23/28 </span><br><span class="line">  Installing : perl-Filter-1.49-3.el7.x86_64                                                                                         24/28 </span><br><span class="line">  Installing : 4:perl-libs-5.16.3-299.el7_9.x86_64                                                                                   25/28 </span><br><span class="line">  Installing : perl-Getopt-Long-2.40-3.el7.noarch                                                                                    26/28 </span><br><span class="line">  Installing : 4:perl-5.16.3-299.el7_9.x86_64                                                                                        27/28 </span><br><span class="line">  Installing : 1:mariadb-5.5.68-1.el7.x86_64                                                                                         28/28 </span><br><span class="line">  Verifying  : perl-HTTP-Tiny-0.033-3.el7.noarch                                                                                      1/28 </span><br><span class="line">  Verifying  : perl-threads-shared-1.43-6.el7.x86_64                                                                                  2/28 </span><br><span class="line">  Verifying  : perl-Storable-2.45-3.el7.x86_64                                                                                        3/28 </span><br><span class="line">  Verifying  : perl-Exporter-5.68-3.el7.noarch                                                                                        4/28 </span><br><span class="line">  Verifying  : perl-constant-1.27-2.el7.noarch                                                                                        5/28 </span><br><span class="line">  Verifying  : perl-PathTools-3.40-5.el7.x86_64                                                                                       6/28 </span><br><span class="line">  Verifying  : perl-Socket-2.010-5.el7.x86_64                                                                                         7/28 </span><br><span class="line">  Verifying  : 1:perl-parent-0.225-244.el7.noarch                                                                                     8/28 </span><br><span class="line">  Verifying  : 4:perl-macros-5.16.3-299.el7_9.x86_64                                                                                  9/28 </span><br><span class="line">  Verifying  : perl-File-Temp-0.23.01-3.el7.noarch                                                                                   10/28 </span><br><span class="line">  Verifying  : 1:perl-Pod-Simple-3.28-4.el7.noarch                                                                                   11/28 </span><br><span class="line">  Verifying  : perl-Time-Local-1.2300-2.el7.noarch                                                                                   12/28 </span><br><span class="line">  Verifying  : 1:perl-Pod-Escapes-1.04-299.el7_9.noarch                                                                              13/28 </span><br><span class="line">  Verifying  : perl-Carp-1.26-244.el7.noarch                                                                                         14/28 </span><br><span class="line">  Verifying  : 4:perl-Time-HiRes-1.9725-3.el7.x86_64                                                                                 15/28 </span><br><span class="line">  Verifying  : perl-Scalar-List-Utils-1.27-248.el7.x86_64                                                                            16/28 </span><br><span class="line">  Verifying  : perl-Pod-Usage-1.63-3.el7.noarch                                                                                      17/28 </span><br><span class="line">  Verifying  : perl-Encode-2.51-7.el7.x86_64                                                                                         18/28 </span><br><span class="line">  Verifying  : perl-Pod-Perldoc-3.20-4.el7.noarch                                                                                    19/28 </span><br><span class="line">  Verifying  : perl-podlators-2.5.1-3.el7.noarch                                                                                     20/28 </span><br><span class="line">  Verifying  : 4:perl-5.16.3-299.el7_9.x86_64                                                                                        21/28 </span><br><span class="line">  Verifying  : perl-File-Path-2.09-2.el7.noarch                                                                                      22/28 </span><br><span class="line">  Verifying  : perl-threads-1.87-4.el7.x86_64                                                                                        23/28 </span><br><span class="line">  Verifying  : 1:mariadb-5.5.68-1.el7.x86_64                                                                                         24/28 </span><br><span class="line">  Verifying  : perl-Filter-1.49-3.el7.x86_64                                                                                         25/28 </span><br><span class="line">  Verifying  : perl-Getopt-Long-2.40-3.el7.noarch                                                                                    26/28 </span><br><span class="line">  Verifying  : perl-Text-ParseWords-3.29-4.el7.noarch                                                                                27/28 </span><br><span class="line">  Verifying  : 4:perl-libs-5.16.3-299.el7_9.x86_64                                                                                   28/28 </span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  mariadb.x86_64 1:5.5.68-1.el7                                                                                                            </span><br><span class="line"></span><br><span class="line">Dependency Installed:</span><br><span class="line">  perl.x86_64 4:5.16.3-299.el7_9            perl-Carp.noarch 0:1.26-244.el7              perl-Encode.x86_64 0:2.51-7.el7                 </span><br><span class="line">  perl-Exporter.noarch 0:5.68-3.el7         perl-File-Path.noarch 0:2.09-2.el7           perl-File-Temp.noarch 0:0.23.01-3.el7           </span><br><span class="line">  perl-Filter.x86_64 0:1.49-3.el7           perl-Getopt-Long.noarch 0:2.40-3.el7         perl-HTTP-Tiny.noarch 0:0.033-3.el7             </span><br><span class="line">  perl-PathTools.x86_64 0:3.40-5.el7        perl-Pod-Escapes.noarch 1:1.04-299.el7_9     perl-Pod-Perldoc.noarch 0:3.20-4.el7            </span><br><span class="line">  perl-Pod-Simple.noarch 1:3.28-4.el7       perl-Pod-Usage.noarch 0:1.63-3.el7           perl-Scalar-List-Utils.x86_64 0:1.27-248.el7    </span><br><span class="line">  perl-Socket.x86_64 0:2.010-5.el7          perl-Storable.x86_64 0:2.45-3.el7            perl-Text-ParseWords.noarch 0:3.29-4.el7        </span><br><span class="line">  perl-Time-HiRes.x86_64 4:1.9725-3.el7     perl-Time-Local.noarch 0:1.2300-2.el7        perl-constant.noarch 0:1.27-2.el7               </span><br><span class="line">  perl-libs.x86_64 4:5.16.3-299.el7_9       perl-macros.x86_64 4:5.16.3-299.el7_9        perl-parent.noarch 1:0.225-244.el7              </span><br><span class="line">  perl-podlators.noarch 0:2.5.1-3.el7       perl-threads.x86_64 0:1.87-4.el7             perl-threads-shared.x86_64 0:1.43-6.el7         </span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试MySQL服务连通性 -h 是k8s节点的IP -P 是mysql外部服务的端口号</span></span><br><span class="line"></span><br><span class="line">[root@ks-k8s-master-0 ~]# mysql -h 192.168.9.91 -P 32529 -u root -p</span><br><span class="line">Enter password: </span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 5</span><br><span class="line">Server version: 5.7.38 MySQL Community Server (GPL)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type &#x27;help;&#x27; or &#x27;\h&#x27; for help. Type &#x27;\c&#x27; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MySQL [(none)]&gt; </span><br></pre></td></tr></table></figure>

<ul>
<li>准备测试数据</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">[root@ks-k8s-master-0 ~]# sysbench --db-driver=mysql --mysql-host=192.168.9.91 --mysql-port=32529 --mysql-user=root --mysql-password=P@88w0rd --mysql-db=sbtest --table-size=100000 --tables=16 --threads=8 --events=999999999 --report-interval=10 --time=100 /usr/share/sysbench/oltp_common.lua prepare</span><br><span class="line">sysbench 1.0.20 (using bundled LuaJIT 2.1.0-beta2)</span><br><span class="line"></span><br><span class="line">Initializing worker threads...</span><br><span class="line"></span><br><span class="line">Creating table &#x27;sbtest6&#x27;...</span><br><span class="line">Creating table &#x27;sbtest2&#x27;...</span><br><span class="line">Creating table &#x27;sbtest8&#x27;...</span><br><span class="line">Creating table &#x27;sbtest3&#x27;...</span><br><span class="line">Creating table &#x27;sbtest7&#x27;...</span><br><span class="line">Creating table &#x27;sbtest5&#x27;...</span><br><span class="line">Creating table &#x27;sbtest1&#x27;...</span><br><span class="line">Creating table &#x27;sbtest4&#x27;...</span><br><span class="line">Inserting 100000 records into &#x27;sbtest3&#x27;</span><br><span class="line">Inserting 100000 records into &#x27;sbtest6&#x27;</span><br><span class="line">Inserting 100000 records into &#x27;sbtest1&#x27;</span><br><span class="line">Inserting 100000 records into &#x27;sbtest4&#x27;</span><br><span class="line">Inserting 100000 records into &#x27;sbtest7&#x27;</span><br><span class="line">Inserting 100000 records into &#x27;sbtest5&#x27;</span><br><span class="line">Inserting 100000 records into &#x27;sbtest2&#x27;</span><br><span class="line">Inserting 100000 records into &#x27;sbtest8&#x27;</span><br><span class="line">Creating a secondary index on &#x27;sbtest3&#x27;...</span><br><span class="line">Creating table &#x27;sbtest11&#x27;...</span><br><span class="line">Inserting 100000 records into &#x27;sbtest11&#x27;</span><br><span class="line">Creating a secondary index on &#x27;sbtest5&#x27;...</span><br><span class="line">Creating a secondary index on &#x27;sbtest1&#x27;...</span><br><span class="line">Creating a secondary index on &#x27;sbtest6&#x27;...</span><br><span class="line">Creating a secondary index on &#x27;sbtest4&#x27;...</span><br><span class="line">Creating a secondary index on &#x27;sbtest7&#x27;...</span><br><span class="line">Creating a secondary index on &#x27;sbtest2&#x27;...</span><br><span class="line">Creating a secondary index on &#x27;sbtest8&#x27;...</span><br><span class="line">Creating table &#x27;sbtest13&#x27;...</span><br><span class="line">Inserting 100000 records into &#x27;sbtest13&#x27;</span><br><span class="line">Creating table &#x27;sbtest9&#x27;...</span><br><span class="line">Inserting 100000 records into &#x27;sbtest9&#x27;</span><br><span class="line">Creating table &#x27;sbtest14&#x27;...</span><br><span class="line">Creating table &#x27;sbtest12&#x27;...</span><br><span class="line">Inserting 100000 records into &#x27;sbtest14&#x27;</span><br><span class="line">Inserting 100000 records into &#x27;sbtest12&#x27;</span><br><span class="line">Creating table &#x27;sbtest15&#x27;...</span><br><span class="line">Inserting 100000 records into &#x27;sbtest15&#x27;</span><br><span class="line">Creating table &#x27;sbtest16&#x27;...</span><br><span class="line">Creating table &#x27;sbtest10&#x27;...</span><br><span class="line">Inserting 100000 records into &#x27;sbtest16&#x27;</span><br><span class="line">Inserting 100000 records into &#x27;sbtest10&#x27;</span><br><span class="line">Creating a secondary index on &#x27;sbtest11&#x27;...</span><br><span class="line">Creating a secondary index on &#x27;sbtest13&#x27;...</span><br><span class="line">Creating a secondary index on &#x27;sbtest9&#x27;...</span><br><span class="line">Creating a secondary index on &#x27;sbtest12&#x27;...</span><br><span class="line">Creating a secondary index on &#x27;sbtest14&#x27;...</span><br><span class="line">Creating a secondary index on &#x27;sbtest15&#x27;...</span><br><span class="line">Creating a secondary index on &#x27;sbtest10&#x27;...</span><br><span class="line">Creating a secondary index on &#x27;sbtest16&#x27;...</span><br></pre></td></tr></table></figure>

<ul>
<li>执行测试-8 线程测试</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">[root@ks-k8s-master-0 ~]# sysbench --db-driver=mysql --mysql-host=192.168.9.91 --mysql-port=32529 --mysql-user=root --mysql-password=P@88w0rd --mysql-db=sbtest --table-size=100000 --tables=16 --threads=8 --events=999999999 --report-interval=10 --time=100  /usr/share/sysbench/oltp_read_write.lua run</span><br><span class="line">sysbench 1.0.20 (using bundled LuaJIT 2.1.0-beta2)</span><br><span class="line"></span><br><span class="line">Running the test with following options:</span><br><span class="line">Number of threads: 8</span><br><span class="line">Report intermediate results every 10 second(s)</span><br><span class="line">Initializing random number generator from current time</span><br><span class="line"></span><br><span class="line">Initializing worker threads...</span><br><span class="line"></span><br><span class="line">Threads started!</span><br><span class="line"></span><br><span class="line">[ 10s ] thds: 8 tps: 88.46 qps: 1782.38 (r/w/o: 1249.19/355.46/177.73) lat (ms,95%): 267.41 err/s: 0.00 reconn/s: 0.00</span><br><span class="line">[ 20s ] thds: 8 tps: 84.31 qps: 1678.47 (r/w/o: 1173.42/336.43/168.62) lat (ms,95%): 277.21 err/s: 0.00 reconn/s: 0.00</span><br><span class="line">[ 30s ] thds: 8 tps: 70.20 qps: 1413.82 (r/w/o: 990.21/283.20/140.40) lat (ms,95%): 369.77 err/s: 0.00 reconn/s: 0.00</span><br><span class="line">[ 40s ] thds: 8 tps: 47.30 qps: 946.00 (r/w/o: 662.20/189.20/94.60) lat (ms,95%): 484.44 err/s: 0.00 reconn/s: 0.00</span><br><span class="line">[ 50s ] thds: 8 tps: 43.80 qps: 875.99 (r/w/o: 613.19/175.20/87.60) lat (ms,95%): 484.44 err/s: 0.00 reconn/s: 0.00</span><br><span class="line">[ 60s ] thds: 8 tps: 60.70 qps: 1213.08 (r/w/o: 849.69/242.00/121.40) lat (ms,95%): 411.96 err/s: 0.00 reconn/s: 0.00</span><br><span class="line">[ 70s ] thds: 8 tps: 53.90 qps: 1078.22 (r/w/o: 754.42/216.00/107.80) lat (ms,95%): 376.49 err/s: 0.00 reconn/s: 0.00</span><br><span class="line">[ 80s ] thds: 8 tps: 56.49 qps: 1127.98 (r/w/o: 790.11/224.88/112.99) lat (ms,95%): 397.39 err/s: 0.00 reconn/s: 0.00</span><br><span class="line">[ 90s ] thds: 8 tps: 50.60 qps: 1014.59 (r/w/o: 709.56/203.82/101.21) lat (ms,95%): 434.83 err/s: 0.00 reconn/s: 0.00</span><br><span class="line">[ 100s ] thds: 8 tps: 54.70 qps: 1093.12 (r/w/o: 765.22/218.50/109.40) lat (ms,95%): 390.30 err/s: 0.00 reconn/s: 0.00</span><br><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            85582</span><br><span class="line">        write:                           24452</span><br><span class="line">        other:                           12226</span><br><span class="line">        total:                           122260</span><br><span class="line">    transactions:                        6113   (61.10 per sec.)</span><br><span class="line">    queries:                             122260 (1221.96 per sec.)</span><br><span class="line">    ignored errors:                      0      (0.00 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br><span class="line"></span><br><span class="line">General statistics:</span><br><span class="line">    total time:                          100.0494s</span><br><span class="line">    total number of events:              6113</span><br><span class="line"></span><br><span class="line">Latency (ms):</span><br><span class="line">         min:                                   35.63</span><br><span class="line">         avg:                                  130.89</span><br><span class="line">         max:                                  951.86</span><br><span class="line">         95th percentile:                      390.30</span><br><span class="line">         sum:                               800129.59</span><br><span class="line"></span><br><span class="line">Threads fairness:</span><br><span class="line">    events (avg/stddev):           764.1250/4.14</span><br><span class="line">    execution time (avg/stddev):   100.0162/0.01</span><br></pre></td></tr></table></figure>

<ul>
<li><p>执行测试-16 线程测试</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">[root@ks-k8s-master-0 ~]# sysbench --db-driver=mysql --mysql-host=192.168.9.91 --mysql-port=32529 --mysql-user=root --mysql-password=P@88w0rd --mysql-db=sbtest --table-size=100000 --tables=16 --threads=16 --events=999999999 --report-interval=10 --time=100  /usr/share/sysbench/oltp_read_write.lua run</span><br><span class="line">sysbench 1.0.20 (using bundled LuaJIT 2.1.0-beta2)</span><br><span class="line"></span><br><span class="line">Running the test with following options:</span><br><span class="line">Number of threads: 16</span><br><span class="line">Report intermediate results every 10 second(s)</span><br><span class="line">Initializing random number generator from current time</span><br><span class="line"></span><br><span class="line">Initializing worker threads...</span><br><span class="line"></span><br><span class="line">Threads started!</span><br><span class="line"></span><br><span class="line">[ 10s ] thds: 16 tps: 114.41 qps: 2310.22 (r/w/o: 1621.18/458.63/230.41) lat (ms,95%): 369.77 err/s: 0.00 reconn/s: 0.00</span><br><span class="line">[ 20s ] thds: 16 tps: 106.35 qps: 2111.86 (r/w/o: 1474.74/424.41/212.71) lat (ms,95%): 383.33 err/s: 0.00 reconn/s: 0.00</span><br><span class="line">[ 30s ] thds: 16 tps: 80.40 qps: 1612.01 (r/w/o: 1129.21/322.00/160.80) lat (ms,95%): 623.33 err/s: 0.00 reconn/s: 0.00</span><br><span class="line">[ 40s ] thds: 16 tps: 63.40 qps: 1266.80 (r/w/o: 886.80/253.20/126.80) lat (ms,95%): 539.71 err/s: 0.00 reconn/s: 0.00</span><br><span class="line">[ 50s ] thds: 16 tps: 57.20 qps: 1145.91 (r/w/o: 802.74/228.78/114.39) lat (ms,95%): 549.52 err/s: 0.00 reconn/s: 0.00</span><br><span class="line">[ 60s ] thds: 16 tps: 69.91 qps: 1408.31 (r/w/o: 987.57/280.92/139.81) lat (ms,95%): 511.33 err/s: 0.00 reconn/s: 0.00</span><br><span class="line">[ 70s ] thds: 16 tps: 78.00 qps: 1547.22 (r/w/o: 1080.51/310.70/156.00) lat (ms,95%): 484.44 err/s: 0.00 reconn/s: 0.00</span><br><span class="line">[ 80s ] thds: 16 tps: 79.50 qps: 1599.87 (r/w/o: 1122.58/318.29/159.00) lat (ms,95%): 520.62 err/s: 0.00 reconn/s: 0.00</span><br><span class="line">[ 90s ] thds: 16 tps: 67.80 qps: 1354.83 (r/w/o: 947.62/271.61/135.60) lat (ms,95%): 539.71 err/s: 0.00 reconn/s: 0.00</span><br><span class="line">[ 100s ] thds: 16 tps: 73.90 qps: 1474.10 (r/w/o: 1030.80/295.50/147.80) lat (ms,95%): 502.20 err/s: 0.00 reconn/s: 0.00</span><br><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            110950</span><br><span class="line">        write:                           31700</span><br><span class="line">        other:                           15850</span><br><span class="line">        total:                           158500</span><br><span class="line">    transactions:                        7925   (79.00 per sec.)</span><br><span class="line">    queries:                             158500 (1580.05 per sec.)</span><br><span class="line">    ignored errors:                      0      (0.00 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br><span class="line"></span><br><span class="line">General statistics:</span><br><span class="line">    total time:                          100.3103s</span><br><span class="line">    total number of events:              7925</span><br><span class="line"></span><br><span class="line">Latency (ms):</span><br><span class="line">         min:                                   41.24</span><br><span class="line">         avg:                                  202.44</span><br><span class="line">         max:                                 1198.81</span><br><span class="line">         95th percentile:                      511.33</span><br><span class="line">         sum:                              1604328.52</span><br><span class="line"></span><br><span class="line">Threads fairness:</span><br><span class="line">    events (avg/stddev):           495.3125/4.03</span><br><span class="line">    execution time (avg/stddev):   100.2705/0.03</span><br></pre></td></tr></table></figure>
</li>
<li><p>执行测试-32 线程测试</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">[root@ks-k8s-master-0 ~]# sysbench --db-driver=mysql --mysql-host=192.168.9.91 --mysql-port=32529 --mysql-user=root --mysql-password=P@88w0rd --mysql-db=sbtest --table-size=100000 --tables=16 --threads=32 --events=999999999 --report-interval=10 --time=100  /usr/share/sysbench/oltp_read_write.lua run</span><br><span class="line">sysbench 1.0.20 (using bundled LuaJIT 2.1.0-beta2)</span><br><span class="line"></span><br><span class="line">Running the test with following options:</span><br><span class="line">Number of threads: 32</span><br><span class="line">Report intermediate results every 10 second(s)</span><br><span class="line">Initializing random number generator from current time</span><br><span class="line"></span><br><span class="line">Initializing worker threads...</span><br><span class="line"></span><br><span class="line">Threads started!</span><br><span class="line"></span><br><span class="line">[ 10s ] thds: 32 tps: 140.10 qps: 2825.04 (r/w/o: 1981.25/560.39/283.39) lat (ms,95%): 450.77 err/s: 0.00 reconn/s: 0.00</span><br><span class="line">[ 20s ] thds: 32 tps: 124.41 qps: 2515.49 (r/w/o: 1763.43/503.24/248.82) lat (ms,95%): 549.52 err/s: 0.00 reconn/s: 0.00</span><br><span class="line">[ 30s ] thds: 32 tps: 95.90 qps: 1887.10 (r/w/o: 1316.70/378.60/191.80) lat (ms,95%): 733.00 err/s: 0.00 reconn/s: 0.00</span><br><span class="line">[ 40s ] thds: 32 tps: 81.80 qps: 1656.59 (r/w/o: 1164.89/328.10/163.60) lat (ms,95%): 707.07 err/s: 0.00 reconn/s: 0.00</span><br><span class="line">[ 50s ] thds: 32 tps: 82.60 qps: 1638.41 (r/w/o: 1143.51/329.70/165.20) lat (ms,95%): 657.93 err/s: 0.00 reconn/s: 0.00</span><br><span class="line">[ 60s ] thds: 32 tps: 94.34 qps: 1905.84 (r/w/o: 1336.62/380.65/188.58) lat (ms,95%): 623.33 err/s: 0.00 reconn/s: 0.00</span><br><span class="line">[ 70s ] thds: 32 tps: 87.86 qps: 1739.86 (r/w/o: 1215.31/348.73/175.82) lat (ms,95%): 634.66 err/s: 0.00 reconn/s: 0.00</span><br><span class="line">[ 80s ] thds: 32 tps: 84.40 qps: 1705.48 (r/w/o: 1196.49/340.20/168.80) lat (ms,95%): 759.88 err/s: 0.00 reconn/s: 0.00</span><br><span class="line">[ 90s ] thds: 32 tps: 80.50 qps: 1580.71 (r/w/o: 1101.70/318.00/161.00) lat (ms,95%): 612.21 err/s: 0.00 reconn/s: 0.00</span><br><span class="line">[ 100s ] thds: 32 tps: 81.40 qps: 1661.90 (r/w/o: 1167.00/332.10/162.80) lat (ms,95%): 707.07 err/s: 0.00 reconn/s: 0.00</span><br><span class="line">SQL statistics:</span><br><span class="line">    queries performed:</span><br><span class="line">        read:                            133924</span><br><span class="line">        write:                           38264</span><br><span class="line">        other:                           19132</span><br><span class="line">        total:                           191320</span><br><span class="line">    transactions:                        9566   (95.33 per sec.)</span><br><span class="line">    queries:                             191320 (1906.56 per sec.)</span><br><span class="line">    ignored errors:                      0      (0.00 per sec.)</span><br><span class="line">    reconnects:                          0      (0.00 per sec.)</span><br><span class="line"></span><br><span class="line">General statistics:</span><br><span class="line">    total time:                          100.3457s</span><br><span class="line">    total number of events:              9566</span><br><span class="line"></span><br><span class="line">Latency (ms):</span><br><span class="line">         min:                                   51.94</span><br><span class="line">         avg:                                  335.14</span><br><span class="line">         max:                                 1405.78</span><br><span class="line">         95th percentile:                      657.93</span><br><span class="line">         sum:                              3205913.85</span><br><span class="line"></span><br><span class="line">Threads fairness:</span><br><span class="line">    events (avg/stddev):           298.9375/5.15</span><br><span class="line">    execution time (avg/stddev):   100.1848/0.14</span><br></pre></td></tr></table></figure>

<p>MySQL 容器性能监控图。</p>
<p><img src="https://znotes-1258881081.cos.ap-beijing.myqcloud.com/k8s-on-kubesphere/kubesphere-projects-lstack-statefulsets-mysql-74.png" alt="kubesphere-projects-lstack-statefulsets-mysql-74"></p>
<p>清理测试数据 (为了保证数据更精准，建议每次测试前都清理数据，准备数据，测试)。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@ks-k8s-master-0 ~]# sysbench --db-driver=mysql --mysql-host=192.168.9.91 --mysql-port=32529 --mysql-user=root --mysql-password=P@88w0rd --mysql-db=sbtest --table-size=100000 --tables=16 --threads=32 --events=999999999 --report-interval=10 --time=100  /usr/share/sysbench/oltp_read_write.lua cleanup</span><br><span class="line">sysbench 1.0.20 (using bundled LuaJIT 2.1.0-beta2)</span><br><span class="line"></span><br><span class="line">Dropping table &#x27;sbtest1&#x27;...</span><br><span class="line">Dropping table &#x27;sbtest2&#x27;...</span><br><span class="line">Dropping table &#x27;sbtest3&#x27;...</span><br><span class="line">Dropping table &#x27;sbtest4&#x27;...</span><br><span class="line">Dropping table &#x27;sbtest5&#x27;...</span><br><span class="line">Dropping table &#x27;sbtest6&#x27;...</span><br><span class="line">Dropping table &#x27;sbtest7&#x27;...</span><br><span class="line">Dropping table &#x27;sbtest8&#x27;...</span><br><span class="line">Dropping table &#x27;sbtest9&#x27;...</span><br><span class="line">Dropping table &#x27;sbtest10&#x27;...</span><br><span class="line">Dropping table &#x27;sbtest11&#x27;...</span><br><span class="line">Dropping table &#x27;sbtest12&#x27;...</span><br><span class="line">Dropping table &#x27;sbtest13&#x27;...</span><br><span class="line">Dropping table &#x27;sbtest14&#x27;...</span><br><span class="line">Dropping table &#x27;sbtest15&#x27;...</span><br><span class="line">Dropping table &#x27;sbtest16&#x27;...</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>04-测试结果</strong></p>
</blockquote>
<p>结果汇总对比。</p>
<table>
<thead>
<tr>
<th>压测线程数量</th>
<th>TPS</th>
<th>QPS</th>
<th>延迟</th>
</tr>
</thead>
<tbody><tr>
<td>8</td>
<td>61</td>
<td>1221</td>
<td>130</td>
</tr>
<tr>
<td>16</td>
<td>79</td>
<td>1580</td>
<td>202</td>
</tr>
<tr>
<td>32</td>
<td>95</td>
<td>1906</td>
<td>335</td>
</tr>
</tbody></table>
<p>建议根据测试结果，调优！</p>
<hr>
<h2 id="7-总结"><a href="#7-总结" class="headerlink" title="7. 总结"></a>7. 总结</h2><p>本文详细介绍了 KubeSphere 图形化部署单节点 MySQL 上的安装配置过程，如何利用 KubeSphere 的图形化功能创建资源配置清单 YAML 文件的思路和具体操作过程，以后再部署其他在官网找不到详细配置指南的服务都可以借鉴这个方法。</p>
<p>本文还详细介绍了 Git 常用操作、如何将代码在多个在线代码仓库中存储并保持同步，还介绍了 GitOps 的基本概念并演示了如何用 GitOps 理念在原生 K8S 上部署 MySQL 服务。</p>
<p>最后，演示了 MySQL 常用性能测试工具 sysbench 的安装和基础使用。</p>
<p>我多年的一些运维经验和运维思路贯穿了全文。</p>
<blockquote>
<p><strong>参考文档</strong></p>
</blockquote>
<ul>
<li>都在文档里直接链接了</li>
</ul>
<blockquote>
<p><strong>Get 文档</strong></p>
</blockquote>
<ul>
<li>Github <a target="_blank" rel="noopener" href="https://github.com/devops/z-notes">https://github.com/devops/z-notes</a></li>
<li>Gitee <a target="_blank" rel="noopener" href="https://gitee.com/zdevops/z-notes">https://gitee.com/zdevops/z-notes</a></li>
</ul>
<blockquote>
<p><strong>Get 代码</strong></p>
</blockquote>
<ul>
<li>Github <a target="_blank" rel="noopener" href="https://github.com/devops/k8s-yaml">https://github.com/devops/k8s-yaml</a></li>
<li>Gitee <a target="_blank" rel="noopener" href="https://gitee.com/zdevops/k8s-yaml">https://gitee.com/zdevops/k8s-yaml</a></li>
</ul>
<blockquote>
<p><strong>B 站</strong></p>
</blockquote>
<ul>
<li><a target="_blank" rel="noopener" href="https://space.bilibili.com/1039301316">老 Z 手记</a> <a target="_blank" rel="noopener" href="https://space.bilibili.com/1039301316">https://space.bilibili.com/1039301316</a></li>
</ul>
<blockquote>
<p><strong>版权声明</strong> </p>
</blockquote>
<ul>
<li>所有内容均属于原创，整理不易，感谢收藏，转载请标明出处。</li>
</ul>
<blockquote>
<p>About Me</p>
</blockquote>
<ul>
<li>昵称：老 Z</li>
<li>坐标：山东济南</li>
<li>职业：运维架构师 &#x2F; 高级运维工程师 &#x3D;<strong>运维</strong></li>
<li>微信：zdevops</li>
<li>关注的领域：云计算 &#x2F; 云原生技术运维，自动化运维</li>
<li>技能标签：OpenStack、Ansible、K8S、Python、Go、CNCF</li>
</ul>

    </article>
    <!-- license -->
    
        <div class="license-wrapper">
            <p>原文作者：<a href="https://lhhxs.github.io">Arcticsea</a>
            <p>原文链接：<a href="https://lhhxs.github.io/2023/09/22/%E8%BF%90%E7%BB%B4/k8s-on-kubesphere/k8s-MySQL%E5%AE%89%E8%A3%85%E6%89%8B%E8%AE%B0/">https://lhhxs.github.io/2023/09/22/%E8%BF%90%E7%BB%B4/k8s-on-kubesphere/k8s-MySQL%E5%AE%89%E8%A3%85%E6%89%8B%E8%AE%B0/</a>
            <p>发表日期：<a href="https://lhhxs.github.io/2023/09/22/%E8%BF%90%E7%BB%B4/k8s-on-kubesphere/k8s-MySQL%E5%AE%89%E8%A3%85%E6%89%8B%E8%AE%B0/">September 22nd 2023, 9:38:09 am</a>
            <p>更新日期：<a href="https://lhhxs.github.io/2023/09/22/%E8%BF%90%E7%BB%B4/k8s-on-kubesphere/k8s-MySQL%E5%AE%89%E8%A3%85%E6%89%8B%E8%AE%B0/">September 22nd 2023, 9:42:58 am</a>
            <p>版权声明：本文采用<a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc/4.0/">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可</p>
        </div>
    
    <!-- paginator -->
    <ul class="post-paginator">
        <li class="next">
            
                <div class="nextSlogan">Next Post</div>
                <a href="/2023/09/22/%E8%BF%90%E7%BB%B4/k8s-on-kubesphere/k8s-GlusterFS%E6%89%A9%E5%AE%B9%E6%89%8B%E8%AE%B0/" title="k8s-GlusterFS 扩容手记">
                    <div class="nextTitle">k8s-GlusterFS 扩容手记</div>
                </a>
            
        </li>
        <li class="previous">
            
                <div class="prevSlogan">Previous Post</div>
                <a href="/2023/09/22/%E8%BF%90%E7%BB%B4/k8s-on-kubesphere/k8s-%E5%BC%80%E5%90%AFetcd%E7%9B%91%E6%8E%A7/" title="k8s-开启etcd监控">
                    <div class="prevTitle">k8s-开启etcd监控</div>
                </a>
            
        </li>
    </ul>
    <!-- comment -->
    
        <div class="post-comment">
            <!-- 来必力 City 版安装代码 -->


            

            

            

            <!-- utteranc评论 -->


            <!-- partial('_partial/comment/changyan') -->
            <!--PC版-->


            
            

            

        </div>
    
    <!-- timeliness note -->
    <!-- idea from: https://hexo.fluid-dev.com/posts/hexo-injector/#%E6%96%87%E7%AB%A0%E6%97%B6%E6%95%88%E6%80%A7%E6%8F%90%E7%A4%BA -->
    
    <!-- Mathjax -->
    
</main>

                <!-- profile -->
                
            </div>
            <footer class="footer footer-unloaded">
    <!-- social  -->
    
        <div class="social">
            
    
        
            
                <a href="mailto:lhhxs@163.com" class="iconfont-archer email" title=email ></a>
            
        
    
        
            
                <a href="//github.com/lhhxs" class="iconfont-archer github" target="_blank" title=github></a>
            
        
    
        
            
                <span class="iconfont-archer wechat" title=wechat>
                    
                    <img class="profile-qr" src="/assets/example_qr.png" />
                </span>
            
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            
                <a href="/atom.xml" class="iconfont-archer rss" target="_blank" title=rss></a>
            
        
    


        </div>
    
    <!-- powered by Hexo  -->
    <div class="copyright">
        <span id="hexo-power">Powered by <a href="https://hexo.io/" target="_blank">Hexo</a></span><span class="iconfont-archer power">&#xe635;</span><span id="theme-info">theme <a href="https://github.com/fi3ework/hexo-theme-archer" target="_blank">Archer</a></span>
    </div>
    <!-- website approve for Chinese user -->
    
    <!-- 不蒜子  -->
    
        <div class="busuanzi-container">
            
             
                <span id="busuanzi_container_site_pv">PV: <span id="busuanzi_value_site_pv"></span> :)</span>
            
        </div>
    	
</footer>

        </div>
        <!-- toc -->
        
            <div class="toc-wrapper toc-wrapper-loding" style=







    top:50vh;

>
                <div class="toc-catalog">
                    <span class="iconfont-archer catalog-icon">&#xe613;</span><span>CATALOG</span>
                </div>
                <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E-KubeSphere-%E7%8E%A9%E8%BD%AC-k8s-MySQL-%E5%AE%89%E8%A3%85%E6%89%8B%E8%AE%B0"><span class="toc-number">1.</span> <span class="toc-text">基于 KubeSphere 玩转 k8s-MySQL 安装手记</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%9C%AC%E6%96%87%E7%AE%80%E4%BB%8B"><span class="toc-number">1.1.</span> <span class="toc-text">1. 本文简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-MySQL-%E5%AE%89%E8%A3%85%E4%B9%8B%E6%97%85"><span class="toc-number">1.2.</span> <span class="toc-text">2. MySQL 安装之旅</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E5%AF%BB%E6%89%BE%E5%8F%82%E8%80%83%E6%96%87%E6%A1%A3"><span class="toc-number">1.2.1.</span> <span class="toc-text">2.1. 寻找参考文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E5%B0%9D%E8%AF%95%E9%83%A8%E7%BD%B2%E5%8D%95%E8%8A%82%E7%82%B9-MySQL"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.2. 尝试部署单节点 MySQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-MySQL-%E9%85%8D%E7%BD%AE%E8%BF%9B%E9%98%B6"><span class="toc-number">1.2.3.</span> <span class="toc-text">2.3. MySQL 配置进阶</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%8E%9F%E7%94%9F-K8S-%E9%83%A8%E7%BD%B2-MySQL-%E5%AE%9E%E7%8E%B0-GitOps"><span class="toc-number">1.3.</span> <span class="toc-text">3. 原生 K8S 部署 MySQL 实现 GitOps</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E4%BB%80%E4%B9%88%E6%98%AF-GitOps-%E7%BD%91%E6%96%87%E6%91%98%E6%8A%84"><span class="toc-number">1.3.1.</span> <span class="toc-text">3.1. 什么是 GitOps(网文摘抄)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E5%87%86%E5%A4%87-K8S-%E4%B8%8A%E7%9A%84-MySQL-%E8%B5%84%E6%BA%90%E9%85%8D%E7%BD%AE%E6%B8%85%E5%8D%95-%E6%80%9D%E8%B7%AF%E6%A2%B3%E7%90%86"><span class="toc-number">1.3.2.</span> <span class="toc-text">3.2. 准备 K8S 上的 MySQL 资源配置清单-思路梳理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E5%87%86%E5%A4%87-K8S-%E4%B8%8A%E7%9A%84-MySQL-%E8%B5%84%E6%BA%90%E9%85%8D%E7%BD%AE%E6%B8%85%E5%8D%95"><span class="toc-number">1.3.3.</span> <span class="toc-text">3.3. 准备 K8S 上的 MySQL 资源配置清单</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-%E5%B0%86-MySQL-%E8%B5%84%E6%BA%90%E9%85%8D%E7%BD%AE%E6%B8%85%E5%8D%95%E6%8F%90%E4%BA%A4%E5%88%B0-Git-%E4%BB%93%E5%BA%93%E3%80%82"><span class="toc-number">1.3.4.</span> <span class="toc-text">3.4. 将 MySQL 资源配置清单提交到 Git 仓库。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-GitOps-%E5%88%9D%E4%BD%93%E9%AA%8C-%E5%9C%A8-K8S-%E9%9B%86%E7%BE%A4%E4%B8%8A%E9%83%A8%E7%BD%B2-MySQL"><span class="toc-number">1.3.5.</span> <span class="toc-text">3.5. GitOps 初体验-在 K8S 集群上部署 MySQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-%E4%BA%8C%E6%AC%A1%E4%BD%93%E9%AA%8C-GitOps"><span class="toc-number">1.3.6.</span> <span class="toc-text">3.6. 二次体验 GitOps</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7-%E5%86%8D%E6%AC%A1%E4%BD%93%E9%AA%8C-GitOps"><span class="toc-number">1.3.7.</span> <span class="toc-text">3.7.再次体验 GitOps</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B2-MySQL-%E9%A2%84%E7%95%99%E5%8D%A0%E5%9D%91"><span class="toc-number">1.4.</span> <span class="toc-text">4. 高可用部署 MySQL(预留占坑)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E7%9B%AE%E5%89%8D%E7%9A%84%E5%81%9A%E6%B3%95"><span class="toc-number">1.4.1.</span> <span class="toc-text">4.1. 目前的做法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E4%BB%A5%E5%90%8E%E5%8F%AF%E8%83%BD%E7%9A%84%E6%96%B9%E5%90%91"><span class="toc-number">1.4.2.</span> <span class="toc-text">4.2. 以后可能的方向</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E9%81%97%E7%95%99%E9%97%AE%E9%A2%98"><span class="toc-number">1.5.</span> <span class="toc-text">5.  遗留问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-MySQL-%E6%80%A7%E8%83%BD-%E5%9F%BA%E5%87%86-%E6%B5%8B%E8%AF%95"><span class="toc-number">1.6.</span> <span class="toc-text">6. MySQL 性能 (基准) 测试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-%E6%80%A7%E8%83%BD-%E5%9F%BA%E5%87%86-%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85"><span class="toc-number">1.6.1.</span> <span class="toc-text">6.1. 性能 (基准) 测试工具安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-%E6%80%A7%E8%83%BD-%E5%9F%BA%E5%87%86-%E6%B5%8B%E8%AF%95"><span class="toc-number">1.6.2.</span> <span class="toc-text">6.2. 性能 (基准) 测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E6%80%BB%E7%BB%93"><span class="toc-number">1.7.</span> <span class="toc-text">7. 总结</span></a></li></ol></li></ol>
            </div>
        
        <!-- sidebar -->
        <div class="sidebar sidebar-hide">
    <ul class="sidebar-tabs sidebar-tabs-active-0">
        <li class="sidebar-tab-archives"><span class="iconfont-archer">&#xe67d;</span><span class="tab-name">Archive</span></li>
        <li class="sidebar-tab-tags"><span class="iconfont-archer">&#xe61b;</span><span class="tab-name">Tag</span></li>
        <li class="sidebar-tab-categories"><span class="iconfont-archer">&#xe666;</span><span class="tab-name">Cate</span></li>
    </ul>
    <div class="sidebar-content sidebar-content-show-archive">
        <div class="sidebar-panel-archives">
    <!-- 在 ejs 中将 archive 按照时间排序 -->
    
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
    
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
    
    
    
    
    <div class="total-and-search">
        <div class="total-archive">
        Total : 46
        </div>
        <!-- search  -->
        
    </div>
    
    <div class="post-archive">
    
        
            
            
            <div class="archive-year"> 2023 </div>
            <ul class="year-list">
            
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/22</span>
            <a class="archive-post-title" href="/2023/09/22/%E8%BF%90%E7%BB%B4/k8s-prod-practices/Kubernetes%E7%94%9F%E4%BA%A7%E5%AE%9E%E8%B7%B5%E4%B9%8B%E8%B7%AF-%E8%B5%B7%E6%AD%A5%E7%AF%87/">Kubernetes生产实践之路-起步篇</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/22</span>
            <a class="archive-post-title" href="/2023/09/22/JAVA%E5%AD%A6%E4%B9%A0/Activiti7%E5%B7%A5%E4%BD%9C%E6%B5%81/">Activiti7工作流</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/22</span>
            <a class="archive-post-title" href="/2023/09/22/%E8%BF%90%E7%BB%B4/k8s-on-kubesphere/k8s-60%E5%88%86%E9%92%9FRook%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8/">k8s｜60 分钟 Rook 实战入门</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/22</span>
            <a class="archive-post-title" href="/2023/09/22/%E8%BF%90%E7%BB%B4/k8s-on-kubesphere/k8s-KubeSphere3.3%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85%E6%89%8B%E8%AE%B0/">k8s-KubeSphere3.3 离线安装手记</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/22</span>
            <a class="archive-post-title" href="/2023/09/22/JAVA%E5%AD%A6%E4%B9%A0/Canal%E6%9E%81%E7%AE%80%E5%85%A5%E9%97%A8/">Canal极简入门</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/22</span>
            <a class="archive-post-title" href="/2023/09/22/%E8%BF%90%E7%BB%B4/k8s-on-kubesphere/k8s-Nacos%E5%AE%89%E8%A3%85%E6%89%8B%E8%AE%B0/">k8s-Nacos 安装手记</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/22</span>
            <a class="archive-post-title" href="/2023/09/22/JAVA%E5%AD%A6%E4%B9%A0/%E8%8B%A5%E4%BE%9D(ruoyi-cloud)%E8%84%9A%E6%89%8B%E6%9E%B6%E8%A7%A3%E8%AF%BB/">若依(ruoyi-cloud)脚手架解读</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/22</span>
            <a class="archive-post-title" href="/2023/09/22/%E8%BF%90%E7%BB%B4/k8s-on-kubesphere/k8s-Redis%E5%AE%89%E8%A3%85%E6%89%8B%E8%AE%B0/">k8s-Redis 安装手记</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/22</span>
            <a class="archive-post-title" href="/2023/09/22/%E8%BF%90%E7%BB%B4/k8s-on-kubesphere/k8s-Harbor%E5%AE%89%E8%A3%85%E6%89%8B%E8%AE%B0/">k8s-Harbor 安装手记</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/22</span>
            <a class="archive-post-title" href="/2023/09/22/%E8%BF%90%E7%BB%B4/k8s-on-kubesphere/k8s-%E5%A4%96%E9%83%A8Ceph%E9%9B%86%E7%BE%A4%E5%AF%B9%E6%8E%A5%E6%89%8B%E8%AE%B0/">k8s-Ceph 之 Ceph-deploy 安装手记</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/22</span>
            <a class="archive-post-title" href="/2023/09/22/%E8%BF%90%E7%BB%B4/k8s-on-kubesphere/k8s-Ceph%E5%AE%89%E8%A3%85%E6%89%8B%E8%AE%B0/">k8s-Ceph 安装手记</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/22</span>
            <a class="archive-post-title" href="/2023/09/22/%E8%BF%90%E7%BB%B4/k8s-on-kubesphere/k8s-GlusterFS%E6%89%A9%E5%AE%B9%E6%89%8B%E8%AE%B0/">k8s-GlusterFS 扩容手记</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/22</span>
            <a class="archive-post-title" href="/2023/09/22/%E8%BF%90%E7%BB%B4/k8s-on-kubesphere/k8s-MySQL%E5%AE%89%E8%A3%85%E6%89%8B%E8%AE%B0/">k8s-MySQL 安装手记</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/22</span>
            <a class="archive-post-title" href="/2023/09/22/%E8%BF%90%E7%BB%B4/k8s-on-kubesphere/k8s-%E5%BC%80%E5%90%AFetcd%E7%9B%91%E6%8E%A7/">k8s-开启etcd监控</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/22</span>
            <a class="archive-post-title" href="/2023/09/22/%E8%BF%90%E7%BB%B4/k8s-on-kubesphere/k8s-Elasticsearch%E5%AE%89%E8%A3%85%E6%89%8B%E8%AE%B0/">k8s-ElasticSearch 安装手记</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/22</span>
            <a class="archive-post-title" href="/2023/09/22/%E8%BF%90%E7%BB%B4/k8s-on-kubesphere/k8s-GlusterFS%E5%AE%89%E8%A3%85%E6%89%8B%E8%AE%B0/">k8s-GlusterFS安装手记</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/22</span>
            <a class="archive-post-title" href="/2023/09/22/%E8%BF%90%E7%BB%B4/k8s-on-kubesphere/k8s-KubeSphere%E5%88%9D%E5%A7%8B%E5%8C%96%E6%89%8B%E8%AE%B0/">k8s-KubeSphere 初始化手记</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/22</span>
            <a class="archive-post-title" href="/2023/09/22/%E8%BF%90%E7%BB%B4/k8s-on-kubesphere/k8s-KubeSphere%E5%AE%89%E8%A3%85%E6%89%8B%E8%AE%B0/">k8s-KubeSphere 安装手记</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/22</span>
            <a class="archive-post-title" href="/2023/09/22/%E8%BF%90%E7%BB%B4/k8s/Kubernetes%20%E5%AE%89%E8%A3%85%E6%89%8B%E8%AE%B0/">Kubernetes 安装手记</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/22</span>
            <a class="archive-post-title" href="/2023/09/22/JAVA%E5%AD%A6%E4%B9%A0/JWT%E5%AE%9E%E6%88%98%E5%BA%94%E7%94%A8%E4%B8%8E%E9%81%BF%E5%9D%91%E6%8C%87%E5%8D%97/">JWT实战应用与避坑指南</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/22</span>
            <a class="archive-post-title" href="/2023/09/22/JAVA%E5%AD%A6%E4%B9%A0/Spring-boot-starter%E5%90%AF%E5%8A%A8%E5%99%A8%E5%AE%9A%E5%88%B6/">Spring-boot-starter启动器定制</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/19</span>
            <a class="archive-post-title" href="/2023/09/19/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0/%E6%B5%AA%E9%A3%9Eyes%E8%A7%86%E9%A2%91%E6%89%80%E6%9C%89%E8%AF%BE%E4%BB%B6/">浪飞yes视频所有课件</a>
        </li>
    
        
            
            
                
                </ul>
            
            <div class="archive-year"> 2022 </div>
            <ul class="year-list">
            
        
        <li class="archive-post-item">
            <span class="archive-post-date">12/29</span>
            <a class="archive-post-title" href="/2022/12/29/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0/vsftp%E8%99%9A%E6%8B%9F%E7%94%A8%E6%88%B7%E9%85%8D%E7%BD%AE/">vsftp虚拟用户配置</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/29</span>
            <a class="archive-post-title" href="/2022/09/29/writeup/%E5%AE%89%E6%81%928%E6%9C%88%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94%E9%A2%98%E7%9B%AE%E5%9B%9E%E9%A1%BE/">安恒8月应急响应题目回顾</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/17</span>
            <a class="archive-post-title" href="/2022/09/17/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0/%E5%9C%A8%E7%BA%BF%E8%A1%A8%E5%8D%95%E6%94%B6%E9%9B%86%E7%B3%BB%E7%BB%9FTduck%EF%BC%88docker%E7%AF%87%EF%BC%89/">在线表单收集系统Tduck（docker篇）</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/10</span>
            <a class="archive-post-title" href="/2022/09/10/writeup/2022%E9%B9%8F%E5%9F%8E%E6%9D%AFweb/">2022鹏城杯web</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/09</span>
            <a class="archive-post-title" href="/2022/09/09/WEB/Burp%20Collaborator-%E5%B8%A6%E5%A4%96%E6%8A%80%E6%9C%AF%E5%B7%A5%E5%85%B7/">Burp Collaborator-带外技术工具</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/09</span>
            <a class="archive-post-title" href="/2022/09/09/writeup/%E8%AE%B08%E6%9C%88%E6%9F%90%E6%AC%A1AWD/">记8月某次AWD</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/09</span>
            <a class="archive-post-title" href="/2022/09/09/WEB/PHP%E4%BC%AA%E5%8D%8F%E8%AE%AE%E5%B0%8F%E6%80%BB%E7%BB%93/">PHP伪协议小总结</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/09</span>
            <a class="archive-post-title" href="/2022/09/09/%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2/CTF%E4%B8%AD%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2/">CTF中的信息泄露</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/09</span>
            <a class="archive-post-title" href="/2022/09/09/ctf%E7%BA%BF%E4%B8%8BAWD%E6%94%BB%E9%98%B2%E8%B5%9B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/CTF%E7%BA%BF%E4%B8%8B%E9%98%B2%E5%BE%A1%E6%88%98%20%E2%80%94%20%E8%AE%A9%E4%BD%A0%E7%9A%84%E9%9D%B6%E6%9C%BA%E5%8F%98%E6%88%90%E2%80%9C%E9%93%9C%E5%A2%99%E9%93%81%E5%A3%81%E2%80%9D/">CTF线下防御战 — 让你的靶机变成“铜墙铁壁”</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/09</span>
            <a class="archive-post-title" href="/2022/09/09/ctf%E7%BA%BF%E4%B8%8BAWD%E6%94%BB%E9%98%B2%E8%B5%9B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/CTF%E7%BA%BF%E4%B8%8BAWD%E6%94%BB%E9%98%B2%E6%AD%A5%E9%AA%A4%E6%80%BB%E7%BB%93/">CTF线下AWD攻防步骤总结</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/09</span>
            <a class="archive-post-title" href="/2022/09/09/ctf%E7%BA%BF%E4%B8%8BAWD%E6%94%BB%E9%98%B2%E8%B5%9B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/CTF%E7%BA%BF%E4%B8%8BAWD%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">CTF AWD模式下简单的CMS代码审计</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">09/07</span>
            <a class="archive-post-title" href="/2022/09/07/ctf%E7%BA%BF%E4%B8%8BAWD%E6%94%BB%E9%98%B2%E8%B5%9B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/ctf%E7%BA%BF%E4%B8%8BAWD%E6%94%BB%E9%98%B2%E8%B5%9B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">ctf线下AWD攻防赛学习笔记</a>
        </li>
    
        
        <li class="archive-post-item">
            <span class="archive-post-date">08/07</span>
            <a class="archive-post-title" href="/2022/08/07/hello-world/">Hello World</a>
        </li>
    
        
            
            
                
                </ul>
            
            <div class="archive-year"> Invalid date </div>
            <ul class="year-list">
            
        
        <li class="archive-post-item">
            <span class="archive-post-date">Invalid date</span>
            <a class="archive-post-title" href="/2022/09/09/WEB/%E5%89%8D%E5%8F%B0%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/">前台反序列化代码审计</a>
        </li>
    
        
            
            
                
                </ul>
            
            <div class="archive-year"> Invalid date </div>
            <ul class="year-list">
            
        
        <li class="archive-post-item">
            <span class="archive-post-date">Invalid date</span>
            <a class="archive-post-title" href="/2022/09/10/writeup/2021%20CISCN%20%E5%86%B3%E8%B5%9B%E6%9D%82%E8%AE%B0/">2021 CISCN 决赛杂记</a>
        </li>
    
        
            
            
                
                </ul>
            
            <div class="archive-year"> Invalid date </div>
            <ul class="year-list">
            
        
        <li class="archive-post-item">
            <span class="archive-post-date">Invalid date</span>
            <a class="archive-post-title" href="/2022/09/09/writeup/%5BBalsn%20CTF%202022%5D2linenodejs/">Balsn CTF 2022 inenodejs</a>
        </li>
    
        
            
            
                
                </ul>
            
            <div class="archive-year"> Invalid date </div>
            <ul class="year-list">
            
        
        <li class="archive-post-item">
            <span class="archive-post-date">Invalid date</span>
            <a class="archive-post-title" href="/2022/11/29/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0/JDK%208u351%E5%AE%89%E8%A3%85/">JAVA JDK 8安装</a>
        </li>
    
        
            
            
                
                </ul>
            
            <div class="archive-year"> 2022 </div>
            <ul class="year-list">
            
        
        <li class="archive-post-item">
            <span class="archive-post-date">08/07</span>
            <a class="archive-post-title" href="/2022/08/07/hexo%E6%8F%90%E7%A4%BAcommand%20not%20found%E8%A7%A3%E5%86%B3/">hexo提示command not found解决</a>
        </li>
    
        
            
            
                
                </ul>
            
            <div class="archive-year"> Invalid date </div>
            <ul class="year-list">
            
        
        <li class="archive-post-item">
            <span class="archive-post-date">Invalid date</span>
            <a class="archive-post-title" href="/2023/09/22/JAVA%E5%AD%A6%E4%B9%A0/Activiti%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%93%E6%9E%84/">Activiti数据库结构</a>
        </li>
    
        
            
            
                
                </ul>
            
            <div class="archive-year"> Invalid date </div>
            <ul class="year-list">
            
        
        <li class="archive-post-item">
            <span class="archive-post-date">Invalid date</span>
            <a class="archive-post-title" href="/2023/09/22/JAVA%E5%AD%A6%E4%B9%A0/%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E4%B8%8ESeata%E8%90%BD%E5%9C%B0/">分布式事务与Seata落地</a>
        </li>
    
        
            
            
                
                </ul>
            
            <div class="archive-year"> Invalid date </div>
            <ul class="year-list">
            
        
        <li class="archive-post-item">
            <span class="archive-post-date">Invalid date</span>
            <a class="archive-post-title" href="/2023/09/22/%E8%BF%90%E7%BB%B4/z-notes-%E6%A8%A1%E6%9D%BF/">z-notes-模板</a>
        </li>
    
        
            
            
                
                </ul>
            
            <div class="archive-year"> Invalid date </div>
            <ul class="year-list">
            
        
        <li class="archive-post-item">
            <span class="archive-post-date">Invalid date</span>
            <a class="archive-post-title" href="/2023/09/22/%E8%BF%90%E7%BB%B4/k8s-prod-practices/SpingCloud%E4%B8%9A%E5%8A%A1%E6%A8%A1%E5%9D%97%E7%9A%84DevOps%E5%AE%9E%E6%88%98/">DevOps 系统</a>
        </li>
    
        
            
            
                
                </ul>
            
            <div class="archive-year"> Invalid date </div>
            <ul class="year-list">
            
        
        <li class="archive-post-item">
            <span class="archive-post-date">Invalid date</span>
            <a class="archive-post-title" href="/2023/09/22/%E8%BF%90%E7%BB%B4/k8s-prod-practices/SpingCloud%E6%9E%B6%E6%9E%84%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/">SpingCloud架构中间件的安装部署</a>
        </li>
    
        
            
            
                
                </ul>
            
            <div class="archive-year"> Invalid date </div>
            <ul class="year-list">
            
        
        <li class="archive-post-item">
            <span class="archive-post-date">Invalid date</span>
            <a class="archive-post-title" href="/2023/09/22/%E8%BF%90%E7%BB%B4/k8s-prod-practices/%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8%E4%B9%8BGlusterFS/">持久化存储之GlusterFS</a>
        </li>
    
    </div>
</div>

        <div class="sidebar-panel-tags">
    <div class="sidebar-tags-name">
        
            <span class="sidebar-tag-name" data-tags="intro">
                <span class="iconfont-archer">&#xe606;</span>
                intro
            </span>
        
            <span class="sidebar-tag-name" data-tags="CTF">
                <span class="iconfont-archer">&#xe606;</span>
                CTF
            </span>
        
            <span class="sidebar-tag-name" data-tags="AWD">
                <span class="iconfont-archer">&#xe606;</span>
                AWD
            </span>
        
            <span class="sidebar-tag-name" data-tags="攻防">
                <span class="iconfont-archer">&#xe606;</span>
                攻防
            </span>
        
            <span class="sidebar-tag-name" data-tags="信息泄露">
                <span class="iconfont-archer">&#xe606;</span>
                信息泄露
            </span>
        
            <span class="sidebar-tag-name" data-tags="web">
                <span class="iconfont-archer">&#xe606;</span>
                web
            </span>
        
            <span class="sidebar-tag-name" data-tags="lfi">
                <span class="iconfont-archer">&#xe606;</span>
                lfi
            </span>
        
            <span class="sidebar-tag-name" data-tags="burpsuite">
                <span class="iconfont-archer">&#xe606;</span>
                burpsuite
            </span>
        
            <span class="sidebar-tag-name" data-tags="java反序列化">
                <span class="iconfont-archer">&#xe606;</span>
                java反序列化
            </span>
        
            <span class="sidebar-tag-name" data-tags="代码审计">
                <span class="iconfont-archer">&#xe606;</span>
                代码审计
            </span>
        
            <span class="sidebar-tag-name" data-tags="PHP反序列化">
                <span class="iconfont-archer">&#xe606;</span>
                PHP反序列化
            </span>
        
            <span class="sidebar-tag-name" data-tags="WEB">
                <span class="iconfont-archer">&#xe606;</span>
                WEB
            </span>
        
            <span class="sidebar-tag-name" data-tags="RCE">
                <span class="iconfont-archer">&#xe606;</span>
                RCE
            </span>
        
            <span class="sidebar-tag-name" data-tags="tduck">
                <span class="iconfont-archer">&#xe606;</span>
                tduck
            </span>
        
            <span class="sidebar-tag-name" data-tags="docker">
                <span class="iconfont-archer">&#xe606;</span>
                docker
            </span>
        
            <span class="sidebar-tag-name" data-tags="java">
                <span class="iconfont-archer">&#xe606;</span>
                java
            </span>
        
            <span class="sidebar-tag-name" data-tags="nodejs">
                <span class="iconfont-archer">&#xe606;</span>
                nodejs
            </span>
        
            <span class="sidebar-tag-name" data-tags="JDK">
                <span class="iconfont-archer">&#xe606;</span>
                JDK
            </span>
        
            <span class="sidebar-tag-name" data-tags="流量分析">
                <span class="iconfont-archer">&#xe606;</span>
                流量分析
            </span>
        
            <span class="sidebar-tag-name" data-tags="wireshark">
                <span class="iconfont-archer">&#xe606;</span>
                wireshark
            </span>
        
            <span class="sidebar-tag-name" data-tags="FTP">
                <span class="iconfont-archer">&#xe606;</span>
                FTP
            </span>
        
            <span class="sidebar-tag-name" data-tags="springboot">
                <span class="iconfont-archer">&#xe606;</span>
                springboot
            </span>
        
            <span class="sidebar-tag-name" data-tags="k8s">
                <span class="iconfont-archer">&#xe606;</span>
                k8s
            </span>
        
            <span class="sidebar-tag-name" data-tags="kubesphere">
                <span class="iconfont-archer">&#xe606;</span>
                kubesphere
            </span>
        
    </div>
    <div class="iconfont-archer sidebar-tags-empty">&#xe678;</div>
    <div class="tag-load-fail" style="display: none; color: #ccc; font-size: 0.6rem;">
        缺失模块，请参考主题文档进行安装配置：https://github.com/fi3ework/hexo-theme-archer#%E5%AE%89%E8%A3%85%E4%B8%BB%E9%A2%98
    </div> 
    <div class="sidebar-tags-list"></div>
</div>

        <div class="sidebar-panel-categories">
    <div class="sidebar-categories-name">
    
        <span class="sidebar-category-name" data-categories="WEB">
            <span class="iconfont-archer">&#xe60a;</span>
            WEB
        </span>
    
        <span class="sidebar-category-name" data-categories="AWD">
            <span class="iconfont-archer">&#xe60a;</span>
            AWD
        </span>
    
        <span class="sidebar-category-name" data-categories="writeup">
            <span class="iconfont-archer">&#xe60a;</span>
            writeup
        </span>
    
        <span class="sidebar-category-name" data-categories="信息泄露">
            <span class="iconfont-archer">&#xe60a;</span>
            信息泄露
        </span>
    
        <span class="sidebar-category-name" data-categories="code">
            <span class="iconfont-archer">&#xe60a;</span>
            code
        </span>
    
        <span class="sidebar-category-name" data-categories="java">
            <span class="iconfont-archer">&#xe60a;</span>
            java
        </span>
    
        <span class="sidebar-category-name" data-categories="运维">
            <span class="iconfont-archer">&#xe60a;</span>
            运维
        </span>
    
    </div>
    <div class="iconfont-archer sidebar-categories-empty">&#xe678;</div>
    <div class="sidebar-categories-list"></div>
</div>

    </div>
</div>

        <!-- site-meta -->
        <script>
    var siteMetaRoot = "/"
    if (siteMetaRoot === "undefined") {
        siteMetaRoot = '/'
    }
    var siteMeta = {
        url: "https://lhhxs.github.io",
        root: siteMetaRoot,
        author: "Arcticsea"
    }
</script>

        <!-- import experimental options here -->
        <!-- Custom Font -->


        <!-- main func -->
        <script src="/scripts/main.js?v=20211217"></script>
        <!-- dark mode -->
        <script src="/scripts/dark.js?v=20211217"></script>
        <!-- fancybox -->
        <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" defer></script>
        <!-- algolia -->
        
        <!-- busuanzi -->
        
            <script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>
        
        <!-- CNZZ -->
        
        <!-- async load share.js -->
        
            <script src="/scripts/share.js?v=20211217" async></script>
        
        <!-- mermaid -->
        
            <script src='https://cdn.jsdelivr.net/npm/mermaid@8.11.0/dist/mermaid.min.js'></script>
            <script>
                if (window.mermaid) {
                    mermaid.initialize({theme: 'dark'});
                }
            </script>
        
    </body>
</html>
